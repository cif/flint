<!DOCTYPE html>  <html> <head>   <title>helpers.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="calendar.html">                 calendar.coffee               </a>                                           <a class="source" href="collection.html">                 collection.coffee               </a>                                           <a class="source" href="controller.html">                 controller.coffee               </a>                                           <a class="source" href="form.html">                 form.coffee               </a>                                           <a class="source" href="helpers.html">                 helpers.coffee               </a>                                           <a class="source" href="list.html">                 list.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="notifications.html">                 notifications.coffee               </a>                                           <a class="source" href="sync.html">                 sync.coffee               </a>                                           <a class="source" href="view.html">                 view.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               helpers.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Helpers</span>
  
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>register class methods with handlebars</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;eq&#39;</span><span class="p">,</span> <span class="nx">@eq</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;check_role&#39;</span><span class="p">,</span> <span class="nx">@check_role</span>
          
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="nx">@link</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;link_nohref&#39;</span><span class="p">,</span> <span class="nx">@link_nohref</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;list&#39;</span><span class="p">,</span> <span class="nx">@list</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;filtered_list&#39;</span><span class="p">,</span> <span class="nx">@filtered_list</span>
      
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="nx">@input</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;text_field&#39;</span><span class="p">,</span> <span class="nx">@text_field</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="nx">@password</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;select&#39;</span><span class="p">,</span> <span class="nx">@select</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;select_range&#39;</span><span class="p">,</span> <span class="nx">@select_range</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;radio&#39;</span><span class="p">,</span> <span class="nx">@radio</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;checkbox&#39;</span><span class="p">,</span> <span class="nx">@checkbox</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;text_area&#39;</span><span class="p">,</span> <span class="nx">@text_area</span>
    
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;month_grid&#39;</span><span class="p">,</span> <span class="nx">@month_grid</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;date_today&#39;</span><span class="p">,</span> <span class="nx">@date_today</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;sql_to_slash&#39;</span><span class="p">,</span> <span class="nx">@sql_to_slash</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;date_format&#39;</span><span class="p">,</span> <span class="nx">@date_format</span>   <span class="c1"># requires momentjs lib</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;twenty_four_to_twelve&#39;</span><span class="p">,</span> <span class="nx">@twenty_four_to_twelve</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;dollar&#39;</span><span class="p">,</span> <span class="nx">@dollar</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;random&#39;</span><span class="p">,</span> <span class="nx">@random</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;sum&#39;</span><span class="p">,</span> <span class="nx">@sum</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;truncate&#39;</span><span class="p">,</span> <span class="nx">@truncate</span>
    <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span> <span class="s">&#39;repeater&#39;</span><span class="p">,</span> <span class="nx">@repeater</span>
    
    <span class="nx">@initialize</span><span class="p">()</span>
    
    <span class="k">this</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>overriden by super, usually.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">=&gt;</span>
      
  <span class="nv">delay: </span><span class="p">(</span><span class="nx">ms</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="vi">@timer = </span><span class="nx">setTimeout</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">ms</span>
    <span class="nx">@timer</span>
    
  <span class="nv">loader: </span><span class="nf">(selector) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s">&#39;&lt;p class=&quot;loader&quot;&gt;&lt;em class=&quot;one&quot;&gt;&amp;nbsp;&lt;/em&gt;&lt;em class=&quot;two&quot;&gt;&amp;nbsp;&lt;/em&gt;&lt;em class=&quot;three&quot;&gt;&amp;nbsp;&lt;/em&gt;&lt;em class=&quot;four&quot;&gt;&amp;nbsp;&lt;/em&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.loader&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">})</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
              
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><strong><em>_</em><em>_</em><em></strong> view helpers registered with handlebars <strong></em><em>_</em><em>_</em></strong>  </p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">eq: </span><span class="nf">(value, test, options) -&gt;</span>
    <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">test</span>
      <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">inverse</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  
  <span class="nv">check_role: </span><span class="nf">(user_or_role, required_roles, options) -&gt;</span>
    <span class="nv">role = </span><span class="k">if</span> <span class="nx">user_or_role</span><span class="p">.</span><span class="nx">get</span> <span class="k">then</span> <span class="nx">user_or_role</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;role&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nx">user_or_role</span>
    <span class="nv">has_role = </span><span class="nx">required_roles</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">role</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nx">has_role</span>
      <span class="k">if</span> <span class="nx">options</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">options</span>
        <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">inverse</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>form helpers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">link: </span><span class="nf">(href, text, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">href</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s">&#39;&lt;/a&gt;&#39;</span><span class="p">)</span>
    
  <span class="nv">link_nohref: </span><span class="nf">(text, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;javascript:void(0)&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s">&#39;&lt;/a&gt;&#39;</span><span class="p">)</span>
  
  <span class="nv">list: </span><span class="nf">(context, zero_length_message, block) -&gt;</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nf">(model) -&gt;</span>
      <span class="nv">context = </span><span class="k">if</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span> <span class="k">then</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span> <span class="k">else</span> <span class="nx">model</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">(</span><span class="nx">context</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="nv">out = </span><span class="k">if</span> <span class="nx">out</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">out</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nx">zero_length_message</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> 
  
  <span class="nv">filtered_list: </span><span class="nf">(context, filter, value, zero_length_message, block) -&gt;</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="nv">values = </span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nf">(model) -&gt;</span>
      <span class="nv">val = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
      <span class="nv">pass = </span><span class="kc">false</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nf">(test) -&gt;</span>
          <span class="k">if</span> <span class="nx">val</span> <span class="o">is</span> <span class="nx">test</span>
            <span class="nv">pass = </span><span class="kc">true</span>
      <span class="p">)</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">))</span> <span class="k">if</span> <span class="nx">pass</span>
    <span class="p">)</span>
    <span class="nv">out = </span><span class="k">if</span> <span class="nx">out</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">out</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nx">zero_length_message</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> 
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><strong><em>_</em><em>_</em><em></strong> form field helpers <strong></em><em>_</em><em>_</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">text_field: </span><span class="nf">(model, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nv">value = </span><span class="k">if</span> <span class="nx">model</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">then</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;input type=&quot;text&quot; name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; value=&quot;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&gt;&#39;</span><span class="p">)</span>
    
  <span class="nv">input: </span><span class="nf">(model, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nv">value = </span><span class="k">if</span> <span class="nx">model</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">then</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;input name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; value=&quot;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&gt;&#39;</span><span class="p">)</span>
  
  <span class="nv">password: </span><span class="nf">(model, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nv">password = </span><span class="s">&#39;&lt;input type=&quot;password&quot; name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; value=&quot;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&gt;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span>
    
  <span class="nv">select: </span><span class="nf">(model, field, options, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>

    <span class="nv">selected = </span><span class="k">if</span> <span class="nx">model</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">then</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">else</span> <span class="kc">false</span>
    <span class="nv">opts = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nf">(option) -&gt;</span> 
      <span class="nv">value = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="k">then</span> <span class="nx">option</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">else</span> <span class="nx">option</span>
      <span class="nv">text = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="k">then</span> <span class="nx">option</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nx">option</span>
      <span class="nv">optstr = </span><span class="s">&#39;&lt;option &#39;</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">selected</span>
        <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39;selected &#39;</span>
      <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39;value=&quot;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s">&#39;&lt;/option&gt;&#39;</span>  
      <span class="nx">opts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">optstr</span><span class="p">)</span>  
    <span class="p">)</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;select name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/select&gt;&#39;</span><span class="p">)</span>
  
  <span class="nv">select_range: </span><span class="nf">(model, min, max, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    
    <span class="nv">selected = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
    <span class="nv">opts = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="p">[</span><span class="nx">min</span><span class="p">...</span><span class="nx">max</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">optstr = </span><span class="s">&#39;&lt;option &#39;</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">selected</span>
        <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39;selected &#39;</span>
      <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39;value=&quot;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&lt;/option&gt;&#39;</span>  
      <span class="nx">opts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">optstr</span><span class="p">)</span>  
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;select name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/select&gt;&#39;</span><span class="p">)</span>
          
  <span class="nv">radio_group: </span><span class="nf">(model, field, options) -&gt;</span>  
    <span class="nv">selected = </span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
    <span class="nv">opts = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nf">(option) -&gt;</span> 
      <span class="nv">value = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="k">then</span> <span class="nx">option</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">else</span> <span class="nx">option</span>
      <span class="nv">text = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="k">then</span> <span class="nx">option</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nx">option</span>
      <span class="nv">optstr = </span><span class="s">&#39;&lt;p class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; value=&quot;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="o">is</span> <span class="nx">selected</span>
        <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39; checked=&quot;true&quot;&#39;</span>
      <span class="nx">optstr</span> <span class="o">+=</span> <span class="s">&#39; /&gt;&lt;label&gt;&#39;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s">&#39;&lt;/label&gt;&lt;/p&gt;&#39;</span>  
      <span class="nx">opts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">optstr</span><span class="p">)</span>  
    <span class="p">)</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;div class=&quot;radios&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&lt;/div&gt;&#39;</span><span class="p">)</span>
  
  <span class="nv">checkbox: </span><span class="nf">(model, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nv">checked = </span><span class="k">if</span> <span class="nx">model</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;checked=&quot;true&quot; &#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;input type=&quot;checkbox&quot; name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; value=&quot;1&quot; &#39;</span> <span class="o">+</span> <span class="nx">checked</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&gt;&#39;</span><span class="p">)</span>
  
  <span class="nv">text_area: </span><span class="nf">(model, field, attributes) -&gt;</span>
    <span class="nv">attrs = </span><span class="p">[]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nf">(value, key) -&gt;</span> 
      <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span> <span class="o">+</span> <span class="s">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nv">value = </span><span class="k">if</span> <span class="nx">model</span> <span class="o">and</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span> <span class="k">then</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="s">&#39;&lt;textarea name=&quot;&#39;</span><span class="o">+</span><span class="nx">field</span><span class="o">+</span><span class="s">&#39;&quot; &#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s">&#39;&lt;/textarea&gt;&#39;</span><span class="p">)</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong><em>_</em><em>_</em><em></strong> cookie function <strong></em><em>_</em><em>_</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  
 
	  

    
    </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong><em>_</em><em>_</em><em></strong> date helpers <strong></em><em>_</em><em>_</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">month_grid: </span><span class="nf">(month, year) -&gt;</span>
        
    <span class="nv">days_in_month = </span><span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
    <span class="nv">length = </span><span class="nx">days_in_month</span><span class="p">[</span><span class="nx">month</span><span class="p">]</span>
    <span class="nv">starts = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nx">getDay</span><span class="p">()</span>
      </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>leap year</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">month</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="nv">length = </span><span class="mi">29</span> <span class="nx">unless</span> <span class="p">(</span><span class="nx">year</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">year</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">is</span> <span class="o">not</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="nx">year</span> <span class="o">%</span> <span class="mi">400</span> <span class="o">is</span> <span class="mi">0</span>
      
    <span class="nv">html = </span><span class="s">&#39;&#39;</span>
    <span class="nv">index = </span><span class="mi">1</span> <span class="o">-</span> <span class="nx">starts</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">5</span><span class="p">]</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="s">&#39;&lt;tr&gt;&#39;</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="mi">6</span><span class="p">]</span>
        
        <span class="nv">date = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
        <span class="nv">day = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>
        <span class="nv">_month = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span>
        <span class="nv">_year = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
        <span class="nv">off_month = </span><span class="k">if</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">index</span> <span class="o">&gt;</span> <span class="nx">length</span> <span class="k">then</span> <span class="s">&#39; off-month&#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
        <span class="nv">id_day = </span><span class="k">if</span> <span class="nx">day</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">then</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">day</span> <span class="k">else</span> <span class="nx">day</span> 
        <span class="nv">id_month = </span><span class="k">if</span> <span class="p">(</span><span class="nx">_month</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">then</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">_month</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nx">_month</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
        <span class="nx">html</span> <span class="o">+=</span> <span class="s">&#39;&lt;td data-dow=&quot;&#39;</span><span class="o">+</span><span class="nx">j</span><span class="o">+</span><span class="s">&#39;&quot; class=&quot;day dow&#39;</span><span class="o">+</span><span class="nx">j</span><span class="o">+</span><span class="nx">off_month</span><span class="o">+</span><span class="s">&#39;&quot; data-sql=&quot;&#39;</span><span class="o">+</span><span class="nx">_year</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="nx">id_month</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="nx">id_day</span><span class="o">+</span><span class="s">&#39;&quot;&gt;&#39;</span>
        
        <span class="nv">out = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>  
        <span class="nx">html</span> <span class="o">+=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;&lt;/td&gt;&#39;</span>
        <span class="nx">index</span><span class="o">++</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;&#39;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;&lt;/table&gt;&#39;</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
    
  
  <span class="nv">date_today: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getDate</span><span class="p">()</span>
  
  <span class="nv">twenty_four_to_twelve: </span><span class="nf">(time) -&gt;</span>
    <span class="nv">parts = </span><span class="nx">time</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="nv">hr = </span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">hr</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;0&#39;</span>
      <span class="nv">hr = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hr</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="nv">min = </span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nv">mer = </span><span class="s">&#39;am&#39;</span>
    <span class="k">if</span> <span class="nx">hr</span> <span class="o">&gt;=</span> <span class="mi">12</span>
      <span class="nv">mer = </span><span class="s">&#39;pm&#39;</span>
      <span class="k">if</span> <span class="nx">hr</span> <span class="o">&gt;</span> <span class="mi">12</span>
        <span class="nx">hr</span> <span class="o">-=</span> <span class="mi">12</span>
    <span class="nx">hr</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">min</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nx">mer</span>
    
  <span class="nv">jsdate_to_sql: </span><span class="nf">(date) -&gt;</span>
    <span class="nv">month = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
    <span class="nv">day = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">month</span> <span class="o">&lt;</span> <span class="mi">10</span>
      <span class="nv">month = </span><span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">month</span>
    <span class="k">if</span> <span class="nx">day</span> <span class="o">&lt;</span> <span class="mi">10</span>
      <span class="nv">day = </span><span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">day</span> 
      
    <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">month</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">day</span>
    
  <span class="nv">sqldate_to_js: </span><span class="nf">(sql) -&gt;</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">sql</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="nv">sp = </span><span class="nx">sql</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">or</span> <span class="o">!</span><span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  
  <span class="nv">date_format: </span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="nx">format</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">date</span> <span class="o">or</span> <span class="nx">date</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="o">or</span> <span class="nx">date</span> <span class="o">is</span> <span class="s">&#39;0000-00-00&#39;</span> <span class="o">or</span> <span class="nx">date</span> <span class="o">is</span> <span class="s">&#39;0000-00-00 00:00:00&#39;</span>
      <span class="k">return</span> <span class="s">&#39;N/A&#39;</span>
    <span class="nx">moment</span><span class="p">(</span><span class="nx">date</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="nx">format</span><span class="p">)</span>
  
  <span class="nv">sql_to_slash: </span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">sql</span> <span class="o">or</span> <span class="nx">sql</span> <span class="o">is</span> <span class="s">&#39;0000-00-00&#39;</span> <span class="o">or</span> <span class="nx">sql</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> 
      <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">sql</span>  
    <span class="nv">js = </span><span class="nx">@sqldate_to_js</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">js</span>
      <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="nv">m = </span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">d = </span><span class="nx">js</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">js</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
    <span class="nx">m</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">d</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">y</span>
    
  <span class="nv">js_to_slash: </span><span class="p">(</span><span class="nx">js</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nv">m = </span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">d = </span><span class="nx">js</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>
    <span class="nv">y = </span><span class="nx">js</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
    <span class="nx">m</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">d</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">y</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><strong><em>_</em><em>_</em><em></strong> miscelaneous formatting helpers <strong></em><em>_</em><em>_</em></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  
  <span class="nv">dollar: </span><span class="nf">(n, decimals = 2, decimal_separator = &quot;.&quot;, thousands_separator = &quot;,&quot;, show_decimals=true) -&gt;</span>
    <span class="nv">c = </span><span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">decimals</span><span class="p">)</span> <span class="k">then</span> <span class="mi">2</span> <span class="k">else</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">decimals</span>
    <span class="nv">sign = </span><span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&quot;-&quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
    <span class="nv">i = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nv">n = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;&#39;</span>
    <span class="nv">j = </span><span class="k">if</span> <span class="p">(</span><span class="nv">j = </span><span class="nx">i</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">then</span> <span class="nx">j</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="nv">x = </span><span class="k">if</span> <span class="nx">j</span> <span class="k">then</span> <span class="nx">i</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="p">)</span> <span class="o">+</span> <span class="nx">thousands_separator</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="nv">y = </span><span class="nx">i</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">j</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\d{3})(?=\d)/g</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span> <span class="o">+</span> <span class="nx">thousands_separator</span><span class="p">)</span>
    <span class="nv">z = </span><span class="k">if</span> <span class="nx">c</span> <span class="o">and</span> <span class="nx">show_decimals</span> <span class="k">then</span> <span class="nx">decimal_separator</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">i</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="nx">sign</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span>
  
  <span class="nv">repeater: </span><span class="nf">(x, y, block) -&gt;</span>
    <span class="nv">min = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="nv">max = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nv">out = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">num</span> <span class="k">in</span> <span class="p">[</span><span class="nx">min</span><span class="p">...</span><span class="nx">max</span><span class="p">]</span>
      <span class="k">this</span><span class="p">.</span><span class="nv">num = </span><span class="nx">num</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">push</span> <span class="nx">block</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">new</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">SafeString</span><span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>
  
  <span class="nv">sum: </span><span class="o">-&gt;</span>
    <span class="nv">sum = </span><span class="mi">0</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">arguments</span><span class="p">,</span> <span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">sum</span> <span class="o">+=</span> <span class="nb">parseFloat</span> <span class="nx">arg</span>
    <span class="nx">sum</span>  
  
  <span class="nv">truncate: </span><span class="nf">(str, length) -&gt;</span>
    <span class="k">if</span> <span class="nx">str</span> <span class="o">and</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">length</span>
      <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">str</span>
  
  <span class="nv">random: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span>
  

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 