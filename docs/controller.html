<!DOCTYPE html>  <html> <head>   <title>controller.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="calendar.html">                 calendar.coffee               </a>                                           <a class="source" href="controller.html">                 controller.coffee               </a>                                           <a class="source" href="form.html">                 form.coffee               </a>                                           <a class="source" href="helpers.html">                 helpers.coffee               </a>                                           <a class="source" href="list.html">                 list.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="notifications.html">                 notifications.coffee               </a>                                           <a class="source" href="sync.html">                 sync.coffee               </a>                                           <a class="source" href="view.html">                 view.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               controller.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Flint.Controller - extends Backbone.Router</p>

<ul>
<li><p>Binds / unbinds common events</p></li>
<li><p>Pushes changes to Flint.Sync / Backbone.Models</p></li>
<li><p>Calls @app.notifications methods with templated messages</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Controller</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Specify a template path for each CRUD action. 
There is also an optional help_template property</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">template_create : </span><span class="s">&#39;forms/create&#39;</span>
  <span class="nv">template_edit   : </span><span class="s">&#39;forms/edit&#39;</span>
  <span class="nv">template_view   : </span><span class="s">&#39;forms/view&#39;</span>
  <span class="nv">template_list   : </span><span class="s">&#39;forms/list&#39;</span>  
  <span class="nv">template_help   : </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Specify the collection and model classes if the exist.
Note that these are strings and not references to the classes themselves.    </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collection      : </span><span class="kc">false</span>
  <span class="nv">model           : </span><span class="kc">false</span>  
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Specify the list class and list element, by default Flint.List will be sued.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">list            : </span><span class="s">&#39;List&#39;</span>
  <span class="nv">list_el         : </span><span class="s">&#39;#app&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>If the list is sortable, a simple boolean flag and sorted_url attribute will take care of everything for you</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sortable        : </span><span class="kc">false</span>  
  <span class="nv">sorted_url      : </span><span class="kc">false</span>
  <span class="nv">sort_handle     : </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Speficy the form class and element, by default Flint.Form will be used</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">form            : </span><span class="s">&#39;Form&#39;</span>
  <span class="nv">form_el         : </span><span class="s">&#39;#app&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Determines whether or not validation will be called as the model is changed by the UI.
This uses silent: true when setting changed attributes on the model. See Flint.Form docs for more.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">valid_changes   : </span><span class="kc">true</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Default messages. If you want to display more verbose messages you can override these. <br />
Note that handlebars syntax is used by default.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_messages:</span>
    <span class="nv">created        : </span><span class="s">&#39;{{name}} has been created.&#39;</span>
    <span class="nv">saved          : </span><span class="s">&#39;Changes to {{name}} have been saved.&#39;</span> 
    <span class="nv">delete_warn    : </span><span class="s">&#39;You are about to delete {{name}}, proceed?&#39;</span>
    <span class="nv">navigate_warn  : </span><span class="s">&#39;Did you want to save the changes you just made?&#39;</span>
    <span class="nv">sorted         : </span><span class="s">&#39;You have changed the sort order.&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Backbone calls this method, sort of a psudo constructor if you will.      </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="nf">(app) -&gt;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Extend any messages that were overriden by the subclass</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@messages = </span><span class="p">{}</span> <span class="nx">unless</span> <span class="nx">@messages</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">@_messages</span><span class="p">,</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">@messages</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
        <span class="nx">@messages</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Instantiate @list as the specified class or Flint.List      </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">list = </span><span class="k">if</span> <span class="nx">views</span><span class="p">[</span><span class="nx">@list</span><span class="p">]</span> <span class="k">then</span> <span class="nx">views</span><span class="p">[</span><span class="nx">@list</span><span class="p">]</span> <span class="k">else</span> <span class="nx">Flint</span><span class="p">[</span><span class="nx">@list</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">list</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&#39;List class &quot;&#39;</span><span class="o">+</span><span class="nx">@list</span><span class="o">+</span><span class="s">&#39;&quot; does not exists&#39;</span><span class="p">)</span> 
    </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Configure @list              </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list = </span><span class="k">new</span> <span class="nx">list</span> <span class="p">{</span> <span class="nv">el: </span><span class="nx">@list_el</span> <span class="p">},</span> <span class="nx">@sortable</span>
    <span class="vi">@list.sort_handle = </span><span class="nx">@sort_handle</span>
    <span class="vi">@list.template = </span><span class="nx">@template_list</span>    
    <span class="vi">@list.template_help = </span><span class="nx">@template_help</span> <span class="k">if</span> <span class="nx">@template_help</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Assign a collection to the list. In Flint, @list works with the collection, not so much the controller</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@list.collection = </span><span class="k">if</span> <span class="nx">@collection</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">collections</span><span class="p">[</span><span class="nx">@collection</span><span class="p">]</span> <span class="k">else</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span>
    <span class="vi">@list.collection.model = </span><span class="k">if</span> <span class="nx">@model</span> <span class="k">then</span> <span class="nx">models</span><span class="p">[</span><span class="nx">@model</span><span class="p">]</span> <span class="k">else</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span>    
       </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Instantiate @form as the specified class or Flint.Form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">form = </span><span class="k">if</span> <span class="nx">views</span><span class="p">[</span><span class="nx">@form</span><span class="p">]</span> <span class="k">then</span> <span class="nx">views</span><span class="p">[</span><span class="nx">@form</span><span class="p">]</span> <span class="k">else</span> <span class="nx">Flint</span><span class="p">[</span><span class="nx">@form</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">form</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&#39;Form class &quot;&#39;</span><span class="o">+</span><span class="nx">@form</span><span class="o">+</span><span class="s">&#39;&quot; does not exists&#39;</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Configure @form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@form = </span><span class="k">new</span> <span class="nx">form</span> <span class="p">{</span> <span class="nv">el: </span><span class="nx">@form_el</span> <span class="p">}</span> 
    <span class="vi">@form.model = </span><span class="k">new</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">model</span>
    <span class="vi">@form.collection = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span>
    <span class="vi">@form.valid_changes = </span><span class="nx">@valid_changes</span>
    </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Undelegate backbone events since they get delegated automatically, in our case we do not want this.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@list</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">()</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Register this instance with the application so that binding and unbinding is called automatically</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">app</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span> 
    </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Keep an internal reference to the app in case you want to intantiate it as something other than var app</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@app = </span><span class="nx">app</span>
    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Call @init</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@init</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>  
    </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Return the instance  </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>This is a method that is called after initialize, in case you need it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init: </span><span class="o">=&gt;</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Binds the application components to common events which include:
  creation, editing, sorting, saving, deleting, leaving the view (cancled)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bind: </span><span class="o">=&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="nx">@create</span>
    <span class="nx">@list</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span> <span class="nx">@edit</span>
    <span class="nx">@list</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;sort&#39;</span><span class="p">,</span> <span class="nx">@sorted</span>    
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="nx">@added</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">@deleted</span> 
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@changed</span>   
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">@error</span>  
       
    <span class="nx">@form</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="nx">@deleted</span>
    <span class="nx">@form</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;saved&#39;</span><span class="p">,</span> <span class="nx">@saved</span>
    <span class="nx">@form</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;canceled&#39;</span><span class="p">,</span> <span class="o">=&gt;</span> <span class="vi">@modelChanged = </span><span class="kc">false</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">@error</span>
    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Note that all the default events will call @update. 
 Overriding @update is the easiest way to subscribe to all these events 
 at once without having to worry about cleanup.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;saved deleted sorted destroyed delete_undone sort_undone destroy_error&#39;</span><span class="p">,</span> <span class="nx">@update</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Unbind frees up the memory consumed by listening for many events. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">unbind: </span><span class="o">=&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="kc">off</span> <span class="s">&#39;create edit sort&#39;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="kc">off</span> <span class="s">&#39;add remove change error&#39;</span>
    <span class="nx">@form</span><span class="p">.</span><span class="kc">off</span> <span class="s">&#39;delete saved canceled&#39;</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="kc">off</span> <span class="s">&#39;error&#39;</span>
    <span class="nx">@</span><span class="p">.</span><span class="kc">off</span> <span class="s">&#39;saved deleted sorted destroyed delete_undone sort_undone destroy_error&#39;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>fetch()
is a helper method that will fetch the list from the server 
without having to rewrite this routine each time you want to make sure the collection is there</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fetch: </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="k">return</span> <span class="nx">callback</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span>
    <span class="k">else</span>
      <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">fetch</span>
        <span class="nv">silent: </span><span class="kc">true</span>
        <span class="nv">success: </span><span class="o">=&gt;</span>
          <span class="k">if</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
             <span class="k">return</span> <span class="nx">callback</span> <span class="kc">false</span>
          <span class="nx">callback</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>get(id)
 is a helper method that returns a specific model from the collection by id. 
 it will call fetch if the collection is not populated.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get: </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="o">=</span><span class="p">{})</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">@fetch</span> <span class="o">=&gt;</span>
        <span class="nx">@__get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@__get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
        
  <span class="nx">__get</span><span class="o">:</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nv">model = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">model</span>
      <span class="nx">callback</span> <span class="kc">false</span>
    <span class="k">else</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">fetch</span>
        <span class="nv">silent: </span><span class="kc">true</span>
        <span class="nv">success: </span><span class="o">=&gt;</span> 
          <span class="nx">callback</span> <span class="nx">model</span>
            </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>create() is the c in your crud. it will render a new model instance into your form 
using defaults to populate any values specified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">create: </span><span class="o">=&gt;</span>
    <span class="vi">@form.model = </span><span class="k">new</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">model</span> <span class="nv">sort_order: </span><span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">render</span> <span class="nx">@template_create</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">@form</span><span class="p">.</span><span class="nx">model</span>
    <span class="nx">@trigger</span> <span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>added will get fired when @form save() pushes the model into the collection
the default Backbone.Model.Save() method pushes the model to the @app.sync for processing. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">added: </span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@trigger</span> <span class="s">&#39;added&#39;</span><span class="p">,</span> <span class="nx">model</span>
    <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s">&#39;Saving...&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">save</span> <span class="nx">model</span><span class="p">,</span> <span class="nv">success: </span><span class="o">=&gt;</span>
        <span class="nv">_tmpl = </span><span class="nx">tmpl_compile</span><span class="p">(</span><span class="nx">@messages</span><span class="p">.</span><span class="nx">created</span><span class="p">)</span>
        <span class="nv">message = </span><span class="nx">_tmpl</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span>
        <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span>       
        <span class="nx">@edit</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span>
        <span class="nx">@list</span><span class="p">.</span><span class="nx">render</span> <span class="nx">@template_list</span>
             </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>edit() renders an existing model into @form</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">edit: </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nv">model = </span><span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">render</span> <span class="nx">@template_edit</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">model</span>
  </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>changed() is received from @form.chanaged method and then broadcast to listeners 
it is first pushed directly to @app.sync (Flint.Sync) for processing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">changed: </span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@app</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">changed</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">sync</span>
    <span class="nx">@trigger</span> <span class="s">&#39;changed&#39;</span><span class="p">,</span> <span class="nx">model</span>
  </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>saved() is called from @form.save's event broadcast and pushes the entire model to the server
 as a result Flint.Sync becomes aware of this change. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">saved: </span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@trigger</span> <span class="s">&#39;saved&#39;</span><span class="p">,</span> <span class="nx">model</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">save</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">success: </span><span class="o">=&gt;</span>
      <span class="nv">_tmpl = </span><span class="nx">tmpl_compile</span><span class="p">(</span><span class="nx">@messages</span><span class="p">.</span><span class="nx">saved</span><span class="p">)</span>
      <span class="nv">message = </span><span class="nx">_tmpl</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span>
      <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span>      
  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>deleted() is recieved from @list or @form and behaves differently than you might expect. 
Instead of blowing the model away, it retains a copy and will prompt undo</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">deleted: </span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">collection</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span>
    
    <span class="nx">@trigger</span> <span class="s">&#39;deleted&#39;</span><span class="p">,</span> <span class="nx">model</span>
    </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>if an item from the list already teed up, just go ahead and destroy it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@to_delete</span>
        <span class="nx">@destroy</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>we lost reference to the collection as it was removed by @list or @from so the url needs to be re-assigne</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">Deletable = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span> <span class="nv">url: </span><span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">url</span>
    <span class="vi">@to_delete = </span><span class="k">new</span> <span class="nx">Deletable</span> <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span>
    </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>if notifications are present, we know the undo action will recive the confirmation and @destroy as callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span> 
      <span class="nv">_tmpl = </span><span class="nx">tmpl_compile</span><span class="p">(</span><span class="nx">@messages</span><span class="p">.</span><span class="nx">delete_warn</span><span class="p">)</span>
      <span class="nv">message = </span><span class="nx">_tmpl</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span>
      <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">@undo_delete</span><span class="p">,</span> <span class="nx">@destroy</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@destroy</span><span class="p">()</span>
    
  </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If a user elects to take the notification's undo action callback 
then the model is added back to the collection quietly</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">undo_delete: </span><span class="o">=&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span> <span class="k">new</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="nx">@to_delete</span><span class="p">.</span><span class="nx">attributes</span><span class="p">),</span> <span class="nv">silent: </span><span class="kc">true</span>
    <span class="vi">@to_delete = </span><span class="kc">null</span>
    <span class="nx">@trigger</span> <span class="s">&#39;delete_undone&#39;</span><span class="p">,</span> <span class="nx">@to_delete</span>
  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>destroy() tells the server to kill the model. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">destroy: </span><span class="o">=&gt;</span> 
     <span class="nx">@to_delete</span><span class="p">.</span><span class="nx">destroy</span> <span class="nv">success: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>in the event we get an error from destruction attempt (not authorzied etc.) 
let the user know and quietly put it back.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">response</span> <span class="o">and</span> <span class="nx">response</span><span class="p">.</span><span class="nx">error</span>
        <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span>
        <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@to_delete</span><span class="p">,</span> <span class="nv">silent: </span><span class="kc">true</span>
        <span class="nx">@trigger</span> <span class="s">&#39;destroyed&#39;</span><span class="p">,</span> <span class="nx">@to_delete</span>
        <span class="nx">@update</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@trigger</span> <span class="s">&#39;destroy_error&#39;</span><span class="p">,</span> <span class="nx">@to_delete</span>
  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Update is a handy method to overide which gets all the events broadcast by this class that 
by default, it will simply re-render the list view</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="o">=&gt;</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">render</span> <span class="nx">@template_list</span>
    </pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Handle any errors recived from validation or other     </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">error: </span><span class="nf">(object, error) -&gt;</span>
    
    <span class="k">if</span> <span class="nx">console</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;NOTICE: error triggered on controller: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">)</span>
    <span class="nv">error = </span><span class="nx">error</span><span class="p">.</span><span class="nx">responseText</span> <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>check to see if we are getting 401 and force the app to do an update call</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">error</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;401&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">@app</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">update</span>
    <span class="k">else</span>
      <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">unless</span> <span class="o">not</span> <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span>
      </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>sorted() handles sorting from @list. if the user confirms instead of undoing their action 
serialize the data and send to @app.sync</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sorted: </span><span class="p">(</span><span class="nx">serialized</span><span class="p">)</span> <span class="o">=&gt;</span>  
    <span class="nx">@trigger</span> <span class="s">&#39;sorted&#39;</span>
    <span class="nx">@app</span><span class="p">.</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">notify</span>
      <span class="nx">@messages</span><span class="p">.</span><span class="nx">sorted</span><span class="p">,</span> 
      <span class="nx">@undo_sort_order</span><span class="p">,</span> 
      <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>send request if confirmed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@app</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">ajax</span> <span class="nx">@sorted_url</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span><span class="s">&#39;POST&#39;</span>
            <span class="nv">data: </span>
              <span class="nx">json</span><span class="o">:</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">serialized</span><span class="p">)</span>
      
    
  </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Revert all the sort order attributes to their orignal state and broadcasts the event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">undo_sort_order: </span><span class="o">=&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@list</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span> <span class="nf">(model) -&gt;</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">set</span> <span class="s">&#39;sort_order&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;order_before_sort&#39;</span><span class="p">),</span> <span class="nx">silent</span><span class="o">:</span><span class="kc">true</span>
    <span class="nx">@trigger</span> <span class="s">&#39;sort_undone&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>delegate() and undelegate() bind / unbind the events specified by @form and @list 
as well as the internal events listened to by this class. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">delegate: </span><span class="o">=&gt;</span>
    <span class="nx">@undelegate</span><span class="p">()</span>
    <span class="nx">@bind</span><span class="p">()</span>
    <span class="nx">@form</span><span class="p">.</span><span class="nx">delegateEvents</span><span class="p">()</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">delegateEvents</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>This reference makes the application instance aware of the fact this controller is currently locked and loaded.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@app.controller = </span><span class="nx">@</span>
    
  <span class="nv">undelegate: </span><span class="o">=&gt;</span>
    <span class="nx">@unbind</span><span class="p">()</span> 
    <span class="nx">@form</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">()</span>
    <span class="nx">@list</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">()</span>
      

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 