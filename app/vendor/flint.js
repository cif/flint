var Flint={};__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},Flint.Calendar=function(){function a(a,b,c){this.el=a!=null?a:"#calendar",this.year=b,this.month=c,this.set_focus_and_highlight=__bind(this.set_focus_and_highlight,this),this.set_focus_date=__bind(this.set_focus_date,this),this.events=_.extend({},this._events,this.events),this.$el=$(this.el),this.initialize(this.year,this.month),this.delegateEvents(),this}return __extends(a,Backbone.View),a.prototype._events={"click button.next":"next_month","click button.previous":"previous_month","click td.day":"date_clicked"},a.prototype.selected_dates=[],a.prototype.focus_date=!1,a.prototype.higlight="day",a.prototype.day_labels=[{day:"S"},{day:"M"},{day:"T"},{day:"W"},{day:"T"},{day:"F"},{day:"S"}],a.prototype.month_labels=["January","February","March","April","May","June","July","August","September","October","November","December"],a.prototype.initialize=function(a,b){var c,d;return this.year=a,this.month=b,this.date=new Date,this.month||(this.month=this.date.getMonth()),this.year||(this.year=this.date.getFullYear()),this.date=this.date.getDate(),d=this.month+1<10?"0"+(this.month+1):this.month+1,c=this.date<10?"0"+this.date:this.date,this.focus_date=this.year+"-"+d+"-"+c,this.render(),$("#"+this.focus_date).addClass("fb-today")},a.prototype.render=function(a,b){var c;a==null&&(a=!1),b==null&&(b=!1);if(a||a===0||a==="0")this.year=a;if(b||b===0||b==="0")this.month=b;return c={month_name:this.month_labels[this.month],day_labels:this.day_labels,month:this.month,year:this.year},$(this.el).html(Handlebars.templates.month(c))},a.prototype.set_focus_date=function(a,b){return this.focus_date=a,b&&(this.date=b),this.month=this.date.getMonth(),this.year=this.date.getFullYear(),this.render(),this.set_focus_and_highlight()},a.prototype.set_focus_and_highlight=function(a){var b,c,d,e;a==null&&(a=!1),d=$(this.el).attr("id"),$("#"+d+" td").removeClass("fb-highlight").removeClass("fb-focus"),e=$("#"+d+" td[data-sql="+this.focus_date+"]"),c=this.focus_date.split("-"),b=c[1],a&&(this.highlight=a);switch(this.highlight){case"week":e.parent().children("td").addClass("fb-highlight");break;case"month":b-1===this.month&&$("#"+d+" td").addClass("fb-highlight")}return e.removeClass("fb-highlight").addClass("fb-focus")},a.prototype.next_month=function(){return parseInt(this.month)+1===12?(this.year++,this.month=0):this.month++,this.render(this.year,this.month),this.set_focus_and_highlight(),this.trigger("next",this)},a.prototype.previous_month=function(){return parseInt(this.month)===0?(this.year--,this.month=11):this.month--,this.render(this.year,this.month),this.set_focus_and_highlight(),this.trigger("prev",this)},a.prototype.date_clicked=function(a){var b,c,d,e;return e=$(a.target),d=e.attr("data-sql"),c=d.split("-"),b=new Date(c[0],c[1]-1,c[2]),this.trigger("clicked",d,b,this.selected_dates,a),_.indexOf(this.selected_dates,b)>=0?(this.selected_dates=_.without(this.selected_dates,b),this.trigger("deselect",d,b,this.selected_dates,a)):(this.selected_dates.push(b),this.trigger("select",d,b,this.selected_dates,a)),this.focus_date=d,this.set_focus_and_highlight()},a}(),Flint.Collection=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),Flint.Controller=function(){function a(){this.undelegate=__bind(this.undelegate,this),this.delegate=__bind(this.delegate,this),this.undo_sort_order=__bind(this.undo_sort_order,this),this.sorted=__bind(this.sorted,this),this.error=__bind(this.error,this),this.update=__bind(this.update,this),this.destroy=__bind(this.destroy,this),this.undo_delete=__bind(this.undo_delete,this),this.deleted=__bind(this.deleted,this),this.saved=__bind(this.saved,this),this.changed=__bind(this.changed,this),this.edit=__bind(this.edit,this),this.added=__bind(this.added,this),this.create=__bind(this.create,this),this.fresh=__bind(this.fresh,this),this.grab=__bind(this.grab,this),this.__get=__bind(this.__get,this),this.get=__bind(this.get,this),this.refresh=__bind(this.refresh,this),this.fetch=__bind(this.fetch,this),this._unbind=__bind(this._unbind,this),this.unbind=__bind(this.unbind,this),this._bind=__bind(this._bind,this),this.bind=__bind(this.bind,this),this.init=__bind(this.init,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Router),a.prototype.template_create="default/create",a.prototype.template_edit="default/edit",a.prototype.template_view="default/view",a.prototype.template_list="default/list",a.prototype.collection=!1,a.prototype.model=!1,a.prototype.list="List",a.prototype.sortable=!1,a.prototype.sorted_url=!1,a.prototype.sort_handle=!1,a.prototype.form="Form",a.prototype.valid_changes=!0,a.prototype._messages={created:"{{name}} has been created.",saved:"Changes to {{name}} have been saved.",delete_warn:"You are about to delete {{name}}, proceed?",navigate_warn:"Did you want to save the changes you just made?",sorted:"You have changed the sort order."},a.prototype.initialize=function(a){var b,c,d=this;this.messages||(this.messages={}),_.map(this._messages,function(a,b){if(_.isUndefined(d.messages[b]))return d.messages[b]=a}),c=views[this.list]?views[this.list]:Flint[this.list];if(!c)throw new Error('List class "'+this.list+'" does not exists');this.list=new c({},this.sortable),this.list_el&&(this.list.el=this.list_el),this.list.sort_handle=this.sort_handle,this.list.template=this.template_list,this.template_help&&(this.list.template_help=this.template_help),this.list.collection=this.collection?new collections[this.collection]:new Backbone.Collection,this.list.collection.model=this.model?models[this.model]:Backbone.Model,b=views[this.form]?views[this.form]:Flint[this.form];if(!b)throw new Error('Form class "'+this.form+'" does not exists');return this.form=new b({el:this.form_el}),this.form.model=new this.list.collection.model,this.form.collection=this.list.collection,this.form.valid_changes=this.valid_changes,this.list.undelegateEvents(),this.form.undelegateEvents(),a.register(this),this.app=a,this.init.apply(this,arguments),this},a.prototype.init=function(){},a.prototype.bind=function(){},a.prototype._bind=function(){var a=this;return this.bind(),this.list.on("create",this.create),this.list.on("edit",this.edit),this.list.on("sort",this.sorted),this.list.collection.on("add",this.added),this.list.collection.on("remove",this.deleted),this.list.collection.on("change",this.changed),this.list.collection.on("error",this.error),this.form.on("delete",this.deleted),this.form.on("saved",this.saved),this.form.on("canceled",function(){return a.modelChanged=!1}),this.form.model.on("error",this.error),this.on("saved deleted sorted destroyed delete_undone sort_undone destroy_error",this.update)},a.prototype.unbind=function(){},a.prototype._unbind=function(){return this.unbind(),this.list.off("create edit sort"),this.list.collection.off("add remove change error"),this.form.off("delete saved canceled"),this.form.model.off("error"),this.off("saved deleted sorted destroyed delete_undone sort_undone destroy_error")},a.prototype.fetch=function(a,b){var c=this;return b==null&&(b=!1),this.list.collection.length>0&&!b?a(this.list.collection):this.list.collection.fetch({silent:!0,success:function(){return c.list.collection.length===0?a(!1):a(c.list.collection)}})},a.prototype.refresh=function(a){return this.fetch(a,!0)},a.prototype.get=function(a,b,c){var d=this;return c==null&&(c={}),this.list.collection.length===0?this.fetch(function(){return d.__get(a,b,c)}):this.__get(a,b,c)},a.prototype.__get=function(a,b,c){var d,e=this;d=this.list.collection.get(a);if(!!d)return d.fetch({silent:!0,success:function(a){if(b)return b(d)}});if(b)return b(!1)},a.prototype.grab=function(a){return this.list.collection.get(a)},a.prototype.fresh=function(a,b){var c,d=this;c=this.grab(a);if(!c){b(!1);return}return c.fetch({silent:!0}),{success:function(a){if(b)return b(c)}}},a.prototype.create=function(){return this.form.model=new this.list.collection.model({sort_order:this.list.collection.length}),this.form.render(this.template_create,{},this.form.model),this.trigger("create",this)},a.prototype.added=function(a){var b=this;return this.trigger("added",a),!this.app.notifications||this.app.notifications.notify("Saving..."),a.save(a,{success:function(){var c,d;return d=tmpl_compile(b.messages.created),c=d(a.attributes),!!b.app.notifications&&!!b.messages.created&&b.app.notifications.notify(c),b.edit(a.id),b.trigger("returned",a)},error:function(a,c){return!b.app.notifications||b.app.notifications.error(c),b.list.collection.remove(a,{silent:!0})}})},a.prototype.edit=function(a){var b;return b=this.list.collection.get(a),this.form.render(this.template_edit,{},b)},a.prototype.changed=function(a){return!this.app.sync||this.app.sync.changed(a),this.trigger("changed",a)},a.prototype.saved=function(a){var b=this;return this.trigger("saved",a),!this.app.notifications||this.app.notifications.notify("Saving..."),a.save(null,{success:function(){var c,d;return d=tmpl_compile(b.messages.saved),c=d(a.attributes),!!b.app.notifications&&!!b.messages.saved&&b.app.notifications.notify(c),b.trigger("returned",a)}})},a.prototype.deleted=function(a,b,c){var d,e,f;return this.trigger("deleted",a),this.to_delete&&this.destroy(),d=Backbone.Model.extend({url:this.list.collection.url}),this.to_delete=new d(a.attributes),this.app.notifications?(f=tmpl_compile(this.messages.delete_warn),e=f(a.attributes),this.app.notifications.notify(e,this.undo_delete,this.destroy)):this.destroy()},a.prototype.undo_delete=function(){return this.list.collection.add(new this.list.collection.model(this.to_delete.attributes),{silent:!0}),this.to_delete=null,this.trigger("delete_undone",this.to_delete)},a.prototype.destroy=function(){var a=this;return this.to_delete.destroy({success:function(b,c){return c&&c.error?(!a.app.notifications||a.app.notifications.error(c.error),a.list.collection.add(a.to_delete,{silent:!0}),a.trigger("destroyed",a.to_delete),a.update()):a.trigger("destroy_error",a.to_delete)}})},a.prototype.update=function(){return this.list.render()},a.prototype.error=function(a,b){console&&console.log&&console.log("NOTICE: error triggered on Flint.Controller: "+b),_.isString(b)||(b=b.responseText);if(b.indexOf("401")>0){if(!!this.app.update)return this.app.update()}else if(!!this.app.notifications)return this.app.notifications.error(b)},a.prototype.sorted=function(a){var b=this;return this.trigger("sorted"),this.app.notifications.notify(this.messages.sorted,this.undo_sort_order,function(){return b.app.sync.ajax(b.sorted_url,{type:"POST",data:{json:JSON.stringify(a)}})})},a.prototype.undo_sort_order=function(){return _.each(this.list.collection.models,function(a){return a.set("sort_order",a.get("order_before_sort"),{silent:!0})}),this.list.collection.sort(),this.trigger("sort_undone")},a.prototype.delegate=function(){return this.undelegate(),this._bind(),this.form.delegateEvents(),this.list.delegateEvents(),this.app.controller=this},a.prototype.undelegate=function(){return this._unbind(),this.form.undelegateEvents(),this.list.undelegateEvents()},a}(),Flint.Form=function(){function a(){this["delete"]=__bind(this["delete"],this),this.cancel=__bind(this.cancel,this),this.done=__bind(this.done,this),this.init=__bind(this.init,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype._events={"change input,textarea,select":"changed","click .done":"done","click .save":"save","click .delete":"delete","click .cancel":"cancel","click label":"label_click","submit form":"nosubmit"},a.prototype.initialize=function(){return this.events=_.extend({},this._events,this.events),this.init.apply(this,arguments),this},a.prototype.init=function(){},a.prototype.render=function(a,b,c){var d=this;return this.template=a,this.data=b!=null?b:{},c==null&&(c=!1),c&&(this.model=c,this.data.model=this.model,this.data=_.extend({},this.data,this.model.attributes)),this.before(function(){return $(d.el).html(tmpl[d.template](d.data)),d.after()}),this},a.prototype.before=function(a){return a()},a.prototype.after=function(){},a.prototype.changed=function(a){var b,c,d;a.stopPropagation(),c=$(a.target),d=c.val(),c.attr("type")==="checkbox"&&(c.is(":checked")?d=c.val():d=0),c.hasClass("num")&&(d=d.toString().replace(/[A-Za-z$-,]/g,""));if(!_.isUndefined(d&&!_.isUndefined(this.model)))return b=c.attr("name"),this.model.set(b,d.toString(),{silent:!this.valid_changes}),this.trigger("changed",this.model,b,d),this.trigger("changed:"+b,this.model,d)},a.prototype.save=function(){return this.collection.add(this.model)},a.prototype.done=function(a){return a==null&&(a=!1),(!a||!!_.isObject(a))&&this.trigger("saved",this.model),this.cancel()},a.prototype.cancel=function(a){return a==null&&(a=!1),(!a||!!_.isObject(a))&&this.trigger("canceled",this.model),$(this.el).empty()},a.prototype["delete"]=function(){return this.done(!0),this.collection.remove(this.model)},a.prototype.label_click=function(a){var b;return b=$(a.target),b.next().click(),b.prev().click()},a.prototype.nosubmit=function(){return!1},a}(),Flint.Grid=function(){function a(){this.quicksort=__bind(this.quicksort,this),this.swap=__bind(this.swap,this),this.compare=__bind(this.compare,this),this.partition=__bind(this.partition,this),this.sort=__bind(this.sort,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype._events={"click tr td,.edit":"edit","click th.sortable":"sort","click .delete":"delete","click .create":"create","click .view":"read"},a.prototype.initialize=function(a){return this.events=_.extend({},this._events,this.events),this},a.prototype.render=function(a,b,c){return a&&(this.template=a),c&&(this.headings=c),b&&(this.data=b),this.before(),this.data||(this.data={items:this.collection.models}),this.data.headings=this.headings,this.template?$(this.el).html(tmpl[this.template](this.data)):console&&console.log&&console.log("WARNING Flint.Grid: @template is undefined, unable to render view."),this.trigger("rendered",this),this.after(),this},a.prototype.before=function(){},a.prototype.after=function(){},a.prototype.create=function(){return this.trigger("create")},a.prototype.read=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("read",b)},a.prototype.edit=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("edit",b)},a.prototype["delete"]=function(a){var b,c,d;a.stopPropagation(),d=$(a.target),b=d.attr("id");while(_.isUndefined(b))d=d.parent(),b=d.attr("id");return c=this.collection.get(b),this.collection.remove(c),!1},a.prototype.sort=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;f=a.target;while(f.tagName!=="TABLE")f=f.parentNode;d=$("tr th").index(a.target),c=a.target,this.sort_data_type=$(a.target).attr("data-type"),this.sorting_dir||(this.sorting_dir=1),c===this.heading&&(this.sorting_dir*=-1),this.heading=a.target,$("tr th").css("font-weight","300"),$("tr th span").remove(),b=this.sorting_dir===-1?"<span>&uarr;&nbsp;</span>":"<span>&darr;&nbsp;</span>",$(a.target).css("font-weight","bold"),$(a.target).html(b+$(a.target).html()),this.sort_index=d,h=f.getElementsByTagName("tr"),e=[],g=1;while(g<h.length)e.push(h[g]),g++;for(i=0,k=e.length;i<k;i++)g=e[i],$(g).remove();this.quicksort(e,0,e.length),m=[];for(j=0,l=e.length;j<l;j++)g=e[j],m.push($(f).append(g));return m},a.prototype.partition=function(a,b,c,d){var e,f,g,h;f=a[d],this.swap(a,d,c-1),g=b;for(e=b,h=c-1;b<=h?e<h:e>h;b<=h?e++:e--)this.compare(a[e],f)&&(this.swap(a,g,e),g++);return this.swap(a,c-1,g),g},a.prototype.compare=function(a,b,c){return c==null&&(c=!1),a=$(a.getElementsByTagName("td")[this.sort_index]).html(),b=$(b.getElementsByTagName("td")[this.sort_index]).html(),this.sort_data_type&&(this.sort_data_type==="date"&&(a.indexOf("-")>0&&(a=a.substring(0,a.indexOf(" -"))),b.indexOf("-")>0&&(b=b.substring(0,b.indexOf(" -"))),a=moment(a),b=moment(b),isNaN(a.toDate().getTime())&&(a=moment(0),console.log(a)),isNaN(b.toDate().getTime())&&(b=moment(0))),this.sort_data_type==="number"&&(a=parseFloat(a.replace(/[A-Za-z$,]/g,"")),b=parseFloat(b.replace(/[A-Za-z$,]/g,"")),isNaN(a)&&(a=0),isNaN(b)&&(b=0))),this.sorting_dir===1?a<b:a>b},a.prototype.swap=function(a,b,c){var d;return d=a[b],a[b]=a[c],a[c]=d,a},a.prototype.quicksort=function(a,b,c){var d;if(c-1>b)return d=b+Math.floor(Math.random()*(c-b)),d=this.partition(a,b,c,d),this.quicksort(a,b,d),this.quicksort(a,d+1,c)},a}(),Flint.Helpers=function(){function a(){this.js_to_slash=__bind(this.js_to_slash,this),this.sql_to_slash=__bind(this.sql_to_slash,this),this.date_format=__bind(this.date_format,this),this._get_cookie=__bind(this._get_cookie,this),this.cookie=__bind(this.cookie,this),this.after_transition=__bind(this.after_transition,this),this.delay=__bind(this.delay,this),this.initialize=__bind(this.initialize,this),Handlebars.registerHelper("eq",this.eq),Handlebars.registerHelper("check_role",this.check_role),Handlebars.registerHelper("link",this.link),Handlebars.registerHelper("link_nohref",this.link_nohref),Handlebars.registerHelper("list",this.list),Handlebars.registerHelper("input",this.input),Handlebars.registerHelper("text_field",this.text_field),Handlebars.registerHelper("password",this.password),Handlebars.registerHelper("select",this.select),Handlebars.registerHelper("select_range",this.select_range),Handlebars.registerHelper("radio",this.radio),Handlebars.registerHelper("checkbox",this.checkbox),Handlebars.registerHelper("text_area",this.text_area),Handlebars.registerHelper("month_grid",this.month_grid),Handlebars.registerHelper("date_today",this.date_today),Handlebars.registerHelper("sql_to_slash",this.sql_to_slash),Handlebars.registerHelper("date_format",this.date_format),Handlebars.registerHelper("twenty_four_to_twelve",this.twenty_four_to_twelve),Handlebars.registerHelper("dollar",this.dollar),Handlebars.registerHelper("random",this.random),Handlebars.registerHelper("sum",this.sum),Handlebars.registerHelper("truncate",this.truncate),Handlebars.registerHelper("repeater",this.repeater),this.initialize(),this}return a.prototype.initialize=function(){},a.prototype.delay=function(a,b){return this.timer=setTimeout(b,a),this.timer},a.prototype.after_transition=function(a,b){var c,d=this;return c="webkitTransitionEnd transitionend oTransitionEnd",$(a).unbind(c),$(a).bind(c,function(){return $(a).unbind(c),b()})},a.prototype.link=function(a,b,c){var d;return d=[],_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),new Handlebars.SafeString('<a href="'+a+'" '+d.join(" ")+">"+b+"</a>")},a.prototype.link_nohref=function(a,b){var c;return c=[],_.map(b.hash,function(a,b){return c.push(b+'="'+a+'"')}),new Handlebars.SafeString('<a href="javascript:void(0)" '+c.join(" ")+">"+a+"</a>")},a.prototype.list=function(a,b,c){var d;return d=[],_.each(a,function(b){return a=b.attributes?b.attributes:b,d.push(c(a))}),d=d.length>0?d.join(""):b,new Handlebars.SafeString(d)},a.prototype.eq=function(a,b,c){return a===b?c.fn(this):c.inverse(this)},a.prototype.text_field=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)?a.get(b):"",new Handlebars.SafeString('<input type="text" name="'+b+'" value="'+e.replace(/"/g,"&quot;")+'" '+d.join(" ")+"/>")},a.prototype.input=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)?a.get(b):"",new Handlebars.SafeString('<input name="'+b+'" value="'+e.replace(/"/g,"&quot;")+'" '+d.join(" ")+"/>")},a.prototype.password=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e='<input type="password" name="'+b+'" value="" '+d.join(" ")+"/>",new Handlebars.SafeString(e)},a.prototype.select=function(a,b,c,d){var e,f,g;return e=[],d&&_.map(d.hash,function(a,b){return e.push(b+'="'+a+'"')}),g=a&&a.get&&a.get(b)?a.get(b):!1,a&&a[b]&&(g=a[b]),f=[],_.each(c,function(a){var b,c,d;return d=_.isArray(a)?a[0]:a,c=_.isArray(a)?a[1]:a,b="<option ",d&&g&&d.toString()===g.toString()&&(b+="selected "),b+='value="'+d+'">'+c+"</option>",f.push(b)}),new Handlebars.SafeString('<select name="'+b+'" '+e.join(" ")+">"+f.join("")+"</select>")},a.prototype.select_range=function(a,b,c,d,e){var f,g,h,i,j,k;f=[],e&&_.map(e.hash,function(a,b){return f.push(b+'="'+a+'"')}),i=a&&a.get&&a.get(d)?a.get(d):!1,g=[];for(j=b,k=c+1;b<=k?j<k:j>k;b<=k?j++:j--)h="<option ",j===i&&(h+="selected "),h+='value="'+j+'">'+j+"</option>",g.push(h);return new Handlebars.SafeString('<select name="'+d+'" '+f.join(" ")+">"+g.join("")+"</select>")},a.prototype.radio_group=function(a,b,c){var d,e;return e=a.get(b),d=[],_.each(c,function(a){var c,f,g;return g=_.isArray(a)?a[0]:a,f=_.isArray(a)?a[1]:a,c='<p class="radio"><input type="radio" name="'+b+'" value="'+g+'"',g===e&&(c+=' checked="true"'),c+=" /><label>"+f+"</label></p>",d.push(c)}),new Handlebars.SafeString('<div class="radios">'+d.join("")+"</div>")},a.prototype.checkbox=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)>0?'checked="true" ':"",new Handlebars.SafeString('<input type="checkbox" name="'+b+'" value="1" '+e+d.join(" ")+"/>")},a.prototype.text_area=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get?a.get(b):"",new Handlebars.SafeString('<textarea name="'+b+'" '+d.join(" ")+">"+e+"</textarea>")},a.prototype.cookie=function(a,b,c,d,e){var f,g;return c==null&&(c=""),d==null&&(d="/"),e==null&&(e=""),_.isUndefined(b)?this._get_cookie(a):(f=a+"="+b,c===!0&&(c="; expires="+(new Date(c)).toGMTString()),c===""&&(g=(new Date).getTime()+31536e6,c="; expires="+(new Date(g)).toGMTString()),d="; path="+d,e===!0&&(e="; domain"+e),document.cookie=f+c+d+e,b)},a.prototype._get_cookie=function(a){var b,c,d,e,f,g;d=a+"=",c=document.cookie.split(";"),e=!1;for(f=0,g=c.length;f<g;f++)b=c[f],b.toString().indexOf(d)>=0&&(e=b.substring(d.length+1,b.length));return e},a.prototype.month_grid=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;e=[31,28,31,30,31,30,31,31,30,31,30,31],l=e[a],o=(new Date(b,a,1)).getDay(),a===1&&(b%4!==0||b%100!==!0)&&b%400!==0&&(l=29),f="",j=1-o;for(g=0;g<=5;g++){f+="<tr>";for(k=0;k<=6;k++)c=new Date(b,a,j),d=c.getDate(),p=c.getMonth(),q=c.getFullYear(),m=j<1||j>l?" off-month":"",h=d<10?"0"+d:d,i=p+1<10?"0"+(p+1):p+1,f+='<td data-dow="'+k+'" class="day dow'+k+m+'" data-sql="'+q+"-"+i+"-"+h+'">',n=c.getDate(),f+=c.getDate()+"</td>",j++;f+="</tr>"}return f+="</tr></table>",new Handlebars.SafeString(f)},a.prototype.date_today=function(){return(new Date).getDate()},a.prototype.twenty_four_to_twelve=function(a){var b,c,d,e;return e=a.split(":"),b=e[0],b.substr(0,1)==="0"&&(b=parseInt(b.substr(1,1))),d=e[1],c="am",b>=12&&(c="pm",b>12&&(b-=12)),b+":"+d+" "+c},a.prototype.jsdate_to_sql=function(a){var b,c;return c=a.getMonth()+1,b=a.getDate(),c<10&&(c="0"+c),b<10&&(b="0"+b),a.getFullYear()+"-"+c+"-"+b},a.prototype.sqldate_to_js=function(a){var b;return a?(b=a.split("-"),!b[1]||!b[2]?!1:(b[2].indexOf(" ")>=0&&(b[2]=b[2].substr(0,b[2].indexOf(" "))),new Date(b[0],b[1]-1,b[2]))):!1},a.prototype.date_format=function(a,b){return!a||a===""||a==="0000-00-00"||a==="0000-00-00 00:00:00"?"N/A":moment(a).format(b)},a.prototype.sql_to_slash=function(a){var b,c,d,e;return!a||a==="0000-00-00"||a===""?"":a.indexOf("/")>0?a:(c=this.sqldate_to_js(a),c?(d=c.getMonth()+1,b=c.getDate(),e=c.getFullYear(),d+"/"+b+"/"+e):"")},a.prototype.js_to_slash=function(a){var b,c,d;return c=a.getMonth()+1,b=a.getDate(),d=a.getFullYear(),c+"/"+b+"/"+d},a.prototype.dollar=function(a,b,c,d,e){var f,g,h,i,j,k,l;return b==null&&(b=2),c==null&&(c="."),d==null&&(d=","),e==null&&(e=!0),f=isNaN(b)?2:Math.abs(b),i=a<0?"-":"",g=parseInt(a=Math.abs(a).toFixed(f))+"",h=(h=g.length)>3?h%3:0,j=h?g.substr(0,h)+d:"",k=g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+d),l=f&&e?c+Math.abs(a-g).toFixed(f).slice(2):"",i+j+k+l},a.prototype.repeater=function(a,b,c){var d,e,f,g;e=parseInt(a),d=parseInt(b)+1,g=[];for(f=e;e<=d?f<d:f>d;e<=d?f++:f--)this.num=f,g.push(c.fn(this));return new Handlebars.SafeString(g.join(""))},a.prototype.sum=function(){var a,b=this;return a=0,_.each(arguments,function(b){return a+=parseFloat(b)}),a},a.prototype.truncate=function(a,b){return a&&a.length>b?a.substr(0,b)+"...":a},a.prototype.random=function(){return Math.random()*1e3},a}(),Flint.List=function(){function a(){this.sorted=__bind(this.sorted,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype._events={"click .edit":"edit","click .delete":"delete","click .create":"create","click .view":"read"},a.prototype.initialize=function(a,b){return this.sortable=b,this.events=_.extend({},this._events,this.events),this},a.prototype.render=function(a,b){var c;return a&&(this.template=a),b&&(this.data=b),this.before(),this.data||(this.data={items:this.collection.models}),this.template?$(this.el).html(tmpl[this.template](this.data)):console&&console.log&&console.log("WARNING Flint.List: @template is undefined, unable to render view."),this.sortable&&(c={update:this.sorted},this.sort_handle&&(c.handle=this.sort_handle),this.sortable=$(".sortable").sortable(c)),this.trigger("rendered",this),this.after(),this},a.prototype.before=function(){},a.prototype.after=function(){},a.prototype.create=function(){return this.trigger("create")},a.prototype.read=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("read",b)},a.prototype.edit=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("edit",b)},a.prototype["delete"]=function(a){var b,c,d;a.stopPropagation(),d=$(a.target),b=d.attr("id");while(_.isUndefined(b))d=d.parent(),b=d.attr("id");return c=this.collection.get(b),this.collection.remove(c),!1},a.prototype.update=function(a,b,c){return c==null&&(c="span"),$("#"+a.get("id")+" "+c).html(a.get(b))},a.prototype.sorted=function(){var a,b=this;return this.serialized=[],a=0,_.each(this.sortable.find("li"),function(a,c){var d,e,f;d=a.getAttribute("id"),f=b.collection.get(d);if(f)return e=f.get("sort_order"),b.collection.get(d).set("sort_order",c,{silent:!0}),b.collection.get(d).set("order_before_sort",e,{silent:!0}),b.serialized.push({id:d,sort_order:c})}),this.collection.sort(),this.data={items:this.collection.models},this.trigger("sort",this.serialized)},a}(),Flint.Model=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a}(),Flint.Notifications=function(){function a(){this.undo=__bind(this.undo,this),this.dismiss=__bind(this.dismiss,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el="#message",a.prototype.events={"click button.close":"dismiss","click button.undo":"undo"},a.prototype.render=function(a,b,c,d){var e;return b==null&&(b=!1),c==null&&(c="Close"),d==null&&(d="Undo"),e=_.isFunction(b),$(this.el).html(tmpl.notification({message:a,undo_callback:e,dismiss:c,undo_text:d})),this},a.prototype.error=function(a,b,c){return b==null&&(b=!1),c==null&&(c=!1),$(this.el).attr("class","error").css({top:0}),this.render(a,b),this.callback=c},a.prototype.notify=function(a,b,c){return b==null&&(b=!1),c==null&&(c=!1),$(this.el).attr("class","notice").css({top:0}),this.render(a,b,"OK"),this.callback=c,this.undo=b},a.prototype.prompt_save=function(a,b){return $(this.el).attr("class","notice").css({top:0}),this.render(a,b,"Save","Discard"),this.callback=b,this.undo=function(){}},a.prototype.confirm=function(a,b){return $(this.el).attr("class","notice").css({top:0}),this.render(a,b,"OK","Cancel"),this.callback=b,this.undo=function(){}},a.prototype.warning=function(a,b){return $(this.el).attr("class","error").css({top:0}),this.render(a,b,"OK","Cancel"),this.callback=b,this.undo=function(){}},a.prototype.yes_or_no=function(a,b,c){return c==null&&(c=!1),$(this.el).attr("class","notice").css({top:0}),this.render(a,b,"Yes","No"),this.callback=b,this.undo=c},a.prototype.warn_and_resolve=function(a,b,c){return c==null&&(c=!1),$(this.el).attr("class","error").css({top:0}),this.render(a,b,"Yes","No"),this.callback=b,this.undo=c},a.prototype.dismiss=function(a){$(this.el).css({top:"-100px"}).html("");if(this.callback&&!_.isUndefined(a))return this.callback()},a.prototype.undo=function(){this.dismiss();if(this.undo)return this.undo(!0)},a}(),Flint.Sync=function(){function a(a){a==null&&(a=!0),this.ajax=__bind(this.ajax,this),this.changed=__bind(this.changed,this),this.backbone=__bind(this.backbone,this),this.broadcast=__bind(this.broadcast,this),this.on=__bind(this.on,this),Backbone.sync=this.backbone,this.io=io.connect("http://"+location.host),this.io.on("data",this.broadcast),this}return a.prototype.listeners={},a.prototype.on=function(a,b){return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a.prototype.broadcast=function(a){var b,c,d,e,f;if(a.event){e=this.listeners[a.event],f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b(a));return f}if(console&&console.log)return console.log("[flint] server emitted socket data with no event attached:")},a.prototype.backbone=function(a,b,c){b.url=_.isFunction(b.url)?b.url():b.url,c||(c={}),b.collection||(b.collection={});if(!c.url&&!b.url&&!b.localstore&&!c.localstore&&!b.collection.localstore)throw new Error("A url or localstore property must be defined to use Storage.sync!");return b.url||c.url&&app.isOnline?this.server(a,b,c):this.local(a,b(c))},a.prototype.local=function(a,b,c){switch(a){case"read":return app.log("read shit!");case"create":return app.log("create shit!");case"delete":return app.log("update shit!");case"delete":return app.log("delete shit!")}},a.prototype.server=function(a,b,c){var d,e,f;return d={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},f=d[a],c||(c={}),e={type:f,dataType:"json"},e.url=c.url?c.url:b.url,!c.data&&b&&(a==="create"||a==="update"||a==="delete")&&(e.contentType="application/json",e.data=JSON.stringify(b.toJSON())),Backbone.emulateHTTP&&(f==="PUT"||f==="DELETE")&&(Backbone.emulateJSON&&(e.data_method=f),e.type="POST",e.beforeSend(function(a){return a.sendRequestHeader("X-HTTP-Method-Override",f)})),e.type!=="GET"&&!Backbone.emulateJSON&&(e.processData=!1),this.last_request=$.ajax(_.extend(e,c)),this},a.prototype.changed=function(a){},a.prototype.ajax=function(a,b){return b.url=a,$.ajax(_.extend(b)),this},a}(),Flint.View=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.render=function(a,b){var c=this;return this.template=a,this.data=b!=null?b:{},this.before(function(){return $(c.el).html(tmpl[c.template](c.data))}),this.after()},a.prototype.before=function(a){return a()},a.prototype.after=function(){},a}()