(function(a,b){function c(a){return J.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function d(a){if(!co[a]){var b=G.body,c=J("<"+a+">").appendTo(b),d=c.css("display");c.remove();if(d==="none"||d===""){cp||(cp=G.createElement("iframe"),cp.frameBorder=cp.width=cp.height=0),b.appendChild(cp);if(!cq||!cp.createElement)cq=(cp.contentWindow||cp.contentDocument).document,cq.write((J.support.boxModel?"<!doctype html>":"")+"<html><body>"),cq.close();c=cq.createElement(a),cq.body.appendChild(c),d=J.css(c,"display"),b.removeChild(cp)}co[a]=d}return co[a]}function e(a,b){var c={};return J.each(cu.concat.apply([],cu.slice(0,b)),function(){c[this]=a}),c}function f(){cv=b}function g(){return setTimeout(f,0),cv=J.now()}function h(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function i(){try{return new a.XMLHttpRequest}catch(b){}}function j(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},f,g,h=d.length,i,j=d[0],k,l,m,n,o;for(f=1;f<h;f++){if(f===1)for(g in a.converters)typeof g=="string"&&(e[g.toLowerCase()]=a.converters[g]);k=j,j=d[f];if(j==="*")j=k;else if(k!=="*"&&k!==j){l=k+" "+j,m=e[l]||e["* "+j];if(!m){o=b;for(n in e){i=n.split(" ");if(i[0]===k||i[0]==="*"){o=e[i[1]+" "+j];if(o){n=e[n],n===!0?m=o:o===!0&&(m=n);break}}}}!m&&!o&&J.error("No conversion from "+l.replace(" "," to ")),m!==!0&&(c=m?m(c):o(n(c)))}}return c}function k(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j)return j!==f[0]&&f.unshift(j),d[j]}function l(a,b,c,d){if(J.isArray(b))J.each(b,function(b,e){c||bQ.test(a)?d(a,e):l(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&J.type(b)==="object")for(var e in b)l(a+"["+e+"]",b[e],c,d);else d(a,b)}function m(a,c){var d,e,f=J.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&J.extend(!0,a,e)}function n(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===cd,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=n(a,c,d,e,l,g)));return(k||!l)&&!g["*"]&&(l=n(a,c,d,e,"*",g)),l}function o(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(J.isFunction(c)){var d=b.toLowerCase().split(b_),e=0,f=d.length,g,h,i;for(;e<f;e++)g=d[e],i=/^\+/.test(g),i&&(g=g.substr(1)||"*"),h=a[g]=a[g]||[],h[i?"unshift":"push"](c)}}}function p(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,f=4;if(d>0){if(c!=="border")for(;e<f;e+=2)c||(d-=parseFloat(J.css(a,"padding"+bL[e]))||0),c==="margin"?d+=parseFloat(J.css(a,c+bL[e]))||0:d-=parseFloat(J.css(a,"border"+bL[e]+"Width"))||0;return d+"px"}d=bM(a,b);if(d<0||d==null)d=a.style[b];if(bH.test(d))return d;d=parseFloat(d)||0;if(c)for(;e<f;e+=2)d+=parseFloat(J.css(a,"padding"+bL[e]))||0,c!=="padding"&&(d+=parseFloat(J.css(a,"border"+bL[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(J.css(a,c+bL[e]))||0);return d+"px"}function q(a){var b=G.createElement("div");return bC.appendChild(b),b.innerHTML=a.outerHTML,b.firstChild}function r(a){var b=(a.nodeName||"").toLowerCase();b==="input"?s(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&J.grep(a.getElementsByTagName("input"),s)}function s(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function t(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function u(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(J.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function v(a,b){if(b.nodeType===1&&!!J.hasData(a)){var c,d,e,f=J._data(a),g=J._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)J.event.add(b,c,h[c][d])}g.data&&(g.data=J.extend({},g.data))}}function w(a,b){return J.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function x(a){var b=bo.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function y(a,b,c){b=b||0;if(J.isFunction(b))return J.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return J.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=J.grep(a,function(a){return a.nodeType===1});if(bk.test(b))return J.filter(b,d,!c);b=J.filter(b,d)}return J.grep(a,function(a,d){return J.inArray(a,b)>=0===c})}function z(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function A(){return!0}function B(){return!1}function C(a,b,c){var d=b+"defer",e=b+"queue",f=b+"mark",g=J._data(a,d);g&&(c==="queue"||!J._data(a,e))&&(c==="mark"||!J._data(a,f))&&setTimeout(function(){!J._data(a,e)&&!J._data(a,f)&&(J.removeData(a,d,!0),g.fire())},0)}function D(a){for(var b in a){if(b==="data"&&J.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function E(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(N,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:J.isNumeric(d)?+d:M.test(d)?J.parseJSON(d):d}catch(f){}J.data(a,c,d)}else d=b}return d}function F(a){var b=K[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var G=a.document,H=a.navigator,I=a.location,J=function(){function c(){if(!d.isReady){try{G.documentElement.doScroll("left")}catch(a){setTimeout(c,1);return}d.ready()}}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,i=/\S/,j=/^\s+/,k=/\s+$/,l=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,q=/(webkit)[ \/]([\w.]+)/,r=/(opera)(?:.*version)?[ \/]([\w.]+)/,s=/(msie) ([\w.]+)/,t=/(mozilla)(?:.*? rv:([\w.]+))?/,u=/-([a-z]|[0-9])/ig,v=/^-ms-/,w=function(a,b){return(b+"").toUpperCase()},x=H.userAgent,y,z,A,B=Object.prototype.toString,C=Object.prototype.hasOwnProperty,D=Array.prototype.push,E=Array.prototype.slice,F=String.prototype.trim,I=Array.prototype.indexOf,J={};return d.fn=d.prototype={constructor:d,init:function(a,c,e){var f,g,i,j;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(a==="body"&&!c&&G.body)return this.context=G,this[0]=G.body,this.selector=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?f=h.exec(a):f=[null,a,null];if(f&&(f[1]||!c)){if(f[1])return c=c instanceof d?c[0]:c,j=c?c.ownerDocument||c:G,i=l.exec(a),i?d.isPlainObject(c)?(a=[G.createElement(i[1])],d.fn.attr.call(a,c,!0)):a=[j.createElement(i[1])]:(i=d.buildFragment([f[1]],[j]),a=(i.cacheable?d.clone(i.fragment):i.fragment).childNodes),d.merge(this,a);g=G.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return e.find(a);this.length=1,this[0]=g}return this.context=G,this.selector=a,this}return!c||c.jquery?(c||e).find(a):this.constructor(c).find(a)}return d.isFunction(a)?e.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),d.makeArray(a,this))},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return E.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();return d.isArray(a)?D.apply(e,a):d.merge(e,a),e.prevObject=this,e.context=this.context,b==="find"?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")"),e},each:function(a,b){return d.each(this,a,b)},ready:function(a){return d.bindReady(),z.add(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(E.apply(this,arguments),"slice",E.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:D,sort:[].sort,splice:[].splice},d.fn.init.prototype=d.fn,d.extend=d.fn.extend=function(){var a,c,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!d.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){e=i[c],f=a[c];if(i===f)continue;l&&f&&(d.isPlainObject(f)||(g=d.isArray(f)))?(g?(g=!1,h=e&&d.isArray(e)?e:[]):h=e&&d.isPlainObject(e)?e:{},i[c]=d.extend(l,h,f)):f!==b&&(i[c]=f)}return i},d.extend({noConflict:function(b){return a.$===d&&(a.$=f),b&&a.jQuery===d&&(a.jQuery=e),d},isReady:!1,readyWait:1,holdReady:function(a){a?d.readyWait++:d.ready(!0)},ready:function(a){if(a===!0&&!--d.readyWait||a!==!0&&!d.isReady){if(!G.body)return setTimeout(d.ready,1);d.isReady=!0;if(a!==!0&&--d.readyWait>0)return;z.fireWith(G,[d]),d.fn.trigger&&d(G).trigger("ready").off("ready")}},bindReady:function(){if(!z){z=d.Callbacks("once memory");if(G.readyState==="complete")return setTimeout(d.ready,1);if(G.addEventListener)G.addEventListener("DOMContentLoaded",A,!1),a.addEventListener("load",d.ready,!1);else if(G.attachEvent){G.attachEvent("onreadystatechange",A),a.attachEvent("onload",d.ready);var b=!1;try{b=a.frameElement==null}catch(e){}G.documentElement.doScroll&&b&&c()}}},isFunction:function(a){return d.type(a)==="function"},isArray:Array.isArray||function(a){return d.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):J[B.call(a)]||"object"},isPlainObject:function(a){if(!a||d.type(a)!=="object"||a.nodeType||d.isWindow(a))return!1;try{if(a.constructor&&!C.call(a,"constructor")&&!C.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var e;for(e in a);return e===b||C.call(a,e)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(m.test(b.replace(n,"@").replace(o,"]").replace(p,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c)return null;var e,f;try{a.DOMParser?(f=new DOMParser,e=f.parseFromString(c,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(c))}catch(g){e=b}return(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)&&d.error("Invalid XML: "+c),e},noop:function(){},globalEval:function(b){b&&i.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(v,"ms-").replace(u,w)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,e){var f,g=0,h=a.length,i=h===b||d.isFunction(a);if(e){if(i){for(f in a)if(c.apply(a[f],e)===!1)break}else for(;g<h;)if(c.apply(a[g++],e)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:F?function(a){return a==null?"":F.call(a)}:function(a){return a==null?"":(a+"").replace(j,"").replace(k,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var e=d.type(a);a.length==null||e==="string"||e==="function"||e==="regexp"||d.isWindow(a)?D.call(c,a):d.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(I)return I.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];return a.length=d,a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,e){var f,g,h=[],i=0,j=a.length,k=a instanceof d||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||d.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,e),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,e),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var e=a[c];c=a,a=e}if(!d.isFunction(a))return b;var f=E.call(arguments,2),g=function(){return a.apply(c,f.concat(E.call(arguments)))};return g.guid=a.guid=a.guid||g.guid||d.guid++,g},access:function(a,c,e,f,g,h,i){var j,k=e==null,l=0,m=a.length;if(e&&typeof e=="object"){for(l in e)d.access(a,c,l,e[l],1,h,f);g=1}else if(f!==b){j=i===b&&d.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(d(a),c)}):(c.call(a,f),c=null));if(c)for(;l<m;l++)c(a[l],e,j?f.call(a[l],l,c(a[l],e)):f,i);g=1}return g?a:k?c.call(a):m?c(a[0],e):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=q.exec(a)||r.exec(a)||s.exec(a)||a.indexOf("compatible")<0&&t.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(c,e){return e&&e instanceof d&&!(e instanceof a)&&(e=a(e)),d.fn.init.call(this,c,e,b)},a.fn.init.prototype=a.fn;var b=a(G);return a},browser:{}}),d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),y=d.uaMatch(x),y.browser&&(d.browser[y.browser]=!0,d.browser.version=y.version),d.browser.webkit&&(d.browser.safari=!0),i.test(" ")&&(j=/^[\s\xA0]+/,k=/[\s\xA0]+$/),g=d(G),G.addEventListener?A=function(){G.removeEventListener("DOMContentLoaded",A,!1),d.ready()}:G.attachEvent&&(A=function(){G.readyState==="complete"&&(G.detachEvent("onreadystatechange",A),d.ready())}),d}(),K={};J.Callbacks=function(a){a=a?K[a]||F(a):{};var c=[],d=[],e,f,g,h,i,j,k=function(b){var d,e,f,g,h;for(d=0,e=b.length;d<e;d++)f=b[d],g=J.type(f),g==="array"?k(f):g==="function"&&(!a.unique||!m.has(f))&&c.push(f)},l=function(b,k){k=k||[],e=!a.memory||[b,k],f=!0,g=!0,j=h||0,h=0,i=c.length;for(;c&&j<i;j++)if(c[j].apply(b,k)===!1&&a.stopOnFalse){e=!0;break}g=!1,c&&(a.once?e===!0?m.disable():c=[]:d&&d.length&&(e=d.shift(),m.fireWith(e[0],e[1])))},m={add:function(){if(c){var a=c.length;k(arguments),g?i=c.length:e&&e!==!0&&(h=a,l(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){g&&f<=i&&(i--,f<=j&&j--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){return c=[],this},disable:function(){return c=d=e=b,this},disabled:function(){return!c},lock:function(){return d=b,(!e||e===!0)&&m.disable(),this},locked:function(){return!d},fireWith:function(b,c){return d&&(g?a.once||d.push([b,c]):(!a.once||!e)&&l(b,c)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!f}};return m};var L=[].slice;J.extend({Deferred:function(a){var b=J.Callbacks("once memory"),c=J.Callbacks("once memory"),d=J.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){return h.done(a).fail(b).progress(c),this},always:function(){return h.done.apply(h,arguments).fail.apply(h,arguments),this},pipe:function(a,b,c){return J.Deferred(function(d){J.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],f;J.isFunction(c)?h[a](function(){f=c.apply(this,arguments),f&&J.isFunction(f.promise)?f.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===h?d:this,[f])}):h[a](d[e])})}).promise()},promise:function(a){if(a==null)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),i;for(i in f)h[i]=f[i].fire,h[i+"With"]=f[i].fireWith;return h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(h,h),h},when:function(a){function b(a){return function(b){g[a]=arguments.length>1?L.call(arguments,0):b,j.notifyWith(k,g)}}function c(a){return function(b){d[a]=arguments.length>1?L.call(arguments,0):b,--h||j.resolveWith(j,d)}}var d=L.call(arguments,0),e=0,f=d.length,g=Array(f),h=f,i=f,j=f<=1&&a&&J.isFunction(a.promise)?a:J.Deferred(),k=j.promise();if(f>1){for(;e<f;e++)d[e]&&d[e].promise&&J.isFunction(d[e].promise)?d[e].promise().then(c(e),j.reject,b(e)):--h;h||j.resolveWith(j,d)}else j!==a&&j.resolveWith(j,f?[a]:[]);return k}}),J.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=G.createElement("div"),o=G.documentElement;n.setAttribute("className","t"),n.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*"),d=n.getElementsByTagName("a")[0];if(!c||!c.length||!d)return{};e=G.createElement("select"),f=e.appendChild(G.createElement("option")),g=n.getElementsByTagName("input")[0],b={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.55/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:g.value==="on",optSelected:f.selected,getSetAttribute:n.className!=="t",enctype:!!G.createElement("form").enctype,html5Clone:G.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},J.boxModel=b.boxModel=G.compatMode==="CSS1Compat",g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete n.test}catch(p){b.deleteExpando=!1}!n.addEventListener&&n.attachEvent&&n.fireEvent&&(n.attachEvent("onclick",function(){b.noCloneEvent=!1}),n.cloneNode(!0).fireEvent("onclick")),g=G.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue=g.value==="t",g.setAttribute("checked","checked"),g.setAttribute("name","t"),n.appendChild(g),h=G.createDocumentFragment(),h.appendChild(n.lastChild),b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,h.removeChild(g),h.appendChild(n);if(n.attachEvent)for(l in{submit:1,change:1,focusin:1})k="on"+l,m=k in n,m||(n.setAttribute(k,"return;"),m=typeof n[k]=="function"),b[l+"Bubbles"]=m;return h.removeChild(n),h=e=f=n=g=null,J(function(){var c,d,e,f,g,h,j,k,l,o,p,q,r,s=G.getElementsByTagName("body")[0];!s||(k=1,r="padding:0;margin:0;border:",p="position:absolute;top:0;left:0;width:1px;height:1px;",q=r+"0;visibility:hidden;",l="style='"+p+r+"5px solid #000;",o="<div "+l+"display:block;'><div style='"+r+"0;display:block;overflow:hidden;'></div></div>"+"<table "+l+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",c=G.createElement("div"),c.style.cssText=q+"width:0;height:0;position:static;top:0;margin-top:"+k+"px",s.insertBefore(c,s.firstChild),n=G.createElement("div"),c.appendChild(n),n.innerHTML="<table><tr><td style='"+r+"0;display:none'></td><td>t</td></tr></table>",i=n.getElementsByTagName("td"),m=i[0].offsetHeight===0,i[0].style.display="",i[1].style.display="none",b.reliableHiddenOffsets=m&&i[0].offsetHeight===0,a.getComputedStyle&&(n.innerHTML="",j=G.createElement("div"),j.style.width="0",j.style.marginRight="0",n.style.width="2px",n.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0),typeof n.style.zoom!="undefined"&&(n.innerHTML="",n.style.width=n.style.padding="1px",n.style.border=0,n.style.overflow="hidden",n.style.display="inline",n.style.zoom=1,b.inlineBlockNeedsLayout=n.offsetWidth===3,n.style.display="block",n.style.overflow="visible",n.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=n.offsetWidth!==3),n.style.cssText=p+q,n.innerHTML=o,d=n.firstChild,e=d.firstChild,g=d.nextSibling.firstChild.firstChild,h={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:g.offsetTop===5},e.style.position="fixed",e.style.top="20px",h.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",h.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,h.doesNotIncludeMarginInBodyOffset=s.offsetTop!==k,a.getComputedStyle&&(n.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(n,null)||{marginTop:0}).marginTop!=="1%"),typeof c.style.zoom!="undefined"&&(c.style.zoom=1),s.removeChild(c),j=n=c=null,J.extend(b,h))}),b}();var M=/^(?:\{.*\}|\[.*\])$/,N=/([A-Z])/g;J.extend({cache:{},uuid:0,expando:"jQuery"+(J.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?J.cache[a[J.expando]]:a[J.expando],!!a&&!D(a)},data:function(a,c,d,e){if(!!J.acceptData(a)){var f,g,h,i=J.expando,j=typeof c=="string",k=a.nodeType,l=k?J.cache:a,m=k?a[i]:a[i]&&i,n=c==="events";if((!m||!l[m]||!n&&!e&&!l[m].data)&&j&&d===b)return;m||(k?a[i]=m=++J.uuid:m=i),l[m]||(l[m]={},k||(l[m].toJSON=J.noop));if(typeof c=="object"||typeof c=="function")e?l[m]=J.extend(l[m],c):l[m].data=J.extend(l[m].data,c);return f=g=l[m],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[J.camelCase(c)]=d),n&&!g[c]?f.events:(j?(h=g[c],h==null&&(h=g[J.camelCase(c)])):h=g,h)}},removeData:function(a,b,c){if(!!J.acceptData(a)){var d,e,f,g=J.expando,h=a.nodeType,i=h?J.cache:a,j=h?a[g]:g;if(!i[j])return;if(b){d=c?i[j]:i[j].data;if(d){J.isArray(b)||(b in d?b=[b]:(b=J.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?D:J.isEmptyObject)(d))return}}if(!c){delete i[j].data;if(!D(i[j]))return}J.support.deleteExpando||!i.setInterval?delete i[j]:i[j]=null,h&&(J.support.deleteExpando?delete a[g]:a.removeAttribute?a.removeAttribute(g):a[g]=null)}},_data:function(a,b,c){return J.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=J.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),J.fn.extend({data:function(a,c){var d,e,f,g,h,i=this[0],j=0,k=null;if(a===b){if(this.length){k=J.data(i);if(i.nodeType===1&&!J._data(i,"parsedAttrs")){f=i.attributes;for(h=f.length;j<h;j++)g=f[j].name,g.indexOf("data-")===0&&(g=J.camelCase(g.substring(5)),E(i,g,k[g]));J._data(i,"parsedAttrs",!0)}}return k}return typeof a=="object"?this.each(function(){J.data(this,a)}):(d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!",J.access(this,function(c){if(c===b)return k=this.triggerHandler("getData"+e,[d[0]]),k===b&&i&&(k=J.data(i,a),k=E(i,a,k)),k===b&&d[1]?this.data(d[0]):k;d[1]=c,this.each(function(){var b=J(this);b.triggerHandler("setData"+e,d),J.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){J.removeData(this,a)})}}),J.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",J._data(a,b,(J._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(J._data(b,d)||1)-1;e?J._data(b,d,e):(J.removeData(b,d,!0),C(b,c,"mark"))}},queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=J._data(a,b),c&&(!d||J.isArray(c)?d=J._data(a,b,J.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=J.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),J._data(a,b+".run",e),d.call(a,function(){J.dequeue(a,b)},e)),c.length||(J.removeData(a,b+"queue "+b+".run",!0),C(a,b,"queue"))}}),J.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?J.queue(this[0],a):c===b?this:this.each(function(){var b=J.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&J.dequeue(this,a)})},dequeue:function(a){return this.each(function(){J.dequeue(this,a)})},delay:function(a,b){return a=J.fx?J.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function d(){--h||e.resolveWith(f,[f])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var e=J.Deferred(),f=this,g=f.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=J.data(f[g],i,b,!0)||(J.data(f[g],j,b,!0)||J.data(f[g],k,b,!0))&&J.data(f[g],i,J.Callbacks("once memory"),!0))h++,l.add(d);return d(),e.promise(c)}});var O=/[\n\t\r]/g,P=/\s+/,Q=/\r/g,R=/^(?:button|input)$/i,S=/^(?:button|input|object|select|textarea)$/i,T=/^a(?:rea)?$/i,U=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=J.support.getSetAttribute,W,X,Y;J.fn.extend({attr:function(a,b){return J.access(this,J.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){J.removeAttr(this,a)})},prop:function(a,b){return J.access(this,J.prop,a,b,arguments.length>1)},removeProp:function(a){return a=J.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(J.isFunction(a))return this.each(function(b){J(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(P);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=J.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(J.isFunction(a))return this.each(function(b){J(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(P);for(d=0,e=this.length;d<e;d++){f=this[d];if(f.nodeType===1&&f.className)if(a){g=(" "+f.className+" ").replace(O," ");for(h=0,i=c.length;h<i;h++)g=g.replace(" "+c[h]+" "," ");f.className=J.trim(g)}else f.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return J.isFunction(a)?this.each(function(c){J(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=J(this),h=b,i=a.split(P);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&J._data(this,"__className__",this.className),this.className=this.className||a===!1?"":J._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!!arguments.length)return e=J.isFunction(a),this.each(function(d){var f=J(this),g;if(this.nodeType===1){e?g=a.call(this,d,f.val()):g=a,g==null?g="":typeof g=="number"?g+="":J.isArray(g)&&(g=J.map(g,function(a){return a==null?"":a+""})),c=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,g,"value")===b)this.value=g}});if(f)return c=J.valHooks[f.type]||J.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(Q,""):d==null?"":d)}}),J.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(J.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!J.nodeName(e.parentNode,"optgroup"))){b=J(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?J(h[f]).val():g},set:function(a,b){var c=J.makeArray(b);return J(a).find("option").each(function(){this.selected=J.inArray(J(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){if(e&&c in J.attrFn)return J(a)[c](d);if(typeof a.getAttribute=="undefined")return J.prop(a,c,d);h=i!==1||!J.isXMLDoc(a),h&&(c=c.toLowerCase(),g=J.attrHooks[c]||(U.test(c)?X:W));if(d!==b){if(d===null){J.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)}},removeAttr:function(a,b){var c,d,e,f,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(P),f=d.length;for(;h<f;h++)e=d[h],e&&(c=J.propFix[e]||e,g=U.test(e),g||J.attr(a,e,""),a.removeAttribute(V?e:c),g&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(R.test(a.nodeName)&&a.parentNode)J.error("type property can't be changed");else if(!J.support.radioValue&&b==="radio"&&J.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return W&&J.nodeName(a,"button")?W.get(a,b):b in a?a.value:null},set:function(a,b,c){if(W&&J.nodeName(a,"button"))return W.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!!a&&h!==3&&h!==8&&h!==2)return g=h!==1||!J.isXMLDoc(a),g&&(c=J.propFix[c]||c,f=J.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):S.test(a.nodeName)||T.test(a.nodeName)&&a.href?0:b}}}}),J.attrHooks.tabindex=J.propHooks.tabIndex,X={get:function(a,c){var d,e=J.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?J.removeAttr(a,c):(d=J.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},V||(Y={name:!0,id:!0,coords:!0},W=J.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=G.createAttribute(c),a.setAttributeNode(d)),d.nodeValue=b+""}},J.attrHooks.tabindex.set=W.set,J.each(["width","height"],function(a,b){J.attrHooks[b]=J.extend(J.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),J.attrHooks.contenteditable={get:W.get,set:function(a,b,c){b===""&&(b="false"),W.set(a,b,c)}}),J.support.hrefNormalized||J.each(["href","src","width","height"],function(a,c){J.attrHooks[c]=J.extend(J.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),J.support.style||(J.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),J.support.optSelected||(J.propHooks.selected=J.extend(J.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),J.support.enctype||(J.propFix.enctype="encoding"),J.support.checkOn||J.each(["radio","checkbox"],function(){J.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]=J.extend(J.valHooks[this],{set:function(a,b){if(J.isArray(b))return a.checked=J.inArray(J(a).val(),b)>=0}})});var Z=/^(?:textarea|input|select)$/i,$=/^([^\.]*)?(?:\.(.+))?$/,_=/(?:^|\s)hover(\.\S+)?\b/,ba=/^key/,bb=/^(?:mouse|contextmenu)|click/,bc=/^(?:focusinfocus|focusoutblur)$/,bd=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,be=function(a){var b=bd.exec(a);return b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)")),b},bf=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},bg=function(a){return J.event.special.hover?a:a.replace(_,"mouseenter$1 mouseleave$1")};J.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(g=J._data(a)))){d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=J.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof J=="undefined"||!!a&&J.event.triggered===a.type?b:J.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=J.trim(bg(c)).split(" ");for(j=0;j<c.length;j++){k=$.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=J.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=J.event.special[l]||{},n=J.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,quick:f&&be(f),namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),J.event.global[l]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f=J.hasData(a)&&J._data(a),g,h,i,j,k,l,m,n,o,p,q,r;if(!!f&&!!(n=f.events)){b=J.trim(bg(b||"")).split(" ");for(g=0;g<b.length;g++){h=$.exec(b[g])||[],i=j=h[1],k=h[2];if(!i){for(i in n)J.event.remove(a,i+b[g],c,d,!0);continue}o=J.event.special[i]||{},i=(d?o.delegateType:o.bindType)||i,q=n[i]||[],l=q.length,k=k?new RegExp("(^|\\.)"+k.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(m=0;m<q.length;m++)r=q[m],(e||j===r.origType)&&(!c||c.guid===r.guid)&&(!k||k.test(r.namespace))&&(!d||d===r.selector||d==="**"&&r.selector)&&(q.splice(m--,1),r.selector&&q.delegateCount--,o.remove&&o.remove.call(a,r));q.length===0&&l!==q.length&&((!o.teardown||o.teardown.call(a,k)===!1)&&J.removeEvent(a,i,f.handle),delete n[i])}J.isEmptyObject(n)&&(p=f.handle,p&&(p.elem=null),J.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||e.nodeType!==3&&e.nodeType!==8){var g=c.type||c,h=[],i,j,k,l,m,n,o,p,q,r;if(bc.test(g+J.event.triggered))return;g.indexOf("!")>=0&&(g=g.slice(0,-1),j=!0),g.indexOf(".")>=0&&(h=g.split("."),g=h.shift(),h.sort());if((!e||J.event.customEvent[g])&&!J.event.global[g])return;c=typeof c=="object"?c[J.expando]?c:new J.Event(g,c):new J.Event(g),c.type=g,c.isTrigger=!0,c.exclusive=j,c.namespace=h.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,n=g.indexOf(":")<0?"on"+g:"";if(!e){i=J.cache;for(k in i)i[k].events&&i[k].events[g]&&J.event.trigger(c,d,i[k].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?J.makeArray(d):[],d.unshift(c),o=J.event.special[g]||{};if(o.trigger&&o.trigger.apply(e,d)===!1)return;q=[[e,o.bindType||g]];if(!f&&!o.noBubble&&!J.isWindow(e)){r=o.delegateType||g,l=bc.test(r+g)?e:e.parentNode,m=null;for(;l;l=l.parentNode)q.push([l,r]),m=l;m&&m===e.ownerDocument&&q.push([m.defaultView||m.parentWindow||a,r])}for(k=0;k<q.length&&!c.isPropagationStopped();k++)l=q[k][0],c.type=q[k][1],p=(J._data(l,"events")||{})[c.type]&&J._data(l,"handle"),p&&p.apply(l,d),p=n&&l[n],p&&J.acceptData(l)&&p.apply(l,d)===!1&&c.preventDefault();return c.type=g,!f&&!c.isDefaultPrevented()&&(!o._default||o._default.apply(e.ownerDocument,d)===!1)&&(g!=="click"||!J.nodeName(e,"a"))&&J.acceptData(e)&&n&&e[g]&&(g!=="focus"&&g!=="blur"||c.target.offsetWidth!==0)&&!J.isWindow(e)&&(m=e[n],m&&(e[n]=null),J.event.triggered=g,e[g](),J.event.triggered=b,m&&(e[n]=m)),c.result}},dispatch:function(c){c=J.event.fix(c||a.event);var d=(J._data(this,"events")||{})[c.type]||[],e=d.delegateCount,f=[].slice.call(arguments,0),g=!c.exclusive&&!c.namespace,h=J.event.special[c.type]||{},i=[],j,k,l,m,n,o,p,q,r,s,t;f[0]=c,c.delegateTarget=this;if(!h.preDispatch||h.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){m=J(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this)if(l.disabled!==!0){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?bf(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(g||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((J.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,f),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return h.postDispatch&&h.postDispatch.call(this,c),c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||G,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[J.expando])return a;var c,d,e=a,f=J.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=J.Event(e);for(c=g.length;c;)d=g[--c],a[d]=e[d];return a.target||(a.target=e.srcElement||G),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey),f.filter?f.filter(a,e):a},special:{ready:{setup:J.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){J.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=J.extend(new J.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?J.event.trigger(e,null,b):J.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},J.event.handle=J.event.dispatch,J.removeEvent=G.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},J.Event=function(a,b){if(this instanceof J.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?A:B):this.type=a,b&&J.extend(this,b),this.timeStamp=a&&a.timeStamp||J.now(),this[J.expando]=!0;else return new J.Event(a,b)},J.Event.prototype={preventDefault:function(){this.isDefaultPrevented=A;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=A;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=A,this.stopPropagation()},isDefaultPrevented:B,isPropagationStopped:B,isImmediatePropagationStopped:B},J.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){J.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,f=e.selector,g;if(!d||d!==c&&!J.contains(c,d))a.type=e.origType,g=e.handler.apply(this,arguments),a.type=b;return g}}}),J.support.submitBubbles||(J.event.special.submit={setup:function(){if(J.nodeName(this,"form"))return!1;J.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=J.nodeName(c,"input")||J.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(J.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&J.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(J.nodeName(this,"form"))return!1;J.event.remove(this,"._submit")}}),J.support.changeBubbles||(J.event.special.change={setup:function(){if(Z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")J.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),J.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,J.event.simulate("change",this,a,!0))});return!1}J.event.add(this,"beforeactivate._change",function(a){var b=a.target;Z.test(b.nodeName)&&!b._change_attached&&(J.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&J.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return J.event.remove(this,"._change"),Z.test(this.nodeName)}}),J.support.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){J.event.simulate(b,a.target,J.event.fix(a),!0)};J.event.special[b]={setup:function(){c++===0&&G.addEventListener(a,d,!0)},teardown:function(){--c===0&&G.removeEventListener(a,d,!0)}}}),J.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=B;else if(!e)return this;return f===1&&(g=e,e=function(a){return J().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=J.guid++)),this.each(function(){J.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;return J(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this}if(typeof a=="object"){for(var f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=B),this.each(function(){J.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return J(this.context).on(a,this.selector,b,c),this},die:function(a,b){return J(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){J.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return J.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||J.guid++,d=0,e=function(c){var e=(J._data(this,"lastToggle"+a.guid)||0)%d;return J._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){J.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},J.attrFn&&(J.attrFn[b]=!0),ba.test(b)&&(J.event.fixHooks[b]=J.event.keyHooks),bb.test(b)&&(J.event.fixHooks[b]=J.event.mouseHooks)}),function(){function a(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}if(j.nodeType===1){g||(j[e]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}d[h]=k}}}function c(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}j.nodeType===1&&!g&&(j[e]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}d[h]=k}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e="sizcache"+(Math.random()+"").replace(".",""),f=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){return i=!1,0});var m=function(a,b,c,e){c=c||[],b=b||G;var f=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!a||typeof a!="string")return c;var h,i,j,k,l,n,q,r,t=!0,u=m.isXML(b),v=[],x=a;do{d.exec(""),h=d.exec(x);if(h){x=h[3],v.push(h[1]);if(h[2]){k=h[3];break}}}while(h);if(v.length>1&&p.exec(a))if(v.length===2&&o.relative[v[0]])i=w(v[0]+v[1],b,e);else{i=o.relative[v[0]]?[b]:m(v.shift(),b);while(v.length)a=v.shift(),o.relative[a]&&(a+=v.shift()),i=w(a,i,e)}else{!e&&v.length>1&&b.nodeType===9&&!u&&o.match.ID.test(v[0])&&!o.match.ID.test(v[v.length-1])&&(l=m.find(v.shift(),b,u),b=l.expr?m.filter(l.expr,l.set)[0]:l.set[0]);if(b){l=e?{expr:v.pop(),set:s(e)}:m.find(v.pop(),v.length!==1||v[0]!=="~"&&v[0]!=="+"||!b.parentNode?b:b.parentNode,u),i=l.expr?m.filter(l.expr,l.set):l.set,v.length>0?j=s(i):t=!1;while(v.length)n=v.pop(),q=n,o.relative[n]?q=v.pop():n="",q==null&&(q=b),o.relative[n](j,q,u)}else j=v=[]}j||(j=i),j||m.error(n||a);if(g.call(j)==="[object Array]")if(!t)c.push.apply(c,j);else if(b&&b.nodeType===1)for(r=0;j[r]!=null;r++)j[r]&&(j[r]===!0||j[r].nodeType===1&&m.contains(b,j[r]))&&c.push(i[r]);else for(r=0;j[r]!=null;r++)j[r]&&j[r].nodeType===1&&c.push(i[r]);else s(j,c);return k&&(m(k,f,c,e),m.uniqueSort(c)),c};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}return d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]),{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("parentNode",d,h,b,g,e)},"~":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("previousSibling",d,h,b,g,e)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);return a[0]=f++,a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");return!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(a,b,c,e,f){if(a[1]==="not")if((d.exec(a[3])||"").length>1||/^\w/.test(a[3]))a[3]=m(a[3],null,null,b);else{var g=m.filter(a[3],b,c,!0^f);return c||e.push.apply(e,g),!1}else if(o.match.POS.test(a[0])||o.match.CHILD.test(a[0]))return!0;return a},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,d,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],d=b[3];if(c===1&&d===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[e]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[e]=f}return j=a.nodeIndex-d,c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));o.match.globalPOS=p;var s=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(G.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;G.documentElement.compareDocumentPosition?u=function(a,b){return a===b?(h=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b)return h=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=G.createElement("div"),c="script"+(new Date).getTime(),d=G.documentElement;a.innerHTML="<a name='"+c+"'/>",d.insertBefore(a,d.firstChild),G.getElementById(c)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),d.removeChild(a),d=a=null}(),function(){var a=G.createElement("div");a.appendChild(G.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),G.querySelectorAll&&function(){var a=m,b=G.createElement("div"),c="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,d,e,f){d=d||G;if(!f&&!m.isXML(d)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(g&&(d.nodeType===1||d.nodeType===9)){if(g[1])return s(d.getElementsByTagName(b),e);if(g[2]&&o.find.CLASS&&d.getElementsByClassName)return s(d.getElementsByClassName(g[2]),e)}if(d.nodeType===9){if(b==="body"&&d.body)return s([d.body],e);if(g&&g[3]){var h=d.getElementById(g[3]);if(!h||!h.parentNode)return s([],e);if(h.id===g[3])return s([h],e)}try{return s(d.querySelectorAll(b),e)}catch(i){}}else if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j=d,k=d.getAttribute("id"),l=k||c,n=d.parentNode,p=/^\s*[+~]/.test(b);k?l=l.replace(/'/g,"\\$&"):d.setAttribute("id",l),p&&n&&(d=d.parentNode);try{if(!p||n)return s(d.querySelectorAll("[id='"+l+"'] "+b),e)}catch(q){}finally{k||j.removeAttribute("id")}}}return a(b,d,e,f)};for(var d in a)m[d]=a[d];b=null}}(),function(){var a=G.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(G.createElement("div"),"div"),d=!1;try{b.call(G.documentElement,"[test!='']:sizzle")}catch(e){d=!0}m.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(d||!o.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(e,null,null,[a]).length>0}}}(),function(){var a=G.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),G.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:G.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var w=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=J.attr,m.selectors.attrMap={},J.find=m,J.expr=m.selectors,J.expr[":"]=J.expr.filters,J.unique=m.uniqueSort,J.text=m.getText,J.isXMLDoc=m.isXML,J.contains=m.contains}();var bh=/Until$/,bi=/^(?:parents|prevUntil|prevAll)/,bj=/,/,bk=/^.[^:#\[\.,]*$/,bl=Array.prototype.slice,bm=J.expr.match.globalPOS,bn={children:!0,contents:!0,next:!0,prev:!0};J.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return J(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(J.contains(b[c],this))return!0});var e=this.pushStack("","find",a),f,g,h;for(c=0,d=this.length;c<d;c++){f=e.length,J.find(a,this[c],e);if(c>0)for(g=f;g<e.length;g++)for(h=0;h<f;h++)if(e[h]===e[g]){e.splice(g--,1);break}}return e},has:function(a){var b=J(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(J.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(y(this,a,!1),"not",a)},filter:function(a){return this.pushStack(y(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bm.test(a)?J(a,this.context).index(this[0])>=0:J.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,f=this[0];if(J.isArray(a)){var g=1;while(f&&f.ownerDocument&&f!==b){for(d=0;d<a.length;d++)J(f).is(a[d])&&c.push({selector:a[d],elem:f,level:g});f=f.parentNode,g++}return c}var h=bm.test(a)||typeof a!="string"?J(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){f=this[d];while(f){if(h?h.index(f)>-1:J.find.matchesSelector(f,a)){c.push(f);break}f=f.parentNode;if(!f||!f.ownerDocument||f===b||f.nodeType===11)break}}return c=c.length>1?J.unique(c):c,this.pushStack(c,"closest",a)},index:function(a){return a?typeof a=="string"?J.inArray(this[0],J(a)):J.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?J(a,b):J.makeArray(a&&a.nodeType?[a]:a),d=J.merge(this.get(),c);return this.pushStack(z(c[0])||z(d[0])?d:J.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),J.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return J.dir(a,"parentNode")},parentsUntil:function(a,b,c){return J.dir(a,"parentNode",c)},next:function(a){return J.nth(a,2,"nextSibling")},prev:function(a){return J.nth(a,2,"previousSibling")},nextAll:function(a){return J.dir(a,"nextSibling")},prevAll:function(a){return J.dir(a,"previousSibling")},nextUntil:function(a,b,c){return J.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return J.dir(a,"previousSibling",c)},siblings:function(a){return J.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return J.sibling(a.firstChild)},contents:function(a){return J.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:J.makeArray(a.childNodes)}},function(a,b){J.fn[a]=function(c,d){var e=J.map(this,b,c);return bh.test(a)||(d=c),d&&typeof d=="string"&&(e=J.filter(d,e)),e=this.length>1&&!bn[a]?J.unique(e):e,(this.length>1||bj.test(d))&&bi.test(a)&&(e=e.reverse()),this.pushStack(e,a,bl.call(arguments).join(","))}}),J.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?J.find.matchesSelector(b[0],a)?[b[0]]:[]:J.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!J(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bo="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bp=/ jQuery\d+="(?:\d+|null)"/g,bq=/^\s+/,br=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,bs=/<([\w:]+)/,bt=/<tbody/i,bu=/<|&#?\w+;/,bv=/<(?:script|style)/i,bw=/<(?:script|object|embed|option|style)/i,bx=new RegExp("<(?:"+bo+")[\\s/>]","i"),by=/checked\s*(?:[^=]|=\s*.checked.)/i,bz=/\/(java|ecma)script/i,bA=/^\s*<!(?:\[CDATA\[|\-\-)/,bB={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bC=x(G);bB.optgroup=bB.option,bB.tbody=bB.tfoot=bB.colgroup=bB.caption=bB.thead,bB.th=bB.td,J.support.htmlSerialize||(bB._default=[1,"div<div>","</div>"]),J.fn.extend({text:function(a){return J.access(this,function(a){return a===b?J.text(this):this.empty().append((this[0]&&this[0].ownerDocument||G).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(J.isFunction(a))return this.each(function(b){J(this).wrapAll(a.call(this,b))});if(this[0]){var b=J(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return J.isFunction(a)?this.each(function(b){J(this).wrapInner(a.call(this,b))}):this.each(function(){var b=J(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=J.isFunction(a);return this.each(function(c){J(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=J.clean(arguments);return a.push.apply(a,this.toArray()),this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);return a.push.apply(a,J.clean(arguments)),a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||J.filter(a,[d]).length)!b&&d.nodeType===1&&(J.cleanData(d.getElementsByTagName("*")),J.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&J.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return J.clone(this,a,b)})},html:function(a){return J.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(bp,""):null;if(typeof a=="string"&&!bv.test(a)&&(J.support.leadingWhitespace||!bq.test(a))&&!bB[(bs.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(br,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(J.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return this[0]&&this[0].parentNode?J.isFunction(a)?this.each(function(b){var c=J(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=J(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;J(this).remove(),b?J(b).before(a):J(c).append(a)})):this.length?this.pushStack(J(J.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,f,g,h,i=a[0],j=[];if(!J.support.checkClone&&arguments.length===3&&typeof i=="string"&&by.test(i))return this.each(function(){J(this).domManip(a,c,d,!0)});if(J.isFunction(i))return this.each(function(e){var f=J(this);a[0]=i.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){h=i&&i.parentNode,J.support.parentNode&&h&&h.nodeType===11&&h.childNodes.length===this.length?e={fragment:h}:e=J.buildFragment(a,this,j),g=e.fragment,g.childNodes.length===1?f=g=g.firstChild:f=g.firstChild;if(f){c=c&&J.nodeName(f,"tr");for(var k=0,l=this.length,m=l-1;k<l;k++)d.call(c?w(this[k],f):this[k],e.cacheable||l>1&&k<m?J.clone(g,!0,!0):g)}j.length&&J.each(j,function(a,b){b.src?J.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):J.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bA,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),J.buildFragment=function(a,b,c){var d,e,f,g,h=a[0];return b&&b[0]&&(g=b[0].ownerDocument||b[0]),g.createDocumentFragment||(g=G),a.length===1&&typeof h=="string"&&h.length<512&&g===G&&h.charAt(0)==="<"&&!bw.test(h)&&(J.support.checkClone||!by.test(h))&&(J.support.html5Clone||!bx.test(h))&&(e=!0,f=J.fragments[h],f&&f!==1&&(d=f)),d||(d=g.createDocumentFragment(),J.clean(a,g,d,c)),e&&(J.fragments[h]=f?d:1),{fragment:d,cacheable:e}},J.fragments={},J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){J.fn[a]=function(c){var d=[],e=J(c),f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&e.length===1)return e[b](this[0]),this;for(var g=0,h=e.length;g<h;g++){var i=(g>0?this.clone(!0):this).get();J(e[g])[b](i),d=d.concat(i)}return this.pushStack(d,a,e.selector)}}),J.extend({clone:function(a,b,c){var d,e,f,g=J.support.html5Clone||J.isXMLDoc(a)||!bx.test("<"+a.nodeName+">")?a.cloneNode(!0):q(a);if((!J.support.noCloneEvent||!J.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!J.isXMLDoc(a)){u(a,g),d=t(a),e=t(g);for(f=0;d[f];++f)e[f]&&u(d[f],e[f])}if(b){v(a,g);if(c){d=t(a),e=t(g);for(f=0;d[f];++f)v(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var e,f,g,h=[];b=b||G,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||G);for(var i=0,j;(j=a[i])!=null;i++){typeof j=="number"&&(j+="");if(!j)continue;if(typeof j=="string")if(!bu.test(j))j=b.createTextNode(j);else{j=j.replace(br,"<$1></$2>");var k=(bs.exec(j)||["",""])[1].toLowerCase(),l=bB[k]||bB._default,m=l[0],n=b.createElement("div"),o=bC.childNodes,p;b===G?bC.appendChild(n):x(b).appendChild(n),n.innerHTML=l[1]+j+l[2];while(m--)n=n.lastChild;if(!J.support.tbody){var q=bt.test(j),s=k==="table"&&!q?n.firstChild&&n.firstChild.childNodes:l[1]==="<table>"&&!q?n.childNodes:[];for(g=s.length-1;g>=0;--g)J.nodeName(s[g],"tbody")&&!s[g].childNodes.length&&s[g].parentNode.removeChild(s[g])}!J.support.leadingWhitespace&&bq.test(j)&&n.insertBefore(b.createTextNode(bq.exec(j)[0]),n.firstChild),j=n.childNodes,n&&(n.parentNode.removeChild(n),o.length>0&&(p=o[o.length-1],p&&p.parentNode&&p.parentNode.removeChild(p)))}var t;if(!J.support.appendChecked)if(j[0]&&typeof (t=j.length)=="number")for(g=0;g<t;g++)r(j[g]);else r(j);j.nodeType?h.push(j):h=J.merge(h,j)}if(c){e=function(a){return!a.type||bz.test(a.type)};for(i=0;h[i];i++){f=h[i];if(d&&J.nodeName(f,"script")&&(!f.type||bz.test(f.type)))d.push(f.parentNode?f.parentNode.removeChild(f):f);else{if(f.nodeType===1){var u=J.grep(f.getElementsByTagName("script"),e);h.splice.apply(h,[i+1,0].concat(u))}c.appendChild(f)}}}return h},cleanData:function(a){var b,c,d=J.cache,e=J.event.special,f=J.support.deleteExpando;for(var g=0,h;(h=a[g])!=null;g++){if(h.nodeName&&J.noData[h.nodeName.toLowerCase()])continue;c=h[J.expando];if(c){b=d[c];if(b&&b.events){for(var i in b.events)e[i]?J.event.remove(h,i):J.removeEvent(h,i,b.handle);b.handle&&(b.handle.elem=null)}f?delete h[J.expando]:h.removeAttribute&&h.removeAttribute(J.expando),delete d[c]}}}});var bD=/alpha\([^)]*\)/i,bE=/opacity=([^)]*)/,bF=/([A-Z]|^ms)/g,bG=/^[\-+]?(?:\d*\.)?\d+$/i,bH=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bI=/^([\-+])=([\-+.\de]+)/,bJ=/^margin/,bK={position:"absolute",visibility:"hidden",display:"block"},bL=["Top","Right","Bottom","Left"],bM,bN,bO;J.fn.css=function(a,c){return J.access(this,function(a,c,d){return d!==b?J.style(a,c,d):J.css(a,c)},a,c,arguments.length>1)},J.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bM(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":J.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var f,g,h=J.camelCase(c),i=a.style,j=J.cssHooks[h];c=J.cssProps[h]||h;if(d===b)return j&&"get"in j&&(f=j.get(a,!1,e))!==b?f:i[c];g=typeof d,g==="string"&&(f=bI.exec(d))&&(d=+(f[1]+1)*+f[2]+parseFloat(J.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!J.cssNumber[h]&&(d+="px");if(!j||!("set"in j)||(d=j.set(a,d))!==b)try{i[c]=d}catch(k){}}},css:function(a,c,d){var e,f;c=J.camelCase(c),f=J.cssHooks[c],c=J.cssProps[c]||c,c==="cssFloat"&&(c="float");if(f&&"get"in f&&(e=f.get(a,!0,d))!==b)return e;if(bM)return bM(a,c)},swap:function(a,b,c){var d={},e,f;for(f in b)d[f]=a.style[f],a.style[f]=b[f];e=c.call(a);for(f in b)a.style[f]=d[f];return e}}),J.curCSS=J.css,G.defaultView&&G.defaultView.getComputedStyle&&(bN=function(a,b){var c,d,e,f,g=a.style;return b=b.replace(bF,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!J.contains(a.ownerDocument.documentElement,a)&&(c=J.style(a,b))),!J.support.pixelMargin&&e&&bJ.test(b)&&bH.test(c)&&(f=g.width,g.width=c,c=e.width,g.width=f),c}),G.documentElement.currentStyle&&(bO=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;return f==null&&g&&(e=g[b])&&(f=e),bH.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d)),f===""?"auto":f}),bM=bN||bO,J.each(["height","width"],function(a,b){J.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth!==0?p(a,b,d):J.swap(a,bK,function(){return p(a,b,d)})},set:function(a,b){return bG.test(b)?b+"px":b}}}),J.support.opacity||(J.cssHooks.opacity={get:function(a,b){return bE.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=J.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&J.trim(f.replace(bD,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bD.test(f)?f.replace(bD,e):f+" "+e}}),J(function(){J.support.reliableMarginRight||(J.cssHooks.marginRight={get:function(a,b){return J.swap(a,{display:"inline-block"},function(){return b?bM(a,"margin-right"):a.style.marginRight})}})}),J.expr&&J.expr.filters&&(J.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!J.support.reliableHiddenOffsets&&(a.style&&a.style.display||J.css(a,"display"))==="none"},J.expr.filters.visible=function(a){return!J.expr.filters.hidden(a)}),J.each({margin:"",padding:"",border:"Width"},function(a,b){J.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bL[d]+b]=e[d]||e[d-2]||e[0];return f}}});var bP=/%20/g,bQ=/\[\]$/,bR=/\r?\n/g,bS=/#.*$/,bT=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bU=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bV=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bW=/^(?:GET|HEAD)$/,bX=/^\/\//,bY=/\?/,bZ=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,b$=/^(?:select|textarea)/i,b_=/\s+/,ca=/([?&])_=[^&]*/,cb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,cc=J.fn.load,cd={},ce={},cf,cg,ch=["*/"]+["*"];try{cf=I.href}catch(ci){cf=G.createElement("a"),cf.href="",cf=cf.href}cg=cb.exec(cf.toLowerCase())||[],J.fn.extend({load:function(a,c,d){if(typeof a!="string"&&cc)return cc.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}var g="GET";c&&(J.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=J.param(c,J.ajaxSettings.traditional),g="POST"));var h=this;return J.ajax({url:a,type:g,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),h.html(f?J("<div>").append(c.replace(bZ,"")).find(f):c)),d&&h.each(d,[c,b,a])}}),this},serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?J.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||b$.test(this.nodeName)||bU.test(this.type))}).map(function(a,b){var c=J(this).val();return c==null?null:J.isArray(c)?J.map(c,function(a,c){return{name:b.name,value:a.replace(bR,"\r\n")}}):{name:b.name,value:c.replace(bR,"\r\n")}}).get()}}),J.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){J.fn[b]=function(a){return this.on(b,a)}}),J.each(["get","post"],function(a,c){J[c]=function(a,d,e,f){return J.isFunction(d)&&(f=f||e,e=d,d=b),J.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),J.extend({getScript:function(a,c){return J.get(a,b,c,"script")},getJSON:function(a,b,c){return J.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?m(a,J.ajaxSettings):(b=a,a=J.ajaxSettings),m(a,b),a},ajaxSettings:{url:cf,isLocal:bV.test(cg[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":ch},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:o(cd),ajaxTransport:o(ce),ajax:function(a,c){function d(a,c,d,n){if(v!==2){v=2,t&&clearTimeout(t),s=b,q=n||"",y.readyState=a>0?4:0;var o,p,r,u=c,x=d?k(e,y,d):b,z,A;if(a>=200&&a<300||a===304){if(e.ifModified){if(z=y.getResponseHeader("Last-Modified"))J.lastModified[m]=z;if(A=y.getResponseHeader("Etag"))J.etag[m]=A}if(a===304)u="notmodified",o=!0;else try{p=j(e,x),u="success",o=!0}catch(B){u="parsererror",r=B}}else{r=u;if(!u||a)u="error",a<0&&(a=0)}y.status=a,y.statusText=""+(c||u),o?h.resolveWith(f,[p,u,y]):h.rejectWith(f,[y,u,r]),y.statusCode(l),l=b,w&&g.trigger("ajax"+(o?"Success":"Error"),[y,e,o?p:r]),i.fireWith(f,[y,u]),w&&(g.trigger("ajaxComplete",[y,e]),--J.active||J.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var e=J.ajaxSetup({},c),f=e.context||e,g=f!==e&&(f.nodeType||f instanceof J)?J(f):J.event,h=J.Deferred(),i=J.Callbacks("once memory"),l=e.statusCode||{},m,o={},p={},q,r,s,t,u,v=0,w,x,y={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=p[c]=p[c]||a,o[a]=b}return this},getAllResponseHeaders:function(){return v===2?q:null},getResponseHeader:function(a){var c;if(v===2){if(!r){r={};while(c=bT.exec(q))r[c[1].toLowerCase()]=c[2]}c=r[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(e.mimeType=a),this},abort:function(a){return a=a||"abort",s&&s.abort(a),d(0,a),this}};h.promise(y),y.success=y.done,y.error=y.fail,y.complete=i.add,y.statusCode=function(a){if(a){var b;if(v<2)for(b in a)l[b]=[l[b],a[b]];else b=a[y.status],y.then(b,b)}return this},e.url=((a||e.url)+"").replace(bS,"").replace(bX,cg[1]+"//"),e.dataTypes=J.trim(e.dataType||"*").toLowerCase().split(b_),e.crossDomain==null&&(u=cb.exec(e.url.toLowerCase()),e.crossDomain=!(!u||u[1]==cg[1]&&u[2]==cg[2]&&(u[3]||(u[1]==="http:"?80:443))==(cg[3]||(cg[1]==="http:"?80:443)))),e.data&&e.processData&&typeof e.data!="string"&&(e.data=J.param(e.data,e.traditional)),n(cd,e,c,y);if(v===2)return!1;w=e.global,e.type=e.type.toUpperCase(),e.hasContent=!bW.test(e.type),w&&J.active++===0&&J.event.trigger("ajaxStart");if(!e.hasContent){e.data&&(e.url+=(bY.test(e.url)?"&":"?")+e.data,delete e.data),m=e.url;if(e.cache===!1){var z=J.now(),A=e.url.replace(ca,"$1_="+z);e.url=A+(A===e.url?(bY.test(e.url)?"&":"?")+"_="+z:"")}}(e.data&&e.hasContent&&e.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",e.contentType),e.ifModified&&(m=m||e.url,J.lastModified[m]&&y.setRequestHeader("If-Modified-Since",J.lastModified[m]),J.etag[m]&&y.setRequestHeader("If-None-Match",J.etag[m])),y.setRequestHeader("Accept",e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+(e.dataTypes[0]!=="*"?", "+ch+"; q=0.01":""):e.accepts["*"]);for(x in e.headers)y.setRequestHeader(x,e.headers[x]);if(!e.beforeSend||e.beforeSend.call(f,y,e)!==!1&&v!==2){for(x in{success:1,error:1,complete:1})y[x](e[x]);s=n(ce,e,c,y);if(!s)d(-1,"No Transport");else{y.readyState=1,w&&g.trigger("ajaxSend",[y,e]),e.async&&e.timeout>0&&(t=setTimeout(function(){y.abort("timeout")},e.timeout));try{v=1,s.send(o,d)}catch(B){if(v<2)d(-1,B);else throw B}}return y}return y.abort(),!1},param:function(a,c){var d=[],e=function(a,b){b=J.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=J.ajaxSettings.traditional);if(J.isArray(a)||a.jquery&&!J.isPlainObject(a))J.each(a,function(){e(this.name,this.value)});else for(var f in a)l(f,a[f],c,e);return d.join("&").replace(bP,"+")}}),J.extend({active:0,lastModified:{},etag:{}});var cj=J.now(),ck=/(\=)\?(&|$)|\?\?/i;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return J.expando+"_"+cj++}}),J.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ck.test(b.url)||e&&ck.test(b.data))){var f,g=b.jsonpCallback=J.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h=a[g],i=b.url,j=b.data,k="$1"+g+"$2";return b.jsonp!==!1&&(i=i.replace(ck,k),b.url===i&&(e&&(j=j.replace(ck,k)),b.data===j&&(i+=(/\?/.test(i)?"&":"?")+b.jsonp+"="+g))),b.url=i,b.data=j,a[g]=function(a){f=[a]},d.always(function(){a[g]=h,f&&J.isFunction(h)&&a[g](f[0])}),b.converters["script json"]=function(){return f||J.error(g+" was not called"),f[0]},b.dataTypes[0]="json","script"}}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return J.globalEval(a),a}}}),J.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),J.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=G.head||G.getElementsByTagName("head")[0]||G.documentElement;return{send:function(e,f){c=G.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cl=a.ActiveXObject?function(){for(var a in cn)cn[a](0,1)}:!1,cm=0,cn;J.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&i()||h()}:i,function(a){J.extend(J.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(J.ajaxSettings.xhr()),J.support.ajax&&J.ajaxTransport(function(c){if(!c.crossDomain||J.support.cors){var d;return{send:function(e,f){var g=c.xhr(),h,i;c.username?g.open(c.type,c.url,c.async,c.username,c.password):g.open(c.type,c.url,c.async);if(c.xhrFields)for(i in c.xhrFields)g[i]=c.xhrFields[i];c.mimeType&&g.overrideMimeType&&g.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(i in e)g.setRequestHeader(i,e[i])}catch(j){}g.send(c.hasContent&&c.data||null),d=function(a,e){var i,j,k,l,m;try{if(d&&(e||g.readyState===4)){d=b,h&&(g.onreadystatechange=J.noop,cl&&delete cn[h]);if(e)g.readyState!==4&&g.abort();else{i=g.status,k=g.getAllResponseHeaders(),l={},m=g.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=g.responseText}catch(a){}try{j=g.statusText}catch(n){j=""}!i&&c.isLocal&&!c.crossDomain?i=l.text?200:404:i===1223&&(i=204)}}}catch(o){e||f(-1,o)}l&&f(i,j,l,k)},!c.async||g.readyState===4?d():(h=++cm,cl&&(cn||(cn={},J(a).unload(cl)),cn[h]=d),g.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var co={},cp,cq,cr=/^(?:toggle|show|hide)$/,cs=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,ct,cu=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cv;J.fn.extend({show:function(a,b,c){var f,g;if(a||a===0)return this.animate(e("show",3),a,b,c);for(var h=0,i=this.length;h<i;h++)f=this[h],f.style&&(g=f.style.display,!J._data(f,"olddisplay")&&g==="none"&&(g=f.style.display=""),(g===""&&J.css(f,"display")==="none"||!J.contains(f.ownerDocument.documentElement,f))&&J._data(f,"olddisplay",d(f.nodeName)));for(h=0;h<i;h++){f=this[h];if(f.style){g=f.style.display;if(g===""||g==="none")f.style.display=J._data(f,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(e("hide",3),a,b,c);var d,f,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(f=J.css(d,"display"),f!=="none"&&!J._data(d,"olddisplay")&&J._data(d,"olddisplay",f));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:J.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";return J.isFunction(a)&&J.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:J(this).is(":hidden");J(this)[b?"show":"hide"]()}):this.animate(e("toggle",3),a,b,c),this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,e){function f(){g.queue===!1&&J._mark(this);var b=J.extend({},g),c=this.nodeType===1,e=c&&J(this).is(":hidden"),f,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){f=J.camelCase(i),i!==f&&(a[f]=a[i],delete a[i]);if((k=J.cssHooks[f])&&"expand"in k){l=k.expand(a[f]),delete a[f];for(i in l)i in a||(a[i]=l[i])}}for(f in a){h=a[f],J.isArray(h)?(b.animatedProperties[f]=h[1],h=a[f]=h[0]):b.animatedProperties[f]=b.specialEasing&&b.specialEasing[f]||b.easing||"swing";if(h==="hide"&&e||h==="show"&&!e)return b.complete.call(this);c&&(f==="height"||f==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],J.css(this,"display")==="inline"&&J.css(this,"float")==="none"&&(!J.support.inlineBlockNeedsLayout||d(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new J.fx(this,b,i),h=a[i],cr.test(h)?(q=J._data(this,"toggle"+i)||(h==="toggle"?e?"show":"hide":0),q?(J._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cs.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(J.cssNumber[i]?"":"px"),p!=="px"&&(J.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,J.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""));return!0}var g=J.speed(b,c,e);return J.isEmptyObject(a)?this.each(g.complete,[!1]):(a=J.extend({},a),g.queue===!1?this.each(f):this.queue(g.queue,f))},stop:function(a,c,d){return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){function b(a,b,c){var e=b[c];J.removeData(a,c,!0),e.stop(d)}var c,e=!1,f=J.timers,g=J._data(this);d||J._unmark(!0,this);if(a==null)for(c in g)g[c]&&g[c].stop&&c.indexOf(".run")===c.length-4&&b(this,g,c);else g[c=a+".run"]&&g[c].stop&&b(this,g,c);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(d?f[c](!0):f[c].saveState(),e=!0,f.splice(c,1));(!d||!e)&&J.dequeue(this,a)})}}),J.each({slideDown:e("show",1),slideUp:e("hide",1),slideToggle:e("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){J.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),J.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?J.extend({},a):{complete:c||!c&&b||J.isFunction(a)&&a,duration:a,easing:c&&b||b&&!J.isFunction(b)&&b};d.duration=J.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in J.fx.speeds?J.fx.speeds[d.duration]:J.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(a){J.isFunction(d.old)&&d.old.call(this),d.queue?J.dequeue(this,d.queue):a!==!1&&J._unmark(this)},d},easing:{linear:function(a){return a},swing:function(a){return-Math.cos(a*Math.PI)/2+.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),J.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(J.fx.step[this.prop]||J.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var a,b=J.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a}return this.elem[this.prop]},custom:function(a,c,d){function e(a){return f.step(a)}var f=this,h=J.fx;this.startTime=cv||g(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(J.cssNumber[this.prop]?"":"px"),e.queue=this.options.queue,e.elem=this.elem,e.saveState=function(){J._data(f.elem,"fxshow"+f.prop)===b&&(f.options.hide?J._data(f.elem,"fxshow"+f.prop,f.start):f.options.show&&J._data(f.elem,"fxshow"+f.prop,f.end))},e()&&J.timers.push(e)&&!ct&&(ct=setInterval(h.tick,h.interval))},show:function(){var a=J._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||J.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),J(this.elem).show()},hide:function(){this.options.orig[this.prop]=J._data(this.elem,"fxshow"+this.prop)||J.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cv||g(),f=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(f=!1);if(f){i.overflow!=null&&!J.support.shrinkWrapBlocks&&J.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&J(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)J.style(h,b,i.orig[b]),J.removeData(h,"fxshow"+b,!0),J.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}return i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=J.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},J.extend(J.fx,{tick:function(){var a,b=J.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||J.fx.stop()},interval:13,stop:function(){clearInterval(ct),ct=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){J.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),J.each(cu.concat.apply([],cu),function(a,b){b.indexOf("margin")&&(J.fx.step[b]=function(a){J.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),J.expr&&J.expr.filters&&(J.expr.filters.animated=function(a){return J.grep(J.timers,function(b){return a===b.elem}).length});var cw,cx=/^t(?:able|d|h)$/i,cy=/^(?:body|html)$/i;"getBoundingClientRect"in G.documentElement?cw=function(a,b,d,e){try{e=a.getBoundingClientRect()}catch(f){}if(!e||!J.contains(d,a))return e?{top:e.top,left:e.left}:{top:0,left:0};var g=b.body,h=c(b),i=d.clientTop||g.clientTop||0,j=d.clientLeft||g.clientLeft||0,k=h.pageYOffset||J.support.boxModel&&d.scrollTop||g.scrollTop,l=h.pageXOffset||J.support.boxModel&&d.scrollLeft||g.scrollLeft,m=e.top+k-i,n=e.left+l-j;return{top:m,left:n}}:cw=function(a,b,c){var d,e=a.offsetParent,f=a,g=b.body,h=b.defaultView,i=h?h.getComputedStyle(a,null):a.currentStyle,j=a.offsetTop,k=a.offsetLeft;while((a=a.parentNode)&&a!==g&&a!==c){if(J.support.fixedPosition&&i.position==="fixed")break;d=h?h.getComputedStyle(a,null):a.currentStyle,j-=a.scrollTop,k-=a.scrollLeft,a===e&&(j+=a.offsetTop,k+=a.offsetLeft,J.support.doesNotAddBorder&&(!J.support.doesAddBorderForTableAndCells||!cx.test(a.nodeName))&&(j+=parseFloat(d.borderTopWidth)||0,k+=parseFloat(d.borderLeftWidth)||0),f=e,e=a.offsetParent),J.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(j+=parseFloat(d.borderTopWidth)||0,k+=parseFloat(d.borderLeftWidth)||0),i=d}if(i.position==="relative"||i.position==="static")j+=g.offsetTop,k+=g.offsetLeft;return J.support.fixedPosition&&i.position==="fixed"&&(j+=Math.max(c.scrollTop,g.scrollTop),k+=Math.max(c.scrollLeft,g.scrollLeft)),{top:j,left:k}},J.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){J.offset.setOffset(this,a,b)});var c=this[0],d=c&&c.ownerDocument;return d?c===d.body?J.offset.bodyOffset(c):cw(c,d,d.documentElement):null},J.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return J.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(J.css(a,"marginTop"))||0,c+=parseFloat(J.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=J.css(a,"position");d==="static"&&(a.style.position="relative");var e=J(a),f=e.offset(),g=J.css(a,"top"),h=J.css(a,"left"),i=(d==="absolute"||d==="fixed")&&J.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),J.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},J.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cy.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(J.css(a,"marginTop"))||0,c.left-=parseFloat(J.css(a,"marginLeft"))||0,d.top+=parseFloat(J.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(J.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||G.body;while(a&&!cy.test(a.nodeName)&&J.css(a,"position")==="static")a=a.offsetParent;return a})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,d){var e=/Y/.test(d);J.fn[a]=function(f){return J.access(this,function(a,f,g){var h=c(a);if(g===b)return h?d in h?h[d]:J.support.boxModel&&h.document.documentElement[f]||h.document.body[f]:a[f];h?h.scrollTo(e?J(h).scrollLeft():g,e?g:J(h).scrollTop()):a[f]=g},a,f,arguments.length,null)}}),J.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,f="offset"+a;J.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(J.css(a,c,"padding")):this[c]():null},J.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(J.css(b,c,a?"margin":"border")):this[c]():null},J.fn[c]=function(a){return J.access(this,function(a,c,g){var h,i,j,k;if(J.isWindow(a))return h=a.document,i=h.documentElement[d],J.support.boxModel&&i||h.body&&h.body[d]||i;if(a.nodeType===9)return h=a.documentElement,h[d]>=h[e]?h[d]:Math.max(a.body[e],h[e],a.body[f],h[f]);if(g===b)return j=J.css(a,c),k=parseFloat(j),J.isNumeric(k)?k:j;J(a).css(c,g)},c,a,arguments.length,null)}}),a.jQuery=a.$=J,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return J})})(window),function(){function A(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&w.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return!1;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&A(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(w.has(a,h)){f++;if(!(g=w.has(b,h)&&A(a[h],b[h],c)))break}if(g){for(h in b)if(w.has(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new I(a)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=w),exports._=w):a._=w,w.VERSION="1.3.3";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(w.has(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=w.collect=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=w.toArray(a).reverse();return d&&!e&&(b=w.bind(b,d)),e?w.reduce(f,b,c,d):w.reduce(f,b)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},w.filter=w.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return a==null?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return a==null?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var y=w.some=w.any=function(a,b,d){b||(b=w.identity);var e=!1;return a==null?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};w.include=w.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(c=y(a,function(a){return a===b}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(w.isFunction(b)?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&w.isEmpty(a))return-Infinity;var d={computed:-Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&w.isEmpty(a))return Infinity;var d={computed:Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.shuffle=function(a){var b=[],c;return x(a,function(a,d,e){c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a}),b},w.sortBy=function(a,b,c){var d=w.isFunction(b)?b:function(a){return a[b]};return w.pluck(w.map(a,function(a,b,e){return{value:a,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={},d=w.isFunction(b)?b:function(a){return a[b]};return x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):a.toArray&&w.isFunction(a.toArray)?a.toArray():w.values(a):[]},w.size=function(a){return w.isArray(a)?a.length:w.keys(a).length},w.first=w.head=w.take=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},w.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a,b){return w.reduce(a,function(a,c){return w.isArray(c)?a.concat(b?c:w.flatten(c)):(a[a.length]=c,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b,c){var d=c?w.map(a,c):a,e=[];return a.length<3&&(b=!0),w.reduce(d,function(c,d,f){if(b?w.last(c)!==d||!c.length:!w.include(c,d))c.push(d),e.push(a[f]);return c},[]),e},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a){var b=w.flatten(g.call(arguments,1),!0);return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(c in a&&a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var z=function(){};w.bind=function(a,b){var c,d;if(a.bind===v&&v)return v.apply(a,g.call(arguments,1));if(!w.isFunction(a))throw new TypeError;return d=g.call(arguments,2),c=function(){if(this instanceof c){z.prototype=a.prototype;var e=new z,f=a.apply(e,d.concat(g.call(arguments)));return Object(f)===f?f:e}return a.apply(b,d.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return w.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))},w.throttle=function(a,b){var c,d,e,f,g,h,i=w.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var j=function(){e=null,g&&a.apply(c,d),i()};return e||(e=setTimeout(j,b)),f?g=!0:h=a.apply(c,d),i(),f=!0,h}},w.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)};c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(g,b)}},w.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments,0));return b.apply(this,c)}},w.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)w.has(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},w.pick=function(a){var b={};return x(w.flatten(g.call(arguments,1)),function(c){c in a&&(b[c]=a[c])}),b},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},w.clone=function(a){return w.isObject(a)?w.isArray(a)?a.slice():w.extend({},a):a},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){return A(a,b,[])},w.isEmpty=function(a){if(a==null)return!0;if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(w.has(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)=="[object Array]"},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return i.call(a)=="[object Arguments]"},w.isArguments(arguments)||(w.isArguments=function(a){return!!a&&!!w.has(a,"callee")}),w.isFunction=function(a){return i.call(a)=="[object Function]"},w.isString=function(a){return i.call(a)=="[object String]"},w.isNumber=function(a){return i.call(a)=="[object Number]"},w.isFinite=function(a){return w.isNumber(a)&&isFinite(a)},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},w.isDate=function(a){return i.call(a)=="[object Date]"},w.isRegExp=function(a){return i.call(a)=="[object RegExp]"},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.has=function(a,b){return j.call(a,b)},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.result=function(a,b){if(a==null)return null;var c=a[b];return w.isFunction(c)?c.call(a):c},w.mixin=function(a){x(w.functions(a),function(b){K(b,w[b]=a[b])})};var B=0;w.uniqueId=function(a){var b=B++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,D={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var E in D)D[D[E]]=E;var F=/\\|'|\r|\n|\t|\u2028|\u2029/g,G=/\\(\\|'|r|n|t|u2028|u2029)/g,H=function(a){return a.replace(G,function(a,b){return D[b]})};w.template=function(a,b,c){c=w.defaults(c||{},w.templateSettings);var d="__p+='"+a.replace(F,function(a){return"\\"+D[a]}).replace(c.escape||C,function(a,b){return"'+\n_.escape("+H(b)+")+\n'"}).replace(c.interpolate||C,function(a,b){return"'+\n("+H(b)+")+\n'"}).replace(c.evaluate||C,function(a,b){return"';\n"+H(b)+"\n;__p+='"})+"';\n";c.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+d+"return __p;\n";var e=new Function(c.variable||"obj","_",d);if(b)return e(b,w);var f=function(a){return e.call(this,a,w)};return f.source="function("+(c.variable||"obj")+"){\n"+d+"}",f},w.chain=function(a){return w(a).chain()};var I=function(a){this._wrapped=a};w.prototype=I.prototype;var J=function(a,b){return b?w(a).chain():a},K=function(a,b){I.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),J(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];I.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],J(c,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];I.prototype[a]=function(){return J(b.apply(this._wrapped,arguments),this._chain)}}),I.prototype.chain=function(){return this._chain=!0,this},I.prototype.value=function(){return this._wrapped}}.call(this),function(){var a=this,b=a.Backbone,c=Array.prototype.slice,d=Array.prototype.splice,e;typeof exports!="undefined"?e=exports:e=a.Backbone={},e.VERSION="0.9.2";var f=a._;!f&&typeof require!="undefined"&&(f=require("underscore"));var g=a.jQuery||a.Zepto||a.ender;e.setDomLibrary=function(a){g=a},e.noConflict=function(){return a.Backbone=b,this},e.emulateHTTP=!1,e.emulateJSON=!1;var h=/\s+/,i=e.Events={on:function(a,b,c){var d,e,f,g,i;if(!b)return this;a=a.split(h),d=this._callbacks||(this._callbacks={});while(e=a.shift())i=d[e],f=i?i.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:i?i.next:f};return this},off:function(a,b,c){var d,e,g,i,j,k;if(!(e=this._callbacks))return;if(!(a||b||c))return delete this._callbacks,this;a=a?a.split(h):f.keys(e);while(d=a.shift()){g=e[d],delete e[d];if(!g||!b&&!c)continue;i=g.tail;while((g=g.next)!==i)j=g.callback,k=g.context,(b&&j!==b||c&&k!==c)&&this.on(d,j,k)}return this},trigger:function(a){var b,d,e,f,g,i,j;if(!(e=this._callbacks))return this;i=e.all,a=a.split(h),j=c.call(arguments,1);while(b=a.shift()){if(d=e[b]){f=d.tail;while((d=d.next)!==f)d.callback.apply(d.context||this,j)}if(d=i){f=d.tail,g=[b].concat(j);while((d=d.next)!==f)d.callback.apply(d.context||this,g)}}return this}};i.bind=i.on,i.unbind=i.off;var j=e.Model=function(a,b){var c;a||(a={}),b&&b.parse&&(a=this.parse(a));if(c=A(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=f.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=f.clone(this.attributes),this.initialize.apply(this,arguments)};f.extend(j.prototype,i,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.get(a);return this._escapedAttributes[a]=f.escape(c==null?"":""+c)},has:function(a){return this.get(a)!=null},set:function(a,b,c){var d,e,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c||(c={});if(!d)return this;d instanceof j&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var h=c.changes={},i=this.attributes,k=this._escapedAttributes,l=this._previousAttributes||{};for(e in d){g=d[e];if(!f.isEqual(i[e],g)||c.unset&&f.has(i,e))delete k[e],(c.silent?this._silent:h)[e]=!0;c.unset?delete i[e]:i[e]=g,!f.isEqual(l[e],g)||f.has(i,e)!=f.has(l,e)?(this.changed[e]=g,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}return c.silent||this.change(c),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(f.clone(this.attributes),a)},fetch:function(a){a=a?f.clone(a):{};var b=this,c=a.success;return a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},save:function(a,b,c){var d,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c=c?f.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;g=f.clone(this.attributes)}var h=f.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?h:c))return!1;var i=this,j=c.success;c.success=function(a,b,e){var g=i.parse(a,e);c.wait&&(delete c.wait,g=f.extend(d||{},g));if(!i.set(g,c))return!1;j?j(i,a):i.trigger("sync",i,a,c)},c.error=e.wrapError(c.error,i,c);var k=this.isNew()?"create":"update",l=(this.sync||e.sync).call(this,k,this,c);return c.wait&&this.set(g,h),l},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d(),c?c(b,e):b.trigger("sync",b,e,a)},a.error=e.wrapError(a.error,b,a);var g=(this.sync||e.sync).call(this,"delete",this,a);return a.wait||d(),g},url:function(){var a=A(this,"urlRoot")||A(this.collection,"url")||B();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(var c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;while(!f.isEmpty(this._pending)){this._pending={},this.trigger("change",this,a);for(var c in this.changed){if(this._pending[c]||this._silent[c])continue;delete this.changed[c]}this._previousAttributes=f.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return arguments.length?f.has(this.changed,a):!f.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes;for(var e in a){if(f.isEqual(d[e],b=a[e]))continue;(c||(c={}))[e]=b}return c},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);return c?(b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}});var k=e.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(k.prototype,i,{model:j,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,e,g,h,i,j,k={},l={},m=[];b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,g=a.length;c<g;c++){if(!(h=a[c]=this._prepareModel(a[c],b)))throw new Error("Can't add an invalid model to a collection");i=h.cid,j=h.id;if(k[i]||this._byCid[i]||j!=null&&(l[j]||this._byId[j])){m.push(c);continue}k[i]=l[j]=h}c=m.length;while(c--)a.splice(m[c],1);for(c=0,g=a.length;c<g;c++)(h=a[c]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,h.id!=null&&(this._byId[h.id]=h);this.length+=g,e=b.at!=null?b.at:this.models.length,d.apply(this.models,[e,0].concat(a)),this.comparator&&this.sort({silent:!0});if(b.silent)return this;for(c=0,g=this.models.length;c<g;c++){if(!k[(h=this.models[c]).cid])continue;b.index=c,h.trigger("add",h,this,b)}return this},remove:function(a,b){var c,d,e,g;b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,d=a.length;c<d;c++){g=this.getByCid(a[c])||this.get(a[c]);if(!g)continue;delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g)}return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,b),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,f.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},get:function(a){return a==null?void 0:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);return this._reset(),this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a=a?f.clone(a):{},a.parse===undefined&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d,e,f){b[a.add?"add":"reset"](b.parse(d,f),a),c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b=b?f.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;return b.success=function(e,f,g){b.wait&&c.add(e,b),d?d(e,f):e.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return f(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){b||(b={});if(a instanceof j)a.collection||(a.collection=this);else{var c=a;b.collection=this,a=new this.model(c,b),a._validate(a.attributes,b)||(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(a!="add"&&a!="remove"||c==this)a=="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments);else return}});var l=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];f.each(l,function(a){k.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=e.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},n=/:\w+/g,o=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,i,{initialize:function(){},route:function(a,b,c){return e.history||(e.history=new q),f.isRegExp(a)||(a=this._routeToRegExp(a)),c||(c=this[b]),e.history.route(a,f.bind(function(d){var f=this._extractParameters(a,d);c&&c.apply(this,f),this.trigger.apply(this,["route:"+b].concat(f)),e.history.trigger("route",this,b,f)},this)),this},navigate:function(a,b){e.history.navigate(a,b)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(p,"\\$&").replace(n,"([^/]+)").replace(o,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var q=e.History=function(){this.handlers=[],f.bindAll(this,"checkUrl")},r=/^[#\/]/,s=/msie [\w.]+/;q.started=!1,f.extend(q.prototype,i,{interval:50,getHash:function(a){var b=a?a.location:window.location,c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(r,"")},start:function(a){if(q.started)throw new Error("Backbone.history has already been started");q.started=!0,this.options=f.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),c=document.documentMode,d=s.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7);d&&(this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=window.location,h=e.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&e.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe)));if(b==this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return c},navigate:function(a,b){if(!q.started)return!1;if(!b||b===!0)b={trigger:b};var c=(a||"").replace(r,"");if(this.fragment==c)return;this._hasPushState?(c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var t=e.View=function(a){this.cid=f.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];f.extend(t.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var d=document.createElement(a);return b&&g(d).attr(b),c&&g(d).html(c),d},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g?a:g(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=A(this,"events")))return;this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(u),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,g===""?this.$el.bind(e,c):this.$el.delegate(g,e,c)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=v.length;b<c;b++){var d=v[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(!this.el){var a=A(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}else this.setElement(this.el,!1)}});var w=function(a,b){var c=z(this,a,b);return c.extend=this.extend,c};j.extend=k.extend=m.extend=t.extend=w;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(a,b,c){var d=x[a];c||(c={});var h={type:d,dataType:"json"};return c.url||(h.url=A(b,"url")||B()),!c.data&&b&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(b.toJSON())),e.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),e.emulateHTTP&&(d==="PUT"||d==="DELETE")&&(e.emulateJSON&&(h.data._method=d),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)}),h.type!=="GET"&&!e.emulateJSON&&(h.processData=!1),g.ajax(f.extend(h,c))},e.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(b,e,c):b.trigger("error",b,e,c)}};var y=function(){},z=function(a,b,c){var d;return b&&b.hasOwnProperty("constructor")?d=b.constructor:d=function(){a.apply(this,arguments)},f.extend(d,a),y.prototype=a.prototype,d.prototype=new y,b&&f.extend(d.prototype,b),c&&f.extend(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},A=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},B=function(){throw new Error('A "url" property or function must be specified')}}.call(this),Flint={},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},Flint.Calendar=function(){function a(a,b,c){this.el=a!=null?a:"#calendar",this.year=b,this.month=c,this.set_focus_and_highlight=__bind(this.set_focus_and_highlight,this),this.set_focus_date=__bind(this.set_focus_date,this),this.events=_.extend({},this._events,this.events),this.$el=$(this.el),this.initialize(this.year,this.month),this.delegateEvents(),this}return __extends(a,Backbone.View),a.prototype._events={"click button.next":"next_month","click button.previous":"previous_month","click td.day":"date_clicked"},a.prototype.selected_dates=[],a.prototype.focus_date=!1,a.prototype.higlight="day",a.prototype.day_labels=[{day:"S"},{day:"M"},{day:"T"},{day:"W"},{day:"T"},{day:"F"},{day:"S"}],a.prototype.month_labels=["January","February","March","April","May","June","July","August","September","October","November","December"],a.prototype.initialize=function(a,b){var c,d;return this.year=a,this.month=b,this.date=new Date,this.month||(this.month=this.date.getMonth()),this.year||(this.year=this.date.getFullYear()),this.date=this.date.getDate(),d=this.month+1<10?"0"+(this.month+1):this.month+1,c=this.date<10?"0"+this.date:this.date,this.focus_date=this.year+"-"+d+"-"+c,this.render(),$("#"+this.focus_date).addClass("fb-today")},a.prototype.render=function(a,b){var c;a==null&&(a=!1),b==null&&(b=!1);if(a||a===0||a==="0")this.year=a;if(b||b===0||b==="0")this.month=b;return c={month_name:this.month_labels[this.month],day_labels:this.day_labels,month:this.month,year:this.year},$(this.el).html(Handlebars.templates.month(c))},a.prototype.set_focus_date=function(a,b){return this.focus_date=a,b&&(this.date=b),this.month=this.date.getMonth(),this.year=this.date.getFullYear(),this.render(),this.set_focus_and_highlight()},a.prototype.set_focus_and_highlight=function(a){var b,c,d,e;a==null&&(a=!1),d=$(this.el).attr("id"),$("#"+d+" td").removeClass("fb-highlight").removeClass("fb-focus"),e=$("#"+d+" td[data-sql="+this.focus_date+"]"),c=this.focus_date.split("-"),b=c[1],a&&(this.highlight=a);switch(this.highlight){case"week":e.parent().children("td").addClass("fb-highlight");break;case"month":b-1===this.month&&$("#"+d+" td").addClass("fb-highlight")}return e.removeClass("fb-highlight").addClass("fb-focus")},a.prototype.next_month=function(){return parseInt(this.month)+1===12?(this.year++,this.month=0):this.month++,this.render(this.year,this.month),this.set_focus_and_highlight(),this.trigger("next",this)},a.prototype.previous_month=function(){return parseInt(this.month)===0?(this.year--,this.month=11):this.month--,this.render(this.year,this.month),this.set_focus_and_highlight(),this.trigger("prev",this)},a.prototype.date_clicked=function(a){var b,c,d,e;return e=$(a.target),d=e.attr("data-sql"),c=d.split("-"),b=new Date(c[0],c[1]-1,c[2]),this.trigger("clicked",d,b,this.selected_dates,a),_.indexOf(this.selected_dates,b)>=0?(this.selected_dates=_.without(this.selected_dates,b),this.trigger("deselect",d,b,this.selected_dates,a)):(this.selected_dates.push(b),this.trigger("select",d,b,this.selected_dates,a)),this.focus_date=d,this.set_focus_and_highlight()},a}(),Flint.Collection=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.comparator=function(a){return+a.get("sort_order")},a.prototype.put=function(a){},a.prototype.post=function(a){},a}(),Flint.Controller=function(){function a(){this.undelegate=__bind(this.undelegate,this),this.delegate=__bind(this.delegate,this),this.undo_sort_order=__bind(this.undo_sort_order,this),this.sorted=__bind(this.sorted,this),this.error=__bind(this.error,this),this.update=__bind(this.update,this),this.destroy=__bind(this.destroy,this),this.undo_delete=__bind(this.undo_delete,this),this.deleted=__bind(this.deleted,this),this.saved=__bind(this.saved,this),this.changed=__bind(this.changed,this),this.edit=__bind(this.edit,this),this.added=__bind(this.added,this),this.create=__bind(this.create,this),this.refresh=__bind(this.refresh,this),this.grab=__bind(this.grab,this),this.__get=__bind(this.__get,this),this.get=__bind(this.get,this),this.fetch=__bind(this.fetch,this),this._unbind=__bind(this._unbind,this),this.unbind=__bind(this.unbind,this),this._bind=__bind(this._bind,this),this.bind=__bind(this.bind,this),this.init=__bind(this.init,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Router),a.prototype.template_create="default/create",a.prototype.template_edit="default/edit",a.prototype.template_view="default/view",a.prototype.template_list="default/list",a.prototype.collection=!1,a.prototype.model=!1,a.prototype.list="List",a.prototype.list_el="#app",a.prototype.sortable=!1,a.prototype.sorted_url=!1,a.prototype.sort_handle=!1,a.prototype.form="Form",a.prototype.form_el="#app",a.prototype.valid_changes=!0,a.prototype._messages={created:"{{name}} has been created.",saved:"Changes to {{name}} have been saved.",delete_warn:"You are about to delete {{name}}, proceed?",navigate_warn:"Did you want to save the changes you just made?",sorted:"You have changed the sort order."},a.prototype.initialize=function(a){var b,c,d=this;this.messages||(this.messages={}),_.map(this._messages,function(a,b){if(_.isUndefined(d.messages[b]))return d.messages[b]=a}),c=views[this.list]?views[this.list]:Flint[this.list];if(!c)throw new Error('List class "'+this.list+'" does not exists');this.list=new c({el:this.list_el},this.sortable),this.list.sort_handle=this.sort_handle,this.list.template=this.template_list,this.template_help&&(this.list.template_help=this.template_help),this.list.collection=this.collection?new collections[this.collection]:new Backbone.Collection,this.list.collection.model=this.model?models[this.model]:Backbone.Model,b=views[this.form]?views[this.form]:Flint[this.form];if(!b)throw new Error('Form class "'+this.form+'" does not exists');return this.form=new b({el:this.form_el}),this.form.model=new this.list.collection.model,this.form.collection=this.list.collection,this.form.valid_changes=this.valid_changes,this.list.undelegateEvents(),this.form.undelegateEvents(),a.register(this),this.app=a,this.init.apply(this,arguments),this},a.prototype.init=function(){},a.prototype.bind=function(){},a.prototype._bind=function(){var a=this;return this.bind(),this.list.on("create",this.create),this.list.on("edit",this.edit),this.list.on("sort",this.sorted),this.list.collection.on("add",this.added),this.list.collection.on("remove",this.deleted),this.list.collection.on("change",this.changed),this.list.collection.on("error",this.error),this.form.on("delete",this.deleted),this.form.on("saved",this.saved),this.form.on("canceled",function(){return a.modelChanged=!1}),this.form.model.on("error",this.error),this.on("saved deleted sorted destroyed delete_undone sort_undone destroy_error",this.update)},a.prototype.unbind=function(){},a.prototype._unbind=function(){return this.unbind(),this.list.off("create edit sort"),this.list.collection.off("add remove change error"),this.form.off("delete saved canceled"),this.form.model.off("error"),this.off("saved deleted sorted destroyed delete_undone sort_undone destroy_error")},a.prototype.fetch=function(a,b){var c=this;return b==null&&(b=!1),this.list.collection.length>0&&!b?a(this.list.collection):this.list.collection.fetch({silent:!0,success:function(){return c.list.collection.length===0?a(!1):a(c.list.collection)}})},a.prototype.get=function(a,b,c){var d=this;return c==null&&(c={}),this.list.collection.length===0?this.fetch(function(){return d.__get(a,b,c)}):this.__get(a,b,c)},a.prototype.__get=function(a,b,c){var d,e=this;d=this.list.collection.get(a);if(!!d)return d.fetch({silent:!0,success:function(){if(b)return b(d)}});if(b)return b(!1)},a.prototype.grab=function(a){var b;return this.list.collection.length===0?b=!1:b=this.list.collection.get(a),b},a.prototype.refresh=function(a){return this.fetch(a,!0)},a.prototype.create=function(){return this.form.model=new this.list.collection.model({sort_order:this.list.collection.length}),this.form.render(this.template_create,{},this.form.model),this.trigger("create",this)},a.prototype.added=function(a){var b=this;return this.trigger("added",a),!this.app.notifications||this.app.notifications.notify("Saving..."),a.save(a,{success:function(){var c,d;return d=tmpl_compile(b.messages.created),c=d(a.attributes),!!b.app.notifications&&!!b.messages.created&&b.app.notifications.notify(c),b.edit(a.id),b.trigger("returned",a)},error:function(a,c){return!b.app.notifications||b.app.notifications.error(c),b.list.collection.remove(a,{silent:!0})}})},a.prototype.edit=function(a){var b;return b=this.list.collection.get(a),this.form.render(this.template_edit,{},b)},a.prototype.changed=function(a){return!this.app.sync||this.app.sync.changed(a),this.trigger("changed",a)},a.prototype.saved=function(a){var b=this;return this.trigger("saved",a),!this.app.notifications||this.app.notifications.notify("Saving..."),a.save(null,{success:function(){var c,d;return d=tmpl_compile(b.messages.saved),c=d(a.attributes),!!b.app.notifications&&!!b.messages.saved&&b.app.notifications.notify(c),b.trigger("returned",a)}})},a.prototype.deleted=function(a,b,c){var d,e,f;return this.trigger("deleted",a),this.to_delete&&this.destroy(),d=Backbone.Model.extend({url:this.list.collection.url}),this.to_delete=new d(a.attributes),this.app.notifications?(f=tmpl_compile(this.messages.delete_warn),e=f(a.attributes),this.app.notifications.notify(e,this.undo_delete,this.destroy)):this.destroy()},a.prototype.undo_delete=function(){return this.list.collection.add(new this.list.collection.model(this.to_delete.attributes),{silent:!0}),this.to_delete=null,this.trigger("delete_undone",this.to_delete)},a.prototype.destroy=function(){var a=this;return this.to_delete.destroy({success:function(b,c){return c&&c.error?(!a.app.notifications||a.app.notifications.error(c.error),a.list.collection.add(a.to_delete,{silent:!0}),a.trigger("destroyed",a.to_delete),a.update()):a.trigger("destroy_error",a.to_delete)}})},a.prototype.update=function(){return this.list.render(this.template_list)},a.prototype.error=function(a,b){console&&console.log&&console.log("NOTICE: error triggered on Flint.Controller: "+b),_.isString(b)||(b=b.responseText);if(b.indexOf("401")>0){if(!!this.app.update)return this.app.update()}else if(!!this.app.notifications)return this.app.notifications.error(b)},a.prototype.sorted=function(a){var b=this;return this.trigger("sorted"),this.app.notifications.notify(this.messages.sorted,this.undo_sort_order,function(){return b.app.sync.ajax(b.sorted_url,{type:"POST",data:{json:JSON.stringify(a)}})})},a.prototype.undo_sort_order=function(){return _.each(this.list.collection.models,function(a){return a.set("sort_order",a.get("order_before_sort"),{silent:!0})}),this.list.collection.sort(),this.trigger("sort_undone")},a.prototype.delegate=function(){return this.undelegate(),this._bind(),this.form.delegateEvents(),this.list.delegateEvents(),this.app.controller=this},a.prototype.undelegate=function(){return this._unbind(),this.form.undelegateEvents(),this.list.undelegateEvents()},a}(),Flint.Form=function(){function a(){this["delete"]=__bind(this["delete"],this),this.cancel=__bind(this.cancel,this),this.done=__bind(this.done,this),this.init=__bind(this.init,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype._events={"change input,textarea,select":"changed","click .done":"done","click .save":"save","click .delete":"delete","click .cancel":"cancel","click label":"label_click","submit form":"nosubmit"},a.prototype.initialize=function(){return this.events=_.extend({},this._events,this.events),this.init.apply(this,arguments),this},a.prototype.init=function(){},a.prototype.render=function(a,b,c){var d=this;return this.template=a,this.data=b!=null?b:{},c==null&&(c=!1),c&&(this.model=c,this.data.model=this.model,this.data=_.extend({},this.data,this.model.attributes)),this.before(function(){return $(d.el).html(tmpl[d.template](d.data)),d.after()}),this},a.prototype.before=function(a){return a()},a.prototype.after=function(){},a.prototype.changed=function(a){var b,c,d;a.stopPropagation(),c=$(a.target),d=c.val(),c.attr("type")==="checkbox"&&(c.is(":checked")?d=1:d=0),c.hasClass("num")&&(d=d.toString().replace(/[A-Za-z$-,]/g,""));if(!_.isUndefined(d))return b=c.attr("name"),this.model.set(b,d.toString(),{silent:!this.valid_changes}),this.trigger("changed",this.model),this.trigger("changed:"+b,this.model,d)},a.prototype.save=function(){return this.collection.add(this.model)},a.prototype.done=function(a){return a==null&&(a=!1),(!a||!!_.isObject(a))&&this.trigger("saved",this.model),this.cancel()},a.prototype.cancel=function(a){return a==null&&(a=!1),(!a||!!_.isObject(a))&&this.trigger("canceled",this.model),$(this.el).empty()},a.prototype["delete"]=function(){return this.done(!0),this.collection.remove(this.model)},a.prototype.label_click=function(a){var b;return b=$(a.target),b.next().click(),b.prev().click()},a.prototype.nosubmit=function(){return!1},a}(),Flint.Helpers=function(){function a(){this.js_to_slash=__bind(this.js_to_slash,this),this.sql_to_slash=__bind(this.sql_to_slash,this),this.date_format=__bind(this.date_format,this),this.delay=__bind(this.delay,this),this.initialize=__bind(this.initialize,this),Handlebars.registerHelper("eq",this.eq),Handlebars.registerHelper("check_role",this.check_role),Handlebars.registerHelper("link",this.link),Handlebars.registerHelper("link_nohref",this.link_nohref),Handlebars.registerHelper("list",this.list),Handlebars.registerHelper("filtered_list",this.filtered_list),Handlebars.registerHelper("input",this.input),Handlebars.registerHelper("text_field",this.text_field),Handlebars.registerHelper("password",this.password),Handlebars.registerHelper("select",this.select),Handlebars.registerHelper("select_range",this.select_range),Handlebars.registerHelper("radio",this.radio),Handlebars.registerHelper("checkbox",this.checkbox),Handlebars.registerHelper("text_area",this.text_area),Handlebars.registerHelper("month_grid",this.month_grid),Handlebars.registerHelper("date_today",this.date_today),Handlebars.registerHelper("sql_to_slash",this.sql_to_slash),Handlebars.registerHelper("date_format",this.date_format),Handlebars.registerHelper("twenty_four_to_twelve",this.twenty_four_to_twelve),Handlebars.registerHelper("dollar",this.dollar),Handlebars.registerHelper("random",this.random),Handlebars.registerHelper("sum",this.sum),Handlebars.registerHelper("truncate",this.truncate),Handlebars.registerHelper("repeater",this.repeater),this.initialize(),this}return a.prototype.initialize=function(){},a.prototype.delay=function(a,b){return this.timer=setTimeout(b,a),this.timer},a.prototype.loader=function(a){return $(a).html('<p class="loader"><em class="one">&nbsp;</em><em class="two">&nbsp;</em><em class="three">&nbsp;</em><em class="four">&nbsp;</em></p>'),$(".loader").css({opacity:1}),$(a)},a.prototype.eq=function(a,b,c){return a===b?c.fn(this):c.inverse(this)},a.prototype.check_role=function(a,b,c){var d,e;return e=a.get?a.get("role"):a,d=b.indexOf(e)>=0,d?c?c.fn(this):!0:c?c.inverse(this):!1},a.prototype.link=function(a,b,c){var d;return d=[],_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),new Handlebars.SafeString('<a href="'+a+'" '+d.join(" ")+">"+b+"</a>")},a.prototype.link_nohref=function(a,b){var c;return c=[],_.map(b.hash,function(a,b){return c.push(b+'="'+a+'"')}),new Handlebars.SafeString('<a href="javascript:void(0)" '+c.join(" ")+">"+a+"</a>")},a.prototype.list=function(a,b,c){var d;return d=[],_.each(a,function(b){return a=b.attributes?b.attributes:b,d.push(c(a))}),d=d.length>0?d.join(""):b,new Handlebars.SafeString(d)},a.prototype.filtered_list=function(a,b,c,d,e){var f,g;return f=[],g=c.split(","),_.each(a,function(a){var c,d;d=a.get(b),c=!1,_.each(g,function(a){if(d===a)return c=!0});if(c)return f.push(e(a.attributes))}),f=f.length>0?f.join(""):d,new Handlebars.SafeString(f)},a.prototype.text_field=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)?a.get(b):"",new Handlebars.SafeString('<input type="text" name="'+b+'" value="'+e+'" '+d.join(" ")+"/>")},a.prototype.input=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)?a.get(b):"",new Handlebars.SafeString('<input name="'+b+'" value="'+e+'" '+d.join(" ")+"/>")},a.prototype.password=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e='<input type="password" name="'+b+'" value="" '+d.join(" ")+"/>",new Handlebars.SafeString(e)},a.prototype.select=function(a,b,c,d){var e,f,g;return e=[],d&&_.map(d.hash,function(a,b){return e.push(b+'="'+a+'"')}),g=a&&a.get&&a.get(b)?a.get(b):!1,f=[],_.each(c,function(a){var b,c,d;return d=_.isArray(a)?a[0]:a,c=_.isArray(a)?a[1]:a,b="<option ",d===g&&(b+="selected "),b+='value="'+d+'">'+c+"</option>",f.push(b)}),new Handlebars.SafeString('<select name="'+b+'" '+e.join(" ")+">"+f.join("")+"</select>")},a.prototype.select_range=function(a,b,c,d,e){var f,g,h,i,j,k;f=[],e&&_.map(e.hash,function(a,b){return f.push(b+'="'+a+'"')}),i=a.get(d),g=[];for(j=b,k=c+1;b<=k?j<k:j>k;b<=k?j++:j--)h="<option ",j===i&&(h+="selected "),h+='value="'+j+'">'+j+"</option>",g.push(h);return new Handlebars.SafeString('<select name="'+d+'" '+f.join(" ")+">"+g.join("")+"</select>")},a.prototype.radio_group=function(a,b,c){var d,e;return e=a.get(b),d=[],_.each(c,function(a){var c,f,g;return g=_.isArray(a)?a[0]:a,f=_.isArray(a)?a[1]:a,c='<p class="radio"><input type="radio" name="'+b+'" value="'+g+'"',g===e&&(c+=' checked="true"'),c+=" /><label>"+f+"</label></p>",d.push(c)}),new Handlebars.SafeString('<div class="radios">'+d.join("")+"</div>")},a.prototype.checkbox=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)>0?'checked="true" ':"",new Handlebars.SafeString('<input type="checkbox" name="'+b+'" value="1" '+e+d.join(" ")+"/>")},a.prototype.text_area=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get?a.get(b):"",new Handlebars.SafeString('<textarea name="'+b+'" '+d.join(" ")+">"+e+"</textarea>")},a.prototype.month_grid=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;e=[31,28,31,30,31,30,31,31,30,31,30,31],l=e[a],o=(new Date(b,a,1)).getDay(),a===1&&(b%4!==0||b%100!==!0)&&b%400!==0&&(l=29),f="",j=1-o;for(g=0;g<=5;g++){f+="<tr>";for(k=0;k<=6;k++)c=new Date(b,a,j),d=c.getDate(),p=c.getMonth(),q=c.getFullYear(),m=j<1||j>l?" off-month":"",h=d<10?"0"+d:d,i=p+1<10?"0"+(p+1):p+1,f+='<td data-dow="'+k+'" class="day dow'+k+m+'" data-sql="'+q+"-"+i+"-"+h+'">',n=c.getDate(),f+=c.getDate()+"</td>",j++;f+="</tr>"}return f+="</tr></table>",new Handlebars.SafeString(f)},a.prototype.date_today=function(){return(new Date).getDate()},a.prototype.twenty_four_to_twelve=function(a){var b,c,d,e;return e=a.split(":"),b=e[0],b.substr(0,1)==="0"&&(b=parseInt(b.substr(1,1))),d=e[1],c="am",b>=12&&(c="pm",b>12&&(b-=12)),b+":"+d+" "+c},a.prototype.jsdate_to_sql=function(a){var b,c;return c=a.getMonth()+1,b=a.getDate(),c<10&&(c="0"+c),b<10&&(b="0"+b),a.getFullYear()+"-"+c+"-"+b},a.prototype.sqldate_to_js=function(a){var b;return a?(b=a.split("-"),!b[1]||!b[2]?!1:(b[2].indexOf(" ")>=0&&(b[2]=b[2].substr(0,b[2].indexOf(" "))),new Date(b[0],b[1]-1,b[2]))):!1},a.prototype.date_format=function(a,b){return!a||a===""||a==="0000-00-00"||a==="0000-00-00 00:00:00"?"N/A":moment(a).format(b)},a.prototype.sql_to_slash=function(a){var b,c,d,e;return!a||a==="0000-00-00"||a===""?"":a.indexOf("/")>0?a:(c=this.sqldate_to_js(a),c?(d=c.getMonth()+1,b=c.getDate(),e=c.getFullYear(),d+"/"+b+"/"+e):"")},a.prototype.js_to_slash=function(a){var b,c,d;return c=a.getMonth()+1,b=a.getDate(),d=a.getFullYear(),c+"/"+b+"/"+d},a.prototype.dollar=function(a,b,c,d,e){var f,g,h,i,j,k,l;return b==null&&(b=2),c==null&&(c="."),d==null&&(d=","),e==null&&(e=!0),f=isNaN(b)?2:Math.abs(b),i=a<0?"-":"",g=parseInt(a=Math.abs(a).toFixed(f))+"",h=(h=g.length)>3?h%3:0,j=h?g.substr(0,h)+d:"",k=g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+d),l=f&&e?c+Math.abs(a-g).toFixed(f).slice(2):"",i+j+k+l},a.prototype.repeater=function(a,b,c){var d,e,f,g;e=parseInt(a),d=parseInt(b)+1,g=[];for(f=e;e<=d?f<d:f>d;e<=d?f++:f--)this.num=f,g.push(c.fn(this));return new Handlebars.SafeString(g.join(""))},a.prototype.sum=function(){var a,b=this;return a=0,_.each(arguments,function(b){return a+=parseFloat(b)}),a},a.prototype.truncate=function(a,b){return a&&a.length>b?a.substr(0,b)+"...":a},a.prototype.random=function(){return Math.random()*1e3},a}(),Flint.List=function(){function a(){this.close_help=__bind(this.close_help,this),this.help=__bind(this.help,this),this.sorted=__bind(this.sorted,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype._events={"click .edit":"edit","click .delete":"delete","click .create":"create","click .view":"read","click .help":"help","click .close":"close_help"},a.prototype.initialize=function(a,b){return this.sortable=b,this.events=_.extend({},this._events,this.events),this},a.prototype.render=function(a,b){var c;return a&&(this.template=a),b&&(this.data=b),this.before(),this.data||(this.data={items:this.collection.models}),this.template?$(this.el).html(tmpl[this.template](this.data)):console&&console.log&&console.log("WARNING Flint.List: @template is undefined, unable to render view."),this.sortable&&(c={update:this.sorted},this.sort_handle&&(c.handle=this.sort_handle),this.sortable=$(".sortable").sortable(c)),this.trigger("rendered",this),this.after(),this},a.prototype.before=function(){},a.prototype.after=function(){},a.prototype.create=function(){return this.trigger("create")},a.prototype.read=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("read",b)},a.prototype.edit=function(a){var b,c;c=$(a.target),b=c.attr("id");while(_.isUndefined(b))c=c.parent(),b=c.attr("id");return this.trigger("edit",b)},a.prototype["delete"]=function(a){var b,c,d;d=$(a.target),b=d.attr("id");while(_.isUndefined(b))d=d.parent(),b=d.attr("id");return c=this.collection.get(b),this.collection.remove(c)},a.prototype.update=function(a,b,c){return c==null&&(c="span"),$("#"+a.get("id")+" "+c).html(a.get(b))},a.prototype.sorted=function(){var a,b=this;return this.serialized=[],a=0,_.each(this.sortable.find("li"),function(a,c){var d,e,f;d=a.getAttribute("id"),f=b.collection.get(d);if(f)return e=f.get("sort_order"),b.collection.get(d).set("sort_order",c,{silent:!0}),b.collection.get(d).set("order_before_sort",e,{silent:!0}),b.serialized.push({id:d,sort_order:c})}),console.log(this.collection.models),this.collection.sort(),this.trigger("sort",this.serialized)},a.prototype.help=function(a){a==null&&(a=!0);if(this.template_help)return $(this.el).html(tmpl[this.template_help]({help:a}))},a.prototype.close_help=function(){return this.render()},a}(),Flint.Model=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a}(),Flint.Notifications=function(){function a(){this.undo=__bind(this.undo,this),this.dismiss=__bind(this.dismiss,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el="#message",a.prototype.events={"click button.close":"dismiss","click button.undo":"undo"},a.prototype.render=function(a,b,c,d){var e;return b==null&&(b=!1),c==null&&(c="Close"),d==null&&(d="Undo"),e=_.isFunction(b),$(this.el).html(tmpl.notification({message:a,undo_callback:e,dismiss:c,undo_text:d})),this},a.prototype.error=function(a,b,c){return b==null&&(b=!1),c==null&&(c=!1),$(this.el).attr("class","error").css({top:0}),this.render(a,b),this.callback=c},a.prototype.notify=function(a,b,c){return b==null&&(b=!1),c==null&&(c=!1),$(this.el).attr("class","notice").css({top:0}),this.render(a,b,"OK"),this.callback=c,this.undo=b},a.prototype.prompt_save=function(a,b){return $(this.el).attr("class","notice").css({top:0}),this.render(a,b,"Save","Discard"),this.callback=b,this.undo=function(){}},a.prototype.confirm=function(a,b){return $(this.el).attr("class","notice").css({top:0}),this.render(a,b,"OK","Cancel"),this.callback=b,this.undo=function(){}},a.prototype.yes_or_no=function(a,b){return $(this.el).attr("class","notice").css({top:0}),this.render(a,b,"Yes","No"),this.callback=b,this.undo=function(){}},a.prototype.dismiss=function(a){$(this.el).css({top:"-100px"}).html("");if(this.callback&&!_.isUndefined(a))return this.callback()},a.prototype.undo=function(){this.dismiss();if(this.undo)return this.undo(!0)},a}(),Flint.Sync=function(){function a(){this.ajax=__bind(this.ajax,this),this.backbone=__bind(this.backbone,this),this.changed=__bind(this.changed,this),Backbone.sync=this.backbone,this}return a.prototype.changed=function(a){},a.prototype.backbone=function(a,b,c){b.url=_.isFunction(b.url)?b.url():b.url,c||(c={}),b.collection||(b.collection={});if(!c.url&&!b.url&&!b.localstore&&!c.localstore&&!b.collection.localstore)throw new Error("A url or localstore property must be defined to use Storage.sync!");if(b.url||c.url&&app.isOnline)return this.server(a,b,c)},a.prototype.local=function(a,b,c){switch(a){case"read":return app.log("read shit!");case"create":return app.log("create shit!");case"delete":return app.log("update shit!");case"delete":return app.log("delete shit!")}},a.prototype.server=function(a,b,c){var d,e,f;return d={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},f=d[a],c||(c={}),e={type:f,dataType:"json"},e.url=c.url?c.url:b.url,!c.data&&b&&(a==="create"||a==="update"||a==="delete")&&(e.contentType="application/json",e.data=JSON.stringify(b.toJSON())),Backbone.emulateHTTP&&(f==="PUT"||f==="DELETE")&&(Backbone.emulateJSON&&(e.data_method=f),e.type="POST",e.beforeSend(function(a){return a.sendRequestHeader("X-HTTP-Method-Override",f)})),e.type!=="GET"&&!Backbone.emulateJSON&&(e.processData=!1),$.ajax(_.extend(e,c)),this},a.prototype.ajax=function(a,b){return b.url=a,$.ajax(_.extend(b)),this},a}(),Flint.View=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.render=function(a,b){var c=this;return this.template=a,this.data=b!=null?b:{},this.before(function(){return $(c.el).html(tmpl[c.template](c.data))}),this.after()},a.prototype.before=function(a){return a()},a.prototype.after=function(){},a}(),function(a,b){function c(b){a.extend(!0,br,b)}function d(c,d,j){function k(a){bb?(y(),x(),G(),t(a)):l()}function l(){bc=d.theme?"ui":"fc",c.addClass("fc"),d.isRTL&&c.addClass("fc-rtl"),d.theme&&c.addClass("ui-widget"),bb=a("<div class='fc-content' style='position:relative'/>").prependTo(c),_=new e(X,d),(ba=_.render())&&c.prepend(ba),s(d.defaultView),a(window).resize(A),r()||n()}function n(){setTimeout(function(){!bd.start&&r()&&t()},0)}function o(){a(window).unbind("resize",A),_.destroy(),bb.remove(),c.removeClass("fc fc-rtl ui-widget")}function p(){return $.offsetWidth!==0}function r(){return a("body")[0].offsetWidth!==0}function s(b){if(!bd||b!=bd.name){bj++,I();var c=bd,d;c?((c.beforeHide||O)(),N(bb,bb.height()),c.element.hide()):N(bb,1),bb.css("overflow","hidden"),(bd=be[b])?bd.element.show():bd=be[b]=new bu[b](d=bh=a("<div class='fc-view fc-view-"+b+"' style='position:absolute'/>").appendTo(bb),X),c&&_.deactivateButton(c.name),_.activateButton(b),t(),bb.css("overflow",""),c&&N(bb,1),d||(bd.afterShow||O)(),bj--}}function t(a){if(p()){bj++,I(),bg===b&&y();var d=!1;!bd.start||a||bk<bd.start||bk>=bd.end?(bd.render(bk,a||0),z(!0),d=!0):bd.sizeDirty?(bd.clearEvents(),z(),d=!0):bd.eventsDirty&&(bd.clearEvents(),d=!0),bd.sizeDirty=!1,bd.eventsDirty=!1,B(d),bf=c.outerWidth(),_.updateTitle(bd.title),a=new Date,a>=bd.start&&a<bd.end?_.disableButton("today"):_.enableButton("today"),bj--,bd.trigger("viewDisplay",$)}}function w(){x(),p()&&(y(),z(),I(),bd.clearEvents(),bd.renderEvents(bl),bd.sizeDirty=!1)}function x(){a.each(be,function(a,b){b.sizeDirty=!0})}function y(){bg=d.contentHeight?d.contentHeight:d.height?d.height-(ba?ba.height():0)-J(bb):Math.round(bb.width()/Math.max(d.aspectRatio,.5))}function z(a){bj++,bd.setHeight(bg,a),bh&&(bh.css("position","relative"),bh=null),bd.setWidth(bb.width(),a),bj--}function A(){if(!bj)if(bd.start){var a=++bi;setTimeout(function(){a==bi&&!bj&&p()&&bf!=(bf=c.outerWidth())&&(bj++,w(),bd.trigger("windowResize",$),bj--)},200)}else n()}function B(a){!d.lazyFetching||Y(bd.visStart,bd.visEnd)?C():a&&F()}function C(){Z(bd.visStart,bd.visEnd)}function D(a){bl=a,F()}function E(a){F(a)}function F(a){G(),p()&&(bd.clearEvents(),bd.renderEvents(bl,a),bd.eventsDirty=!1)}function G(){a.each(be,function(a,b){b.eventsDirty=!0})}function H(a,c,d){bd.select(a,c,d===b?!0:d)}function I(){bd&&bd.unselect()}function K(){t(-1)}function L(){t(1)}function M(){g(bk,-1),t()}function P(){g(bk,1),t()}function Q(){bk=new Date,t()}function R(a,b,c){a instanceof Date?bk=m(a):q(bk,a,b,c),t()}function S(a,c,d){a!==b&&g(bk,a),c!==b&&h(bk,c),d!==b&&i(bk,d),t()}function T(){return m(bk)}function U(){return bd}function V(a,c){if(c===b)return d[a];if(a=="height"||a=="contentHeight"||a=="aspectRatio")d[a]=c,w()}function W(a,b){if(d[a])return d[a].apply(b||$,Array.prototype.slice.call(arguments,2))}var X=this;X.options=d,X.render=k,X.destroy=o,X.refetchEvents=C,X.reportEvents=D,X.reportEventChange=E,X.rerenderEvents=F,X.changeView=s,X.select=H,X.unselect=I,X.prev=K,X.next=L,X.prevYear=M,X.nextYear=P,X.today=Q,X.gotoDate=R,X.incrementDate=S,X.formatDate=function(a,b){return u(a,b,d)},X.formatDates=function(a,b,c){return v(a,b,c,d)},X.getDate=T,X.getView=U,X.option=V,X.trigger=W,f.call(X,d,j);var Y=X.isFetchNeeded,Z=X.fetchEvents,$=c[0],_,ba,bb,bc,bd,be={},bf,bg,bh,bi=0,bj=0,bk=new Date,bl=[],bm;q(bk,d.year,d.month,d.date),d.droppable&&a(document).bind("dragstart",function(b,c){var e=b.target,f=a(e);if(!f.parents(".fc").length){var g=d.dropAccept;if(a.isFunction(g)?g.call(e,f):f.is(g))bm=e,bd.dragStart(bm,b,c)}}).bind("dragstop",function(a,b){bm&&(bd.dragStop(bm,a,b),bm=null)})}function e(b,c){function d(){n=c.theme?"ui":"fc";if(c.header)return m=a("<table class='fc-header' style='width:100%'/>").append(a("<tr/>").append(f("left")).append(f("center")).append(f("right")))}function e(){m.remove()}function f(d){var e=a("<td class='fc-header-"+d+"'/>");return(d=c.header[d])&&a.each(d.split(" "),function(d){d>0&&e.append("<span class='fc-header-space'/>");var f;a.each(this.split(","),function(d,g){if(g=="title")e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>"),f&&f.addClass(n+"-corner-right"),f=null;else{var h;b[g]?h=b[g]:bu[g]&&(h=function(){j.removeClass(n+"-state-hover"),b.changeView(g)});if(h){d=c.theme?S(c.buttonIcons,g):null;var i=S(c.buttonText,g),j=a("<span class='fc-button fc-button-"+g+" "+n+"-state-default'><span class='fc-button-inner'><span class='fc-button-content'>"+(d?"<span class='fc-icon-wrap'><span class='ui-icon ui-icon-"+d+"'/></span>":i)+"</span><span class='fc-button-effect'><span></span></span></span></span>");j&&(j.click(function(){j.hasClass(n+"-state-disabled")||h()}).mousedown(function(){j.not("."+n+"-state-active").not("."+n+"-state-disabled").addClass(n+"-state-down")}).mouseup(function(){j.removeClass(n+"-state-down")}).hover(function(){j.not("."+n+"-state-active").not("."+n+"-state-disabled").addClass(n+"-state-hover")},function(){j.removeClass(n+"-state-hover").removeClass(n+"-state-down")}).appendTo(e),f||j.addClass(n+"-corner-left"),f=j)}}}),f&&f.addClass(n+"-corner-right")}),e}function g(a){m.find("h2").html(a)}function h(a){m.find("span.fc-button-"+a).addClass(n+"-state-active")}function i(a){m.find("span.fc-button-"+a).removeClass(n+"-state-active")}function j(a){m.find("span.fc-button-"+a).addClass(n+"-state-disabled")}function k(a){m.find("span.fc-button-"+a).removeClass(n+"-state-disabled")}var l=this;l.render=d,l.destroy=e,l.updateTitle=g,l.activateButton=h,l.deactivateButton=i,l.disableButton=j,l.enableButton=k;var m=a([]),n}function f(c,d){function e(a,b){return!D||a<D||b>E}function f(a,b){D=a,E=b,I=[],a=++F,G=b=C.length;for(var c=0;c<b;c++)g(C[c],a)}function g(a,b){h(a,function(c){if(b==F){if(c){for(var d=0;d<c.length;d++)c[d].source=a,t(c[d]);I=I.concat(c)}G--,G||A(I)}})}function h(b,d){var e,f=bt.sourceFetchers,g;for(e=0;e<f.length;e++){g=f[e](b,D,E,d);if(g===!0)return;if(typeof g=="object"){h(g,d);return}}if(e=b.events)a.isFunction(e)?(q(),e(m(D),m(E),function(a){d(a),s()})):a.isArray(e)?d(e):d();else if(b.url){var i=b.success,j=b.error,k=b.complete;e=a.extend({},b.data||{}),f=$(b.startParam,c.startParam),g=$(b.endParam,c.endParam),f&&(e[f]=Math.round(+D/1e3)),g&&(e[g]=Math.round(+E/1e3)),q(),a.ajax(a.extend({},bv,b,{data:e,success:function(b){b=b||[];var c=Z(i,this,arguments);a.isArray(c)&&(b=c),d(b)},error:function(){Z(j,this,arguments),d()},complete:function(){Z(k,this,arguments),s()}}))}else d()}function i(a){if(a=j(a))G++,g(a,F)}function j(b){a.isFunction(b)||a.isArray(b)?b={events:b}:typeof b=="string"&&(b={url:b});if(typeof b=="object")return u(b),C.push(b),b}function k(b){C=a.grep(C,function(a){return!v(a,b)}),I=a.grep(I,function(a){return!v(a.source,b)}),A(I)}function l(a){var b,c=I.length,d,e=z().defaultEventEnd,f=a.start-a._start,g=a.end?a.end-(a._end||e(a)):0;for(b=0;b<c;b++)d=I[b],d._id==a._id&&d!=a&&(d.start=new Date(+d.start+f),d.end=a.end?d.end?new Date(+d.end+g):new Date(+e(d)+g):null,d.title=a.title,d.url=a.url,d.allDay=a.allDay,d.className=a.className,d.editable=a.editable,d.color=a.color,d.backgroudColor=a.backgroudColor,d.borderColor=a.borderColor,d.textColor=a.textColor,t(d));t(a),A(I)}function n(a,b){t(a),a.source||(b&&(B.events.push(a),a.source=B),I.push(a)),A(I)}function o(b){if(b){if(!a.isFunction(b)){var c=b+"";b=function(a){return a._id==c}}I=a.grep(I,b,!0);for(d=0;d<C.length;d++)a.isArray(C[d].events)&&(C[d].events=a.grep(C[d].events,b,!0))}else{I=[];for(var d=0;d<C.length;d++)a.isArray(C[d].events)&&(C[d].events=[])}A(I)}function p(b){return a.isFunction(b)?a.grep(I,b):b?(b+="",a.grep(I,function(a){return a._id==b})):I}function q(){H++||y("loading",null,!0)}function s(){--H||y("loading",null,!1)}function t(a){var d=a.source||{},e=$(d.ignoreTimezone,c.ignoreTimezone);a._id=a._id||(a.id===b?"_fc"+bw++:a.id+""),a.date&&(a.start||(a.start=a.date),delete a.date),a._start=m(a.start=r(a.start,e)),a.end=r(a.end,e),a.end&&a.end<=a.start&&(a.end=null),a._end=a.end?m(a.end):null,a.allDay===b&&(a.allDay=$(d.allDayDefault,c.allDayDefault)),a.className?typeof a.className=="string"&&(a.className=a.className.split(/\s+/)):a.className=[]}function u(a){a.className?typeof a.className=="string"&&(a.className=a.className.split(/\s+/)):a.className=[];for(var b=bt.sourceNormalizers,c=0;c<b.length;c++)b[c](a)}function v(a,b){return a&&b&&w(a)==w(b)}function w(a){return(typeof a=="object"?a.events||a.url:"")||a}var x=this;x.isFetchNeeded=e,x.fetchEvents=f,x.addEventSource=i,x.removeEventSource=k,x.updateEvent=l,x.renderEvent=n,x.removeEvents=o,x.clientEvents=p,x.normalizeEvent=t;var y=x.trigger,z=x.getView,A=x.reportEvents,B={events:[]},C=[B],D,E,F=0,G=0,H=0,I=[];for(x=0;x<d.length;x++)j(d[x])}function g(a,b,c){return a.setFullYear(a.getFullYear()+b),c||l(a),a}function h(a,b,c){if(+a){b=a.getMonth()+b;var d=m(a);d.setDate(1),d.setMonth(b),a.setMonth(b);for(c||l(a);a.getMonth()!=d.getMonth();)a.setDate(a.getDate()+(a<d?1:-1))}return a}function i(a,b,c){if(+a){b=a.getDate()+b;var d=m(a);d.setHours(9),d.setDate(b),a.setDate(b),c||l(a),j(a,d)}return a}function j(a,b){if(+a)for(;a.getDate()!=b.getDate();)a.setTime(+a+(a<b?1:-1)*bz)}function k(a,b){return a.setMinutes(a.getMinutes()+b),a}function l(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a}function m(a,b){return b?l(new Date(+a)):new Date(+a)}function n(){var a=0,b;do b=new Date(1970,a++,1);while(b.getHours());return b}function o(a,b,c){for(b=b||1;!a.getDay()||c&&a.getDay()==1||!c&&a.getDay()==6;)i(a,b);return a}function p(a,b){return Math.round((m(a,!0)-m(b,!0))/by)}function q(a,c,d,e){c!==b&&c!=a.getFullYear()&&(a.setDate(1),a.setMonth(0),a.setFullYear(c)),d!==b&&d!=a.getMonth()&&(a.setDate(1),a.setMonth(d)),e!==b&&a.setDate(e)}function r(a,c){return typeof a=="object"?a:typeof a=="number"?new Date(a*1e3):typeof a=="string"?a.match(/^\d+(\.\d+)?$/)?new Date(parseFloat(a)*1e3):(c===b&&(c=!0),s(a,c)||(a?new Date(a):null)):null}function s(a,b){a=a.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!a)return null;var c=new Date(a[1],0,1);return b||!a[13]?(b=new Date(a[1],0,1,9,0),a[3]&&(c.setMonth(a[3]-1),b.setMonth(a[3]-1)),a[5]&&(c.setDate(a[5]),b.setDate(a[5])),j(c,b),a[7]&&c.setHours(a[7]),a[8]&&c.setMinutes(a[8]),a[10]&&c.setSeconds(a[10]),a[12]&&c.setMilliseconds(Number("0."+a[12])*1e3),j(c,b)):(c.setUTCFullYear(a[1],a[3]?a[3]-1:0,a[5]||1),c.setUTCHours(a[7]||0,a[8]||0,a[10]||0,a[12]?Number("0."+a[12])*1e3:0),a[14]&&(b=Number(a[16])*60+(a[18]?Number(a[18]):0),b*=a[15]=="-"?1:-1,c=new Date(+c+b*60*1e3))),c}function t(a){if(typeof a=="number")return a*60;if(typeof a=="object")return a.getHours()*60+a.getMinutes();if(a=a.match(/(\d+)(?::(\d+))?\s*(\w+)?/)){var b=parseInt(a[1],10);return a[3]&&(b%=12,a[3].toLowerCase().charAt(0)=="p"&&(b+=12)),b*60+(a[2]?parseInt(a[2],10):0)}}function u(a,b,c){return v(a,null,b,c)}function v(a,b,c,d){d=d||br;var e=a,f=b,g,h=c.length,i,j,k,l="";for(g=0;g<h;g++){i=c.charAt(g);if(i=="'"){for(j=g+1;j<h;j++)if(c.charAt(j)=="'"){e&&(l+=j==g+1?"'":c.substring(g+1,j),g=j);break}}else if(i=="("){for(j=g+1;j<h;j++)if(c.charAt(j)==")"){g=u(e,c.substring(g+1,j),d),parseInt(g.replace(/\D/,""),10)&&(l+=g),g=j;break}}else if(i=="["){for(j=g+1;j<h;j++)if(c.charAt(j)=="]"){i=c.substring(g+1,j),g=u(e,i,d),g!=u(f,i,d)&&(l+=g),g=j;break}}else if(i=="{")e=b,f=a;else if(i=="}")e=a,f=b;else{for(j=h;j>g;j--)if(k=bB[c.substring(g,j)]){e&&(l+=k(e,d)),g=j-1;break}j==g&&e&&(l+=i)}}return l}function w(a){return a.end?x(a.end,a.allDay):i(m(a.start),1)}function x(a,b){return a=m(a),b||a.getHours()||a.getMinutes()?i(a,1):l(a)}function y(a,b){return(b.msLength-a.msLength)*100+(a.event.start-b.event.start)}function z(a,b){return a.end>b.start&&a.start<b.end}function A(a,b,c,d){var e=[],f,g=a.length,h,i,j,k,l;for(f=0;f<g;f++)h=a[f],i=h.start,j=b[f],j>c&&i<d&&(i<c?(i=m(c),k=!1):(i=i,k=!0),j>d?(j=m(d),l=!1):(j=j,l=!0),e.push({event:h,start:i,end:j,isStart:k,isEnd:l,msLength:j-i}));return e.sort(y)}function B(a){var b=[],c,d=a.length,e,f,g,h;for(c=0;c<d;c++){e=a[c];for(f=0;;){g=!1;if(b[f])for(h=0;h<b[f].length;h++)if(z(b[f][h],e)){g=!0;break}if(g)f++;else break}b[f]?b[f].push(e):b[f]=[e]}return b}function C(c,d,e){c.unbind("mouseover").mouseover(function(c){for(var f=c.target,g;f!=this;)g=f,f=f.parentNode;(f=g._fci)!==b&&(g._fci=b,g=d[f],e(g.event,g.element,g),a(c.target).trigger(c)),c.stopPropagation()})}function D(b,c,d){for(var e=0,f;e<b.length;e++)f=a(b[e]),f.width(Math.max(0,c-F(f,d)))}function E(b,c,d){for(var e=0,f;e<b.length;e++)f=a(b[e]),f.height(Math.max(0,c-J(f,d)))}function F(a,b){return G(a)+I(a)+(b?H(a):0)}function G(b){return(parseFloat(a.curCSS(b[0],"paddingLeft",!0))||0)+(parseFloat(a.curCSS(b[0],"paddingRight",!0))||0)}function H(b){return(parseFloat(a.curCSS(b[0],"marginLeft",!0))||0)+(parseFloat(a.curCSS(b[0],"marginRight",!0))||0)}function I(b){return(parseFloat(a.curCSS(b[0],"borderLeftWidth",!0))||0)+(parseFloat(a.curCSS(b[0],"borderRightWidth",!0))||0)}function J(a,b){return K(a)+M(a)+(b?L(a):0)}function K(b){return(parseFloat(a.curCSS(b[0],"paddingTop",!0))||0)+(parseFloat(a.curCSS(b[0],"paddingBottom",!0))||0)}function L(b){return(parseFloat(a.curCSS(b[0],"marginTop",!0))||0)+(parseFloat(a.curCSS(b[0],"marginBottom",!0))||0)}function M(b){return(parseFloat(a.curCSS(b[0],"borderTopWidth",!0))||0)+(parseFloat(a.curCSS(b[0],"borderBottomWidth",!0))||0)}function N(a,b){b=typeof b=="number"?b+"px":b,a.each(function(a,c){c.style.cssText+=";min-height:"+b+";_height:"+b})}function O(){}function P(a,b){return a-b}function Q(a){return Math.max.apply(Math,a)}function R(a){return(a<10?"0":"")+a}function S(a,c){if(a[c]!==b)return a[c];c=c.split(/(?=[A-Z])/);for(var d=c.length-1,e;d>=0;d--){e=a[c[d].toLowerCase()];if(e!==b)return e}return a[""]}function T(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function U(a){return a.id+"/"+a.className+"/"+a.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,"")}function V(a){a.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function W(a){a.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last")}function X(a,b){a.each(function(a,c){c.className=c.className.replace(/^fc-\w*/,"fc-"+bx[b.getDay()])})}function Y(a,b){var c=a.source||{},d=a.color,e=c.color,f=b("eventColor"),g=a.backgroundColor||d||c.backgroundColor||e||b("eventBackgroundColor")||f;return d=a.borderColor||d||c.borderColor||e||b("eventBorderColor")||f,a=a.textColor||c.textColor||b("eventTextColor"),b=[],g&&b.push("background-color:"+g),d&&b.push("border-color:"+d),a&&b.push("color:"+a),b.join(";")}function Z(b,c,d){a.isFunction(b)&&(b=[b]);if(b){var e,f;for(e=0;e<b.length;e++)f=b[e].apply(c,d)||f;return f}}function $(){for(var a=0;a<arguments.length;a++)if(arguments[a]!==b)return arguments[a]}function _(a,b){function c(a,b){b&&(h(a,b),a.setDate(1)),a=m(a,!0),a.setDate(1),b=h(m(a),1);var c=m(a),j=m(b),k=e("firstDay"),l=e("weekends")?0:1;l&&(o(c),o(j,-1,!0)),i(c,-((c.getDay()-Math.max(k,l)+7)%7)),i(j,(7-j.getDay()+Math.max(k,l))%7),k=Math.round((j-c)/(by*7)),e("weekMode")=="fixed"&&(i(j,(6-k)*7),k=6),d.title=g(a,e("titleFormat")),d.start=a,d.end=b,d.visStart=c,d.visEnd=j,f(6,k,l?5:7,!0)}var d=this;d.render=c,bc.call(d,a,b,"month");var e=d.opt,f=d.renderBasic,g=b.formatDate}function ba(a,b){function c(a,b){b&&i(a,b*7),a=i(m(a),-((a.getDay()-e("firstDay")+7)%7)),b=i(m(a),7);var c=m(a),h=m(b),j=e("weekends");j||(o(c),o(h,-1,!0)),d.title=g(c,i(m(h),-1),e("titleFormat")),d.start=a,d.end=b,d.visStart=c,d.visEnd=h,f(1,1,j?7:5,!1)}var d=this;d.render=c,bc.call(d,a,b,"basicWeek");var e=d.opt,f=d.renderBasic,g=b.formatDates}function bb(a,b){function c(a,b){b&&(i(a,b),e("weekends")||o(a,b<0?-1:1)),d.title=g(a,e("titleFormat")),d.start=d.visStart=m(a,!0),d.end=d.visEnd=i(m(d.start),1),f(1,1,1,!1)}var d=this;d.render=c,bc.call(d,a,b,"basicDay");var e=d.opt,f=d.renderBasic,g=b.formatDate}function bc(b,c,d){function e(a,b,c,d){bg=b,bh=c,f(),(b=!Y)?g(a,d):O(),h(b)}function f(){(br=L("isRTL"))?(bs=-1,bt=bh-1):(bs=1,bt=0),bu=L("firstDay"),bv=L("weekends")?0:1,bw=L("theme")?"ui":"fc",bx=L("columnFormat")}function g(c,d){var e,f=bw+"-widget-header",g=bw+"-widget-content",h;e="<table class='fc-border-separate' style='width:100%' cellspacing='0'><thead><tr>";for(h=0;h<bh;h++)e+="<th class='fc- "+f+"'/>";e+="</tr></thead><tbody>";for(h=0;h<c;h++){e+="<tr class='fc-week"+h+"'>";for(f=0;f<bh;f++)e+="<td class='fc- "+g+" fc-day"+(h*bh+f)+"'><div>"+(d?"<div class='fc-day-number'/>":"")+"<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>";e+="</tr>"}e+="</tbody></table>",c=a(e).appendTo(b),T=c.find("thead"),U=T.find("th"),Y=c.find("tbody"),Z=Y.find("tr"),$=Y.find("td"),_=$.filter(":first-child"),ba=Z.eq(0).find("div.fc-day-content div"),W(T.add(T.find("tr"))),W(Z),Z.eq(0).addClass("fc-first"),n($),bb=a("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(b)}function h(b){var c=b||bg==1,d=K.start.getMonth(),e=l(new Date),f,g,h;c&&U.each(function(b,c){f=a(c),g=F(b),f.html(S(g,bx)),X(f,g)}),$.each(function(b,h){f=a(h),g=F(b),g.getMonth()==d?f.removeClass("fc-other-month"):f.addClass("fc-other-month"),+g==+e?f.addClass(bw+"-state-highlight fc-today"):f.removeClass(bw+"-state-highlight fc-today"),f.find("div.fc-day-number").text(g.getDate()),c&&X(f,g)}),Z.each(function(b,c){h=a(c),b<bg?(h.show(),b==bg-1?h.addClass("fc-last"):h.removeClass("fc-last")):h.hide()})}function j(b){be=b,b=be-T.height();var c,d,e;L("weekMode")=="variable"?c=d=Math.floor(b/(bg==1?2:6)):(c=Math.floor(b/bg),d=b-c*(bg-1)),_.each(function(b,f){b<bg&&(e=a(f),N(e.find("> div"),(b==bg-1?d:c)-J(e)))})}function k(a){bc=a,bp.clear(),bf=Math.floor(bc/bh),D(U.slice(0,-1),bf)}function n(a){a.click(o).mousedown(R)}function o(a){if(!L("selectable")){var b=parseInt(this.className.match(/fc\-day(\d+)/)[1]);b=F(b),M("dayClick",this,b,!0,a)}}function q(a,b,c){c&&bi.build(),c=m(K.visStart);for(var d=i(m(c),bh),e=0;e<bg;e++){var f=new Date(Math.max(c,a)),g=new Date(Math.min(d,b));if(f<g){var h;br?(h=p(g,c)*bs+bt+1,f=p(f,c)*bs+bt+1):(h=p(f,c),f=p(g,c)),n(r(e,h,e,f-1))}i(c,7),i(d,7)}}function r(a,c,d,e){return a=bi.rect(a,c,d,e,b),P(a,b)}function s(a){return m(a)}function t(a,b){q(a,i(m(b),1),!0)}function u(){Q()}function v(a,b,c){var d=B(a);M("dayClick",$[d.row*bh+d.col],a,b,c)}function w(a,b){bk.start(function(a){Q(),a&&r(a.row,a.col,a.row,a.col)},b)}function x(a,b,c){var d=bk.stop();Q(),d&&(d=C(d),M("drop",a,d,!0,b,c))}function y(a){return m(a.start)}function z(a){return bp.left(a)}function A(a){return bp.right(a)}function B(a){return{row:Math.floor(p(a,K.visStart)/7),col:G(a.getDay())}}function C(a){return E(a.row,a.col)}function E(a,b){return i(m(K.visStart),a*7+b*bs+bt)}function F(a){return E(Math.floor(a/bh),a%bh)}function G(a){return(a-Math.max(bu,bv)+bh)%bh*bs+bt}function H(a){return Z.eq(a)}function I(){return{left:0,right:bc}}var K=this;K.renderBasic=e,K.setHeight=j,K.setWidth=k,K.renderDayOverlay=q,K.defaultSelectionEnd=s,K.renderSelection=t,K.clearSelection=u,K.reportDayClick=v,K.dragStart=w,K.dragStop=x,K.defaultEventEnd=y,K.getHoverListener=function(){return bk},K.colContentLeft=z,K.colContentRight=A,K.dayOfWeekCol=G,K.dateCell=B,K.cellDate=C,K.cellIsAllDay=function(){return!0},K.allDayRow=H,K.allDayBounds=I,K.getRowCnt=function(){return bg},K.getColCnt=function(){return bh},K.getColWidth=function(){return bf},K.getDaySegmentContainer=function(){return bb},bj.call(K,b,c,d),bm.call(K),bl.call(K),bd.call(K);var L=K.opt,M=K.trigger,O=K.clearEvents,P=K.renderOverlay,Q=K.clearOverlays,R=K.daySelectionMousedown,S=c.formatDate,T,U,Y,Z,$,_,ba,bb,bc,be,bf,bg,bh,bi,bk,bp,br,bs,bt,bu,bv,bw,bx;V(b.addClass("fc-grid")),bi=new bn(function(b,c){var d,e,f;U.each(function(b,g){d=a(g),e=d.offset().left,b&&(f[1]=e),f=[e],c[b]=f}),f[1]=e+d.outerWidth(),Z.each(function(c,g){c<bg&&(d=a(g),e=d.offset().top,c&&(f[1]=e),f=[e],b[c]=f)}),f[1]=e+d.outerHeight()}),bk=new bo(bi),bp=new bq(function(a){return ba.eq(a)})}function bd(){function b(a,b){n(a),C(d(a),b)}function c(){o(),t().empty()}function d(b){var c=y(),d=z(),e=m(g.visStart);d=i(m(e),d);var f=a.map(b,w),h,j,k,l,n,o,p=[];for(h=0;h<c;h++){j=B(A(b,f,e,d));for(k=0;k<j.length;k++){l=j[k];for(n=0;n<l.length;n++)o=l[n],o.row=h,o.level=k,p.push(o)}i(e,7),i(d,7)}return p}function e(a,b,c){k(a)&&f(a,b),c.isEnd&&l(a)&&D(a,b,c),p(a,b)}function f(a,b){var c=u(),d;b.draggable({zIndex:9,delay:50,opacity:h("dragOpacity"),revertDuration:h("dragRevertDuration"),start:function(e,f){j("eventDragStart",b,a,e,f),r(a,b),c.start(function(c,e,f,g){b.draggable("option","revert",!c||!f&&!g),x(),c?(d=f*7+g*(h("isRTL")?-1:1),v(i(m(a.start),d),i(w(a),d))):d=0},e,"drag")},stop:function(e,f){c.stop(),x(),j("eventDragStop",b,a,e,f),d?s(this,a,d,0,a.allDay,e,f):(b.css("filter",""),q(a,b))}})}var g=this;g.renderEvents=b,g.compileDaySegs=d,g.clearEvents=c,g.bindDaySeg=e,bk.call(g);var h=g.opt,j=g.trigger,k=g.isEventDraggable,l=g.isEventResizable,n=g.reportEvents,o=g.reportEventClear,p=g.eventElementHandlers,q=g.showEvents,r=g.hideEvents,s=g.eventDrop,t=g.getDaySegmentContainer,u=g.getHoverListener,v=g.renderDayOverlay,x=g.clearOverlays,y=g.getRowCnt,z=g.getColCnt,C=g.renderDaySegs,D=g.resizableDayEvent}function be(a,b){function c(a,b){b&&i(a,b*7),a=i(m(a),-((a.getDay()-e("firstDay")+7)%7)),b=i(m(a),7);var c=m(a),h=m(b),j=e("weekends");j||(o(c),o(h,-1,!0)),d.title=g(c,i(m(h),-1),e("titleFormat")),d.start=a,d.end=b,d.visStart=c,d.visEnd=h,f(j?7:5)}var d=this;d.render=c,bg.call(d,a,b,"agendaWeek");var e=d.opt,f=d.renderAgenda,g=b.formatDates}function bf(a,b){function c(a,b){b&&(i(a,b),e("weekends")||o(a,b<0?-1:1)),b=m(a,!0);var c=i(m(b),1);d.title=g(a,e("titleFormat")),d.start=d.visStart=b,d.end=d.visEnd=c,f(1)}var d=this;d.render=c,bg.call(d,a,b,"agendaDay");var e=d.opt,f=d.renderAgenda,g=b.formatDate}function bg(c,d,e){function f(a){bS=a,g(),br?bc():h(),j()}function g(){bY=ba("theme")?"ui":"fc",b$=ba("weekends")?0:1,bZ=ba("firstDay"),(b_=ba("isRTL"))?(ca=-1,cb=bS-1):(ca=1,cb=0),cc=t(ba("minTime")),cd=t(ba("maxTime")),ce=ba("columnFormat")}function h(){var b=bY+"-widget-header",d=bY+"-widget-content",e,f,g,h,i,j=ba("slotMinutes")%15==0;e="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'><thead><tr><th class='fc-agenda-axis "+b+"'>&nbsp;</th>";for(f=0;f<bS;f++)e+="<th class='fc- fc-col"+f+" "+b+"'/>";e+="<th class='fc-agenda-gutter "+b+"'>&nbsp;</th></tr></thead><tbody><tr><th class='fc-agenda-axis "+b+"'>&nbsp;</th>";for(f=0;f<bS;f++)e+="<td class='fc- fc-col"+f+" "+d+"'><div><div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>";e+="<td class='fc-agenda-gutter "+d+"'>&nbsp;</td></tr></tbody></table>",br=a(e).appendTo(c),bs=br.find("thead"),bt=bs.find("th").slice(1,-1),bu=br.find("tbody"),bv=bu.find("td").slice(0,-1),bw=bv.find("div.fc-day-content div"),bx=bv.eq(0),by=bx.find("> div"),W(bs.add(bs.find("tr"))),W(bu.add(bu.find("tr"))),bI=bs.find("th:first"),bJ=br.find(".fc-agenda-gutter"),bz=a("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(c),ba("allDaySlot")?(bA=a("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(bz),e="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+b+" fc-agenda-axis'>"+ba("allDayText")+"</th><td><div class='fc-day-content'><div style='position:relative'/></div></td><th class='"+b+" fc-agenda-gutter'>&nbsp;</th></tr></table>",bB=a(e).appendTo(bz),bC=bB.find("tr"),v(bC.find("td")),bI=bI.add(bB.find("th:first")),bJ=bJ.add(bB.find("th.fc-agenda-gutter")),bz.append("<div class='fc-agenda-divider "+b+"'><div class='fc-agenda-divider-inner'/></div>")):bA=a([]),bD=a("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(bz),bE=a("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(bD),bF=a("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(bE),e="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>",g=n(),h=k(m(g),cd),k(g,cc);for(f=bT=0;g<h;f++)i=g.getMinutes(),e+="<tr class='fc-slot"+f+" "+(i?"fc-minor":"")+"'><th class='fc-agenda-axis "+b+"'>"+(!j||!i?bp(g,ba("axisFormat")):"&nbsp;")+"</th><td class='"+d+"'><div style='position:relative'>&nbsp;</div></td></tr>",k(g,ba("slotMinutes")),bT++;e+="</tbody></table>",bG=a(e).appendTo(bE),bH=bG.find("div:first"),w(bG.find("td")),bI=bI.add(bG.find("th:first"))}function j(){var a,b,c,d,e=l(new Date);for(a=0;a<bS;a++)d=H(a),b=bt.eq(a),b.html(bp(d,ce)),c=bv.eq(a),+d==+e?c.addClass(bY+"-state-highlight fc-today"):c.removeClass(bY+"-state-highlight fc-today"),X(b.add(c),d)}function o(a,c){a===b&&(a=bM),bM=a,bX={};var d=bu.position().top,e=bD.position().top;a=Math.min(a-d,bG.height()+e+1),by.height(a-J(bx)),bz.css("top",d),bD.height(a-e-1),bQ=bH.height()+1,c&&r()}function q(b){bL=b,bW.clear(),bN=0,D(bI.width("").each(function(b,c){bN=Math.max(bN,a(c).outerWidth())}),bN),b=bD[0].clientWidth,(bP=bD.width()-b)?(D(bJ,bP),bJ.show().prev().removeClass("fc-last")):bJ.hide().prev().addClass("fc-last"),bO=Math.floor((b-bN)/bS),D(bt.slice(0,-1),bO)}function r(){function a(){bD.scrollTop(d)}var b=n(),c=m(b);c.setHours(ba("firstHour"));var d=L(b,c)+1;a(),setTimeout(a,0)}function s(){bR=bD.scrollTop()}function u(){bD.scrollTop(bR)}function v(a){a.click(x).mousedown(bi)}function w(a){a.click(x).mousedown(U)}function x(a){if(!ba("selectable")){var b=Math.min(bS-1,Math.floor((a.pageX-br.offset().left-bN)/bO)),c=H(b),d=this.parentNode.className.match(/fc-slot(\d+)/);if(d){d=parseInt(d[1])*ba("slotMinutes");var e=Math.floor(d/60);c.setHours(e),c.setMinutes(d%60+cc),bb("dayClick",bv[b],c,!1,a)}else bb("dayClick",bv[b],c,!0,a)}}function y(a,b,c){c&&bU.build();var d=m(_.visStart);b_?(c=p(b,d)*ca+cb+1,a=p(a,d)*ca+cb+1):(c=p(a,d),a=p(b,d)),c=Math.max(0,c),a=Math.min(bS,a),c<a&&v(z(0,c,0,a-1))}function z(a,b,c,d){return a=bU.rect(a,b,c,d,bz),bd(a,bz)}function A(a,b){for(var c=m(_.visStart),d=i(m(c),1),e=0;e<bS;e++){var f=new Date(Math.max(c,a)),g=new Date(Math.min(d,b));if(f<g){var h=e*ca+cb;h=bU.rect(0,h,0,h,bE),f=L(c,f),g=L(c,g),h.top=f,h.height=g-f,w(bd(h,bE))}i(c,1),i(d,1)}}function B(a){return bW.left(a)}function C(a){return bW.right(a)}function F(a){return{row:Math.floor(p(a,_.visStart)/7),col:K(a.getDay())}}function G(a){var b=H(a.col);return a=a.row,ba("allDaySlot")&&a--,a>=0&&k(b,cc+a*ba("slotMinutes")),b}function H(a){return i(m(_.visStart),a*ca+cb)}function I(a){return ba("allDaySlot")&&!a.row}function K(a){return(a-Math.max(bZ,b$)+bS)%bS*ca+cb}function L(a,c){a=m(a,!0);if(c<k(m(a),cc))return 0;if(c>=k(m(a),cd))return bG.height();a=ba("slotMinutes"),c=c.getHours()*60+c.getMinutes()-cc;var d=Math.floor(c/a),e=bX[d];return e===b&&(e=bX[d]=bG.find("tr:eq("+d+") td div")[0].offsetTop),Math.max(0,Math.round(e-1+bQ*(c%a/a)))}function M(){return{left:bN,right:bL-bP}}function N(){return bC}function O(a){var b=m(a.start);return a.allDay?b:k(b,ba("defaultEventMinutes"))}function Q(a,b){return b?m(a):k(m(a),ba("slotMinutes"))}function R(a,b,c){c?ba("allDaySlot")&&y(a,i(m(b),1),!0):S(a,b)}function S(b,c){var d=ba("selectHelper");bU.build();if(d){var e=p(b,_.visStart)*ca+cb;if(e>=0&&e<bS){e=bU.rect(0,e,0,e,bE);var f=L(b,b),g=L(b,c);if(g>f){e.top=f,e.height=g-f,e.left+=2,e.width-=5;if(a.isFunction(d)){if(b=d(b,c))e.position="absolute",e.zIndex=8,bK=a(b).css(e).appendTo(bE)}else e.isStart=!0,e.isEnd=!0,bK=a(bk({title:"",start:b,end:c,className:["fc-select-helper"],editable:!1},e)),bK.css("opacity",ba("dragOpacity"));bK&&(w(bK),bE.append(bK),D(bK,e.width,!0),E(bK,e.height,!0))}}}else A(b,c)}function T(){be(),bK&&(bK.remove(),bK=null)}function U(b){if(b.which==1&&ba("selectable")){bg(b);var c;bV.start(function(a,b){T(),a&&a.col==b.col&&!I(a)?(b=G(b),a=G(a),c=[b,k(m(b),ba("slotMinutes")),a,k(m(a),ba("slotMinutes"))].sort(P),S(c[0],c[3])):c=null},b),a(document).one("mouseup",function(a){bV.stop(),c&&(+c[0]==+c[1]&&Y(c[0],!1,a),bf(c[0],c[3],!1,a))})}}function Y(a,b,c){bb("dayClick",bv[K(a.getDay())],a,b,c)}function Z(a,b){bV.start(function(a){be();if(a)if(I(a))z(a.row,a.col,a.row,a.col);else{a=G(a);var b=k(m(a),ba("defaultEventMinutes"));A(a,b)}},b)}function $(a,b,c){var d=bV.stop();be(),d&&bb("drop",a,G(d),I(d),b,c)}var _=this;_.renderAgenda=f,_.setWidth=q,_.setHeight=o,_.beforeHide=s,_.afterShow=u,_.defaultEventEnd=O,_.timePosition=L,_.dayOfWeekCol=K,_.dateCell=F,_.cellDate=G,_.cellIsAllDay=I,_.allDayRow=N,_.allDayBounds=M,_.getHoverListener=function(){return bV},_.colContentLeft=B,_.colContentRight=C,_.getDaySegmentContainer=function(){return bA},_.getSlotSegmentContainer=function(){return bF},_.getMinMinute=function(){return cc},_.getMaxMinute=function(){return cd},_.getBodyContent=function(){return bE},_.getRowCnt=function(){return 1},_.getColCnt=function(){return bS},_.getColWidth=function(){return bO},_.getSlotHeight=function(){return bQ},_.defaultSelectionEnd=Q,_.renderDayOverlay=y,_.renderSelection=R,_.clearSelection=T,_.reportDayClick=Y,_.dragStart=Z,_.dragStop=$,bj.call(_,c,d,e),bm.call(_),bl.call(_),bh.call(_);var ba=_.opt,bb=_.trigger,bc=_.clearEvents,bd=_.renderOverlay,be=_.clearOverlays,bf=_.reportSelection,bg=_.unselect,bi=_.daySelectionMousedown,bk=_.slotSegHtml,bp=d.formatDate,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX={},bY,bZ,b$,b_,ca,cb,cc,cd,ce;V(c.addClass("fc-agenda")),bU=new bn(function(b,c){function d(a){return Math.max(i,Math.min(j,a))}var e,f,g;bt.each(function(b,d){e=a(d),f=e.offset().left,b&&(g[1]=f),g=[f],c[b]=g}),g[1]=f+e.outerWidth(),ba("allDaySlot")&&(e=bC,f=e.offset().top,b[0]=[f,f+e.outerHeight()]);for(var h=bE.offset().top,i=bD.offset().top,j=i+bD.outerHeight(),k=0;k<bT;k++)b.push([d(h+bQ*k),d(h+bQ*(k+1))])}),bV=new bo(bU),bW=new bq(function(a){return bw.eq(a)})}function bh(){function c(a,b){y(a);var c,d=a.length,g=[],i=[];for(c=0;c<d;c++)a[c].allDay?g.push(a[c]):i.push(a[c]);s("allDaySlot")&&(Q(e(g),b),G()),h(f(i),b)}function d(){z(),H().empty(),I().empty()}function e(b){b=B(A(b,a.map(b,w),r.visStart,r.visEnd));var c,d=b.length,e,f,g,h=[];for(c=0;c<d;c++){e=b[c];for(f=0;f<e.length;f++)g=e[f],g.row=0,g.level=c,h.push(g)}return h}function f(b){var c=S(),d=M(),e=L(),f=k(m(r.visStart),d),h=a.map(b,g),j,l,n,o,p,q,s=[];for(j=0;j<c;j++){l=B(A(b,h,f,k(m(f),e-d))),bi(l);for(n=0;n<l.length;n++){o=l[n];for(p=0;p<o.length;p++)q=o[p],q.col=j,q.level=n,s.push(q)}i(f,1,!0)}return s}function g(a){return a.end?m(a.end):k(m(a.start),s("defaultEventMinutes"))}function h(c,d){var e,f=c.length,g,h,i,k,l,m,o,p,q,r="",u,v,w={},x={},y=I(),z;e=S(),(u=s("isRTL"))?(v=-1,z=e-1):(v=1,z=0);for(e=0;e<f;e++)g=c[e],h=g.event,i=N(g.start,g.start),k=N(g.start,g.end),l=g.col,m=g.level,o=g.forward||0,p=O(l*v+z),q=P(l*v+z)-p,q=Math.min(q-6,q*.95),l=m?q/(m+o+1):o?(q/(o+1)-6)*2:q,m=p+q/(m+o+1)*m*v+(u?q-l:0),g.top=i,g.left=m,g.outerWidth=l,g.outerHeight=k-i,r+=j(h,g);y[0].innerHTML=r,u=y.children();for(e=0;e<f;e++)g=c[e],h=g.event,r=a(u[e]),v=t("eventRender",h,h,r),v===!1?r.remove():(v&&v!==!0&&(r.remove(),r=a(v).css({position:"absolute",top:g.top,left:g.left}).appendTo(y)),g.element=r,h._id===d?n(h,r,g):r[0]._fci=e,Z(h,r));C(y,c,n);for(e=0;e<f;e++){g=c[e];if(r=g.element)h=w[d=g.key=U(r[0])],g.vsides=h===b?w[d]=J(r,!0):h,h=x[d],g.hsides=h===b?x[d]=F(r,!0):h,d=r.find("div.fc-event-content"),d.length&&(g.contentTop=d[0].offsetTop)}for(e=0;e<f;e++){g=c[e];if(r=g.element)r[0].style.width=Math.max(0,g.outerWidth-g.hsides)+"px",w=Math.max(0,g.outerHeight-g.vsides),r[0].style.height=w+"px",h=g.event,g.contentTop!==b&&w-g.contentTop<10&&(r.find("div.fc-event-time").text(bf(h.start,s("timeFormat"))+" - "+h.title),r.find("div.fc-event-title").remove()),t("eventAfterRender",h,h,r)}}function j(a,b){var c="<",d=a.url,e=Y(a,s),f=e?" style='"+e+"'":"",g=["fc-event","fc-event-skin","fc-event-vert"];return u(a)&&g.push("fc-event-draggable"),b.isStart&&g.push("fc-corner-top"),b.isEnd&&g.push("fc-corner-bottom"),g=g.concat(a.className),a.source&&(g=g.concat(a.source.className||[])),c+=d?"a href='"+T(a.url)+"'":"div",c+=" class='"+g.join(" ")+"' style='position:absolute;z-index:8;top:"+b.top+"px;left:"+b.left+"px;"+e+"'><div class='fc-event-inner fc-event-skin'"+f+"><div class='fc-event-head fc-event-skin'"+f+"><div class='fc-event-time'>"+T(bg(a.start,a.end,s("timeFormat")))+"</div></div><div class='fc-event-content'><div class='fc-event-title'>"+T(a.title)+"</div></div><div class='fc-event-bg'></div></div>",b.isEnd&&v(a)&&(c+="<div class='ui-resizable-handle ui-resizable-s'>=</div>"),c+="</"+(d?"a":"div")+">",c}function l(a,b,c){u(a)&&o(a,b,c.isStart),c.isEnd&&v(a)&&R(a,b,c),D(a,b)}function n(a,b,c){var d=b.find("div.fc-event-time");u(a)&&p(a,b,d),c.isEnd&&v(a)&&q(a,b,d),D(a,b)}function o(a,b,c){function d(){g||(b.width(e).height("").draggable("option","grid",null),g=!0)}var e,f,g=!0,h,j=s("isRTL")?-1:1,k=K(),l=V(),n=W(),o=M();b.draggable({zIndex:9,opacity:s("dragOpacity","month"),revertDuration:s("dragRevertDuration"),start:function(o,p){t("eventDragStart",b,a,o,p),_(a,b),e=b.width(),k.start(function(e,k,o,p){bd(),e?(f=!1,h=p*j,e.row?c?g&&(b.width(l-10),E(b,n*Math.round((a.end?(a.end-a.start)/bA:s("defaultEventMinutes"))/s("slotMinutes"))),b.draggable("option","grid",[l,1]),g=!1):f=!0:(bc(i(m(a.start),h),i(w(a),h)),d()),f=f||g&&!h):(d(),f=!0),b.draggable("option","revert",f)},o,"drag")},stop:function(c,e){k.stop(),bd(),t("eventDragStop",b,a,c,e);if(f)d(),b.css("filter",""),$(a,b);else{var i=0;g||(i=Math.round((b.offset().top-X().offset().top)/n)*s("slotMinutes")+o-(a.start.getHours()*60+a.start.getMinutes())),ba(this,a,h,i,g,c,e)}}})}function p(a,b,c){function d(b){var d=k(m(a.start),b),e;a.end&&(e=k(m(a.end),b)),c.text(bg(d,e,s("timeFormat")))}function e(){g&&(c.css("display",""),b.draggable("option","grid",[q,r]),g=!1)}var f,g=!1,h,j,l,n=s("isRTL")?-1:1,o=K(),p=S(),q=V(),r=W();b.draggable({zIndex:9,scroll:!1,grid:[q,r],axis:p==1?"y":!1,opacity:s("dragOpacity"),revertDuration:s("dragRevertDuration"),start:function(d,k){t("eventDragStart",b,a,d,k),_(a,b),f=b.position(),j=l=0,o.start(function(d,f,j,k){b.draggable("option","revert",!d),bd(),d&&(h=k*n,s("allDaySlot")&&!d.row?(g||(g=!0,c.hide(),b.draggable("option","grid",null)),bc(i(m(a.start),h),i(w(a),h))):e())},d,"drag")},drag:function(a,b){j=Math.round((b.position.top-f.top)/r)*s("slotMinutes"),j!=l&&(g||d(j),l=j)},stop:function(c,i){var k=o.stop();bd(),t("eventDragStop",b,a,c,i),k&&(h||j||g)?ba(this,a,h,g?0:j,g,c,i):(e(),b.css("filter",""),b.css(f),d(0),$(a,b))}})}function q(a,b,c){var d,e,f=W();b.resizable({handles:{s:"div.ui-resizable-s"},grid:f,start:function(c,f){d=e=0,_(a,b),b.css("z-index",9),t("eventResizeStart",this,a,c,f)},resize:function(g,h){d=Math.round((Math.max(f,b.height())-h.originalSize.height)/f),d!=e&&(c.text(bg(a.start,!d&&!a.end?null:k(x(a),s("slotMinutes")*d),s("timeFormat"))),e=d)},stop:function(c,e){t("eventResizeStop",this,a,c,e),d?bb(this,a,0,s("slotMinutes")*d,c,e):(b.css("z-index",8),$(a,b))}})}var r=this;r.renderEvents=c,r.compileDaySegs=e,r.clearEvents=d,r.slotSegHtml=j,r.bindDaySeg=l,bk.call(r);var s=r.opt,t=r.trigger,u=r.isEventDraggable,v=r.isEventResizable,x=r.eventEnd,y=r.reportEvents,z=r.reportEventClear,D=r.eventElementHandlers,G=r.setHeight,H=r.getDaySegmentContainer,I=r.getSlotSegmentContainer,K=r.getHoverListener,L=r.getMaxMinute,M=r.getMinMinute,N=r.timePosition,O=r.colContentLeft,P=r.colContentRight,Q=r.renderDaySegs,R=r.resizableDayEvent,S=r.getColCnt,V=r.getColWidth,W=r.getSlotHeight,X=r.getBodyContent,Z=r.reportEventElement,$=r.showEvents,_=r.hideEvents,ba=r.eventDrop,bb=r.eventResize,bc=r.renderDayOverlay,bd=r.clearOverlays,be=r.calendar,bf=be.formatDate,bg=be.formatDates}function bi(a){var b,c,d,e,f,g;for(b=a.length-1;b>0;b--){e=a[b];for(c=0;c<e.length;c++){f=e[c];for(d=0;d<a[b-1].length;d++)g=a[b-1][d],z(f,g)&&(g.forward=Math.max(g.forward||0,(f.forward||0)+1))}}}function bj(a,c,d){function e(a,b){return a=F[a],typeof a=="object"?S(a,b||d):a}function f(a,b){return c.trigger.apply(c,[a,b||y].concat(Array.prototype.slice.call(arguments,2),[y]))}function g(a){return j(a)&&!e("disableDragging")}function h(a){return j(a)&&!e("disableResizing")}function j(a){return $(a.editable,(a.source||{}).editable,e("editable"))}function l(a){C={};var b,c=a.length,d;for(b=0;b<c;b++)d=a[b],C[d._id]?C[d._id].push(d):C[d._id]=[d]}function n(a){return a.end?m(a.end):z(a)}function o(a,b){D.push(b),E[a._id]?E[a._id].push(b):E[a._id]=[b]}function p(){D=[],E={}}function q(a,b){b.click(function(c){if(!b.hasClass("ui-draggable-dragging")&&!b.hasClass("ui-resizable-resizing"))return f("eventClick",this,a,c)}).hover(function(b){f("eventMouseover",this,a,b)},function(b){f("eventMouseout",this,a,b)})}function r(a,b){t(a,b,"show")}function s(a,b){t(a,b,"hide")}function t(a,b,c){a=E[a._id];var d,e=a.length;for(d=0;d<e;d++)(!b||a[d][0]!=b[0])&&a[d][c]()}function u(a,b,c,d,e,g,h){var i=b.allDay,j=b._id;w(C[j],c,d,e),f("eventDrop",a,b,c,d,e,function(){w(C[j],-c,-d,i),B(j)},g,h),B(j)}function v(a,b,c,d,e,g){var h=b._id;x(C[h],c,d),f("eventResize",a,b,c,d,function(){x(C[h],-c,-d),B(h)},e,g),B(h)}function w(a,c,d,e){d=d||0;for(var f,g=a.length,h=0;h<g;h++)f=a[h],e!==b&&(f.allDay=e),k(i(f.start,c,!0),d),f.end&&(f.end=k(i(f.end,c,!0),d)),A(f,F)}function x(a,b,c){c=c||0;for(var d,e=a.length,f=0;f<e;f++)d=a[f],d.end=k(i(n(d),b,!0),c),A(d,F)}var y=this;y.element=a,y.calendar=c,y.name=d,y.opt=e,y.trigger=f,y.isEventDraggable=g,y.isEventResizable=h,y.reportEvents=l,y.eventEnd=n,y.reportEventElement=o,y.reportEventClear=p,y.eventElementHandlers=q,y.showEvents=r,y.hideEvents=s,y.eventDrop=u,y.eventResize=v;var z=y.defaultEventEnd,A=c.normalizeEvent,B=c.reportEventChange,C={},D=[],E={},F=c.options}function bk(){function c(a,b){var c=N(),d=B(),i=D(),m=0,q,r,s=a.length,t,u;c[0].innerHTML=e(a),f(a,c.children()),g(a),h(a,c,b),j(a),k(a),l(a),b=n();for(c=0;c<d;c++){q=[];for(r=0;r<i;r++)q[r]=0;for(;m<s&&(t=a[m]).row==c;){r=Q(q.slice(t.startCol,t.endCol)),t.top=r,r+=t.outerHeight;for(u=t.startCol;u<t.endCol;u++)q[u]=r;m++}b[c].height(Q(q))}p(a,o(b))}function d(b,c,d){var g=a("<div/>"),h=N(),i=b.length,m;g[0].innerHTML=e(b),g=g.children(),h.append(g),f(b,g),j(b),k(b),l(b),p(b,o(n())),g=[];for(h=0;h<i;h++)if(m=b[h].element)b[h].row===c&&m.css("top",d),g.push(m[0]);return a(g)}function e(a){var b=s("isRTL"),c,d=a.length,e,f,g,h;c=G();var i=c.left,j=c.right,k,l,m,n,o,p="";for(c=0;c<d;c++)e=a[c],f=e.event,h=["fc-event","fc-event-skin","fc-event-hori"],u(f)&&h.push("fc-event-draggable"),b?(e.isStart&&h.push("fc-corner-right"),e.isEnd&&h.push("fc-corner-left"),k=J(e.end.getDay()-1),l=J(e.start.getDay()),m=e.isEnd?H(k):i,n=e.isStart?I(l):j):(e.isStart&&h.push("fc-corner-left"),e.isEnd&&h.push("fc-corner-right"),k=J(e.start.getDay()),l=J(e.end.getDay()-1),m=e.isStart?H(k):i,n=e.isEnd?I(l):j),h=h.concat(f.className),f.source&&(h=h.concat(f.source.className||[])),g=f.url,o=Y(f,s),p+=g?"<a href='"+T(g)+"'":"<div",p+=" class='"+h.join(" ")+"' style='position:absolute;z-index:8;left:"+m+"px;"+o+"'><div class='fc-event-inner fc-event-skin'"+(o?" style='"+o+"'":"")+">",!f.allDay&&e.isStart&&(p+="<span class='fc-event-time'>"+T(P(f.start,f.end,s("timeFormat")))+"</span>"),p+="<span class='fc-event-title'>"+T(f.title)+"</span></div>",e.isEnd&&v(f)&&(p+="<div class='ui-resizable-handle ui-resizable-"+(b?"w":"e")+"'>&nbsp;&nbsp;&nbsp;</div>"),p+="</"+(g?"a":"div")+">",e.left=m,e.outerWidth=n-m,e.startCol=k,e.endCol=l+1;return p}function f(b,c){var d,e=b.length,f,g,h;for(d=0;d<e;d++)f=b[d],g=f.event,h=a(c[d]),g=t("eventRender",g,g,h),g===!1?h.remove():(g&&g!==!0&&(g=a(g).css({position:"absolute",left:f.left}),h.replaceWith(g),h=g),f.element=h)}function g(a){var b,c=a.length,d,e;for(b=0;b<c;b++)d=a[b],(e=d.element)&&x(d.event,e)}function h(a,b,c){var d,e=a.length,f,g,h;for(d=0;d<e;d++){f=a[d];if(g=f.element)h=f.event,h._id===c?O(h,g,f):g[0]._fci=d}C(b,a,O)}function j(a){var c,d=a.length,e,f,g,h,i={};for(c=0;c<d;c++){e=a[c];if(f=e.element)g=e.key=U(f[0]),h=i[g],h===b&&(h=i[g]=F(f,!0)),e.hsides=h}}function k(a){var b,c=a.length,d,e;for(b=0;b<c;b++){d=a[b];if(e=d.element)e[0].style.width=Math.max(0,d.outerWidth-d.hsides)+"px"}}function l(a){var c,d=a.length,e,f,g,h,i={};for(c=0;c<d;c++){e=a[c];if(f=e.element)g=e.key,h=i[g],h===b&&(h=i[g]=L(f)),e.outerHeight=f[0].offsetHeight+h}}function n(){var a,b=B(),c=[];for(a=0;a<b;a++)c[a]=E(a).find("td:first div.fc-day-content > div");return c}function o(a){var b,c=a.length,d=[];for(b=0;b<c;b++)d[b]=a[b][0].offsetTop;return d}function p(a,b){var c,d=a.length,e,f;for(c=0;c<d;c++){e=a[c];if(f=e.element)f[0].style.top=b[e.row]+(e.top||0)+"px",e=e.event,t("eventAfterRender",e,e,f)}}function q(b,c,e){var f=s("isRTL"),g=f?"w":"e",h=c.find("div.ui-resizable-"+g),j=!1;V(c),c.mousedown(function(a){a.preventDefault()}).click(function(a){j&&(a.preventDefault(),a.stopImmediatePropagation())}),h.mousedown(function(h){function k(c){t("eventResizeStop",this,b,c),a("body").css("cursor",""),l.stop(),S(),u&&A(this,b,u,0,c),setTimeout(function(){j=!1},0)}if(h.which==1){j=!0;var l=r.getHoverListener(),n=B(),o=D(),p=f?-1:1,q=f?o-1:0,s=c.css("top"),u,v,x=a.extend({},b),C=K(b.start);W(),a("body").css("cursor",g+"-resize").one("mouseup",k),t("eventResizeStart",this,b,h),l.start(function(a,c){if(a){var h=Math.max(C.row,a.row);a=a.col,n==1&&(h=0),h==C.row&&(a=f?Math.min(C.col,a):Math.max(C.col,a)),u=h*7+a*p+q-(c.row*7+c.col*p+q),c=i(w(b),u,!0),u?(x.end=c,h=v,v=d(M([x]),e.row,s),v.find("*").css("cursor",g+"-resize"),h&&h.remove(),z(b)):v&&(y(b),v.remove(),v=null),S(),R(b.start,i(m(c),1))}},h)}})}var r=this;r.renderDaySegs=c,r.resizableDayEvent=q;var s=r.opt,t=r.trigger,u=r.isEventDraggable,v=r.isEventResizable,w=r.eventEnd,x=r.reportEventElement,y=r.showEvents,z=r.hideEvents,A=r.eventResize,B=r.getRowCnt,D=r.getColCnt,E=r.allDayRow,G=r.allDayBounds,H=r.colContentLeft,I=r.colContentRight,J=r.dayOfWeekCol,K=r.dateCell,M=r.compileDaySegs,N=r.getDaySegmentContainer,O=r.bindDaySeg,P=r.calendar.formatDates,R=r.renderDayOverlay,S=r.clearOverlays,W=r.clearSelection}function bl(){function b(a,b,e){c(),b||(b=i(a,e)),j(a,b,e),d(a,b,e)}function c(a){l&&(l=!1,k(),h("unselect",null,a))}function d(a,b,c,d){l=!0,h("select",null,a,b,c,d)}function e(b){var e=f.cellDate,h=f.cellIsAllDay,i=f.getHoverListener(),l=f.reportDayClick;if(b.which==1&&g("selectable")){c(b);var m;i.start(function(a,b){k(),a&&h(a)?(m=[e(b),e(a)].sort(P),j(m[0],m[1],!0)):m=null},b),a(document).one("mouseup",function(a){i.stop(),m&&(+m[0]==+m[1]&&l(m[0],!0,a),d(m[0],m[1],!0,a))})}}var f=this;f.select=b,f.unselect=c,f.reportSelection=d,f.daySelectionMousedown=e;var g=f.opt,h=f.trigger,i=f.defaultSelectionEnd,j=f.renderSelection,k=f.clearSelection,l=!1;g("selectable")&&g("unselectAuto")&&a(document).mousedown(function(b){var d=g("unselectCancel");if(d&&a(b.target).parents(d).length)return;c(b)})}function bm(){function b(b,c){var d=f.shift();return d||(d=a("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>")),d[0].parentNode!=c[0]&&d.appendTo(c),e.push(d.css(b).show()),d}function c(){for(var a;a=e.shift();)f.push(a.hide().unbind())}var d=this;d.renderOverlay=b,d.clearOverlays=c;var e=[],f=[]}function bn(a){var b=this,c,d;b.build=function(){c=[],d=[],a(c,d)},b.cell=function(a,b){var e=c.length,f=d.length,g,h=-1,i=-1;for(g=0;g<e;g++)if(b>=c[g][0]&&b<c[g][1]){h=g;break}for(g=0;g<f;g++)if(a>=d[g][0]&&a<d[g][1]){i=g;break}return h>=0&&i>=0?{row:h,col:i}:null},b.rect=function(a,b,e,f,g){return g=g.offset(),{top:c[a][0]-g.top,left:d[b][0]-g.left,width:d[f][1]-d[b][0],height:c[e][1]-c[a][0]}}}function bo(b){function c(a){bp(a),a=b.cell(a.pageX,a.pageY);if(!a!=!h||a&&(a.row!=h.row||a.col!=h.col))a?(g||(g=a),f(a,g,a.row-g.row,a.col-g.col)):f(a,g),h=a}var d=this,e,f,g,h;d.start=function(d,i,j){f=d,g=h=null,b.build(),c(i),e=j||"mousemove",a(document).bind(e,c)},d.stop=function(){return a(document).unbind(e,c),h}}function bp(a){a.pageX===b&&(a.pageX=a.originalEvent.pageX,a.pageY=a.originalEvent.pageY)}function bq(a){function c(b){return e[b]=e[b]||a(b)}var d=this,e={},f={},g={};d.left=function(a){return f[a]=f[a]===b?c(a).position().left:f[a]},d.right=function(a){return g[a]=g[a]===b?d.left(a)+c(a).width():g[a]},d.clear=function(){e={},f={},g={}}}var br={defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:!0,allDayDefault:!0,ignoreTimezone:!0,lazyFetching:!0,startParam:"start",endParam:"end",titleFormat:{month:"MMMM yyyy",week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:"dddd, MMM d, yyyy"},columnFormat:{month:"ddd",week:"ddd M/d",day:"dddd M/d"},timeFormat:{"":"h(:mm)t"},isRTL:!1,firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],buttonText:{prev:"&nbsp;&#9668;&nbsp;",next:"&nbsp;&#9658;&nbsp;",prevYear:"&nbsp;&lt;&lt;&nbsp;",nextYear:"&nbsp;&gt;&gt;&nbsp;",today:"today",month:"month",week:"week",day:"day"},theme:!1,buttonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e"},unselectAuto:!0,dropAccept:"*"},bs={header:{left:"next,prev today",center:"",right:"title"},buttonText:{prev:"&nbsp;&#9658;&nbsp;",next:"&nbsp;&#9668;&nbsp;",prevYear:"&nbsp;&gt;&gt;&nbsp;",nextYear:"&nbsp;&lt;&lt;&nbsp;"},buttonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w"}},bt=a.fullCalendar={version:"1.5.3"},bu=bt.views={};a.fn.fullCalendar=function(c){if(typeof c=="string"){var e=Array.prototype.slice.call(arguments,1),f;return this.each(function(){var d=a.data(this,"fullCalendar");d&&a.isFunction(d[c])&&(d=d[c].apply(d,e),f===b&&(f=d),c=="destroy"&&a.removeData(this,"fullCalendar"))}),f!==b?f:this}var g=c.eventSources||[];return delete c.eventSources,c.events&&(g.push(c.events),delete c.events),c=a.extend(!0,{},br,c.isRTL||c.isRTL===b&&br.isRTL?bs:{},c),this.each(function(b,e){b=a(e),e=new d(b,c,g),b.data("fullCalendar",e),e.render()}),this},bt.sourceNormalizers=[],bt.sourceFetchers=[];var bv={dataType:"json",cache:!1},bw=1;bt.addDays=i,bt.cloneDate=m,bt.parseDate=r,bt.parseISO8601=s,bt.parseTime=t,bt.formatDate=u,bt.formatDates=v;var bx=["sun","mon","tue","wed","thu","fri","sat"],by=864e5,bz=36e5,bA=6e4,bB={s:function(a){return a.getSeconds()},ss:function(a){return R(a.getSeconds())},m:function(a){return a.getMinutes()},mm:function(a){return R(a.getMinutes())},h:function(a){return a.getHours()%12||12},hh:function(a){return R(a.getHours()%12||12)},H:function(a){return a.getHours()},HH:function(a){return R(a.getHours())},d:function(a){return a.getDate()},dd:function(a){return R(a.getDate())},ddd:function(a,b){return b.dayNamesShort[a.getDay()]},dddd:function(a,b){return b.dayNames[a.getDay()]},M:function(a){return a.getMonth()+1},MM:function(a){return R(a.getMonth()+1)},MMM:function(a,b){return b.monthNamesShort[a.getMonth()]},MMMM:function(a,b){return b.monthNames[a.getMonth()]},yy:function(a){return(a.getFullYear()+"").substring(2)},yyyy:function(a){return a.getFullYear()},t:function(a){return a.getHours()<12?"a":"p"},tt:function(a){return a.getHours()<12?"am":"pm"},T:function(a){return a.getHours()<12?"A":"P"},TT:function(a){return a.getHours()<12?"AM":"PM"},u:function(a){return u(a,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(a){return a=a.getDate(),a>10&&a<20?"th":["st","nd","rd"][a%10-1]||"th"}};bt.applyAll=Z,bu.month=_,bu.basicWeek=ba,bu.basicDay=bb,c({weekMode:"fixed"}),bu.agendaWeek=be,bu.agendaDay=bf,c({allDaySlot:!0,allDayText:"all-day",firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:"h(:mm)tt",timeFormat:{agenda:"h:mm{ - h:mm}"},dragOpacity:{agenda:.5},minTime:0,maxTime:24})}(jQuery);var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(a,b,c){c&&(b.not=c),this.helpers[a]=b},Handlebars.registerPartial=function(a,b){this.partials[a]=b},Handlebars.registerHelper("helperMissing",function(a){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+a+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(a,b){var c=b.inverse||function(){},d=b.fn,e="",f=toString.call(a);f===functionType&&(a=a.call(this));if(a===!0)return d(this);if(a===!1||a==null)return c(this);if(f==="[object Array]"){if(a.length>0)for(var g=0,h=a.length;g<h;g++)e+=d(a[g]);else e=c(this);return e}return d(a)}),Handlebars.registerHelper("each",function(a,b){var c=b.fn,d=b.inverse,e="";if(a&&a.length>0)for(var f=0,g=a.length;f<g;f++)e+=c(a[f]);else e=d(this);return e}),Handlebars.registerHelper("if",function(a,b){var c=toString.call(a);return c===functionType&&(a=a.call(this)),!a||Handlebars.Utils.isEmpty(a)?b.inverse(this):b.fn(this)}),Handlebars.registerHelper("unless",function(a,b){var c=b.fn,d=b.inverse;return b.fn=d,b.inverse=c,Handlebars.helpers["if"].call(this,a,b)}),Handlebars.registerHelper("with",function(a,b){return b.fn(a)}),Handlebars.registerHelper("log",function(a){Handlebars.log(a)});var handlebars=function(){var a={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function d(a,b,c,d,e,f,g){var h=f.length-1;switch(e){case 1:return f[h-1];case 2:this.$=new d.ProgramNode(f[h-2],f[h]);break;case 3:this.$=new d.ProgramNode(f[h]);break;case 4:this.$=new d.ProgramNode([]);break;case 5:this.$=[f[h]];break;case 6:f[h-1].push(f[h]),this.$=f[h-1];break;case 7:this.$=new d.InverseNode(f[h-2],f[h-1],f[h]);break;case 8:this.$=new d.BlockNode(f[h-2],f[h-1],f[h]);break;case 9:this.$=f[h];break;case 10:this.$=f[h];break;case 11:this.$=new d.ContentNode(f[h]);break;case 12:this.$=new d.CommentNode(f[h]);break;case 13:this.$=new d.MustacheNode(f[h-1][0],f[h-1][1]);break;case 14:this.$=new d.MustacheNode(f[h-1][0],f[h-1][1]);break;case 15:this.$=f[h-1];break;case 16:this.$=new d.MustacheNode(f[h-1][0],f[h-1][1]);break;case 17:this.$=new d.MustacheNode(f[h-1][0],f[h-1][1],!0);break;case 18:this.$=new d.PartialNode(f[h-1]);break;case 19:this.$=new d.PartialNode(f[h-2],f[h-1]);break;case 20:break;case 21:this.$=[[f[h-2]].concat(f[h-1]),f[h]];break;case 22:this.$=[[f[h-1]].concat(f[h]),null];break;case 23:this.$=[[f[h-1]],f[h]];break;case 24:this.$=[[f[h]],null];break;case 25:f[h-1].push(f[h]),this.$=f[h-1];break;case 26:this.$=[f[h]];break;case 27:this.$=f[h];break;case 28:this.$=new d.StringNode(f[h]);break;case 29:this.$=new d.IntegerNode(f[h]);break;case 30:this.$=new d.BooleanNode(f[h]);break;case 31:this.$=new d.HashNode(f[h]);break;case 32:f[h-1].push(f[h]),this.$=f[h-1];break;case 33:this.$=[f[h]];break;case 34:this.$=[f[h-2],f[h]];break;case 35:this.$=[f[h-2],new d.StringNode(f[h])];break;case 36:this.$=[f[h-2],new d.IntegerNode(f[h])];break;case 37:this.$=[f[h-2],new d.BooleanNode(f[h])];break;case 38:this.$=new d.IdNode(f[h]);break;case 39:f[h-2].push(f[h]),this.$=f[h-2];break;case 40:this.$=[f[h]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(a,b){throw new Error(a)},parse:function f(a){function n(a){c.length=c.length-2*a,d.length=d.length-a,e.length=e.length-a}function o(){var a;return a=b.lexer.lex()||1,typeof a!="number"&&(a=b.symbols_[a]||a),a}var b=this,c=[0],d=[null],e=[],f=this.table,g="",h=0,i=0,j=0,k=2,l=1;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var m=this.lexer.yylloc;e.push(m),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var p,q,r,s,t,u,v={},w,x,y,z;for(;;){r=c[c.length-1],this.defaultActions[r]?s=this.defaultActions[r]:(p==null&&(p=o()),s=f[r]&&f[r][p]);if(typeof s=="undefined"||!s.length||!s[0])if(!j){z=[];for(w in f[r])this.terminals_[w]&&w>2&&z.push("'"+this.terminals_[w]+"'");var A="";this.lexer.showPosition?A="Parse error on line "+(h+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+z.join(", ")+", got '"+this.terminals_[p]+"'":A="Parse error on line "+(h+1)+": Unexpected "+(p==1?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(A,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:m,expected:z})}if(s[0]instanceof Array&&s.length>1)throw new Error("Parse Error: multiple actions possible at state: "+r+", token: "+p);switch(s[0]){case 1:c.push(p),d.push(this.lexer.yytext),e.push(this.lexer.yylloc),c.push(s[1]),p=null,q?(p=q,q=null):(i=this.lexer.yyleng,g=this.lexer.yytext,h=this.lexer.yylineno,m=this.lexer.yylloc,j>0&&j--);break;case 2:x=this.productions_[s[1]][1],v.$=d[d.length-x],v._$={first_line:e[e.length-(x||1)].first_line,last_line:e[e.length-1].last_line,first_column:e[e.length-(x||1)].first_column,last_column:e[e.length-1].last_column},u=this.performAction.call(v,g,i,h,this.yy,s[1],d,e);if(typeof u!="undefined")return u;x&&(c=c.slice(0,-1*x*2),d=d.slice(0,-1*x),e=e.slice(0,-1*x)),c.push(this.productions_[s[1]][0]),d.push(v.$),e.push(v._$),y=f[c[c.length-2]][c[c.length-1]],c.push(y);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function b(a,b){if(this.yy.parseError)this.yy.parseError(a,b);else throw new Error(a)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");var e=this._currentRules();for(var f=0;f<e.length;f++){b=this._input.match(this.rules[e[f]]);if(b){d=b[0].match(/\n.*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,e[f],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return typeof a!="undefined"?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.performAction=function(a,b,c,d){var e=d;switch(c){case 0:b.yytext.slice(-1)!=="\\"&&this.begin("mu"),b.yytext.slice(-1)==="\\"&&(b.yytext=b.yytext.substr(0,b.yyleng-1),this.begin("emu"));if(b.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return b.yytext=b.yytext.substr(3,b.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return b.yytext=b.yytext.substr(1,b.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},a.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],a.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},a}();return a.lexer=b,a}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(a){if(!a[1])throw new Error("Usage: "+a[0]+" FILE");if(typeof process!="undefined")var b=require("fs").readFileSync(require("path").join(process.cwd(),a[1]),"utf8");else var c=require("file").path(require("file").cwd()),b=c.join(a[1]).read({charset:"utf-8"});return exports.parser.parse(b)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(a){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(a)},Handlebars.print=function(a){return(new Handlebars.PrintVisitor).accept(a)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){}},Handlebars.log=function(a,b){Handlebars.logger.log(a,b)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(a,b){this.type="program",this.statements=a,b&&(this.inverse=new Handlebars.AST.ProgramNode(b))},Handlebars.AST.MustacheNode=function(a,b,c){this.type="mustache",this.id=a[0],this.params=a.slice(1),this.hash=b,this.escaped=!c},Handlebars.AST.PartialNode=function(a,b){this.type="partial",this.id=a,this.context=b};var a=function(a,b){if(a.original!==b.original)throw new Handlebars.Exception(a.original+" doesn't match "+b.original)};Handlebars.AST.BlockNode=function(b,c,d){a(b.id,d),this.type="block",this.mustache=b,this.program=c},Handlebars.AST.InverseNode=function(b,c,d){a(b.id,d),this.type="inverse",this.mustache=b,this.program=c},Handlebars.AST.ContentNode=function(a){this.type="content",this.string=a},Handlebars.AST.HashNode=function(a){this.type="hash",this.pairs=a},Handlebars.AST.IdNode=function(a){this.type="ID",this.original=a.join(".");var b=[],c=0;for(var d=0,e=a.length;d<e;d++){var f=a[d];f===".."?c++:f==="."||f==="this"?this.isScoped=!0:b.push(f)}this.parts=b,this.string=b.join("."),this.depth=c,this.isSimple=b.length===1&&c===0},Handlebars.AST.StringNode=function(a){this.type="STRING",this.string=a},Handlebars.AST.IntegerNode=function(a){this.type="INTEGER",this.integer=a},Handlebars.AST.BooleanNode=function(a){this.type="BOOLEAN",this.bool=a},Handlebars.AST.CommentNode=function(a){this.type="comment",this.comment=a}}(),Handlebars.Exception=function(a){var b=Error.prototype.constructor.apply(this,arguments);for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);this.message=b.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(a){this.string=a},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},b=/&(?!\w+;)|[<>"'`]/g,c=/[&<>"'`]/,d=function(b){return a[b]||"&amp;"};Handlebars.Utils={escapeExpression:function(a){return a instanceof Handlebars.SafeString?a.toString():a==null||a===!1?"":c.test(a)?a.replace(b,d):a},isEmpty:function(a){return typeof a=="undefined"?!0:a===null?!0:a===!1?!0:a===""?!0:a==="0"?!0:Object.prototype.toString.call(a)==="[object Array]"&&a.length===0?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(a,b){a.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16},a.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1},a.DISASSEMBLE_MAP={};for(var c in a.OPCODE_MAP){var d=a.OPCODE_MAP[c];a.DISASSEMBLE_MAP[d]=c}a.multiParamSize=function(b){return a.MULTI_PARAM_OPCODES[a.DISASSEMBLE_MAP[b]]},a.prototype={compiler:a,disassemble:function(){var b=this.opcodes,c,d,e=[],f,g,h;for(var i=0,j=b.length;i<j;i++){c=b[i];if(c==="DECLARE")g=b[++i],h=b[++i],e.push("DECLARE "+g+" = "+h);else{f=a.DISASSEMBLE_MAP[c];var k=a.multiParamSize(c),l=[];for(var m=0;m<k;m++)d=b[++i],typeof d=="string"&&(d='"'+d.replace("\n","\\n")+'"'),l.push(d);f=f+" "+l.join(" "),e.push(f)}}return e.join("\n")},guid:0,compile:function(a,b){this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b=a.statements,c;this.opcodes=[];for(var d=0,e=b.length;d<e;d++)c=b[d],this[c.type](c);return this.isSimple=e===1,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b=(new this.compiler).compile(a,this.options),c=this.guid++;this.usePartial=this.usePartial||b.usePartial,this.children[c]=b;for(var d=0,e=b.depths.list.length;d<e;d++){depth=b.depths.list[d];if(depth<2)continue;this.addDepth(depth-1)}return c},block:function(a){var b=a.mustache,c,d,e,f,g=this.setupStackForMustache(b),h=this.compileProgram(a.program);a.program.inverse&&(f=this.compileProgram(a.program.inverse),this.declare("inverse",f)),this.opcode("invokeProgram",h,g.length,!!b.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(a){var b=this.setupStackForMustache(a.mustache),c=this.compileProgram(a.program);this.declare("inverse",c),this.opcode("invokeProgram",null,b.length,!!a.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(a){var b=a.pairs,c,d;this.opcode("push","{}");for(var e=0,f=b.length;e<f;e++)c=b[e],d=c[1],this.accept(d),this.opcode("assignToHash",c[0])},partial:function(a){var b=a.id;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.original),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.setupStackForMustache(a);this.opcode("invokeMustache",b.length,a.id.original,!!a.hash),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth),this.opcode("lookupWithHelpers",a.parts[0]||null,a.isScoped||!1);for(var b=1,c=a.parts.length;b<c;b++)this.opcode("lookup",a.parts[b])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("push",a.integer)},BOOLEAN:function(a){this.opcode("push",a.bool)},comment:function(){},pushParams:function(a){var b=a.length,c;while(b--)c=a[b],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.string)):this[c.type](c)},opcode:function(b,c,d,e){this.opcodes.push(a.OPCODE_MAP[b]),c!==undefined&&this.opcodes.push(c),d!==undefined&&this.opcodes.push(d),e!==undefined&&this.opcodes.push(e)},declare:function(a,b){this.opcodes.push("DECLARE"),this.opcodes.push(a),this.opcodes.push(b)},addDepth:function(a){if(a===0)return;this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a))},setupStackForMustache:function(a){var b=a.params;return this.pushParams(b),a.hash&&this.hash(a.hash),this.ID(a.id),b}},b.prototype={nameLookup:function(a,c,d){return/^[0-9]+$/.test(c)?a+"["+c+"]":b.isValidJavaScriptVariableName(c)?a+"."+c:a+"['"+c+"']"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":"buffer += "+a+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(a,b);var e=a.opcodes,f;this.i=0;for(h=e.length;this.i<h;this.i++)f=this.nextOpcode(0),f[0]==="DECLARE"?(this.i=this.i+2,this[f[1]]=f[2]):(this.i=this.i+f[1].length,this[f[0]].apply(this,f[1]));return this.createFunctionContext(d)},nextOpcode:function(b){var c=this.environment.opcodes,d=c[this.i+b],e,f,g,h;if(d==="DECLARE")return e=c[this.i+1],f=c[this.i+2],["DECLARE",e,f];e=a.DISASSEMBLE_MAP[d],g=a.multiParamSize(d),h=[];for(var i=0;i<g;i++)h.push(c[this.i+i+1+b]);return[e,h]},eat:function(a){this.i=this.i+a.length},preamble:function(){var a=[];this.useRegister("foundHelper");if(!this.isChild){var b=this.namespace,c="helpers = helpers || "+b+".helpers;";this.environment.usePartial&&(c=c+" partials = partials || "+b+".partials;"),a.push(c)}else a.push("");this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(a){var b=this.stackVars;this.isChild||(b=b.concat(this.context.registers.list)),b.length>0&&(this.source[1]=this.source[1]+", "+b.join(", "));if(!this.isChild){var c=[];for(var d in this.context.aliases)this.source[1]=this.source[1]+", "+d+"="+this.context.aliases[d]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var e=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var f=0,g=this.environment.depths.list.length;f<g;f++)e.push("depth"+this.environment.depths.list[f]);if(a)return e.push(this.source.join("\n  ")),Function.apply(this,e);var h="function "+(this.name||"")+"("+e.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,h+"\n\n"),h},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var a=this.nextOpcode(1),b="";this.context.aliases.escapeExpression="this.escapeExpression",a[0]==="appendContent"&&(b=" + "+this.quotedString(a[1][0]),this.eat(a)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+b))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupWithHelpers:function(a,b){if(a){var c=this.nextStack();this.usingKnownHelper=!1;var d;!b&&this.options.knownHelpers[a]?(d=c+" = "+this.nameLookup("helpers",a,"helper"),this.usingKnownHelper=!0):b||this.options.knownHelpersOnly?d=c+" = "+this.nameLookup("depth"+this.lastContext,a,"context"):(this.register("foundHelper",this.nameLookup("helpers",a,"helper")),d=c+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,a,"context")),d+=";",this.source.push(d)}else this.pushStack("depth"+this.lastContext)},lookup:function(a){var b=this.topStack();this.source.push(b+" = ("+b+" === null || "+b+" === undefined || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")+");")},pushStringParam:function(a){this.pushStack("depth"+this.lastContext),this.pushString(a)},pushString:function(a){this.pushStack(this.quotedString(a))},push:function(a){this.pushStack(a)},invokeMustache:function(a,b,c){this.populateParams(a,this.quotedString(b),"{}",null,c,function(a,b,c){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+c+"=== undef) { "+a+" = helperMissing.call("+b+"); }"),a!==c&&this.source.push("else { "+a+" = "+c+"; }"))})},invokeProgram:function(a,b,c){var d=this.programExpression(this.inverse),e=this.programExpression(a);this.populateParams(b,null,e,d,c,function(a,b,c){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+a+" = blockHelperMissing.call("+b+"); }"))})},populateParams:function(a,b,c,d,e,f){var g=e||this.options.stringParams||d||this.options.data,h=this.popStack(),i,j=[],k,l,m;g?(this.register("tmp1",c),m="tmp1"):m="{ hash: {} }";if(g){var n=e?this.popStack():"{}";this.source.push("tmp1.hash = "+n+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var o=0;o<a;o++)k=this.popStack(),j.push(k),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");d&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+d+";")),this.options.data&&this.source.push("tmp1.data = data;"),j.push(m),this.populateCall(j,h,b||h,f,c!=="{}")},populateCall:function(a,b,c,d,e){var f=["depth0"].concat(a).join(", "),g=["depth0"].concat(c).concat(a).join(", "),h=this.nextStack();if(this.usingKnownHelper)this.source.push(h+" = "+b+".call("+f+");");else{this.context.aliases.functionType='"function"';var i=e?"foundHelper && ":"";this.source.push("if("+i+"typeof "+b+" === functionType) { "+h+" = "+b+".call("+f+"); }")}d.call(this,h,g,b),this.usingKnownHelper=!1},invokePartial:function(a){params=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(a){var b=this.popStack(),c=this.topStack();this.source.push(c+"['"+a+"'] = "+b+";")},compiler:b,compileChildren:function(a,b){var c=a.children,d,e;for(var f=0,g=c.length;f<g;f++){d=c[f],e=new this.compiler,this.context.programs.push("");var h=this.context.programs.length;d.index=h,d.name="program"+h,this.context.programs[h]=e.compile(d,b,this.context)}},programExpression:function(a){if(a==null)return"self.noop";var b=this.environment.children[a],c=b.depths.list,d=[b.index,b.name,"data"];for(var e=0,f=c.length;e<f;e++)depth=c[e],depth===1?d.push("depth0"):d.push("depth"+(depth-1));return c.length===0?"self.program("+d.join(", ")+")":(d.shift(),"self.programWithDepth("+d.join(", ")+")")},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.context.registers[a]||(this.context.registers[a]=!0,this.context.registers.list.push(a))},pushStack:function(a){return this.source.push(this.nextStack()+" = "+a+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),f=b.RESERVED_WORDS={};for(var g=0,h=e.length;g<h;g++)f[e[g]]=!0;b.isValidJavaScriptVariableName=function(a){return!b.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(a,b){b=b||{};var c=Handlebars.parse(a),d=(new Handlebars.Compiler).compile(c,b);return(new Handlebars.JavaScriptCompiler).compile(d,b)},Handlebars.compile=function(a,b){function d(){var c=Handlebars.parse(a),d=(new Handlebars.Compiler).compile(c,b),e=(new Handlebars.JavaScriptCompiler).compile(d,b,undefined,!0);return Handlebars.template(e)}b=b||{};var c;return function(a,b){return c||(c=d()),c.call(this,a,b)}},Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(a,b,c){var d=this.programs[a];return c?Handlebars.VM.program(b,c):d?d:(d=this.programs[a]=Handlebars.VM.program(b),d)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(c,d){return d=d||{},a.call(b,Handlebars,c,d.helpers,d.partials,d.data)}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,2);return function(c,e){return e=e||{},a.apply(this,[c,e.data||b].concat(d))}},program:function(a,b){return function(c,d){return d=d||{},a(c,d.data||b)}},noop:function(){return""},invokePartial:function(a,b,c,d,e,f){options={helpers:d,partials:e,data:f};if(a===undefined)throw new Handlebars.Exception("The partial "+b+" could not be found");if(a instanceof Function)return a(c,options);if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in runtime-only mode");return e[b]=Handlebars.compile(a),e[b](c,options)}},Handlebars.template=Handlebars.VM.template,function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;return!b.href||!g||f.nodeName.toLowerCase()!=="map"?!1:(h=a("img[usemap=#"+g+"]")[0],!!h&&d(h))}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(a.ui.version)return;a.extend(a.ui,{version:"1.8.21",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),e&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var f=d==="Width"?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!d||!a.element[0].parentNode)return;for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}})}(jQuery),function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&e.charAt(0)==="_"?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b)return h=f,!1}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}(jQuery),function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(c)return;this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted)return b.preventDefault(),!0}return!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||!!b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})}(jQuery),function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(b),this.handle?(c.iframeFix&&a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=!1;a.ui.ddmanager&&!this.options.dropBehaviour&&(c=a.ui.ddmanager.drop(this,b)),this.dropped&&(c=this.dropped,this.dropped=!1);var d=this.element[0],e=!1;while(d&&(d=d.parentNode))d==document&&(e=!0);if(!e&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var f=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){f._trigger("stop",b)!==!1&&f._clear()})}else this._trigger("stop",b)!==!1&&this._clear();return!1},_mouseUp:function(b){return this.options.iframeFix===!0&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?!0:!1;return a(this.options.handle,this.element).find("*").andSelf().each(function(){this==b.target&&(c=!0)}),c},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo),d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[b.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,b.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(b.containment=="document"?0:a(window).scrollLeft())+a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b.containment=="document"?0:a(window).scrollTop())+(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&b.containment.constructor!=Array){var c=a(b.containment),d=c[0];if(!d)return;var e=c.offset(),f=a(d).css("overflow")!="hidden";this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else b.containment.constructor==Array&&(this.containment=b.containment)},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!a.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!a.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){var h;if(this.containment){if(this.relative_container){var i=this.relative_container.offset();h=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]}else h=this.containment;b.pageX-this.offset.click.left<h[0]&&(f=h[0]+this.offset.click.left),b.pageY-this.offset.click.top<h[1]&&(g=h[1]+this.offset.click.top),b.pageX-this.offset.click.left>h[2]&&(f=h[2]+this.offset.click.left),b.pageY-this.offset.click.top>h[3]&&(g=h[3]+this.offset.click.top)}if(c.grid){var j=c.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;g=h?j-this.offset.click.top<h[1]||j-this.offset.click.top>h[3]?j-this.offset.click.top<h[1]?j+c.grid[1]:j-c.grid[1]:j:j;var k=c.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX;f=h?k-this.offset.click.left<h[0]||k-this.offset.click.left>h[2]?k-this.offset.click.left<h[0]?k+c.grid[0]:k-c.grid[0]:k:k}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),b=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.extend(a.ui.draggable,{version:"1.8.21"}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("draggable"),e=this,f=function(b){var c=this.offset.click.top,d=this.offset.click.left,e=this.positionAbs.top,f=this.positionAbs.left,g=b.height,h=b.width,i=b.top,j=b.left;return a.ui.isOver(e+c,f+d,i,j,g,h)};a.each(d.sortables,function(f){this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c){var d=a("body"),e=a(this).data("draggable").options;d.css("cursor")&&(e._cursor=d.css("cursor")),d.css("cursor",e.cursor)},stop:function(b,c){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(b,c){var d=a(this).data("draggable");d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"&&(d.overflowOffset=d.scrollParent.offset())},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=!1;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!="x")d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed);if(!e.axis||e.axis!="y")d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed)}else{if(!e.axis||e.axis!="x")b.pageY-a(document).scrollTop()<e.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<e.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed));if(!e.axis||e.axis!="y")b.pageX-a(document).scrollLeft()<e.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<e.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed))}f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c){var d=a(this).data("draggable"),e=d.options;d.snapElements=[],a(e.snap.constructor!=String?e.snap.items||":data(draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,h=g+d.helperProportions.width,i=c.offset.top,j=i+d.helperProportions.height;for(var k=d.snapElements.length-1;k>=0;k--){var l=d.snapElements[k].left,m=l+d.snapElements[k].width,n=d.snapElements[k].top,o=n+d.snapElements[k].height;if(!(l-f<g&&g<m+f&&n-f<i&&i<o+f||l-f<g&&g<m+f&&n-f<j&&j<o+f||l-f<h&&h<m+f&&n-f<i&&i<o+f||l-f<h&&h<m+f&&n-f<j&&j<o+f)){d.snapElements[k].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=!1;continue}if(e.snapMode!="inner"){var p=Math.abs(n-j)<=f,q=Math.abs(o-i)<=f,r=Math.abs(l-h)<=f,s=Math.abs(m-g)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n-d.helperProportions.height,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m}).left-d.margins.left)}var t=p||q||r||s;if(e.snapMode!="outer"){var p=Math.abs(n-i)<=f,q=Math.abs(o-j)<=f,r=Math.abs(l-g)<=f,s=Math.abs(m-h)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o-d.helperProportions.height,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m-d.helperProportions.width}).left-d.margins.left)}!d.snapElements[k].snapping&&(p||q||r||s||t)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=p||q||r||s||t}}}),a.ui.plugin.add("draggable","stack",{start:function(b,c){var d=a(this).data("draggable").options,e=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!e.length)return;var f=parseInt(e[0].style.zIndex)||0;a(e).each(function(a){this.style.zIndex=f+a}),this[0].style.zIndex=f+e.length}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a,b){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var b=this.options,c=b.accept;this.isover=0,this.isout=1,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];for(var c=0;c<b.length;c++)b[c]==this&&b.splice(c,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(b,c){b=="accept"&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current;if(!d||(d.currentItem||d.element)[0]==this.element[0])return!1;var e=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"droppable");if(b.options.greedy&&!b.options.disabled&&b.options.scope==d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance))return e=!0,!1}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.extend(a.ui.droppable,{version:"1.8.21"}),a.ui.intersect=function(b,c,d){if(!c.offset)return!1;var e=(b.positionAbs||b.position.absolute).left,f=e+b.helperProportions.width,g=(b.positionAbs||b.position.absolute).top,h=g+b.helperProportions.height,i=c.offset.left,j=i+c.proportions.width,k=c.offset.top,l=k+c.proportions.height;switch(d){case"fit":return i<=e&&f<=j&&k<=g&&h<=l;case"intersect":return i<e+b.helperProportions.width/2&&f-b.helperProportions.width/2<j&&k<g+b.helperProportions.height/2&&h-b.helperProportions.height/2<l;case"pointer":var m=(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,n=(b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,o=a.ui.isOver(n,m,k,i,c.proportions.height,c.proportions.width);return o;case"touch":return(g>=k&&g<=l||h>=k&&h<=l||g<k&&h>l)&&(e>=i&&e<=j||f>=i&&f<=j||e<i&&f>j);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d=a.ui.ddmanager.droppables[b.options.scope]||[],e=c?c.type:null,f=(b.currentItem||b.element).find(":data(droppable)").andSelf();g:for(var h=0;h<d.length;h++){if(d[h].options.disabled||b&&!d[h].accept.call(d[h].element[0],b.currentItem||b.element))continue;for(var i=0;i<f.length;i++)if(f[i]==d[h].element[0]){d[h].proportions.height=0;continue g}d[h].visible=d[h].element.css("display")!="none";if(!d[h].visible)continue;e=="mousedown"&&d[h]._activate.call(d[h],c),d[h].offset=d[h].element.offset(),d[h].proportions={width:d[h].element[0].offsetWidth,height:d[h].element[0].offsetHeight}}},drop:function(b,c){var d=!1;return a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,c))}),d},dragStart:function(b,c){b.element.parents(":not(body,html)").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var d=a.ui.intersect(b,this,this.options.tolerance),e=!d&&this.isover==1?"isout":d&&this.isover==0?"isover":null;if(!e)return;var f;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");g.length&&(f=a.data(g[0],"droppable"),f.greedyChild=e=="isover"?1:0)}f&&e=="isover"&&(f.isover=0,f.isout=1,f._out.call(f,c)),this[e]=1,this[e=="isout"?"isover":"isout"]=0,this[e=="isover"?"_over":"_out"].call(this,c),f&&e=="isout"&&(f.isout=0,f.isover=1,f._over.call(f,c))})},dragStop:function(b,c){b.element.parents(":not(body,html)").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery),function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){a.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--)this.items[b].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this,g=a(b.target).parents().each(function(){if(a.data(this,d.widgetName+"-item")==f)return e=a(this),!1});a.data(b.target,d.widgetName+"-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var h=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(h=!0)});if(!h)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options,f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!d)for(var g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",b,f._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(!h)continue;if(g!=this.currentItem[0]&&this.placeholder[h==1?"next":"prev"]()[0]!=g&&!a.ui.contains(this.placeholder[0],g)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],g):!0)){this.direction=h==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f))this._rearrange(b,f);else break;this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(!b)return;a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var d=this,e=d.placeholder.offset();d.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-d.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-d.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=this.options.axis==="x"||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d=this.options.axis==="y"||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&g=="right"||f=="down"?2:1:f&&(f=="down"?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&d||f=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=this,d=[],e=[],f=this._connectWith();if(f&&b)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&e.push([a.isFunction(j.options.items)?j.options.items.call(j.element):a(j.options.items,j.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),j])}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var g=e.length-1;g>=0;g--)e[g][0].each(function(){d.push(this)});return a(d)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");for(var b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=this,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f&&this.ready)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}}for(var g=e.length-1;g>=0;g--){var k=e[g][1],l=e[g][0];for(var i=0,m=l.length;i<m;i++){var n=a(l[i]);n.data(this.widgetName+"-item",k),c.push({item:n,instance:k,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance!=this.currentContainer&&this.currentContainer&&d.item[0]!=this.currentItem[0])continue;var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){var c=b||this,d=c.options;if(!d.placeholder||d.placeholder.constructor==String){var e=d.placeholder;d.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(e||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return e||(b.style.visibility="hidden"),b},update:function(a,b){if(e&&!d.forcePlaceholderSize)return;b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),d.placeholder.update(c,c.placeholder)},_contactContainers:function(b){var c=null,d=null;for(var e=this.containers.length-1;e>=0;e--){if(a.ui.contains(this.currentItem[0],this.containers[e].element[0]))continue;if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.ui.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0)}if(!c)return;if(this.containers.length===1)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else if(this.currentContainer!=this.containers[d]){var f=1e4,g=null,h=this.positionAbs[this.containers[d].floating?"left":"top"];for(var i=this.items.length-1;i>=0;i--){if(!a.ui.contains(this.containers[d].element[0],this.items[i].item[0]))continue;var j=this.containers[d].floating?this.items[i].item.offset().left:this.items[i].item.offset().top;Math.abs(j-h)<f&&(f=Math.abs(j-h),g=this.items[i],this.direction=j-h>0?"down":"up")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;return d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(d[0].style.width==""||c.forceHelperSize)&&d.width(this.currentItem.width()),(d[0].style.height==""||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!a.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!a.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,e=/(html|body)/i.test(d[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition){this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top));if(c.grid){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var d=[],e=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&d.push(function(a){this._trigger("update",a,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||d.push(function(a){this._trigger("remove",a,this._uiHash())});for(var f=this.containers.length-1;f>=0;f--)a.ui.contains(this.containers[f].element[0],this.currentItem[0])&&!c&&(d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.containers[f])),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.containers[f])))}for(var f=this.containers.length-1;f>=0;f--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.21"})}(jQuery),function(a,b){function g(a){var b,c,d;b=a.target.offsetWidth,c=a.target.offsetHeight,d={distX:a.distX,distY:a.distY,velocityX:a.velocityX,velocityY:a.velocityY,finger:a.finger};if(a.distX>a.distY){if(a.distX>-a.distY){if(a.distX/b>f.threshold||a.velocityX*a.distX/b*f.sensitivity>1)d.type="swiperight",e(a.currentTarget,d)}else if(-a.distY/c>f.threshold||a.velocityY*a.distY/b*f.sensitivity>1)d.type="swipeup",e(a.currentTarget,d)}else if(a.distX>-a.distY){if(a.distY/c>f.threshold||a.velocityY*a.distY/b*f.sensitivity>1)d.type="swipedown",e(a.currentTarget,d)}else if(-a.distX/b>f.threshold||a.velocityX*a.distX/b*f.sensitivity>1)d.type="swipeleft",e(a.currentTarget,d)}function h(b){var c=a.data(b,"events");return(c.swipe?1:0)+(c.swipeleft?1:0)+(c.swiperight?1:0)+(c.swipeup?1:0)+(c.swipedown?1:0)>1}var c=a.event.add,d=a.event.remove,e=function(b,c,d){a.event.trigger(c,d,b)},f={threshold:.4,sensitivity:2};a.event.special.swipe=a.event.special.swipeleft=a.event.special.swiperight=a.event.special.swipeup=a.event.special.swipedown={setup:function(a,b,d){if(h(this))return;return c(this,"moveend",g),!0},teardown:function(){if(h(this))return;return d(this,"moveend",g),!0},settings:f}}(jQuery),function(a,b){function G(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,a._a=null,this._lang=c||!1}function H(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,e=a.weeks||a.w||0,f=a.days||a.d||0,g=a.hours||a.h||0,h=a.minutes||a.m||0,i=a.seconds||a.s||0,j=a.milliseconds||a.ms||0;this._milliseconds=j+i*1e3+h*6e4+g*36e5,this._days=f+e*7,this._months=d+c*12,b.milliseconds=j%1e3,i+=I(j/1e3),b.seconds=i%60,h+=I(i/60),b.minutes=h%60,g+=I(h/60),b.hours=g%24,f+=I(g/24),f+=e*7,b.days=f%30,d+=I(f/30),b.months=d%12,c+=I(d/12),b.years=c,this._lang=!1}function I(a){return a<0?Math.ceil(a):Math.floor(a)}function J(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function K(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function L(a){return Object.prototype.toString.call(a)==="[object Array]"}function M(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function N(b,c){var d,e;for(d=1;d<7;d++)b[d]=b[d]==null?d===2?1:0:b[d];return b[7]=c,e=new a(0),c?(e.setUTCFullYear(b[0],b[1],b[2]),e.setUTCHours(b[3],b[4],b[5],b[6])):(e.setFullYear(b[0],b[1],b[2]),e.setHours(b[3],b[4],b[5],b[6])),e._a=b,e}function O(a,b){var d,e,f=[];!b&&i&&(b=require("./lang/"+a));for(d=0;d<j.length;d++)b[j[d]]=b[j[d]]||g.en[j[d]];for(d=0;d<12;d++)e=c([2e3,d]),f[d]=new RegExp("^"+(b.months[d]||b.months(e,""))+"|^"+(b.monthsShort[d]||b.monthsShort(e,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||f,g[a]=b,b}function P(a){var b=typeof a=="string"&&a||a&&a._lang||null;return b?g[b]||O(b):c}function Q(a){return D[a]?"'+("+D[a]+")+'":a.replace(n,"").replace(/\\?'/g,"\\'")}function R(a){return P().longDateFormat[a]||a}function S(a){var b="var a,b;return '"+a.replace(l,Q)+"';",c=Function;return new c("t","v","o","p","m",b)}function T(a){return C[a]||(C[a]=S(a)),C[a]}function U(a,b){function d(d,e){return c[d].call?c[d](a,b):c[d][e]}var c=P(a);while(m.test(b))b=b.replace(m,R);return C[b]||(C[b]=S(b)),C[b](a,d,c.ordinal,J,c.meridiem)}function V(a){switch(a){case"DDDD":return r;case"YYYY":return s;case"S":case"SS":case"SSS":case"DDD":return q;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return t;case"Z":case"ZZ":return u;case"T":return v;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return p;default:return new RegExp(a.replace("\\",""))}}function W(a,b,c,d){var e;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(P().monthsParse[e].test(b)){c[1]=e;break}break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":b=~~b,c[0]=b+(b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(z),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}}function X(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(l),f,g;for(f=0;f<e.length;f++)g=(V(e[f]).exec(a)||[])[0],a=a.replace(V(e[f]),""),W(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),c[3]+=d.tzh,c[4]+=d.tzm,N(c,d.isUTC)}function Y(a,b){var c,d=a.match(o)||[],e,f=99,g,h,i;for(g=0;g<b.length;g++)h=X(a,b[g]),e=U(new G(h),b[g]).match(o)||[],i=M(d,e),i<f&&(f=i,c=h);return c}function Z(b){var c="YYYY-MM-DDT",d;if(w.exec(b)){for(d=0;d<4;d++)if(y[d][1].exec(b)){c+=y[d][0];break}return u.exec(b)?X(b,c+" Z"):X(b,c)}return new a(b)}function $(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function _(a,b,c){var d=e(Math.abs(a)/1e3),f=e(d/60),g=e(f/60),h=e(g/24),i=e(h/365),j=d<45&&["s",d]||f===1&&["m"]||f<45&&["mm",f]||g===1&&["h"]||g<22&&["hh",g]||h===1&&["d"]||h<=25&&["dd",h]||h<=45&&["M"]||h<345&&["MM",e(h/30)]||i===1&&["y"]||["yy",i];return j[2]=b,j[3]=a>0,j[4]=c,$.apply({},j)}function ba(a,b){c.fn[a]=function(a){var c=this._isUTC?"UTC":"";return a!=null?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function bb(a){c.duration.fn[a]=function(){return this._data[a]}}function bc(a,b){c.duration.fn["as"+a]=function(){return+this/b}}var c,d="1.7.0",e=Math.round,f,g={},h="en",i=typeof module!="undefined"&&module.exports,j="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),k=/^\/?Date\((\-?\d+)/i,l=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?)/g,m=/(LT|LL?L?L?)/g,n=/(^\[)|(\\)|\]$/g,o=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,p=/\d\d?/,q=/\d{1,3}/,r=/\d{3}/,s=/\d{1,4}/,t=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,u=/Z|[\+\-]\d\d:?\d\d/i,v=/T/i,w=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,x="YYYY-MM-DDTHH:mm:ssZ",y=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],z=/([\+\-]|\d\d)/gi,A="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),B={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},C={},D={M:"(a=t.month()+1)",MMM:'v("monthsShort",t.month())',MMMM:'v("months",t.month())',D:"(a=t.date())",DDD:"(a=new Date(t.year(),t.month(),t.date()),b=new Date(t.year(),0,1),a=~~(((a-b)/864e5)+1.5))",d:"(a=t.day())",dd:'v("weekdaysMin",t.day())',ddd:'v("weekdaysShort",t.day())',dddd:'v("weekdays",t.day())',w:"(a=new Date(t.year(),t.month(),t.date()-t.day()+5),b=new Date(a.getFullYear(),0,4),a=~~((a-b)/864e5/7+1.5))",YY:"p(t.year()%100,2)",YYYY:"p(t.year(),4)",a:"m(t.hours(),t.minutes(),!0)",A:"m(t.hours(),t.minutes(),!1)",H:"t.hours()",h:"t.hours()%12||12",m:"t.minutes()",s:"t.seconds()",S:"~~(t.milliseconds()/100)",SS:"p(~~(t.milliseconds()/10),2)",SSS:"p(t.milliseconds(),3)",Z:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(a/60),2)+":"+p(~~a%60,2)',ZZ:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(10*a/6),4)'},E="DDD w M D d".split(" "),F="M D H h m s w".split(" ");while(E.length)f=E.pop(),D[f+"o"]=D[f]+"+o(a)";while(F.length)f=F.pop(),D[f+f]="p("+D[f]+",2)";D.DDDD="p("+D.DDD+",3)",c=function(d,e){if(d===null||d==="")return null;var f,g;return c.isMoment(d)?new G(new a(+d._d),d._isUTC,d._lang):(e?L(e)?f=Y(d,e):f=X(d,e):(g=k.exec(d),f=d===b?new a:g?new a(+g[1]):d instanceof a?d:L(d)?N(d):typeof d=="string"?Z(d):new a(d)),new G(f))},c.utc=function(a,b){return L(a)?new G(N(a,!0),!0):(typeof a=="string"&&!u.exec(a)&&(a+=" +0000",b&&(b+=" Z")),c(a,b).utc())},c.unix=function(a){return c(a*1e3)},c.duration=function(a,b){var d=c.isDuration(a),e=typeof a=="number",f=d?a._data:e?{}:a,g;return e&&(b?f[b]=a:f.milliseconds=a),g=new H(f),d&&(g._lang=a._lang),g},c.humanizeDuration=function(a,b,d){return c.duration(a,b===!0?null:b).humanize(b===!0?!0:d)},c.version=d,c.defaultFormat=x,c.lang=function(a,b){var d;if(!a)return h;(b||!g[a])&&O(a,b);if(g[a]){for(d=0;d<j.length;d++)c[j[d]]=g[a][j[d]];c.monthsParse=g[a].monthsParse,h=a}},c.langData=P,c.isMoment=function(a){return a instanceof G},c.isDuration=function(a){return a instanceof H},c.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),c.fn=G.prototype={clone:function(){return c(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?!M(this._a,(this._a[7]?c.utc(this):this).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return U(this,a?a:c.defaultFormat)},add:function(a,b){var d=b?c.duration(+b,a):c.duration(a);return K(this,d,1),this},subtract:function(a,b){var d=b?c.duration(+b,a):c.duration(a);return K(this,d,-1),this},diff:function(a,b,d){var f=this._isUTC?c(a).utc():c(a).local(),g=(this.zone()-f.zone())*6e4,h=this._d-f._d-g,i=this.year()-f.year(),j=this.month()-f.month(),k=this.date()-f.date(),l;return b==="months"?l=i*12+j+k/30:b==="years"?l=i+(j+k/30)/12:l=b==="seconds"?h/1e3:b==="minutes"?h/6e4:b==="hours"?h/36e5:b==="days"?h/864e5:b==="weeks"?h/6048e5:h,d?l:e(l)},from:function(a,b){return c.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(c(),a)},calendar:function(){var a=this.diff(c().sod(),"days",!0),b=this.lang().calendar,d=b.sameElse,e=a<-6?d:a<-1?b.lastWeek:a<0?b.lastDay:a<1?b.sameDay:a<2?b.nextDay:a<7?b.nextWeek:d;return this.format(typeof e=="function"?e.apply(this):e)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<c([this.year()]).zone()||this.zone()<c([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return c.utc([this.year(),this.month()+1,0]).date()},lang:function(a){return a===b?P(this):(this._lang=a,this)}};for(f=0;f<A.length;f++)ba(A[f].toLowerCase(),A[f]);ba("year","FullYear"),c.duration.fn=H.prototype={weeks:function(){return I(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=_(b,!a,this.lang());return a&&(d=(b<=0?c.past:c.future).replace(/%s/i,d)),d},lang:c.fn.lang};for(f in B)B.hasOwnProperty(f)&&(bc(f,B[f]),bb(f.toLowerCase()));bc("Weeks",6048e5),i&&(module.exports=c),typeof ender=="undefined"&&(this.moment=c),typeof define=="function"&&define.amd&&define("moment",[],function(){return c})}.call(this,Date);var qq=qq||{};qq.extend=function(a,b){for(var c in b)a[c]=b[c]},qq.indexOf=function(a,b,c){if(a.indexOf)return a.indexOf(b,c);c=c||0;var d=a.length;c<0&&(c+=d);for(;c<d;c++)if(c in a&&a[c]===b)return c;return-1},qq.getUniqueId=function(){var a=0;return function(){return a++}}(),qq.attach=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},qq.detach=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c)},qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},qq.insertBefore=function(a,b){b.parentNode.insertBefore(a,b)},qq.remove=function(a){a.parentNode.removeChild(a)},qq.contains=function(a,b){return a==b?!0:a.contains?a.contains(b):!!(b.compareDocumentPosition(a)&8)},qq.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c),c}}(),qq.css=function(a,b){b.opacity!=null&&typeof a.style.opacity!="string"&&typeof a.filters!="undefined"&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"),qq.extend(a.style,b)},qq.hasClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},qq.addClass=function(a,b){qq.hasClass(a,b)||(a.className+=" "+b)},qq.removeClass=function(a,b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"")},qq.setText=function(a,b){a.innerText=b,a.textContent=b},qq.children=function(a){var b=[],c=a.firstChild;while(c)c.nodeType==1&&b.push(c),c=c.nextSibling;return b},qq.getByClass=function(a,b){if(a.querySelectorAll)return a.querySelectorAll("."+b);var c=[],d=a.getElementsByTagName("*"),e=d.length;for(var f=0;f<e;f++)qq.hasClass(d[f],b)&&c.push(d[f]);return c},qq.obj2url=function(a,b,c){var d=[],e="&",f=function(a,c){var e=b?/\[\]$/.test(b)?b:b+"["+c+"]":c;e!="undefined"&&c!="undefined"&&d.push(typeof a=="object"?qq.obj2url(a,e,!0):Object.prototype.toString.call(a)==="[object Function]"?encodeURIComponent(e)+"="+encodeURIComponent(a()):encodeURIComponent(e)+"="+encodeURIComponent(a))};if(!c&&b)e=/\?/.test(b)?/\?$/.test(b)?"":"&":"?",d.push(b),d.push(qq.obj2url(a));else if(Object.prototype.toString.call(a)==="[object Array]"&&typeof a!="undefined")for(var g=0,h=a.length;g<h;++g)f(a[g],g);else if(typeof a!="undefined"&&a!==null&&typeof a=="object")for(var g in a)f(a[g],g);else d.push(encodeURIComponent(b)+"="+encodeURIComponent(a));return d.join(e).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(a){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,filesLimit:0,onSubmit:function(a,b){},onProgress:function(a,b,c,d){},onComplete:function(a,b,c){},onAllComplete:function(a){},onCancel:function(a,b){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",filesLimitError:"Only {filesLimit} files upload allowed.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(a){alert(a)}},qq.extend(this._options,a),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(a){var b=this;return new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(a){b._onInputChange(a)}})},_createUploadHandler:function(){var a=this,b;qq.UploadHandlerXhr.isSupported()?b="UploadHandlerXhr":b="UploadHandlerForm";var c=new qq[b]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(b,c,d,e){a._onProgress(b,c,d,e),a._options.onProgress(b,c,d,e)},onComplete:function(b,c,d){a._onComplete(b,c,d),a._options.onComplete(b,c,d)},onAllComplete:function(b){a._options.onAllComplete(b)},onCancel:function(b,c){a._onCancel(b,c),a._options.onCancel(b,c)}});return c},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress)return;var b=b||window.event;return b.returnValue=a._options.messages.onLeave,a._options.messages.onLeave})},_onSubmit:function(a,b){this._filesInProgress++},_onProgress:function(a,b,c,d){},_onComplete:function(a,b,c){this._filesInProgress--,c.error&&this._options.showMessage(c.error)},_onCancel:function(a,b){this._filesInProgress--},_onInputChange:function(a){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(a.files):this._validateFile(a)&&this._uploadFile(a),this._button.reset()},_uploadFileList:function(a){var b=0;for(var c=0;c<a.length;c++){if(!this._validateFile(a[c],b))return;b++}for(var c=0;c<a.length;c++)this._uploadFile(a[c])},_uploadFile:function(a){var b=this._handler.add(a),c=this._handler.getName(b);this._options.onSubmit(b,c)!==!1&&(this._onSubmit(b,c),this._handler.upload(b,this._options.params))},_validateFile:function(a,b){var c,d;a.value?c=a.value.replace(/.*(\/|\\)/,""):(c=a.fileName!=null?a.fileName:a.name,d=a.fileSize!=null?a.fileSize:a.size);if(!this._isAllowedExtension(c))return this._error("typeError",c),!1;if(d===0)return this._error("emptyError",c),!1;if(d&&this._options.sizeLimit&&d>this._options.sizeLimit)return this._error("sizeError",c),!1;if(d&&d<this._options.minSizeLimit)return this._error("minSizeError",c),!1;if(this._options.filesLimit){if(b==undefined||b==NaN)var b=0;if(this._handler._completed_files==undefined||this._handler._completed_files==NaN)var e=0;else var e=this._handler._completed_files.length;if(this._handler._queue==undefined||this._handler._queue==NaN)var f=0;else var f=this._handler._queue.length;if(this._options.filesLimit<=e+f+b)return this._error("filesLimitError",c),!1}return!0},_error:function(a,b){function c(a,b){d=d.replace(a,b)}var d=this._options.messages[a];c("{file}",this._formatFileName(b)),c("{extensions}",this._options.allowedExtensions.join(", ")),c("{sizeLimit}",this._formatSize(this._options.sizeLimit)),c("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),c("{filesLimit}",this._options.filesLimit),this._options.showMessage(d)},_formatFileName:function(a){return a.length>33&&(a=a.slice(0,19)+"..."+a.slice(-13)),a},_isAllowedExtension:function(a){var b=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",c=this._options.allowedExtensions;if(!c.length)return!0;for(var d=0;d<c.length;d++)if(c[d].toLowerCase()==b)return!0;return!1},_formatSize:function(a){var b=-1;do a/=1024,b++;while(a>99);return Math.max(a,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}},qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><div class="qq-upload-button"><span> </span></div></div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),qq.extend(this._options,a),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploader.prototype,{_find:function(a,b){var c=qq.getByClass(a,this._options.classes[b])[0];if(!c)throw new Error("element not found "+b);return c},_setupDragDrop:function(){var a=this,b=this._find(this._element,"drop"),c=new qq.UploadDropZone({element:b,onEnter:function(c){qq.addClass(b,a._classes.dropActive),c.stopPropagation()},onLeave:function(a){a.stopPropagation()},onLeaveNotDescendants:function(c){qq.removeClass(b,a._classes.dropActive)},onDrop:function(c){qq.removeClass(b,a._classes.dropActive),!a.multiple&&c.dataTransfer.files.length>1?alert("Multiple file uploads are disabled."):a._uploadFileList(c.dataTransfer.files)}});qq.attach(document,"dragenter",function(a){if(!c._isValidFileDrag(a))return;b.style.display="block"}),qq.attach(document,"dragleave",function(a){if(!c._isValidFileDrag(a))return;var d=document.elementFromPoint(a.clientX,a.clientY);if(!d||d.nodeName=="HTML")b.style.display="none"})},_onSubmit:function(a,b){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(a,b)},_onProgress:function(a,b,c,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var e=this._getItemByFileId(a),f=this._find(e,"size");f.style.display="inline";var g;c!=d?g=Math.round(c/d*100)+"% from "+this._formatSize(d):g=this._formatSize(d),qq.setText(f,g)},_onComplete:function(a,b,c){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var d=this._getItemByFileId(a);qq.remove(this._find(d,"cancel")),qq.remove(this._find(d,"spinner")),c.success?qq.addClass(d,this._classes.success):qq.addClass(d,this._classes.fail)},_addToList:function(a,b){var c=qq.toElement(this._options.fileTemplate);c.qqFileId=a;var d=this._find(c,"file");qq.setText(d,this._formatFileName(b)),this._find(c,"size").style.display="none",this._listElement.appendChild(c)},_getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a)return b;b=b.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;qq.attach(b,"click",function(b){b=b||window.event;var c=b.target||b.srcElement;if(qq.hasClass(c,a._classes.cancel)){qq.preventDefault(b);var d=c.parentNode;a._handler.cancel(d.qqFileId),qq.remove(d)}})}}),qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(a){},onLeave:function(a){},onLeaveNotDescendants:function(a){},onDrop:function(a){}},qq.extend(this._options,a),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_disableDropOutside:function(a){qq.UploadDropZone.dropOutsideDisabled||(qq.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(b){if(!a._isValidFileDrag(b))return;var c=b.dataTransfer.effectAllowed;c=="move"||c=="linkMove"?b.dataTransfer.dropEffect="move":b.dataTransfer.dropEffect="copy",b.stopPropagation(),b.preventDefault()}),qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b))return;a._options.onEnter(b)}),qq.attach(a._element,"dragleave",function(b){if(!a._isValidFileDrag(b))return;a._options.onLeave(b);var c=document.elementFromPoint(b.clientX,b.clientY);if(qq.contains(this,c))return;a._options.onLeaveNotDescendants(b)}),qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b))return;b.preventDefault(),a._options.onDrop(b)})},_isValidFileDrag:function(a){var b=a.dataTransfer,c=navigator.userAgent.indexOf("AppleWebKit")>-1;return b&&b.effectAllowed!="none"&&(b.files||!c&&b.types.contains&&b.types.contains("Files"))}},qq.UploadButton=function(a){this._options={element:null,multiple:!1,name:"file",onChange:function(a){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,a),this._element=this._options.element,qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input),qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");this._options.multiple&&a.setAttribute("multiple","multiple"),a.setAttribute("type","file"),a.setAttribute("name",this._options.name),qq.css(a,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(a);var b=this;return qq.attach(a,"change",function(){b._options.onChange(a)}),qq.attach(a,"mouseover",function(){qq.addClass(b._element,b._options.hoverClass)}),qq.attach(a,"mouseout",function(){qq.removeClass(b._element,b._options.hoverClass)}),qq.attach(a,"focus",function(){qq.addClass(b._element,b._options.focusClass)}),qq.attach(a,"blur",function(){qq.removeClass(b._element,b._options.focusClass)}),window.attachEvent&&a.setAttribute("tabIndex","-1"),a}},qq.UploadHandlerAbstract=function(a){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(a,b,c,d){},onComplete:function(a,b,c){},onAllComplete:function(a){},onCancel:function(a,b){}},qq.extend(this._options,a),this._queue=[],this._params=[],this._completed_files=[]},qq.UploadHandlerAbstract.prototype={log:function(a){this._options.debug&&window.console&&app.log("[uploader] "+a)},add:function(a){},upload:function(a,b){var c=this._queue.push(a),d={};qq.extend(d,b),this._params[a]=d,c<=this._options.maxConnections&&this._upload(a,this._params[a])},cancel:function(a){this._cancel(a),this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++)this._cancel(this._queue[a]);this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(a){var b=qq.indexOf(this._queue,a);this._queue.splice(b,1);var c=this._options.maxConnections;if(this._queue.length>=c){var d=this._queue[c-1];this._upload(d,this._params[d])}this._queue.length==0&&this._onAllComplete()},_onAllComplete:function(){this._options.onAllComplete(this._completed_files)}},qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","qqfile");var b="qq-upload-handler-iframe"+qq.getUniqueId();return this._inputs[b]=a,a.parentNode&&qq.remove(a),b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(a){this._options.onCancel(a,this.getName(a)),delete this._inputs[a];var b=document.getElementById(a);b&&(b.setAttribute("src","javascript:false;"),qq.remove(b))},_upload:function(a,b){var c=this._inputs[a];if(!c)throw new Error("file with passed id was not added, or already uploaded or cancelled");var d=this.getName(a),e=this._createIframe(a),f=this._createForm(e,b);f.appendChild(c);var g=this;return this._attachLoadEvent(e,function(){g.log("iframe loaded");var b=g._getIframeContentJSON(e);g._options.onComplete(a,d,b),g._dequeue(a),delete g._inputs[a],setTimeout(function(){qq.remove(e)},1)}),f.submit(),qq.remove(f),a},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode)return;if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false")return;b()})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');return b.setAttribute("id",a),b.style.display="none",document.body.appendChild(b),b},_createForm:function(a,b){var c=null;if(b.csrf_token&&b.csrf_name){var d='<input type="hidden" name="'+b.csrf_name+'" value="'+b.csrf_token+'" />';c=qq.toElement('<form method="post" enctype="multipart/form-data">'+d+"</form>")}else c=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');delete b.csrf_token,delete b.csrf_name,delete b.csrf_xname;var e=qq.obj2url(b,this._options.action);return c.setAttribute("action",e),c.setAttribute("target",a.name),c.style.display="none",document.body.appendChild(c),c}}),qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");return a.type="file","multiple"in a&&typeof File!="undefined"&&typeof (new XMLHttpRequest).upload!="undefined"},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(a instanceof File)return this._files.push(a)-1;throw new Error("Passed obj is not a File (in qq.UploadHandlerXhr)")},getName:function(a){var b=this._files[a];return b.fileName!=null?b.fileName:b.name},getSize:function(a){var b=this._files[a];return b.fileSize!=null?b.fileSize:b.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(a,b){var c=this._files[a],d=this.getName(a),e=this.getSize(a);this._loaded[a]=0;var f=this._xhrs[a]=new XMLHttpRequest,g=this;f.upload.onprogress=function(b){b.lengthComputable&&(g._loaded[a]=b.loaded,g._options.onProgress(a,d,b.loaded,b.total))},f.onreadystatechange=function(){f.readyState==4&&g._onComplete(a,f)},b=b||{};var h=!1,i=!1;b.csrf_token&&b.csrf_xname&&(h=b.csrf_token,i=b.csrf_xname,delete b.csrf_token,delete b.csrf_xname,delete b.csrf_name),b.qqfile=d;var j=qq.obj2url(b,this._options.action);f.open("POST",j,!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.setRequestHeader("X-File-Name",encodeURIComponent(d)),f.setRequestHeader("Content-Type","application/octet-stream"),h&&f.setRequestHeader(i,h),f.send(c)},_onComplete:function(id,xhr){if(!this._files[id])return;var name=this.getName(id),size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200||xhr.status==201){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._completed_files.push({file:this._files[id],response:response}),this._options.onComplete(id,name,response)}else this._completed_files.push({file:this._files[id],response:{}}),this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a)),this._files[a]=null,this._xhrs[a]&&(this._xhrs[a].abort(),this._xhrs[a]=null)}});var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};Handlebars.partials=Handlebars.templates;var tmpl=Handlebars.templates,tmpl_compile=Handlebars.compile;templates.navigation=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='    <li id="clients">',e={},e.rel="Clients",f=c.link,e=f?f.call(a,"#clients","&nbsp;",{hash:e}):i.call(a,"link","#clients","&nbsp;",{hash:e}),d+=j(e)+'</li>    <li id="reports">',e={},e.rel="Reports",f=c.link,e=f?f.call(a,"#reports","&nbsp;",{hash:e}):i.call(a,"link","#reports","&nbsp;",{hash:e}),d+=j(e)+"</li>  ",d}function n(a,b){var d="",e,f;return d+='    <li id="setup">',e={},e.rel="Setup",f=c.link,e=f?f.call(a,"#setup","&nbsp;",{hash:e}):i.call(a,"link","#setup","&nbsp;",{hash:e}),d+=j(e)+"</li>  ",d}function o(a,b){var d="",e,f;return d+='          <li id="account">',e={},e["class"]="pm",f=c.link,e=f?f.call(a,"#account","Account Settings",{hash:e}):i.call(a,"link","#account","Account Settings",{hash:e}),d+=j(e)+"</li>        ",d}function p(a,b){var d="",e,f;return d+="          <li>",e={},e["class"]="pm",f=c.link,e=f?f.call(a,"#accounts","Flybook Administration",{hash:e}):i.call(a,"link","#accounts","Flybook Administration",{hash:e}),d+=j(e)+"</li>        ",d}function q(a,b){var d="",e;d+='          <li class="uf">Use Flybook On Behalf of:</li>          ',e=a.accounts,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(10,r,b)});if(e||e===0)d+=e;return d+="          ",d}function r(a,b){var d="",e,f;return d+='            <li><a href="#accounts/switch/',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===k?e():e),d+=j(e)+'/">',e=a.company,f=c.truncate,e=f?f.call(a,e,30,{hash:{}}):i.call(a,"truncate",e,30,{hash:{}}),d+=j(e)+"</a></li>          ",d}function s(a,b){var d="",e,f;return d+=" style=\"background-image:url('https://s3.amazonaws.com/flybook/icon_",f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===k?e():e),d+=j(e)+".jpg');\"",d}function t(a,b){return"style=\"background-image:url('https://s3.amazonaws.com/flybook-asset/images/gone-default-user.gif');\""}c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression,k="function",l=this;f+='<ul id="main-nav">  <li id="reservation">',g={},g.rel="New Reservation",h=c.link,g=h?h.call(b,"#reservation","&nbsp;",{hash:g}):i.call(b,"link","#reservation","&nbsp;",{hash:g}),f+=j(g)+'</li>  <li id="dashboard">',g={},g.rel="Dashboard",h=c.link,g=h?h.call(b,"#dashboard","&nbsp;",{hash:g}):i.call(b,"link","#dashboard","&nbsp;",{hash:g}),f+=j(g)+'</li>  <li id="calendar"><em>',h=c.date_today,h?g=h.call(b,{hash:{}}):(g=b.date_today,g=typeof g===k?g():g),f+=j(g)+"</em>",g={},g.rel="Calendar",h=c.link,g=h?h.call(b,"#calendar","&nbsp;",{hash:g}):i.call(b,"link","#calendar","&nbsp;",{hash:g}),f+=j(g)+"</li>  ",g=b.role,h=c.check_role,g=h?h.call(b,g,"super,manager,staff",{hash:{},inverse:l.noop,fn:l.program(1,m,e)}):i.call(b,"check_role",g,"super,manager,staff",{hash:{},inverse:l.noop,fn:l.program(1,m,e)});if(g||g===0)f+=g;f+="  ",g=b.role,h=c.check_role,g=h?h.call(b,g,"super,manager",{hash:{},inverse:l.noop,fn:l.program(3,n,e)}):i.call(b,"check_role",g,"super,manager",{hash:{},inverse:l.noop,fn:l.program(3,n,e)});if(g||g===0)f+=g;f+='  <li id="tip"></li></ul><ul id="user">      <li class="a"><span class="arrow"> </span>      <ul>        <li id="prefs">',g={},g["class"]="pm",h=c.link,g=h?h.call(b,"#preferences","Personal Preferences",{hash:g}):i.call(b,"link","#preferences","Personal Preferences",{hash:g}),f+=j(g)+"</li>        ",g=b.role,h=c.check_role,g=h?h.call(b,g,"super,manager",{hash:{},inverse:l.noop,fn:l.program(5,o,e)}):i.call(b,"check_role",g,"super,manager",{hash:{},inverse:l.noop,fn:l.program(5,o,e)});if(g||g===0)f+=g;f+="        ",g=b.flybook_admin,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(7,p,e)});if(g||g===0)f+=g;f+="        ",g=b.accounts,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(9,q,e)});if(g||g===0)f+=g;f+='        <li class="lo">',g={},g["class"]="logout",h=c.link_nohref,g=h?h.call(b,"Logout",{hash:g}):i.call(b,"link_nohref","Logout",{hash:g}),f+=j(g)+'</li>      </ul>      </li>    <li><span class="cover" ',g=b.has_icon,g=c["if"].call(b,g,{hash:{},inverse:l.program(14,t,e),fn:l.program(12,s,e)});if(g||g===0)f+=g;return f+='>&nbsp;</span></li>    <li><a class="profile"><span>',h=c.name,h?g=h.call(b,{hash:{}}):(g=b.name,g=typeof g===k?g():g),f+=j(g)+"</span> ",g=b.account,g=g==null||g===!1?g:g.company,g=typeof g===k?g():g,f+=j(g)+'</a></li></ul><div id="arrow-ind"></div>',f}),templates.navigation_sidebar=template(function(a,b,c,d,e){function l(a,b){var e="",f;e+="  ",f=a,f=h.invokePartial(d.search_box,"search_box",f,c,d);if(f||f===0)e+=f;return e}function m(a,b){var d="",e,f;return d+="<h3>",f=c.title,f?e=f.call(a,{hash:{}}):(e=a.title,e=typeof e===i?e():e),d+=j(e)+"</h3>",d}function n(a,b){var d="",e;d+=" <ul>  ",e=a.contents,e=c.each.call(a,e,{hash:{},inverse:h.noop,fn:h.program(6,o,b)});if(e||e===0)d+=e;return d+=" </ul>",d}function o(a,b){var d="",e,f;return d+='    <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><a href="',f=c.href,f?e=f.call(a,{hash:{}}):(e=a.href,e=typeof e===i?e():e),d+=j(e)+'">',f=c.title,f?e=f.call(a,{hash:{}}):(e=a.title,e=typeof e===i?e():e),d+=j(e)+"</a></li>  ",d}function p(a,b){var d="",e;d+='  <div id="side-calendar"> </div>      <div id="toggles"> ',e=a.trips,e=c["if"].call(a,e,{hash:{},inverse:h.noop,fn:h.program(9,q,b)});if(e||e===0)d+=e;d+="  ",e=a.staff,e=c["if"].call(a,e,{hash:{},inverse:h.noop,fn:h.program(12,s,b)});if(e||e===0)d+=e;d+="  ",e=a.lodges,e=c["if"].call(a,e,{hash:{},inverse:h.noop,fn:h.program(15,u,b)});if(e||e===0)d+=e;d+="<!--  ",e=a.meals,e=c["if"].call(a,e,{hash:{},inverse:h.noop,fn:h.program(18,w,b)});if(e||e===0)d+=e;return d+=" --></div> ",d}function q(a,b){var d="",e,f,g;d+='  <h4><span class="up"></span>',e=a.attributes,f={},f["class"]="all",g=c.checkbox,e=g?g.call(a,e,"trip",{hash:f}):k.call(a,"checkbox",e,"trip",{hash:f}),d+=j(e)+' Trips &amp; Activities</h4>  <div class="group" id="trip">  ',e=a.trips,e=c.each.call(a,e,{hash:{},inverse:h.noop,fn:h.program(10,r,b)});if(e||e===0)d+=e;return d+="  </div> ",d}function r(a,b){var c="",d;return c+='    <p class="checkbox color',d=a.attributes,d=d==null||d===!1?d:d.color,d=typeof d===i?d():d,c+=j(d)+'" id="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><input type="checkbox" name="trip" value="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><label>',d=a.attributes,d=d==null||d===!1?d:d.name,d=typeof d===i?d():d,c+=j(d)+"</label></p>  ",c}function s(a,b){var d="",e,f,g;d+='  <h4><span class="up"></span>',e=a.attributes,f={},f["class"]="all",g=c.checkbox,e=g?g.call(a,e,"staff",{hash:f}):k.call(a,"checkbox",e,"staff",{hash:f}),d+=j(e)+' Guides &amp; Staff</h4>  <div class="group" id="staff">  ',e=a.staff,e=c.each.call(a,e,{hash:{},inverse:h.noop,fn:h.program(13,t,b)});if(e||e===0)d+=e;return d+="  </div> ",d}function t(a,b){var c="",d;return c+='    <p class="checkbox color',d=a.attributes,d=d==null||d===!1?d:d.color,d=typeof d===i?d():d,c+=j(d)+'" id="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><input type="checkbox" name="staff" value="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><label>',d=a.attributes,d=d==null||d===!1?d:d.nickname,d=typeof d===i?d():d,c+=j(d)+"</label></p>  ",c}function u(a,b){var d="",e,f,g;d+='  <h4><span class="up"></span>',e=a.attributes,f={},f["class"]="all",g=c.checkbox,e=g?g.call(a,e,"lodge",{hash:f}):k.call(a,"checkbox",e,"lodge",{hash:f}),d+=j(e)+' Lodging</h4>  <div class="group" id="lodge">  ',e=a.lodges,e=c.each.call(a,e,{hash:{},inverse:h.noop,fn:h.program(16,v,b)});if(e||e===0)d+=e;return d+="  </div> ",d}function v(a,b){var c="",d;return c+='    <p class="checkbox color',d=a.attributes,d=d==null||d===!1?d:d.color,d=typeof d===i?d():d,c+=j(d)+'" id="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><input type="checkbox" name="lodge" value="',d=a.attributes,d=d==null||d===!1?d:d.id,d=typeof d===i?d():d,c+=j(d)+'"><label>',d=a.attributes,d=d==null||d===!1?d:d.name,d=typeof d===i?d():d,c+=j(d)+"</label></p>  ",c}function w(a,b){return'  <h4><span class="up"></span>Meals</h4>  <div class="group" id="meals">  <p class="checkbox" id="breakfast"><input type="checkbox" name="meal" value="breakfast"><label>Breakfast</label></p>  <p class="checkbox" id="lunch"><input type="checkbox" name="meal" value="lunch"><label>Lunch</label></p>  <p class="checkbox" id="dinner"><input type="checkbox" name="meal" value="dinner"><label>Dinner</label></p>  </div>   '}c=c||a.helpers,d=d||a.partials;var f="",g,h=this,i="function",j=this.escapeExpression,k=c.helperMissing;f+='<div id="nav">  ',g=b.search,g=c["if"].call(b,g,{hash:{},inverse:h.noop,fn:h.program(1,l,e)});if(g||g===0)f+=g;g=b.title,g=c["if"].call(b,g,{hash:{},inverse:h.noop,fn:h.program(3,m,e)});if(g||g===0)f+=g;g=b.contents,g=c["if"].call(b,g,{hash:{},inverse:h.noop,fn:h.program(5,n,e)});if(g||g===0)f+=g;g=b.calendar,g=c["if"].call(b,g,{hash:{},inverse:h.noop,fn:h.program(8,p,e)});if(g||g===0)f+=g;return f+="</div>",f}),templates.notification=template(function(a,b,c,d,e){function l(a,b){var d="",e,f;return d+='<button class="undo">',f=c.undo_text,f?e=f.call(a,{hash:{}}):(e=a.undo_text,e=typeof e===i?e():e),d+=j(e)+"</button>",d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this;f+="<h2>",h=c.message,h?g=h.call(b,{hash:{}}):(g=b.message,g=typeof g===i?g():g),f+=j(g)+'</h2><button class="close">',h=c.dismiss,h?g=h.call(b,{hash:{}}):(g=b.dismiss,g=typeof g===i?g():g),f+=j(g)+"</button>",g=b.undo_callback,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,l,e)});if(g||g===0)f+=g;return f}),templates["accounts/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<form class="settings" onsubmit="return false"><h1>Create A New Account</h1><p class="step"><span>1</span> New model company name:</p><fieldset>',g=b.model,h={},h.placeholder="(Company Name)",j=c.text_field,g=j?j.call(b,g,"company",{hash:h}):k.call(b,"text_field",g,"company",{hash:h}),f+=l(g)+'</fieldset><p class="step"><span>2</span> Primary Industry and Account Settings:</p><fieldset><p class="field"><label>Outfitter Type</label>',g=b.model,g=g==null||g===!1?g:g.industries,h=b.model,i={},i.style="width:210px",j=c.select,g=j?j.call(b,h,"industry",g,{hash:i}):k.call(b,"select",h,"industry",g,{hash:i}),f+=l(g)+'</p><p class="field"><label>Booking URL: http://</label>',g=b.model,h={},h.style="width:110px",j=c.text_field,g=j?j.call(b,g,"flybook_url",{hash:h}):k.call(b,"text_field",g,"flybook_url",{hash:h}),f+=l(g)+'<label>.flybook.com</label></p></fieldset><p class="step"><span>3</span> Account Contact Information. (You can enter more details next)</p><fieldset><p class="field"><label>Full Name</label>',g=b.model,h={},h.placeholder="(Contact Name)",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):k.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+'</p><p class="field"><label>Email Address</label>',g=b.model,h={},h.placeholder="(Contact Email)",j=c.text_field,g=j?j.call(b,g,"email",{hash:h}):k.call(b,"text_field",g,"email",{hash:h}),f+=l(g)+'</p></fieldset><div class="buttons-right"> <button class="save continue">Save &amp; Continue</button><br /> <a href="javascript:void(0)" class="cancel">or cancel</a></div></form>',f}),templates["accounts/edit"]=template(function(a,b,c,d,e){function o(a,b){var d="",e;d+='<ul class="list">',e=a.users,e=c.each.call(a,e,{hash:{},inverse:m.noop,fn:m.program(2,p,b)});if(e||e===0)d+=e;return d+="</ul>",d}function p(a,b){var d="",e,f;return d+="<li><div><span>",f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===k?e():e),d+=l(e)+"</span>&nbsp;&nbsp;<span>(",f=c.email,f?e=f.call(a,{hash:{}}):(e=a.email,e=typeof e===k?e():e),d+=l(e)+")</div></li>",d}function q(a,b){var d;return d=a.email,d=c["if"].call(a,d,{hash:{},inverse:m.program(7,s,b),fn:m.program(5,r,b)}),d||d===0?d:""}function r(a,b){var d="",e,f,g;return d+="  <p>No users added to this account yet.<br />  <strong>Create the primary admin account now for ",e=a.account,e=e==null||e===!1?e:e.attributes,e=e==null||e===!1?e:e.email,e=typeof e===k?e():e,d+=l(e)+"?</strong> The user will be notified by email.   <br />You may optionally set a temporary password which will be emailed to the user.</p>  ",e=a.model,f={},f.placeholder="(Temporary Password)",f.style="width:200px",g=c.password,e=g?g.call(a,e,"new_user_password",{hash:f}):n.call(a,"password",e,"new_user_password",{hash:f}),d+=l(e)+'  <p class="field">  <button class="new-user-account">Yes, Create it!</button>  </p>  <br />  <p class="small">Note &mdash; creating an admin account will cause this view to reset.</p>  ',d}function s(a,b){return"  <p>To create an admin user for the account, <strong>enter a contact email for the account</strong>.<br />    Once you have entered one, save your changes then re-manage this account.</p>  "}c=c||a.helpers;var f="",g,h,i,j,k="function",l=this.escapeExpression,m=this,n=c.helperMissing;f+='<form class="account" onsubmit="return false"><button class="cancel">Cancel</button><button class="done">Done</button> ',g=b.model,h={},h["class"]="title",j=c.text_field,g=j?j.call(b,g,"company",{hash:h}):n.call(b,"text_field",g,"company",{hash:h}),f+=l(g)+'<br style="clear:both;" />&nbsp;&nbsp;&nbsp;<a href="#accounts/switch/',j=c.id,j?g=j.call(b,{hash:{}}):(g=b.id,g=typeof g===k?g():g),f+=l(g)+'/">Use FLyBOOK as ',j=c.company,j?g=j.call(b,{hash:{}}):(g=b.company,g=typeof g===k?g():g),f+=l(g)+'</a><ul class="tabs"><li>',g={},g["class"]="tab current",j=c.link_nohref,g=j?j.call(b,"Contact",{hash:g}):n.call(b,"link_nohref","Contact",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Commissions &amp; Fees",{hash:g}):n.call(b,"link_nohref","Commissions &amp; Fees",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Settings",{hash:g}):n.call(b,"link_nohref","Settings",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Users",{hash:g}):n.call(b,"link_nohref","Users",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Notes",{hash:g}):n.call(b,"link_nohref","Notes",{hash:g}),f+=l(g)+'</li></ul><div class="tabshell">\t\t<div class="tab"> <div class="left">\t<h3>Primary Contact</h3>\t<fieldset>\t\t',g=b.model,h={},h.placeholder="(Contact Name)",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):n.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+"\t\t",g=b.model,h={},h.placeholder="(Contact Phone)",j=c.text_field,g=j?j.call(b,g,"phone",{hash:h}):n.call(b,"text_field",g,"phone",{hash:h}),f+=l(g)+"\t\t",g=b.model,h={},h.placeholder="(Contact Email)",j=c.text_field,g=j?j.call(b,g,"email",{hash:h}):n.call(b,"text_field",g,"email",{hash:h}),f+=l(g)+"\t\t",g=b.model,h={},h.placeholder="(Website)",j=c.text_field,g=j?j.call(b,g,"url",{hash:h}):n.call(b,"text_field",g,"url",{hash:h}),f+=l(g)+'\t\t<!-- \t\ttodo: quick links\t\t<a href="tel:',j=c.phone,j?g=j.call(b,{hash:{}}):(g=b.phone,g=typeof g===k?g():g),f+=l(g)+'" class="call"><span>Call ',j=c.contact,j?g=j.call(b,{hash:{}}):(g=b.contact,g=typeof g===k?g():g),f+=l(g)+'</span></a>\t\t<a href="mailto:',j=c.email,j?g=j.call(b,{hash:{}}):(g=b.email,g=typeof g===k?g():g),f+=l(g)+'" class="email"><span>Email ',j=c.contact,j?g=j.call(b,{hash:{}}):(g=b.contact,g=typeof g===k?g():g),f+=l(g)+'</span></a>\t\t-->\t</fieldset>\t </div> <div class="right">\t <h3>Physical Address</h3>\t  <fieldset>\t\t',g=b.model,h={},h.placeholder="(Address)",j=c.text_field,g=j?j.call(b,g,"address",{hash:h}):n.call(b,"text_field",g,"address",{hash:h}),f+=l(g)+"\t\t",g=b.model,h={},h.placeholder="(City/Town)",j=c.text_field,g=j?j.call(b,g,"city",{hash:h}):n.call(b,"text_field",g,"city",{hash:h}),f+=l(g)+'\t\t<p class="field">',g=b.states,h=b.model,i={},i.style="width:210px",j=c.select,g=j?j.call(b,h,"state",g,{hash:i}):n.call(b,"select",h,"state",g,{hash:i}),f+=l(g)+"</p>\t\t",g=b.model,h={},h.placeholder="(Zip/Postal Code)",h.style="width:150px",j=c.text_field,g=j?j.call(b,g,"zip",{hash:h}):n.call(b,"text_field",g,"zip",{hash:h}),f+=l(g)+'<br />\t\t<p class="field">',g=b.countries,h=b.model,i={},i.style="width:130px",j=c.select,g=j?j.call(b,h,"country",g,{hash:i}):n.call(b,"select",h,"country",g,{hash:i}),f+=l(g)+'</p> </div>\t\t</div>\t\t\t\t\t<div class="tab three-column"> <div class="left"> \t<h3>Base Commissions</h3>  <fieldset>\t <p class="field"><label>Trip Commission</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_trip",{hash:h}):n.call(b,"text_field",g,"commission_trip",{hash:h}),f+=l(g)+'<span>%</span></p> \t <p class="field"><label>Lodge Commission</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_lodging",{hash:h}):n.call(b,"text_field",g,"commission_lodging",{hash:h}),f+=l(g)+'<span>%</span></p> \t <p class="field"><label>Product Commission</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_product",{hash:h}):n.call(b,"text_field",g,"commission_product",{hash:h}),f+=l(g)+'<span>%</span></p>\t</fieldset> </div> <div class="center">\t\t<h3>Origin Commissions</h3>\t<fieldset>\t <p class="field"><label>Network Referral</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_referral",{hash:h}):n.call(b,"text_field",g,"commission_referral",{hash:h}),f+=l(g)+'<span>%</span></p> \t <p class="field"><label>Booked Online</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_web",{hash:h}):n.call(b,"text_field",g,"commission_web",{hash:h}),f+=l(g)+'<span>%</span></p> \t <p class="field"><label>Admin Entered</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"commission_entered",{hash:h}):n.call(b,"text_field",g,"commission_entered",{hash:h}),f+=l(g)+'<span>%</span></p>\t</fieldset> </div> <div class="right">  <h3>Account Plan &amp; Fees</h3>\t<fieldset>\t\t<p class="field"><label>Monthly Fee $</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"monthly_fee",{hash:h}):n.call(b,"text_field",g,"monthly_fee",{hash:h}),f+=l(g)+'</p>\t\t<p class="field"><label>Mail Send Quota</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"mail_send_quota",{hash:h}):n.call(b,"text_field",g,"mail_send_quota",{hash:h}),f+=l(g)+'<span>/mo.</span></p>\t</fieldset> </div>\t\t</div>\t<div class="tab"> <div class="full">  <h3>Settings / Admin</h3>   <fieldset>\t\t<p class="select"><label>Outfitter Type</label>',g=b.model,g=g==null||g===!1?g:g.industries,h=b.model,j=c.select,g=j?j.call(b,h,"industry",g,{hash:{}}):n.call(b,"select",h,"industry",g,{hash:{}}),f+=l(g)+'</p>    <p class="field"><label>Booking URL: http://</label>',g=b.model,h={},h.style="width:110px",j=c.text_field,g=j?j.call(b,g,"flybook_url",{hash:h}):n.call(b,"text_field",g,"flybook_url",{hash:h}),f+=l(g)+'<label>.theflybook.com</label></p>    <p class="field"><label>gone profile default theme color</label>',g=b.model,h={},h.style="width:60px",j=c.text_field,g=j?j.call(b,g,"theme_color",{hash:h}):n.call(b,"text_field",g,"theme_color",{hash:h}),f+=l(g)+'</p>    <p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"allow_auto_balance",{hash:{}}):n.call(b,"checkbox",g,"allow_auto_balance",{hash:{}}),f+=l(g)+'<label>Enable this account to use automatic balance collection</label></p>\t\t    <p><a href="/api/accounts/_export/?id=',j=c.id,j?g=j.call(b,{hash:{}}):(g=b.id,g=typeof g===k?g():g),f+=l(g)+'">Export account data to SQL file</a></p>  </fieldset> </div>\t\t</div><div class="tab">',g=b.users,g=c["if"].call(b,g,{hash:{},inverse:m.program(4,q,e),fn:m.program(1,o,e)});if(g||g===0)f+=g;return f+='\t</div>\t<div class="tab"><h3>Private Account / Sales Notes</h3><fieldset>',g=b.model,j=c.text_area,g=j?j.call(b,g,"notes",{hash:{}}):n.call(b,"text_area",g,"notes",{hash:{}}),f+=l(g)+"</fieldset></div></div>\t<br /></form>\t",f}),templates["accounts/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.company,f?e=f.call(a,{hash:{}}):(e=a.company,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">Delete</button></li>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+="<h1>",h=c.title,h?g=h.call(b,{hash:{}}):(g=b.title,g=typeof g===i?g():g),f+=j(g)+'</h1><button class="create">New Account</button><ol id="accounts" class="list">',g=b.accounts,h=c.list,g=h?h.call(b,g,"No account matches",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No account matches",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates["calendar/day"]=template(function(a,b,c,d,e){function m(a,b,d){var e="",f,g;e+='   <div class="trip ',f=a.trip,f=f==null||f===!1?f:f.id,f=typeof f===i?f():f,e+=j(f)+'" data-sql="',f=d.sql,f=typeof f===i?f():f,e+=j(f)+'" ',f=a.time,f=f==null||f===!1?f:f.twofour,f=c["if"].call(a,f,{hash:{},inverse:k.noop,fn:k.program(2,n,b)});if(f||f===0)e+=f;e+='>    <h4 class="color',f=a.trip,f=f==null||f===!1?f:f.color,f=typeof f===i?f():f,e+=j(f)+'">',f=a.trip,f=f==null||f===!1?f:f.name,g=c.truncate,f=g?g.call(a,f,20,{hash:{}}):l.call(a,"truncate",f,20,{hash:{}}),e+=j(f)+" ",f=a.time,f=f==null||f===!1?f:f.start,f=c["if"].call(a,f,{hash:{},inverse:k.noop,fn:k.program(4,o,b)});if(f||f===0)e+=f;e+=" (",g=c.available,g?f=g.call(a,{hash:{}}):(f=a.available,f=typeof f===i?f():f),e+=j(f)+")</h4>    ",f=a.schedule,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.programWithDepth(p,b,a,d)});if(f||f===0)e+=f;return e+="   </div>    ",e}function n(a,b){var c="",d;return c+='data-time="',d=a.time,d=d==null||d===!1?d:d.twofour,d=typeof d===i?d():d,c+=j(d)+'"',c}function o(a,b){var c;return c=a.time,c=c==null||c===!1?c:c.start,c=typeof c===i?c():c,j(c)}function p(a,b,d,e){var f="",g,h;f+='    <div class="group ',g=a.empty,g=c["if"].call(a,g,{hash:{},inverse:k.noop,fn:k.program(7,q,b)});if(g||g===0)f+=g;f+='">      <div class="guide ',g=a.guide,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-number="',h=c.number,h?g=h.call(a,{hash:{}}):(g=a.number,g=typeof g===i?g():g),f+=j(g)+'" data-space="',g=a.available,g=g==null||g===!1?g:g.length,g=typeof g===i?g():g,f+=j(g)+'">       <p class="guide-name">',g=a.guide,g=g==null||g===!1?g:g.nickname,g=typeof g===i?g():g,f+=j(g)+" (",h=c.filled,h?g=h.call(a,{hash:{}}):(g=a.filled,g=typeof g===i?g():g),f+=j(g)+")</p>       ",g=a.reservations,g=c.each.call(a,g,{hash:{},inverse:k.noop,fn:k.program(9,r,b)});if(g||g===0)f+=g;f+="       ",g=a.available,g=c.each.call(a,g,{hash:{},inverse:k.noop,fn:k.programWithDepth(t,b,a,d,e)});if(g||g===0)f+=g;return f+="      </div>    </div>    ",f}function q(a,b){return"empty"}function r(a,b){var d="",e,f;d+='         <div class="reservation client-group ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'" data-activity="',f=c.activity_id,f?e=f.call(a,{hash:{}}):(e=a.activity_id,e=typeof e===i?e():e),d+=j(e)+'" data-people="',f=c.people,f?e=f.call(a,{hash:{}}):(e=a.people,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.people,f?e=f.call(a,{hash:{}}):(e=a.people,e=typeof e===i?e():e),d+=j(e)+")</div>         ",e=a.clients,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(s,b,a)});if(e||e===0)d+=e;return d+="       ",d}function s(a,b,d){var e="",f,g;return e+='           <div class="reservation client ',f=d.status,f=typeof f===i?f():f,e+=j(f)+'" id="',g=c.id,g?f=g.call(a,{hash:{}}):(f=a.id,f=typeof f===i?f():f),e+=j(f)+'" data-activity="',g=c.activity_id,g?f=g.call(a,{hash:{}}):(f=a.activity_id,f=typeof f===i?f():f),e+=j(f)+'">',g=c.name,g?f=g.call(a,{hash:{}}):(f=a.name,f=typeof f===i?f():f),e+=j(f)+"</div>         ",e}function t(a,b,c,d,e){var f="",g;return f+='        <div class="available seat" id="',g=d.trip,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-sql="',g=e.sql,g=typeof g===i?g():g,f+=j(g)+'" data-guide="',g=c.guide,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-time="',g=c.time,g=typeof g===i?g():g,f+=j(g)+'">Available</div>       ',f}function u(a,b,d){var e="",f;e+='       <div class="lodge ',f=a.lodge,f=f==null||f===!1?f:f.id,f=typeof f===i?f():f,e+=j(f)+'">          <h4>',f=a.lodge,f=f==null||f===!1?f:f.name,f=typeof f===i?f():f,e+=j(f)+"</h4>          ",f=a.schedule,f=f==null||f===!1?f:f.booked,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.program(15,v,b)});if(f||f===0)e+=f;e+="          ",f=a.schedule,f=f==null||f===!1?f:f.available,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.programWithDepth(w,b,a,d)});if(f||f===0)e+=f;return e+="       </div>    ",e}function v(a,b){var d="",e,f;return d+='            <div class="reservation lodging ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.room,f?e=f.call(a,{hash:{}}):(e=a.room,e=typeof e===i?e():e),d+=j(e)+")</div>          ",d}function w(a,b,d,e){var f="",g,h;return f+='            <div class="available lodging" id="',g=d.lodge,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-sql="',g=e.sql,g=typeof g===i?g():g,f+=j(g)+'" data-room="',h=c.id,h?g=h.call(a,{hash:{}}):(g=a.id,g=typeof g===i?g():g),f+=j(g)+'">',h=c.type,h?g=h.call(a,{hash:{}}):(g=a.type,g=typeof g===i?g():g),f+=j(g)+"</div>          ",f}function x(a,b){var d="",e;d+='     <div class="lodge ',e=a.lodge,e=e==null||e===!1?e:e.id,e=typeof e===i?e():e,d+=j(e)+'">        <h4>',e=a.lodge,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+"</h4>        ",e=a.schedule,e=e==null||e===!1?e:e.checking_in,e=c["if"].call(a,e,{hash:{},inverse:k.program(23,A,b),fn:k.program(20,y,b)});if(e||e===0)d+=e;return d+="             </div>  ",d}function y(a,b){var d="",e;d+="          ",e=a.schedule,e=e==null||e===!1?e:e.checking_in,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(21,z,b)});if(e||e===0)d+=e;return d+="        ",d}function z(a,b){var d="",e,f;return d+='            <div class="reservation lodging ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.room,f?e=f.call(a,{hash:{}}):(e=a.room,e=typeof e===i?e():e),d+=j(e)+")</div>          ",d}function A(a,b){var c="",d;return c+='         <p class="no-action">No one is checking into ',d=a.lodge,d=d==null||d===!1?d:d.name,d=typeof d===i?d():d,c+=j(d)+" today.</p>        ",c}function B(a,b){var d="",e;d+='     <div class="lodge ',e=a.lodge,e=e==null||e===!1?e:e.id,e=typeof e===i?e():e,d+=j(e)+'">        <h4>',e=a.lodge,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+"</h4>        ",e=a.schedule,e=e==null||e===!1?e:e.checking_out,e=c["if"].call(a,e,{hash:{},inverse:k.program(29,E,b),fn:k.program(26,C,b)});if(e||e===0)d+=e;return d+="             </div>  ",d}function C(a,b){var d="",e;d+="          ",e=a.schedule,e=e==null||e===!1?e:e.checking_out,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(27,D,b)});if(e||e===0)d+=e;return d+="        ",d}function D(a,b){var d="",e,f;return d+='            <div class="reservation lodging ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.room,f?e=f.call(a,{hash:{}}):(e=a.room,e=typeof e===i?e():e),d+=j(e)+")</div>          ",d}function E(a,b){var c="",d;return c+='         <p class="no-action">No one is checking out of ',d=a.lodge,d=d==null||d===!1?d:d.name,d=typeof d===i?d():d,c+=j(d)+" today.</p>        ",c}function F(a,b){var d="",e;d+="   ",e=a.arrivals,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(32,G,b)});if(e||e===0)d+=e;return d+="    ",d}function G(a,b){var d="",e,f;d+='       <div class="time">',f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e)+"</div>       ",e=a.parties,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(33,H,b)});if(e||e===0)d+=e;return d+="    ",d}function H(a,b){var d="",e,f;return d+='       <div class="travel" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">          <span>',f=c.who,f?e=f.call(a,{hash:{}}):(e=a.who,e=typeof e===i?e():e),d+=j(e)+" via ",f=c.via,f?e=f.call(a,{hash:{}}):(e=a.via,e=typeof e===i?e():e),d+=j(e)+"</span>       </div>       ",d}function I(a,b){return'    <p class="no-action">No one to pick up today.</p>  '}function J(a,b){var d="",e;d+="   ",e=a.departures,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(38,K,b)});if(e||e===0)d+=e;return d+="    ",d}function K(a,b){var d="",e,f;d+='       <div class="time">',f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e)+"</div>       ",e=a.parties,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(39,L,b)});if(e||e===0)d+=e;return d+="    ",d}function L(a,b){var d="",e,f;return d+='       <div class="travel" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">          <span>',f=c.who,f?e=f.call(a,{hash:{}}):(e=a.who,e=typeof e===i?e():e),d+=j(e)+" via ",f=c.via,f?e=f.call(a,{hash:{}}):(e=a.via,e=typeof e===i?e():e),d+=j(e)+"</span>       </div>       ",d}function M(a,b){return'    <p class="no-action">No one to drop off today.</p>    '}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<table class="fc-header" style="width:100%">  <tbody>  <tr>    <td class="fc-header-left"></td>    <td class="fc-header-center"></td>    <td class="fc-header-right">      <span class="fc-header-title"><h2>',h=c.label,h?g=h.call(b,{hash:{}}):(g=b.label,g=typeof g===i?g():g),f+=j(g)+'</h2></span>    </td></tr></tbody></table><div class="view-opts"> <p class="checkbox show-availability sha-staff">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-staff",{hash:{}}):l.call(b,"checkbox",g,"sha-staff",{hash:{}}),f+=j(g)+' <label>Available Staff</label></p> <p class="checkbox show-availability sha-space">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-space",{hash:{}}):l.call(b,"checkbox",g,"sha-space",{hash:{}}),f+=j(g)+' <label>Available Space</label></p> <p class="checkbox show-availability sha-client">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-client",{hash:{}}):l.call(b,"checkbox",g,"sha-client",{hash:{}}),f+=j(g)+' <label>Individual Clients</label></p></div><a class="print" href="javascript:window.print()"><span>Print</span></a><br /><div class="day-view"><div class="program">  <h3>Activity Schedule</h3>  ',g=b.trips,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.programWithDepth(m,e,b)});if(g||g===0)f+=g;f+='  </div>    <div class="lodge-assign">  <h3>Lodge Assignments</h3>     ',g=b.lodging,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.programWithDepth(u,e,b)});if(g||g===0)f+=g;f+='    </div> <div class="checks"><h3>Checking In</h3>  ',g=b.lodging,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.program(19,x,e)});if(g||g===0)f+=g;f+="   <h3>Checking Out</h3>  ",g=b.lodging,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.program(25,B,e)});if(g||g===0)f+=g;f+='     </div>  <div class="travelers">  <h3>Arrivals</h3>  ',g=b.arrivals,g=c["if"].call(b,g,{hash:{},inverse:k.program(35,I,e),fn:k.program(31,F,e)});if(g||g===0)f+=g;f+="  <h3>Departures</h3>  ",g=b.departures,g=c["if"].call(b,g,{hash:{},inverse:k.program(41,M,e),fn:k.program(37,J,e)});if(g||g===0)f+=g;return f+="</div>      </div>",f}),templates["calendar/main"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<div class="cal-buttons">  <button class="prev">‹</button>    <button class="day unselected">Day</button>  <button class="week unselected">Week</button>  <button class="month unselected">Month</button>  <button class="next">›</button></div>  <div id="month-view" class="schedule-view"></div><div id="week-view" class="schedule-view"></div><div id="day-view" class="schedule-view"></div>'}),templates["calendar/prompt"]=template(function(a,b,c,d,e){function l(a,b){var d="",e,f;return d+='  <p class="small">',f=c.guide,f?e=f.call(a,{hash:{}}):(e=a.guide,e=typeof e===i?e():e),d+=j(e)+"</p>",d}function m(a,b){var d="",e;d+='<div class="col"><p><b>Book A Trip:</b></p> ',e=a.trips,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(n,b,a)});if(e||e===0)d+=e;return d+="</div>",d}function n(a,b,c){var d="",e;return d+='    <a href="#reservation/trip/',e=a.attributes,e=e==null||e===!1?e:e.id,e=typeof e===i?e():e,d+=j(e)+"/",e=c.start,e=typeof e===i?e():e,d+=j(e),e=c.end,e=typeof e===i?e():e,d+=j(e)+'">',e=a.attributes,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+"</a> ",d}function o(a,b){var d="",e;d+='<div class="col"><p><b>Book A Lodge:</b></p> ',e=a.lodges,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(p,b,a)});if(e||e===0)d+=e;return d+="</div>",d}function p(a,b,c){var d="",e;return d+='    <a href="#reservation/lodge/',e=a.attributes,e=e==null||e===!1?e:e.id,e=typeof e===i?e():e,d+=j(e)+"/",e=c.start,e=typeof e===i?e():e,d+=j(e),e=c.end,e=typeof e===i?e():e,d+=j(e)+'">',e=a.attributes,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+"</a> ",d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this;f+='<p class="small">',h=c.display,h?g=h.call(b,{hash:{}}):(g=b.display,g=typeof g===i?g():g),f+=j(g)+"</p>",g=b.guide,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,l,e)});if(g||g===0)f+=g;g=b.trips,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(3,m,e)});if(g||g===0)f+=g;g=b.lodges,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(6,o,e)});if(g||g===0)f+=g;return f+='<button class="close cancel">Cancel</button>',f}),templates["calendar/week"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;d+='   <div class="week-day ',f=c.sql,f?e=f.call(a,{hash:{}}):(e=a.sql,e=typeof e===i?e():e),d+=j(e)+'"> <em>',f=c.slash,f?e=f.call(a,{hash:{}}):(e=a.slash,e=typeof e===i?e():e),d+=j(e)+"</em> ",e=a.trips,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(n,b,a)});if(e||e===0)d+=e;return d+="     </div>",d}function n(a,b,d){var e="",f,g;e+='  <div class="trip ',f=a.trip,f=f==null||f===!1?f:f.id,f=typeof f===i?f():f,e+=j(f)+'" data-sql="',f=d.sql,f=typeof f===i?f():f,e+=j(f)+'" ',f=a.time,f=f==null||f===!1?f:f.twofour,f=c["if"].call(a,f,{hash:{},inverse:k.noop,fn:k.program(3,o,b)});if(f||f===0)e+=f;e+='>    <h4 class="color',f=a.trip,f=f==null||f===!1?f:f.color,f=typeof f===i?f():f,e+=j(f)+'">',f=a.trip,f=f==null||f===!1?f:f.name,g=c.truncate,f=g?g.call(a,f,20,{hash:{}}):l.call(a,"truncate",f,20,{hash:{}}),e+=j(f)+" ",f=a.time,f=f==null||f===!1?f:f.start,f=c["if"].call(a,f,{hash:{},inverse:k.noop,fn:k.program(5,p,b)});if(f||f===0)e+=f;e+=" (",g=c.available,g?f=g.call(a,{hash:{}}):(f=a.available,f=typeof f===i?f():f),e+=j(f)+")</h4>    ",f=a.schedule,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.programWithDepth(q,b,a,d)});if(f||f===0)e+=f;return e+="  </div>   ",e}function o(a,b){var c="",d;return c+='data-time="',d=a.time,d=d==null||d===!1?d:d.twofour,d=typeof d===i?d():d,c+=j(d)+'"',c}function p(a,b){var c;return c=a.time,c=c==null||c===!1?c:c.start,c=typeof c===i?c():c,j(c)}function q(a,b,d,e){var f="",g,h;f+='    <div class="group ',g=a.empty,g=c["if"].call(a,g,{hash:{},inverse:k.noop,fn:k.program(8,r,b)});if(g||g===0)f+=g;f+='">      <div class="guide ',g=a.guide,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-number="',h=c.number,h?g=h.call(a,{hash:{}}):(g=a.number,g=typeof g===i?g():g),f+=j(g)+'" data-space="',g=a.available,g=g==null||g===!1?g:g.length,g=typeof g===i?g():g,f+=j(g)+'">       <p class="guide-name">',g=a.guide,g=g==null||g===!1?g:g.nickname,g=typeof g===i?g():g,f+=j(g)+" (",h=c.filled,h?g=h.call(a,{hash:{}}):(g=a.filled,g=typeof g===i?g():g),f+=j(g)+")</p>       ",g=a.reservations,g=c.each.call(a,g,{hash:{},inverse:k.noop,fn:k.program(10,s,b)});if(g||g===0)f+=g;f+="       ",g=a.available,g=c.each.call(a,g,{hash:{},inverse:k.noop,fn:k.programWithDepth(u,b,a,d,e)});if(g||g===0)f+=g;return f+="      </div>    </div>    ",f}function r(a,b){return"empty"}function s(a,b){var d="",e,f;d+='         <div class="reservation client-group ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'" data-activity="',f=c.activity_id,f?e=f.call(a,{hash:{}}):(e=a.activity_id,e=typeof e===i?e():e),d+=j(e)+'" data-people="',f=c.people,f?e=f.call(a,{hash:{}}):(e=a.people,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.people,f?e=f.call(a,{hash:{}}):(e=a.people,e=typeof e===i?e():e),d+=j(e)+")</div>         ",e=a.clients,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(t,b,a)});if(e||e===0)d+=e;return d+="       ",d}function t(a,b,d){var e="",f,g;return e+='           <div class="reservation client ',f=d.status,f=typeof f===i?f():f,e+=j(f)+'" id="',g=c.id,g?f=g.call(a,{hash:{}}):(f=a.id,f=typeof f===i?f():f),e+=j(f)+'" data-activity="',g=c.activity_id,g?f=g.call(a,{hash:{}}):(f=a.activity_id,f=typeof f===i?f():f),e+=j(f)+'">',g=c.name,g?f=g.call(a,{hash:{}}):(f=a.name,f=typeof f===i?f():f),e+=j(f)+"</div>         ",e}function u(a,b,c,d,e){var f="",g;return f+='        <div class="available seat" id="',g=d.trip,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-sql="',g=e.sql,g=typeof g===i?g():g,f+=j(g)+'" data-guide="',g=c.guide,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-time="',g=c.time,g=typeof g===i?g():g,f+=j(g)+'">Available</div>       ',f}function v(a,b){var d="",e;d+="  <h3>Lodging</h3>  ",e=a.days,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(16,w,b)});if(e||e===0)d+=e;return d}function w(a,b){var d="",e,f;d+='     <div class="week-day ',f=c.sql,f?e=f.call(a,{hash:{}}):(e=a.sql,e=typeof e===i?e():e),d+=j(e)+'">    <em>',f=c.slash,f?e=f.call(a,{hash:{}}):(e=a.slash,e=typeof e===i?e():e),d+=j(e)+"</em>    ",e=a.lodging,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.programWithDepth(x,b,a)});if(e||e===0)d+=e;return d+="    </div>       ",d}function x(a,b,d){var e="",f;e+='       <div class="lodge ',f=a.lodge,f=f==null||f===!1?f:f.id,f=typeof f===i?f():f,e+=j(f)+'">          <h4>',f=a.lodge,f=f==null||f===!1?f:f.name,f=typeof f===i?f():f,e+=j(f)+"</h4>          ",f=a.schedule,f=f==null||f===!1?f:f.booked,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.program(18,y,b)});if(f||f===0)e+=f;e+="          ",f=a.schedule,f=f==null||f===!1?f:f.available,f=c.each.call(a,f,{hash:{},inverse:k.noop,fn:k.programWithDepth(z,b,a,d)});if(f||f===0)e+=f;return e+="       </div>    ",e}function y(a,b){var d="",e,f;return d+='            <div class="reservation lodging ',f=c.status,f?e=f.call(a,{hash:{}}):(e=a.status,e=typeof e===i?e():e),d+=j(e)+'" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+" (",f=c.room,f?e=f.call(a,{hash:{}}):(e=a.room,e=typeof e===i?e():e),d+=j(e)+")</div>          ",d}function z(a,b,d,e){var f="",g,h;return f+='            <div class="available lodging" id="',g=d.lodge,g=g==null||g===!1?g:g.id,g=typeof g===i?g():g,f+=j(g)+'" data-sql="',g=e.sql,g=typeof g===i?g():g,f+=j(g)+'" data-room="',h=c.id,h?g=h.call(a,{hash:{}}):(g=a.id,g=typeof g===i?g():g),f+=j(g)+'">',h=c.type,h?g=h.call(a,{hash:{}}):(g=a.type,g=typeof g===i?g():g),f+=j(g)+"</div>          ",f}function A(a,b){var d="",e,f;d+='     <div class="week-day ',f=c.sql,f?e=f.call(a,{hash:{}}):(e=a.sql,e=typeof e===i?e():e),d+=j(e)+'">    <em>',f=c.slash,f?e=f.call(a,{hash:{}}):(e=a.slash,e=typeof e===i?e():e),d+=j(e)+"</em>    ",e=a.arrivals,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(23,B,b)});if(e||e===0)d+=e;return d+="    </div>       ",d}function B(a,b){var d="",e,f;d+='       <div class="time">',f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e)+"</div>       ",e=a.parties,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(24,C,b)});if(e||e===0)d+=e;return d+="    ",d}function C(a,b){var d="",e,f;return d+='       <div class="travel" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">          <span>',f=c.who,f?e=f.call(a,{hash:{}}):(e=a.who,e=typeof e===i?e():e),d+=j(e)+" via ",f=c.via,f?e=f.call(a,{hash:{}}):(e=a.via,e=typeof e===i?e():e),d+=j(e)+"</span>       </div>       ",d}function D(a,b){var d="",e,f;d+='     <div class="week-day ',f=c.sql,f?e=f.call(a,{hash:{}}):(e=a.sql,e=typeof e===i?e():e),d+=j(e)+'">    <em>',f=c.slash,f?e=f.call(a,{hash:{}}):(e=a.slash,e=typeof e===i?e():e),d+=j(e)+"</em>    ",e=a.departures,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(27,E,b)});if(e||e===0)d+=e;return d+="    </div>       ",d}function E(a,b){var d="",e,f;d+='       <div class="time">',f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e)+"</div>       ",e=a.parties,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(28,F,b)});if(e||e===0)d+=e;return d+="    ",d}function F(a,b){var d="",e,f;return d+='       <div class="travel" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'">          <span>',f=c.who,f?e=f.call(a,{hash:{}}):(e=a.who,e=typeof e===i?e():e),d+=j(e)+" via ",f=c.via,f?e=f.call(a,{hash:{}}):(e=a.via,e=typeof e===i?e():e),d+=j(e)+"</span>       </div>       ",d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<table class="fc-header" style="width:100%">  <tbody>  <tr>    <td class="fc-header-left"></td>    <td class="fc-header-center"></td>    <td class="fc-header-right">      <span class="fc-header-title"><h2>',h=c.range,h?g=h.call(b,{hash:{}}):(g=b.range,g=typeof g===i?g():g),f+=j(g)+'</h2></span>    </td></tr></tbody></table><div class="view-opts"> <p class="checkbox show-availability sha-staff">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-staff",{hash:{}}):l.call(b,"checkbox",g,"sha-staff",{hash:{}}),f+=j(g)+' <label>Available Staff</label></p> <p class="checkbox show-availability sha-space">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-space",{hash:{}}):l.call(b,"checkbox",g,"sha-space",{hash:{}}),f+=j(g)+' <label>Available Space</label></p> <p class="checkbox show-availability sha-client">',g=b.model,h=c.checkbox,g=h?h.call(b,g,"sha-client",{hash:{}}):l.call(b,"checkbox",g,"sha-client",{hash:{}}),f+=j(g)+' <label>Individual Clients</label></p></div><a class="print" href="javascript:window.print()"><span>Print</span></a><div class="weeks"><h3>Activity</h3>',g=b.days,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;f+=" ",g=b.is_lodging,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(15,v,e)});if(g||g===0)f+=g;f+="<br /><h3>Arrivals</h3>  ",g=b.days,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.program(22,A,e)});if(g||g===0)f+=g;f+="  <br /><h3>Departures</h3>  ",g=b.days,g=c.each.call(b,g,{hash:{},inverse:k.noop,fn:k.program(26,D,e)});if(g||g===0)f+=g;return f+="   </div>",f}),templates["employees/activity"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<form onsubmit="return false;"><h1>Guide activity report</h1>    <div class="buttons-left"> <button class="save-activity">Save Changes</button> <button class="cancel">Cancel</button></div> </form>'}),templates["employees/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form id="employee" onsubmit="return false"><h1>Add a new staff member</h1><fieldset><p class="step"><span>1</span> Enter the employee <strong>Name.</strong> &nbsp; It doesn\'t have to be their real name.</p> ',g=b.employee,h={},h.placeholder="(Sparky, Pork Chop, Lil' John, etc.)",i=c.text_field,g=i?i.call(b,g,"nickname",{hash:h}):j.call(b,"text_field",g,"nickname",{hash:h}),f+=k(g)+'<p class="step"><span>2</span> Enter the <strong>employee\'s email address.</strong> &nbsp; Required if you want them to manage their own schedule.</p> ',g=b.employee,h={},h.placeholder="(No email)",i=c.text_field,g=i?i.call(b,g,"email",{hash:h}):j.call(b,"text_field",g,"email",{hash:h}),f+=k(g)+'</fielset><p class="step"><span>3</span> What <strong>role</strong> does the staff member play in your organization?</p> <div class="role" id="manager">  <input type="radio" name="role" value="manager" id="rd-manager" />  <label for="admin">Manager</label>  <p>A manager staff member will have all administrative privileges.</p> </div> <div class="role" id="staff">  <input type="radio" name="role" value="staff" id="rd-staff" />  <label for="staff">Staff Member</label>  <p>Office staff can manage reservations, but not employees or the account.</p> </div> <div class="role" id="guide">  <input type="radio" name="role" value="guide" id="rd-guide" checked="true" />  <label for="guide">Guide</label>  <p>Guides can see their scheduled trips, client group information, and manage their availability.</p> </div> <div class="role" id="assistant">  <input type="radio" name="role" value="assistant" id="rd-assistant" />  <label for="assistant">Assistant</label>  <p>Assistants can be scheduled on trips. They only see their scheduled days and group sizes.</p> </div>  <div class="buttons-right">  <button class="save continue">Save &amp; Continue</button><br />  <a href="javascript:void(0)" class="cancel">... or cancel</a> </div> </form>',f}),templates["employees/edit"]=template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression,l=this;f+='<form id="employee" onsubmit="return false" class="wider-right"><button class="dummy"></button>  <button class="cancel">Cancel</button>  <button class="done">Done</button> ',g=b.model,h={},h["class"]="title",i=c.text_field,g=i?i.call(b,g,"nickname",{hash:h}):j.call(b,"text_field",g,"nickname",{hash:h}),f+=k(g)+' <div class="col left">   <h3>Contact Information</h3>    <fieldset>    ',g=b.model,h={},h.placeholder="(Phone Number)",i=c.text_field,g=i?i.call(b,g,"phone",{hash:h}):j.call(b,"text_field",g,"phone",{hash:h}),f+=k(g)+"    ",g=b.model,h={},h.placeholder="(Email Address)",i=c.text_field,g=i?i.call(b,g,"email",{hash:h}):j.call(b,"text_field",g,"email",{hash:h}),f+=k(g)+"    </fieldset>  <h3>Role &amp; Options</h3>   <fieldset>   ",g=b.model,g=g==null||g===!1?g:g.roles,h=b.model,i=c.select,g=i?i.call(b,h,"role",g,{hash:{}}):j.call(b,"select",h,"role",g,{hash:{}}),f+=k(g)+'</p>   <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"self_managed",{hash:{}}):j.call(b,"checkbox",g,"self_managed",{hash:{}}),f+=k(g)+'<label>Allow employee to set own schedule</label></p>   <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"active",{hash:{}}):j.call(b,"checkbox",g,"active",{hash:{}}),f+=k(g)+'<label>This employee is active</label></p>   <p class="small"><strong>Note</strong>: For employes to set their own schedule make sure a valid email is entered</p>   </fieldset></div>  <div class="col right">    <h3>Availability</h3>    <p class="small"><span class="blackout">Black days</span> indicate the guide/staff member is unavailable. Click the calendar dates and/or days of the week to change available dates.</p>    ',g=b,g=l.invokePartial(d.weekday_calendar,"weekday_calendar",g,c,d);if(g||g===0)f+=g;return f+="  </div></form>",f}),templates["employees/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add A Staff Member</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Guides &amp; Staff</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<br /><br /><p>Staff members are assigned a role of Manager, Staff Member, Guide or Assistant.</p><p>If an employee fits more than one role, select the highest rank. <strong>You will be able to schedule Managers and Staff Members as guides</strong> \tif you would like to do so.</p><br /><p>It\'s important that you <strong>assign a correct email</strong> to your employees if you want them to login to FlyBook and view their schedule. </p><br />\t<p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["employees/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="info ',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'">',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'</span><span class="name">',f=c.nickname,f?e=f.call(a,{hash:{}}):(e=a.nickname,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>',d}function n(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="info ',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'">',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'</span><span class="name">',f=c.nickname,f?e=f.call(a,{hash:{}}):(e=a.nickname,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>',d}function o(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="info ',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'">',f=c.role,f?e=f.call(a,{hash:{}}):(e=a.role,e=typeof e===i?e():e),d+=j(e)+'</span><span class="name">',f=c.nickname,f?e=f.call(a,{hash:{}}):(e=a.nickname,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Guides &amp; Staff</h1><button class="help">Help</button><button class="create">Add Staff</button><ol id="employee-list" class="sortable list">',g=b.active,h=c.filtered_list,g=h?h.call(b,g,"role","guide,staff,manager","No active guides, managers or staff right now",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"filtered_list",g,"role","guide,staff,manager","No active guides, managers or staff right now",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;f+='</ol><br /><h3>Assistants</h3><ol id="assistant-list" class="sortable list">',g=b.active,h=c.filtered_list,g=h?h.call(b,g,"role","assistant","No active assistants right now",{hash:{},inverse:k.noop,fn:k.program(3,n,e)}):l.call(b,"filtered_list",g,"role","assistant","No active assistants right now",{hash:{},inverse:k.noop,fn:k.program(3,n,e)});if(g||g===0)f+=g;f+='</ol><br /><h3>Inactive Staff</h3><ol id="inactive-list" class="sortable list">',g=b.inactive,h=c.list,g=h?h.call(b,g,"No inactive employees right now",{hash:{},inverse:k.noop,fn:k.program(5,o,e)}):l.call(b,"list",g,"No inactive employees right now",{hash:{},inverse:k.noop,fn:k.program(5,o,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates.forms_preview=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+=" ",e=a.copy,f=c.text_field,e=f?f.call(a,e,"empty",{hash:{}}):i.call(a,"text_field",e,"empty",{hash:{}}),d+=j(e),d}function n(a,b){var d="",e,f,g;return d+="  ",e=a.copy,f={},f.style="height:130px",g=c.text_area,e=g?g.call(a,e,"empty",{hash:f}):i.call(a,"text_area",e,"empty",{hash:f}),d+=j(e),d}function o(a,b){var d="",e,f,g;return d+="  ",e=a.copy,f={},f.style="width:50px",g=c.text_field,e=g?g.call(a,e,"empty",{hash:f}):i.call(a,"text_field",e,"empty",{hash:f}),d+=j(e),d}function p(a,b){var d="",e,f,g;return d+="  ",e=a.copy,f={},f.style="width:90px",g=c.text_field,e=g?g.call(a,e,"empty",{hash:f}):i.call(a,"text_field",e,"empty",{hash:f}),d+=j(e),d}function q(a,b){var d="",e;d+='  <select name="preview">  ',e=a.answers,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(10,r,b)});if(e||e===0)d+=e;return d+="  </select>",d}function r(a,b){var d="",e,f;return d+='    <option value="',f=c.val,f?e=f.call(a,{hash:{}}):(e=a.val,e=typeof e===k?e():e),d+=j(e)+'">',f=c.val,f?e=f.call(a,{hash:{}}):(e=a.val,e=typeof e===k?e():e),d+=j(e)+"</option>  ",d}function s(a,b){var d="",e;d+="  ",e=a.answers,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(13,t,b)});if(e||e===0)d+=e;return d}function t(a,b){var d="",e,f;return d+='    <input type="radio" name="preview" /><label>',f=c.val,f?e=f.call(a,{hash:{}}):(e=a.val,e=typeof e===k?e():e),d+=j(e)+"</label><br />  ",d}function u(a,b){var d="",e;d+="  ",e=a.answers,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(16,v,b)});if(e||e===0)d+=e;return d}function v(a,b){var d="",e,f;return d+='    <input type="checkbox" name="',f=c.val,f?e=f.call(a,{hash:{}}):(e=a.val,e=typeof e===k?e():e),d+=j(e)+'" /><label>',f=c.val,f?e=f.call(a,{hash:{}}):(e=a.val,e=typeof e===k?e():e),d+=j(e)+"</label><br />  ",d}c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression,k="function",l=this;f+="<label>",h=c.name,h?g=h.call(b,{hash:{}}):(g=b.name,g=typeof g===k?g():g),f+=j(g)+"</label><fieldset>",g=b.type,h=c.eq,g=h?h.call(b,g,"text",{hash:{},inverse:l.noop,fn:l.program(1,m,e)}):i.call(b,"eq",g,"text",{hash:{},inverse:l.noop,fn:l.program(1,m,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"textarea",{hash:{},inverse:l.noop,fn:l.program(3,n,e)}):i.call(b,"eq",g,"textarea",{hash:{},inverse:l.noop,fn:l.program(3,n,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"number",{hash:{},inverse:l.noop,fn:l.program(5,o,e)}):i.call(b,"eq",g,"number",{hash:{},inverse:l.noop,fn:l.program(5,o,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"short",{hash:{},inverse:l.noop,fn:l.program(7,p,e)}):i.call(b,"eq",g,"short",{hash:{},inverse:l.noop,fn:l.program(7,p,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"dropdown",{hash:{},inverse:l.noop,fn:l.program(9,q,e)}):i.call(b,"eq",g,"dropdown",{hash:{},inverse:l.noop,fn:l.program(9,q,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"radio",{hash:{},inverse:l.noop,fn:l.program(12,s,e)}):i.call(b,"eq",g,"radio",{hash:{},inverse:l.noop,fn:l.program(12,s,e)});if(g||g===0)f+=g;g=b.type,h=c.eq,g=h?h.call(b,g,"checkbox",{hash:{},inverse:l.noop,fn:l.program(15,u,e)}):i.call(b,"eq",g,"checkbox",{hash:{},inverse:l.noop,fn:l.program(15,u,e)});if(g||g===0)f+=g;return f+="</fieldset>",f}),templates["forms/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<form class="store" onsubmit="return false"><h1>Add a question to your client form:</h1><fieldset><p class="step"><span>1</span> What do you want to ask the client? &nbsp;&nbsp;</p>',g=b.model,h={},h.placeholder="(Height, weight, shoe size, ability, allergies etc.)",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):k.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+'<p class="step"><span>2</span> How do you want them to answer? &nbsp;&nbsp;</p>',g=b.model,g=g==null||g===!1?g:g.types,h=b.model,i={},i.id="types",j=c.select,g=j?j.call(b,h,"type",g,{hash:i}):k.call(b,"select",h,"type",g,{hash:i}),f+=l(g)+'</fieldset><div class="buttons-right"> <button class="save continue">Save &amp; Continue</button><br /> <a href="javascript:void(0)" class="cancel">or cancel</a></div></form>',f}),templates["forms/edit"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<form class="store" onsubmit="return false"><button class="dummy"></button><button class="cancel">Cancel</button><button class="done">Done</button> <h1>Edit Client Form Field</h1> <div class="tabshell"><div class="tab wider-right"> <div class="left">  <h3>Ask A Question</h3>  <fieldset>  <label>What do you want to know?</label>    ',g=b.model,h={},h.placeholder="(Height, weight, age, ability etc.)",h.id="quest",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):k.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+"  <br />  <label>How would you like them to answer?</label>  ",g=b.model,g=g==null||g===!1?g:g.types,h=b.model,i={},i.id="types",j=c.select,g=j?j.call(b,h,"type",g,{hash:i}):k.call(b,"select",h,"type",g,{hash:i}),f+=l(g)+'  </fieldset>  <div id="value-specs" style="display:none;">    <label>Provide answer choices:</label>    <ul class="list sortable checklist" id="responses"></ul>    <fieldset>',g=b.model,h={},h.id="response",j=c.text_field,g=j?j.call(b,g,"nv",{hash:h}):k.call(b,"text_field",g,"nv",{hash:h}),f+=l(g)+'</fieldset>    <button class="add-to add-value">Add Response Option</button>  </div>   </div> <div class="right"> <h3>Preview</h3>  <p>This is how the question will look on your client form:</p>  <div id="preview">    </div>  <br />  <p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"marketing",{hash:{}}):k.call(b,"checkbox",g,"marketing",{hash:{}}),f+=l(g)+" <label>This question is for marketing purposes only.</label></p>   </div> </div></div></form>  ",f}),templates["forms/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add Question/Field</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Client Data</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<p>If you\'re like most companies that guide tours you need more than a name and a phone number.   You probably want to know some other things about your clients for marketing purposes too.  The FLyBOOK saves everyone time by turning making your forms digital.</p><p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["forms/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>  ',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Client Form Data</h1><button class="help">Help</button><button class="create add-form-field">Add Question</button><ol id="item-list" class="sortable list items"> ',g=b.fields,h=c.list,g=h?h.call(b,g,"No fields have been created",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No fields have been created",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+="</ol><br />",f}),templates.lodging_room=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=c.helperMissing;return f+='<li id="',h=c.id,h?g=h.call(b,{hash:{}}):(g=b.id,g=typeof g===i?g():g),f+=j(g)+'">  <div>   <span class="long">',h=c.type,h?g=h.call(b,{hash:{}}):(g=b.type,g=typeof g===i?g():g),f+=j(g)+'</span>   <span class="short">',h=c.sleeps,h?g=h.call(b,{hash:{}}):(g=b.sleeps,g=typeof g===i?g():g),f+=j(g)+'</span>   <span class="short">$',g=b.price,h=c.dollar,g=h?h.call(b,g,{hash:{}}):k.call(b,"dollar",g,{hash:{}}),f+=j(g)+"</span>   <span>",h=c.display_start_month,h?g=h.call(b,{hash:{}}):(g=b.display_start_month,g=typeof g===i?g():g),f+=j(g)+" ",h=c.start_date,h?g=h.call(b,{hash:{}}):(g=b.start_date,g=typeof g===i?g():g),f+=j(g)+"</span>   <span>",h=c.display_end_month,h?g=h.call(b,{hash:{}}):(g=b.display_end_month,g=typeof g===i?g():g),f+=j(g)+" ",h=c.end_date,h?g=h.call(b,{hash:{}}):(g=b.end_date,g=typeof g===i?g():g),f+=j(g)+'</span>  </div> <button class="del remove-room">Delete</buton></li>',f}),templates["lodging/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="lodge" onsubmit="return false"><h1>Add a new lodge</h1><fieldset><p class="step"><span>1</span> <strong>Lodge Name</strong></p>',g=b.model,h={},h.placeholder="(The Yurt, Cabin B, The Plaza Hotel etc.)",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):j.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'<br /><p class="step"><span>2</span> <strong>Where is the lodge located?</strong></p>',g=b.model,h={},h.placeholder="(White Mountains NH, Swiss Alps, North Shore Hawaii, etc.)",i=c.text_field,g=i?i.call(b,g,"location",{hash:h}):j.call(b,"text_field",g,"location",{hash:h}),f+=k(g)+'</fieldset><br /><div class="buttons-right"> <button class="save continue">Save &amp; Continue</button><br /> <a href="javascript:void(0)" class="cancel">or cancel</a></div></form>',f}),templates["lodging/edit"]=template(function(a,b,c,d,e){function n(a,b){return'<button class="cancel">Cancel</button>  <button class="done">Done</button>  '}function o(a,b){var d="",e,f,g;return d+='   <li id="',g=c.id,g?e=g.call(a,{hash:{}}):(e=a.id,e=typeof e===j?e():e),d+=k(e)+'"><div>',e=a.model,f={},f["class"]="ups",g=c.checkbox,e=g?g.call(a,e,"t",{hash:f}):l.call(a,"checkbox",e,"t",{hash:f}),d+=k(e)+"<span>",g=c.name,g?e=g.call(a,{hash:{}}):(e=a.name,e=typeof e===j?e():e),d+=k(e)+"</span></div></li>  ",d}function p(a,b){return" "}function q(a,b){return'<div class="buttons-right"> <button class="next-step continue">Continue Setup</button><br /> <a href="javascript:void(0)" class="done">or save and make changes later</a></div>'}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j="function",k=this.escapeExpression,l=c.helperMissing,m=this;f+='<form class="lodge" onsubmit="return false"><button class="dummy"></button>',g=b.setup_complete,g=c["if"].call(b,g,{hash:{},inverse:m.noop,fn:m.program(1,n,e)});if(g||g===0)f+=g;g=b.model,h={},h["class"]="title",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):l.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'<ul class="tabs">  <li>',g={},g["class"]="tab current",i=c.link_nohref,g=i?i.call(b,"Details",{hash:g}):l.call(b,"link_nohref","Details",{hash:g}),f+=k(g)+"</li>  <li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Photos &amp; Location",{hash:g}):l.call(b,"link_nohref","Photos &amp; Location",{hash:g}),f+=k(g)+"</li>  <li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Rooms &amp; Pricing",{hash:g}):l.call(b,"link_nohref","Rooms &amp; Pricing",{hash:g}),f+=k(g)+"</li>  <li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Upsell Settings",{hash:g}):l.call(b,"link_nohref","Upsell Settings",{hash:g}),f+=k(g)+'</li></ul>  <div class="tabshell"><div class="tab wider-right"> <div class="left">  <h3>Lodging Type</h3>  <label>What kind of "lodge" is this?</label>  ',g=b.model,g=g==null||g===!1?g:g.styles,h=b.model,i=c.select,g=i?i.call(b,h,"style",g,{hash:{}}):l.call(b,"select",h,"style",g,{hash:{}}),f+=k(g)+'  <br />  <h3>Publish Settings</h3>  <fieldset>  <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"standalone",{hash:{}}):l.call(b,"checkbox",g,"standalone",{hash:{}}),f+=k(g)+'<label>Allow room reservations without a trip</label></p>  <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"web_active",{hash:{}}):l.call(b,"checkbox",g,"web_active",{hash:{}}),f+=k(g)+'<label>Allow online reservations to be made</label></p>\t<p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"published",{hash:{}}):l.call(b,"checkbox",g,"published",{hash:{}}),f+=k(g)+'<label>Publish lodging to the <a href="http://www.guideoutdoornetwork.com" target="_blank">gone.</a> network</label></p>  </fieldset> </div> <div class="right">   <h3>Description</h3>   <fieldset>   ',g=b.model,i=c.text_area,g=i?i.call(b,g,"description",{hash:{}}):l.call(b,"text_area",g,"description",{hash:{}}),f+=k(g)+'    </fieldset>  </div> </div><div class="tab wider-right"> ',g=b,g=m.invokePartial(d.progress_bar,"progress_bar",g,c,d);if(g||g===0)f+=g;f+='   <div class="left photos">  ',g=b,g=m.invokePartial(d.photos,"photos",g,c,d);if(g||g===0)f+=g;f+=' </div>      <div class="right map">  ',g=b,g=m.invokePartial(d.location,"location",g,c,d);if(g||g===0)f+=g;f+=' </div>   </div> <div class="tab"> <div class="full-width">  <h3>Available Room Types</h3>  <div class="longer-headings">    <span class="long">Room Type Description</span>    <span class="short">Sleeps</span>    <span class="short">$ Per Night</span>    <span>Start Date</span>    <span>Ending Date</span>  </div>  <ul class="list longer sortable" id="rooms"></ul>  <div class="longer-add-fields room-inputs">   ',g=b.model,h={},h["class"]="long",i=c.text_field,g=i?i.call(b,g,"type",{hash:h}):l.call(b,"text_field",g,"type",{hash:h}),f+=k(g)+"   ",g=b.model,h={},h["class"]="short",i=c.text_field,g=i?i.call(b,g,"sleeps",{hash:h}):l.call(b,"text_field",g,"sleeps",{hash:h}),f+=k(g)+"   ",g=b.model,h={},h["class"]="short",i=c.text_field,g=i?i.call(b,g,"price",{hash:h}):l.call(b,"text_field",g,"price",{hash:h}),f+=k(g)+"   ",g=b.model,g=g==null||g===!1?g:g.months,h=b.model,i=c.select,g=i?i.call(b,h,"start_month",g,{hash:{}}):l.call(b,"select",h,"start_month",g,{hash:{}}),f+=k(g),g=b.model,g=g==null||g===!1?g:g.days,h=b.model,i=c.select,g=i?i.call(b,h,"start_date",g,{hash:{}}):l.call(b,"select",h,"start_date",g,{hash:{}}),f+=k(g)+"   ",g=b.model,g=g==null||g===!1?g:g.months,h=b.model,i=c.select,g=i?i.call(b,h,"end_month",g,{hash:{}}):l.call(b,"select",h,"end_month",g,{hash:{}}),f+=k(g),g=b.model,g=g==null||g===!1?g:g.days,h=b.model,i=c.select,g=i?i.call(b,h,"end_date",g,{hash:{}}):l.call(b,"select",h,"end_date",g,{hash:{}}),f+=k(g)+'  </div><br style="clear:both;" />  <button class="create add-new-room">Add New Room</button>     </div></div><div class="tab wider-left"> <div class="left">  <h3>Upsell Settings</h3>  <span class="long">Check the boxes to add this lodge as a checkout upsell to trips</span>  <ul class="list checklist">  ',g=b.trips,i=c.list,g=i?i.call(b,g,"You must have trips for this feature to work.",{hash:{},inverse:m.noop,fn:m.program(3,o,e)}):l.call(b,"list",g,"You must have trips for this feature to work.",{hash:{},inverse:m.noop,fn:m.program(3,o,e)});if(g||g===0)f+=g;f+='  </ul> </div> <div class="right">\t <div class="tip">\t\t\t<p><strong>How do upsells work?</strong><br />When a trip is selected and a customer is booking that trip online, \t\t\t\tthis lodge will be presented as an additional purchase option at checkout. \t\t\t\t<br /><br />If the lodge is already included as part of the trip package, it will not be presented.\t </div> </div>\t  </div> </div>',g=b.setup_complete,g=c["if"].call(b,g,{hash:{},inverse:m.program(7,q,e),fn:m.program(5,p,e)});if(g||g===0)f+=g;return f+="<br /><br /> &nbsp;</form>  ",f}),templates["lodging/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add Lodging</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Lodging &amp; Meals</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<p>Manage reservations for lodging and indicate which and when you serve meals. Learn more about how these tools work by watching the video:</p><p>VIDEO!</p><p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["lodging/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Lodges</h1><button class="help">Help</button><button class="create">New Lodge</button><ol id="lodges" class="list sortable">',g=b.lodges,h=c.list,g=h?h.call(b,g,"No lodges at the moment",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No lodges at the moment",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+='</ol><br /><h1>Meal Service</h1><p class="small">If you offer meal service on any of your trips, check each weekday you serve each meal.</p><div id="meals"> </div>',f}),templates["lodging/meals"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<span class="data heading">&nbsp;</span><span class="data heading served">SMTWTFS</span><span class="data heading">Price</span><span class="data heading">Overhead</span><ol class="list"><li><div class="breakfast"><span class="name">Breakfast</span><p>',g=b.model,h={},h.value="0",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="1",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="2",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="3",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="4",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="5",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="6",i=c.checkbox,g=i?i.call(b,g,"breakfast[]",{hash:h}):j.call(b,"checkbox",g,"breakfast[]",{hash:h}),f+=k(g)+"  </p>  ",g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"price",{hash:h}):j.call(b,"text_field",g,"price",{hash:h}),f+=k(g),g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"overhead",{hash:h}):j.call(b,"text_field",g,"overhead",{hash:h}),f+=k(g)+'</div></li><li><div class="lunch"><span class="name">Lunch</span><p>',g=b.model,h={},h.value="0",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="1",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="2",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="3",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="4",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="5",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="6",i=c.checkbox,g=i?i.call(b,g,"lunch[]",{hash:h}):j.call(b,"checkbox",g,"lunch[]",{hash:h}),f+=k(g)+"  </p>  ",g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"price",{hash:h}):j.call(b,"text_field",g,"price",{hash:h}),f+=k(g),g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"overhead",{hash:h}):j.call(b,"text_field",g,"overhead",{hash:h}),f+=k(g)+'</div></li><li><div class="dinner"><span class="name">Dinner</span><p>',g=b.model,h={},h.value="0",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="1",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="2",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="3",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="4",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="5",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g),g=b.model,h={},h.value="6",i=c.checkbox,g=i?i.call(b,g,"dinner[]",{hash:h}):j.call(b,"checkbox",g,"dinner[]",{hash:h}),f+=k(g)+"  </p>  ",g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"price",{hash:h}):j.call(b,"text_field",g,"price",{hash:h}),f+=k(g),g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"overhead",{hash:h}):j.call(b,"text_field",g,"overhead",{hash:h}),f+=k(g)+'</div></li></ol><button class="update-meals">Update</button>',f}),templates["pages/edit"]=template(function(a,b,c,d,e){function m(a,b){return"done"}function n(a,b){return"save done"}function o(a,b){var e="",f;e+="    ",f=a,f=j.invokePartial(d.photos,"photos",f,c,d);if(f||f===0)e+=f;return e+="   ",e}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j=this,k=c.helperMissing,l=this.escapeExpression;f+='<form onsubmit="return false"><button class="dummy"></button><button class="cancel">Cancel</button><button class="',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:j.program(3,n,e),fn:j.program(1,m,e)});if(g||g===0)f+=g;f+='">Done</button>',g=b.model,h={},h["class"]="title",i=c.text_field,g=i?i.call(b,g,"title",{hash:h}):k.call(b,"text_field",g,"title",{hash:h}),f+=l(g)+'<ul class="tabs"> <li>',g={},g["class"]="tab current",i=c.link_nohref,g=i?i.call(b,"Content",{hash:g}):k.call(b,"link_nohref","Content",{hash:g}),f+=l(g)+"</li> <li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Settings",{hash:g}):k.call(b,"link_nohref","Settings",{hash:g}),f+=l(g)+'</li>  </ul> <div class="tabshell">  <div class="tab page-editor wider-right">',g=b,g=j.invokePartial(d.progress_bar,"progress_bar",g,c,d);if(g||g===0)f+=g;f+='      <div class="left">   <h3>Summary</h3>   <fieldset>   ',g=b.model,i=c.text_area,g=i?i.call(b,g,"summary",{hash:{}}):k.call(b,"text_area",g,"summary",{hash:{}}),f+=l(g)+"   </fieldset>   ",g=b.id,g=c["if"].call(b,g,{hash:{},inverse:j.noop,fn:j.program(5,o,e)});if(g||g===0)f+=g;return f+='   </div>    <div class="right">    <h3>Page Content</h3>    <fieldset>    ',g=b.model,i=c.text_area,g=i?i.call(b,g,"content",{hash:{}}):k.call(b,"text_area",g,"content",{hash:{}}),f+=l(g)+'    </fieldset>   </div>    </div><div class="tab"> <div class="left">   <h3>Page Properties</h3>\t <p class="error-msg"><p><b>Warning!</b> Don\'t mess with these unless you know what you are doing.</p>\t <p class="field"><label>Address</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"address",{hash:{}}):k.call(b,"text_field",g,"address",{hash:{}}),f+=l(g)+'</p>\t <p class="field"><label>Identifier</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"identifier",{hash:{}}):k.call(b,"text_field",g,"identifier",{hash:{}}),f+=l(g)+'</p>  </div> <div class="right">   <h3>Publish Settings</h3> \t <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"active",{hash:{}}):k.call(b,"checkbox",g,"active",{hash:{}}),f+=l(g)+'<label>Publish this page</label></p> </div>        </div>   </div> <div class="buttons-right"> </div><br /><br />  </form>',f}),templates["pages/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add Page</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Website Pages</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<p>Flybook has a CMS too!?  Yup! However, to use it you\'ll want to talk to us before you get setup.</p><p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["pages/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.title,f?e=f.call(a,{hash:{}}):(e=a.title,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li>  ',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Website Pages</h1><button class="help">Help</button><button class="create">Add Page</button><ol id="item-list" class="sortable list items"> ',g=b.items,h=c.list,g=h?h.call(b,g,"No pages have been created",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No pages have been created",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+="</ol><br />",f}),templates.address_fields=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<div class="address">',g=b.countries,h=b.model,i={},i["class"]="country",j=c.select,g=j?j.call(b,h,"country",g,{hash:i}):k.call(b,"select",h,"country",g,{hash:i}),f+=l(g),g=b.model,h={},h["class"]="street",h.placeholder="Street Address, Apt./Unit",j=c.text_field,g=j?j.call(b,g,"address",{hash:h}):k.call(b,"text_field",g,"address",{hash:h}),f+=l(g)+"</p>",g=b.model,h={},h["class"]="city",h.placeholder="City",j=c.text_field,g=j?j.call(b,g,"city",{hash:h}):k.call(b,"text_field",g,"city",{hash:h}),f+=l(g)+" ",g=b.states,h=b.model,i={},i["class"]="state",j=c.select,g=j?j.call(b,h,"state",g,{hash:i}):k.call(b,"select",h,"state",g,{hash:i}),f+=l(g)+" ",g=b.model,h={},h["class"]="zip",h.placeholder="Zip/Post",h["class"]="zip",j=c.text_field,g=j?j.call(b,g,"zip",{hash:h}):k.call(b,"text_field",g,"zip",{hash:h}),f+=l(g)+"  </div>",f}),templates.loader=template(function(a,b,c,d,e){return c=c||a.helpers,'<p class="loader"><em class="one">&nbsp;</em><em class="two">&nbsp;</em><em class="three">&nbsp;</em><em class="four">&nbsp;</em></p>'}),templates.location=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+="<h3>Location</h3><fieldset>",g=b.model,h={},h.placeholder="Landmark or address",h.id="location",i=c.text_field,g=i?i.call(b,g,"location",{hash:h}):j.call(b,"text_field",g,"location",{hash:h}),f+=k(g)+'<button class="lookup">Find Location On The Map</button></fieldset><div id="gmap" style="-webkit-transform: none; z-index: 10;"><p>Maps are unavailable right now.</p></div><p class="field"><label>Latitude</label>',g=b.trip,h={},h.placeholder="Lat",h["class"]="num",h.id="lat",i=c.text_field,g=i?i.call(b,g,"lat",{hash:h}):j.call(b,"text_field",g,"lat",{hash:h}),f+=k(g)+'</p><p class="field"><label>Longitude</label>',g=b.trip,h={},h.placeholder="Lng",h["class"]="num",h.id="lng",i=c.text_field,g=i?i.call(b,g,"lng",{hash:h}):j.call(b,"text_field",g,"lng",{hash:h}),f+=k(g)+"</p>",f}),templates.month=template(function(a,b,c,d,e){function n(a,b){var d="",e;d+="<tr>  ",e=a.day_labels,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(2,o,b)});if(e||e===0)d+=e;return d+="</tr>",d}function o(a,b){var d="",e,f;return d+="  <th>",f=c.day,f?e=f.call(a,{hash:{}}):(e=a.day,e=typeof e===j?e():e),d+=k(e)+"</th>  ",d}c=c||a.helpers;var f="",g,h,i,j="function",k=this.escapeExpression,l=this,m=c.helperMissing;f+='<div class="month"><h3>',i=c.month_name,i?g=i.call(b,{hash:{}}):(g=b.month_name,g=typeof g===j?g():g),f+=k(g)+" ",i=c.year,i?g=i.call(b,{hash:{}}):(g=b.year,g=typeof g===j?g():g),f+=k(g)+'</h3><button class="next"><span>›</span></button><button class="previous"><span>‹</span></button><table>',g=b.day_labels,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,n,e)});if(g||g===0)f+=g;return g=b.year,h=b.month,i=c.month_grid,g=i?i.call(b,h,g,{hash:{}}):m.call(b,"month_grid",h,g,{hash:{}}),f+=k(g)+"</div>",f}),templates.photos=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<div class="upload-field" id="photo',f=c.num,f?e=f.call(a,{hash:{}}):(e=a.num,e=typeof e===i?e():e),d+=j(e)+'"><div class="upload"><p class="tip">click or drop</p><div id="photo-upload-',f=c.num,f?e=f.call(a,{hash:{}}):(e=a.num,e=typeof e===i?e():e),d+=j(e)+'"></div></div></div>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+="<h3>Photos</h3>",h=c.repeater,g=h?h.call(b,1,6,{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"repeater",1,6,{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+='<div class="tip"><p class="small"><b>Photo Tips:</b>Upload files at least 500 pixels wide for the best results. JPG formats will work best, though others may work as well.</p></div>',f}),templates.progress_bar=template(function(a,b,c,d,e){return c=c||a.helpers,'<div id="progress"><span>Uploading...</span><div id="bar"></div></div>'}),templates.search_box=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression;return f+='<div id="search"> <div>  <div id="find"></div>  <div id="close">X</div>  <input type="text" placeholder="',h=c.search,h?g=h.call(b,{hash:{}}):(g=b.search,g=typeof g===i?g():g),f+=j(g)+'" /> </div></div>',f}),templates.weekday_calendar=template(function(a,b,c,d,e){return c=c||a.helpers,'<div id="weekday-calendar"></div><div id="weekdays"> <p class="checkbox"><input type="checkbox" name="dow[]" value="0" id="dow0" /><label>Sunday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="1" id="dow1" /><label>Monday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="2" id="dow2" /><label>Tuesday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="3" id="dow3" /><label>Wednesday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="4" id="dow4" /><label>Thursday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="5" id="dow5" /><label>Friday</label></p> <p class="checkbox"><input type="checkbox" name="dow[]" value="6" id="dow6" /><label>Saturday</label></p></div>'}),templates["clients/addresses"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">Delete</button></li>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Address Book</h1><button class="create top-right">New Client</button><ol id="clients" class="list addresses">',g=b.clients,h=c.list,g=h?h.call(b,g,"No clients match your search",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No clients match your search",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates["clients/create"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Add New Client Record</h1>"}),templates["clients/data_tools"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<h1>Import &amp; Export Client Data</h1><img src="https://flybook-asset.s3.amazonaws.com/images/climb-soon.jpg"/>'}),templates["clients/edit"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Edit Client<h1>"}),templates["clients/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='<li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">Delete</button></li>',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Clients</h1><button class="create top-right">New Client</button><ol id="clients" class="list">',g=b.clients,h=c.list,g=h?h.call(b,g,"No clients match your search",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No clients match your search",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates["clients/mailing_list"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<h1>Mailing Lists</h1><img src="https://flybook-asset.s3.amazonaws.com/images/surf-soon.jpg"/>'}),templates["clients/postcards"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<h1>Postcards</h1><img src="https://flybook-asset.s3.amazonaws.com/images/climb-soon.jpg"/>'}),templates["preferences/password"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression;return f+='<form class="settings" onsubmit="return false"><h1>Change your password</h1><p>When setting your password, be smart and clever about it.<br />  Your password <strong>must be at least six characters long</strong>.    For added security, we suggest using numbers and symbols in addition to letters.</p><br /><fieldset><p class="field"><label>Current Password</label>',g=b.user,h=c.password,g=h?h.call(b,g,"old_password",{hash:{}}):i.call(b,"password",g,"old_password",{hash:{}}),f+=j(g)+'</p><p class="field"><label>New Password</label>',g=b.user,h=c.password,g=h?h.call(b,g,"new_password",{hash:{}}):i.call(b,"password",g,"new_password",{hash:{}}),f+=j(g)+'</p><p class="field"><label>Confirm</label>',g=b.user,h=c.password,g=h?h.call(b,g,"confirmed",{hash:{}}):i.call(b,"password",g,"confirmed",{hash:{}}),f+=j(g)+'</p></fieldset><br /><div class="buttons-right"> <button class="passchange">Change</button> <button class="cancel">Cancel</button></div></form>',f}),templates["preferences/profile"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="settings" onsubmit="return false"><h1>Edit Your Profile</h1><p class="field"><label>Your Full Name</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"name",{hash:{}}):j.call(b,"text_field",g,"name",{hash:{}}),f+=k(g)+'</p><h3>Contact Information</h3><div class="left"><fieldset><p class="field"><label>Email Address</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"email",{hash:{}}):j.call(b,"text_field",g,"email",{hash:{}}),f+=k(g)+'</p><p class="field"><label>Phone Number</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"phone",{hash:{}}):j.call(b,"text_field",g,"phone",{hash:{}}),f+=k(g)+'</p><p class="field"><label>Alternate Phone</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"phone",{hash:{}}):j.call(b,"text_field",g,"phone",{hash:{}}),f+=k(g)+'</p></fieldset></div><div class="right"><fieldset>  <p class="field"><label>Website URL</label>',g=b.model,h={},h.placeholder="www.myhomepage.com",i=c.text_field,g=i?i.call(b,g,"url",{hash:h}):j.call(b,"text_field",g,"url",{hash:h}),f+=k(g)+'</p><p class="field"><label>Facebook URL</label>',g=b.model,h={},h.placeholder="facebook.com/myfacebook",i=c.text_field,g=i?i.call(b,g,"facebook_url",{hash:h}):j.call(b,"text_field",g,"facebook_url",{hash:h}),f+=k(g)+'</p><p class="field"><label>Twitter Account</label>',g=b.model,h={},h.placeholder="@mytwitter",i=c.text_field,g=i?i.call(b,g,"twitter",{hash:h}):j.call(b,"text_field",g,"twitter",{hash:h}),f+=k(g)+'</p></fieldset></div><h3>Upload A Nice Picture</h3><div id="progress"><span>Uploading...</span><div id="bar"></div></div><div class="upload-field" id="icon"><label>Your mugshot or icon</label><div class="upload"><p class="tip">click or drop to upload</p><div id="logo-upload"></div></div></div><h3>Quick Bio (Optional)</h3><fieldset>',g=b.model,i=c.text_area,g=i?i.call(b,g,"description",{hash:{}}):j.call(b,"text_area",g,"description",{hash:{}}),f+=k(g)+'</fieldset><br /><div class="buttons-right"><button class="done">Save</button> <button class="cancel">Cancel</button></form>',f}),templates["dashboard/home"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>FlyBook Home</h1><p>The following shortcuts are provided to make it easier getting around.</p>"}),templates["products/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="product" onsubmit="return false"><h1>Add A New Purchase or Rental Item</h1><p class="step"><span>1</span> Give your item a good <strong>name.</strong> &nbsp;&nbsp;</p><fieldset>',g=b.model,h={},h.placeholder="(Fly Rod Rental, Dry Suit Rental, Hooded sweatshirt etc.)",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):j.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'</fieldset><div class="buttons-right"> <button class="save continue">Save &amp; Continue</button><br /> <a href="javascript:void(0)" class="cancel">or cancel</a></div></form>',f}),templates["products/edit"]=template(function(a,b,c,d,e){function n(a,b){var d="",e,f,g;return d+='   <li id="',g=c.id,g?e=g.call(a,{hash:{}}):(e=a.id,e=typeof e===j?e():e),d+=k(e)+'"><div><span>',g=c.name,g?e=g.call(a,{hash:{}}):(e=a.name,e=typeof e===j?e():e),d+=k(e)+"</span>",e=a.model,f={},f["class"]="ups",g=c.checkbox,e=g?g.call(a,e,"t",{hash:f}):l.call(a,"checkbox",e,"t",{hash:f}),d+=k(e),e=a.model,f={},f["class"]="ren",g=c.checkbox,e=g?g.call(a,e,"t",{hash:f}):l.call(a,"checkbox",e,"t",{hash:f}),d+=k(e)+"</div></li>  ",d}function o(a,b){return'<div class="buttons-left"> <button class="done">Save Changes</button> <button class="cancel">Cancel</button></div>'}function p(a,b){return'<div class="buttons-right"> <button class="next-step continue">Continue Setup</button><br /> <a href="javascript:void(0)" class="done">or save and make changes later</a></div>'}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j="function",k=this.escapeExpression,l=c.helperMissing,m=this;f+='<form class="product" onsubmit="return false"><button class="dummy"></button>  <fieldset>',g=b.model,h={},h["class"]="title",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):l.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'</fieldset><ul class="tabs"><li>',g={},g["class"]="tab current",i=c.link_nohref,g=i?i.call(b,"Product Settings",{hash:g}):l.call(b,"link_nohref","Product Settings",{hash:g}),f+=k(g)+"</li><li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Photos &amp; Description",{hash:g}):l.call(b,"link_nohref","Photos &amp; Description",{hash:g}),f+=k(g)+"</li><li>",g={},g["class"]="tab",i=c.link_nohref,g=i?i.call(b,"Upsell &amp; Rental",{hash:g}):l.call(b,"link_nohref","Upsell &amp; Rental",{hash:g}),f+=k(g)+'</li></ul> <div class="tabshell"><div class="tab wider-right"> <div class="left">  <h3>Pricing</h3>  <fieldset>  <p class="field"><label>Standard Price $</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"price",{hash:h}):l.call(b,"text_field",g,"price",{hash:h}),f+=k(g)+'</p>  <p class="field"><label>Rental Price $</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"rental_price",{hash:h}):l.call(b,"text_field",g,"rental_price",{hash:h}),f+=k(g)+'</p>  <p class="field"><label>Sale Price $</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"sale_price",{hash:h}):l.call(b,"text_field",g,"sale_price",{hash:h}),f+=k(g)+'</p>  <p class="field"><label>Sales Tax %</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"sales_tax",{hash:h}):l.call(b,"text_field",g,"sales_tax",{hash:h}),f+=k(g)+'</p>  </fieldset>  <h3>Options</h3>  <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"rental",{hash:{}}):l.call(b,"checkbox",g,"rental",{hash:{}}),f+=k(g)+'<label>This item is available as a rental</label></p>  <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"web_active",{hash:{}}):l.call(b,"checkbox",g,"web_active",{hash:{}}),f+=k(g)+'<label>Allow this product to be purchased online</label></p>  <p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"published",{hash:{}}):l.call(b,"checkbox",g,"published",{hash:{}}),f+=k(g)+'<label>Publish this product to the <a href="http://www.guideoutdoornetwork.com" target="_blank">gone.</a> network</label></label></p> </div>  <div class="right">  <h3>Sizes, Colors &amp; Variations</h3>  <ul id="variations" class="list sortable checklist"> </ul>  <div class="add">   <fieldset>',g=b.model,h={},h.id="variant",h.placeholder="(Large, Medium Blue etc.)",i=c.text_field,g=i?i.call(b,g,"v",{hash:h}):l.call(b,"text_field",g,"v",{hash:h}),f+=k(g)+'</fieldset>   <button class="add-var create">Add New Variation</button>  </div>  <div class="tip"><p class="small">Users who purchase or rent this product will be able to select a variation. For example "Large" or "Medium Blue" might be variations of your t-shirt.</p></div> </div> </div><div class="tab wider-right"> ',g=b,g=m.invokePartial(d.progress_bar,"progress_bar",g,c,d);if(g||g===0)f+=g;f+=' <div class="left"> ',g=b,g=m.invokePartial(d.photos,"photos",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="right"> <h3>Product Description</h3> <fieldset>',g=b.model,i=c.text_area,g=i?i.call(b,g,"description",{hash:{}}):l.call(b,"text_area",g,"description",{hash:{}}),f+=k(g)+'</fieldset>  </div>     </div><div class="tab wider-left"> <div class="left">  <h3>Upsell Options</h3>  <div class="longer-headings">    <span class="long">Add product as featured upsell to specific trips</span>\t\t<span class="float-right">As Rental</span>\t\t<span class="float-right">Upsell</span>\t  </div>    <ul class="list checklist">  ',g=b.trips,i=c.list,g=i?i.call(b,g,"You must have trips for created to use upsell settings.",{hash:{},inverse:m.noop,fn:m.program(1,n,e)}):l.call(b,"list",g,"You must have trips for created to use upsell settings.",{hash:{},inverse:m.noop,fn:m.program(1,n,e)});if(g||g===0)f+=g;f+='  </ul> </div> <div class="right">  <div class="tip">\t\t\t<p><strong>How upsells work:</strong><br />When a trip is selected and a customer is booking that trip online, \t\t\t\tthis product will be presented as an additional purchase or rental option at checkout. The checkboxes determine whether or \t\t\t\tnot the product will be upsold as a rental item or an item for sale.\t </div> </div>      </div>    </div>',g=b.setup_complete,g=c["if"].call(b,g,{hash:{},inverse:m.program(5,p,e),fn:m.program(3,o,e)});if(g||g===0)f+=g;return f+="  </form>  ",f}),templates["products/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add Product</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Products &amp; Rentals</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<p>Products and rentals allow you to create items for sale or rental. \tWhether you rent gear for your trips or upsell your t-shirt on checkout, you\'re in the right place.</p><p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["products/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span><span class="price">$',e=a.price,f=c.dollar,e=f?f.call(a,e,{hash:{}}):k.call(a,"dollar",e,{hash:{}}),d+=j(e)+'</span></div><button class="delete">delete</button></li>  ',d}function n(a,b){var d="",e,f;return d+='   <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span><span class="price">$',e=a.price,f=c.dollar,e=f?f.call(a,e,{hash:{}}):k.call(a,"dollar",e,{hash:{}}),d+=j(e)+'</span></div><button class="delete">delete</button></li>  ',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=c.helperMissing,l=this;f+='<h1>Products &amp; Rentals</h1><button class="help">Help</button><button class="create">New Product</button><ol id="item-list" class="sortable list items"> ',g=b.active,h=c.list,g=h?h.call(b,g,"No active products or rental items currently",{hash:{},inverse:l.noop,fn:l.program(1,m,e)}):k.call(b,"list",g,"No active products or rental items currently",{hash:{},inverse:l.noop,fn:l.program(1,m,e)});if(g||g===0)f+=g;f+='</ol><br /><h3>Inactive Items</h3> <ol id="items" class="list items">  ',g=b.inactive,h=c.list,g=h?h.call(b,g,"No inactive products right now",{hash:{},inverse:l.noop,fn:l.program(3,n,e)}):k.call(b,"list",g,"No inactive products right now",{hash:{},inverse:l.noop,fn:l.program(3,n,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates["reports/clients"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Client Insights</h1>"}),templates["reports/revenue"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Revenue</h1>"}),templates["reports/sources"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Referral Sources</h1>"}),templates["reports/statements"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Statements</h1>"}),templates["reports/traffic"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Traffic</h1>"}),templates["users/login"]=template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j="function",k=this.escapeExpression,l=c.helperMissing,m=this;f+='<div class="login-lefty"><div class="login">  <form>    <h2>',i=c.login_message,i?g=i.call(b,{hash:{}}):(g=b.login_message,g=typeof g===j?g():g),f+=k(g)+"</h2>    <fieldset>    ",g=b.user,h={},h.placeholder="Email Address",h.type="email",i=c.input,g=i?i.call(b,g,"email",{hash:h}):l.call(b,"input",g,"email",{hash:h}),f+=k(g)+"    ",g=b.user,h={},h.placeholder="Password",i=c.password,g=i?i.call(b,g,"password",{hash:h}):l.call(b,"password",g,"password",{hash:h}),f+=k(g)+'    </fieldset>    <!--<p class="checkbox">      ',g=b.user,i=c.checkbox,g=i?i.call(b,g,"remember",{hash:{}}):l.call(b,"checkbox",g,"remember",{hash:{}}),f+=k(g)+'<label for="remember">Remember me</label>    </p>-->    <button>Login</button>  </form>  ',g=b,g=m.invokePartial(d.loader,"loader",g,c,d);if(g||g===0)f+=g;return f+="</div></div>",f}),templates["settings/bank_account"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="settings bank" onsubmit="return false"><h1>Bank Account</h1><p>FLyBOOK deposits payments into your bank account. &nbsp;Where do you want to receive payments for trips and shop purchases?</p><fieldset>  <p class="field"><label>Bank Name</label>',g=b.model,i=c.text_field,g=i?i.call(b,g,"distribution_reference",{hash:{}}):j.call(b,"text_field",g,"distribution_reference",{hash:{}}),f+=k(g)+'</p> <p class="field"><label>Bank Routing No.</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"distribution_route",{hash:h}):j.call(b,"text_field",g,"distribution_route",{hash:h}),f+=k(g)+'</p> <p class="field"><label>Bank Account No.</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"distribution_number",{hash:h}):j.call(b,"text_field",g,"distribution_number",{hash:h}),f+=k(g)+'</p></fieldset><br /><p class="small">You can easily find this information on any check:</p><img src="https://s3.amazonaws.com/flybook_dev/__flybook/images/check-sample.gif" alt="Example Check" /><br /> <div class="buttons-right">  <button class="done">Save</button>  <button class="cancel">Cancel</button> </div></form>',f}),templates["settings/company_profile"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<form class="settings" onsubmit="return false"><h1>Company Profile</h1> <fieldset class="profile-top">  <p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"publish",{hash:{}}):k.call(b,"checkbox",g,"publish",{hash:{}}),f+=l(g)+'<label>List my company in the <a href="http://www.guideoutdoornetwork.com" target="_blank">gone.</a> network</label></p>  <p class="field"><label>Primary Business</label>',g=b.model,g=g==null||g===!1?g:g.industries,h=b.model,j=c.select,g=j?j.call(b,h,"industry",g,{hash:{}}):k.call(b,"select",h,"industry",g,{hash:{}}),f+=l(g)+'</p>  <p class="field"><label>Company Name</label>',g=b.model,j=c.text_field,g=j?j.call(b,g,"company",{hash:{}}):k.call(b,"text_field",g,"company",{hash:{}}),f+=l(g)+'</p> </fieldset><h3>Contact Information</h3> <div class="left">  <fieldset>  <p class="field"><label>Email Address</label>',g=b.model,j=c.text_field,g=j?j.call(b,g,"email",{hash:{}}):k.call(b,"text_field",g,"email",{hash:{}}),f+=l(g)+'</p>  <p class="field"><label>Phone</label>',g=b.model,j=c.text_field,g=j?j.call(b,g,"phone",{hash:{}}):k.call(b,"text_field",g,"phone",{hash:{}}),f+=l(g)+'</p>  <p class="field"><label>Website URL</label>',g=b.model,h={},h.placeholder="www.mywebsite.com",j=c.text_field,g=j?j.call(b,g,"url",{hash:h}):k.call(b,"text_field",g,"url",{hash:h}),f+=l(g)+'</p>  </fieldset> </div><div class="right"> <fieldset>   <p class="field"><label>Facebook URL</label>',g=b.model,h={},h.placeholder="facebook.com/mycompany",j=c.text_field,g=j?j.call(b,g,"facebook_url",{hash:h}):k.call(b,"text_field",g,"facebook_url",{hash:h}),f+=l(g)+'</p> <p class="field"><label>Twitter Account</label>',g=b.model,h={},h.placeholder="@mycompany",j=c.text_field,g=j?j.call(b,g,"twitter_model",{hash:h}):k.call(b,"text_field",g,"twitter_model",{hash:h}),f+=l(g)+'</p> </fieldset> </div><div class="address"> <fieldset> <label>Physical Address (optional)</label>  ',g=b.model,h={},h["class"]="street",h.placeholder="Street Address, Apt./Unit",j=c.text_field,g=j?j.call(b,g,"address",{hash:h}):k.call(b,"text_field",g,"address",{hash:h}),f+=l(g)+"</p>  ",g=b.model,h={},h["class"]="city",h.placeholder="City",j=c.text_field,g=j?j.call(b,g,"city",{hash:h}):k.call(b,"text_field",g,"city",{hash:h}),f+=l(g)+"   ",g=b.states,h=b.model,i={},i["class"]="state",j=c.select,g=j?j.call(b,h,"state",g,{hash:i}):k.call(b,"select",h,"state",g,{hash:i}),f+=l(g)+"   ",g=b.model,h={},h["class"]="zip",h.placeholder="Zip/Post",h["class"]="zip",j=c.text_field,g=j?j.call(b,g,"zip",{hash:h}):k.call(b,"text_field",g,"zip",{hash:h}),f+=l(g)+"  ",g=b.countries,h=b.model,i={},i["class"]="country",j=c.select,g=j?j.call(b,h,"country",g,{hash:i}):k.call(b,"select",h,"country",g,{hash:i}),f+=l(g)+' </fieldset> </div><h3>Logo &amp; Feature Photo</h3> <div id="progress"><span>Uploading...</span><div id="bar"></div></div> <div class="upload-field" id="logo"><label>Company Logo</label><div class="upload"><p class="tip">click or drop to upload</p><div id="logo-upload"></div></div></div> <div class="upload-field" id="photo"><label>Feature Photo</label><div class="upload"><p class="tip">click or drop to upload</p><div id="photo-upload"></div></div></div><br /> <br /> <br />&nbsp;<h3>Company Description</h3><fieldset>',g=b.model,j=c.text_area,g=j?j.call(b,g,"description",{hash:{}}):k.call(b,"text_area",g,"description",{hash:{}}),f+=l(g)+'</fieldset><br /> <div class="buttons-right">  <button class="done">Save</button>  <button class="cancel">Cancel</button> </div> </form>',f}),templates["settings/documents"]=template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h=this;f+='<h1>Documents</h1><button class="cancel">Cancel</button><button class="done">Done</button><form style="clear:both;" class="documents" onsubmit="return false"><div class="longer-headings"> <span class="long">Name</span> <span>Download</span></div><ul id="docs" class="list docs"><li>No documents have been uploaded yet.</li></ul><br /><h3>Upload a new document:</h3>',g=b,g=h.invokePartial(d.progress_bar,"progress_bar",g,c,d);if(g||g===0)f+=g;return f+='<div class="doc-upload-field"><div class="upload"><p class="tip">click or drop</p><div id="doc-upload"></div></div></div></div></form>',f}),templates["settings/partners"]=template(function(a,b,c,d,e){return c=c||a.helpers,"<h1>Partner Up. Offer More.</h1><p>By partnering with other tour guides, hospitality providers or adventure guides you can expand your offerings and earn commission on referrals.</p><br /><p>The Gone Network is in development and will be your source for other partners."}),templates["settings/partners_intro"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<h1>Partner Up. Offer More.</h1><p>By partnering with other tour guides, hospitality providers or adventure guides you can both expand your offerings and earn commission on referrals.</p><p>The Gone Network is in development and will be your source for finding partners in providing the world\'s greatest adventures.</p><br /><center><a href="http://www.guideoutdoornetwork.com" target="_blank"><img src="https://flybook-asset.s3.amazonaws.com/images/gone-soon.gif" alt="Gone. Dropping 2012-2013" /></a><br /> <button class="cancel">Cool. I\'ll check this out later</button></center>  '}),templates["settings/payment"]=template(function(a,b,c,d,e){return c=c||a.helpers,'<form class="settings" onsubmit="return false"><h1>Payment Method</h1><p>How do you want to pay for FLyBOOK services? If you enter a credit or debit card, you can also use this method to pay your partners commissions automatically.</p></form>'}),templates["settings/promotions"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="promos" onsubmit="return false"><h1>Promotion Codes</h1><button class="cancel">Cancel</button><button class="done">Done</button><div class="headings"><span class="long">Code</span><span>% Discount</span><span>$ Discount</span><span>Valid Through</span></div><ul id="promotion-codes" class="list"></ul><div class="add-fields code-fields">',g=b.model,h={},h["class"]="long",i=c.text_field,g=i?i.call(b,g,"code",{hash:h}):j.call(b,"text_field",g,"code",{hash:h}),f+=k(g),g=b.model,i=c.text_field,g=i?i.call(b,g,"percent_discount",{hash:{}}):j.call(b,"text_field",g,"percent_discount",{hash:{}}),f+=k(g),g=b.model,i=c.text_field,g=i?i.call(b,g,"flat_discount",{hash:{}}):j.call(b,"text_field",g,"flat_discount",{hash:{}}),f+=k(g),g=b.model,h={},h.placeholder="mm/dd/yyyy",h["class"]="long",i=c.text_field,g=i?i.call(b,g,"valid_through",{hash:h}):j.call(b,"text_field",g,"valid_through",{hash:h}),f+=k(g)+'<button class="add-to add-code">Add Code</button></div><br /><br /></form>',f}),templates.reservations_activity=template(function(a,b,c,d,e){function j(a,b){var d="",e,f;d+='  <div class="reservation" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===g?e():e),d+=h(e)+'">  ',e=a.activities,e=c.each.call(a,e,{hash:{},inverse:i.noop,fn:i.program(2,k,b)});if(e||e===0)d+=e;return d}function k(a,b){return"      "}c=c||a.helpers;var f,g="function",h=this.escapeExpression,i=this;return f=b.trip_reservations,f=c.each.call(b,f,{hash:{},inverse:i.noop,fn:i.program(1,j,e)}),f||f===0?f:""}),templates.reservations_addons=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<h3>Add Products / Rentals</h3><p class="small">Select rental and purchase items from the list to add them to this reservation. <br />To ensure accuracy in rental items cost, enter the quantity as: <b>each rental day X number of guests renting.</b></p><fieldset class="addons">',g=b.products,h=b.model,i={},i["class"]="product",j=c.select,g=j?j.call(b,h,"product_id",g,{hash:i}):k.call(b,"select",h,"product_id",g,{hash:i}),f+=l(g)+'<select name="variation" class="product-variations" style="display:none;" /><p class="field"><label>Qty.</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"quantity",{hash:h}):k.call(b,"text_field",g,"quantity",{hash:h}),f+=l(g)+'</p> <p class="add-it">  ',g=b.model,j=c.checkbox,g=j?j.call(b,g,"rental",{hash:{}}):k.call(b,"checkbox",g,"rental",{hash:{}}),f+=l(g)+'<label>Add as rental</label><span>&nbsp;</span>  <button class="create add-product">Add Item</button></p></fieldset>',f}),templates.reservations_auto_balances=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<div class="balances-due"><h5>Collect balances due:</h5><p class="radio">  <input type="radio" name="auto_collect_balances" class="custom-auto" value="2">  <label>Automatically ',g=b.model,h={},h["class"]="num balance-days",i=c.text_field,g=i?i.call(b,g,"auto_collect_days_prior",{hash:h}):j.call(b,"text_field",g,"auto_collect_days_prior",{hash:h}),f+=k(g)+' day(s) prior</label></p><p class="radio">  <input type="radio" name="auto_collect_balances" class="day-auto" value="1">  <label>Automatically on first day of the trip</label></p><p class="radio">  <input type="radio" name="auto_collect_balances" class="no-auto" value="0" checked="true">  <label>Manually</label></p></div>',f}),templates.reservations_confirmation=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<div id="confirmation">  <h3>Send Client(s) Itinerary</h3>  <p class="radio"><input type="radio" name="notify" value="1" ><label>Send itinerary and statement to <b>primary contact</b> via email</label></p>  <p class="radio"><input type="radio" name="notify" value="2" ><label>Send itinerary and statement to client via email and <b>CC all guests</b> as well</label></p>  <p class="radio"><input type="radio" name="notify" value="3" checked="true"><label><strong>Do not</strong> send anything to the guest(s)</label></p>  <p class="small">Include an optional message to the client:</p>  <fieldset>',g=b.model,h={},h.style="height:230px",h["class"]="confirm-letter",i=c.text_area,g=i?i.call(b,g,"confirmation",{hash:h}):j.call(b,"text_area",g,"confirmation",{hash:h}),f+=k(g)+"</fieldset></div>",f}),templates.reservations_contact=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression,l="function";return f+='<p class="field"><label>Full Name</label>',g=b.model,h={},h["class"]="name",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):j.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'</p><p class="view-client"><a href="#clients/edit/',g=b.model,g=g==null||g===!1?g:g.attributes,g=g==null||g===!1?g:g.client,g=g==null||g===!1?g:g.id,g=typeof g===l?g():g,f+=k(g)+'">View all client details</a></p><div id="search-results"> </div><p class="field"><label>Email Address</label>',g=b.model,h={},h.type="email",h["class"]="email",i=c.text_field,g=i?i.call(b,g,"email",{hash:h}):j.call(b,"text_field",g,"email",{hash:h}),f+=k(g)+'</p><p class="field"><label>Phone Number</label>',g=b.model,h={},h["class"]="phone",i=c.text_field,g=i?i.call(b,g,"phone",{hash:h}):j.call(b,"text_field",g,"phone",{hash:h}),f+=k(g)+"</p>",f}),templates.reservations_enter_payment=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<h3>Enter Payment</h3><p>Choose a method or <a class="swipe-msg" href="javascript:void(0)">click to swipe card</a></p>  ',g=b.payment,h={},h["class"]="swipe-focus",j=c.text_field,g=j?j.call(b,g,"swipe_focus",{hash:h}):k.call(b,"text_field",g,"swipe_focus",{hash:h}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.payment_methods,h=b.payment,i={},i.id="pay-method",j=c.select,g=j?j.call(b,h,"method",g,{hash:i}):k.call(b,"select",h,"method",g,{hash:i}),f+=l(g)+"<fieldset>  ",g=b.payment,h={},h.placeholder="Payer's Name",h["class"]="payer-name",j=c.text_field,g=j?j.call(b,g,"_name",{hash:h}):k.call(b,"text_field",g,"_name",{hash:h}),f+=l(g)+"  ",g=b.payment,h={},h.placeholder="Email Address",h["class"]="payer-email",j=c.text_field,g=j?j.call(b,g,"_email",{hash:h}):k.call(b,"text_field",g,"_email",{hash:h}),f+=l(g)+'</fieldset><fieldset class="card-info">  ',g=b.payment,h={},h.placeholder="Card Number",j=c.text_field,g=j?j.call(b,g,"number",{hash:h}):k.call(b,"text_field",g,"number",{hash:h}),f+=l(g)+'    <p class="num-field"><label>Exp. Date</label>',g=b.payment,h={},h["class"]="num",h.placeholder="mm/yy",j=c.text_field,g=j?j.call(b,g,"expires",{hash:h}):k.call(b,"text_field",g,"expires",{hash:h}),f+=l(g)+'</p>  <p class="num-field"><label>Billing Zip </label>',g=b.payment,h={},h["class"]="num zip",h.placeholder="",j=c.text_field,g=j?j.call(b,g,"_zip",{hash:h}):k.call(b,"text_field",g,"_zip",{hash:h}),f+=l(g)+'</p>  <p class="num-field"><label>CVV Code</label>',g=b.payment,h={},h["class"]="num",h.placeholder="",j=c.text_field,g=j?j.call(b,g,"cvv",{hash:h}):k.call(b,"text_field",g,"cvv",{hash:h}),f+=l(g)+'</p></fieldset><p class="field pay-field"><label>Pay Amount $</label>',g=b.model,h={},h["class"]="num amount",j=c.text_field,g=j?j.call(b,g,"amount",{hash:h}):k.call(b,"text_field",g,"amount",{hash:h}),f+=l(g)+'</p>  <button class="enter-payment create">Add Payment</button><p>',g=b.model,h={},h["class"]="add-as-guest",j=c.checkbox,g=j?j.call(b,g,"add_as_guest",{hash:h}):k.call(b,"checkbox",g,"add_as_guest",{hash:h}),f+=l(g)+"<label>Add the payer as reservation guest</label></p> ",f}),templates.reservations_guest_list=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<h3>Additional Guests</h3> <ul class="list checklist guest-list"><div class="empty"><span>No additional guests are assigned to this reservation.</span></ul> <div class="add-guests">  <p>Create or add a client record for guests:</p>  <fieldset>    ',g=b.model,h={},h.placeholder="(Guest name)",h["class"]="guest-name",i=c.text_field,g=i?i.call(b,g,"guest_name",{hash:h}):j.call(b,"text_field",g,"guest_name",{hash:h}),f+=k(g)+"    ",g=b.model,h={},h.placeholder="(Guest email)",h["class"]="guest-email",i=c.text_field,g=i?i.call(b,g,"guest_email",{hash:h}):j.call(b,"text_field",g,"guest_email",{hash:h}),f+=k(g)+'  </fieldset>  <button class="create add-guest">Add Guest</button></div>     ',f}),templates.reservations_lodge_nights=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+="<h3>Lodging Dates</h3>",g=b.lodges,h=b.model,i={},i["class"]="lodge",j=c.select,g=j?j.call(b,h,"lodge_id",g,{hash:i}):k.call(b,"select",h,"lodge_id",g,{hash:i}),f+=l(g)+'<p class="checkbox include">',g=b.model,h={},h["class"]="inc-lodge",j=c.checkbox,g=j?j.call(b,g,"inc",{hash:h}):k.call(b,"checkbox",g,"inc",{hash:h}),f+=l(g)+"<label>Include / Comp</label></p>",g=b.rooms,h=b.model,i={},i["class"]="secondary lodge-rooms",i.style="display:none;",j=c.select,g=j?j.call(b,h,"room_id",g,{hash:i}):k.call(b,"select",h,"room_id",g,{hash:i}),f+=l(g)+'<div id="lodge-calendar"><p class="small" style="padding:20px 0">Select a lodge from the menu above to view availability.</p></div>',f}),templates.reservations_lodging_item=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+="$",e=a.total,f=c.dollar,e=f?f.call(a,e,{hash:{}}):i.call(a,"dollar",e,{hash:{}}),d+=j(e),d}function n(a,b){return"(Incl./Comp.)"}c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression,k="function",l=this;f+='<li id="',h=c.id,h?g=h.call(b,{hash:{}}):(g=b.id,g=typeof g===k?g():g),f+=j(g)+'">  <div>    <span>      <b>',h=c.dates,h?g=h.call(b,{hash:{}}):(g=b.dates,g=typeof g===k?g():g),f+=j(g)+"</b>      <br />",g=b.lodge,g=g==null||g===!1?g:g.name,g=typeof g===k?g():g,f+=j(g)+": ",g=b.room,g=g==null||g===!1?g:g.type,g=typeof g===k?g():g,f+=j(g)+"</b>      <br />",h=c.party,h?g=h.call(b,{hash:{}}):(g=b.party,g=typeof g===k?g():g),f+=j(g)+" ",g=b.total,g=c["if"].call(b,g,{hash:{},inverse:l.program(3,n,e),fn:l.program(1,m,e)});if(g||g===0)f+=g;return f+='    </span>   </div>  <button class="del remove-lodge">X</button></li>',f}),templates.reservations_overview=template(function(a,b,c,d,e){function m(a,b){var d="",e;d+="  ",e=a.trip_reservations,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(2,n,b)});if(e||e===0)d+=e;return d+=" ",d}function n(a,b){var d="",e;d+="    ",e=a.merged_activities,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.programWithDepth(o,b,a)});if(e||e===0)d+=e;return d+="  ",d}function o(a,b,d){var e="",f,g;e+='        <div class="item activity">          <b>',f=a.date,g=c.date_format,f=g?g.call(a,f,"MMM Do YYYY",{hash:{}}):k.call(a,"date_format",f,"MMM Do YYYY",{hash:{}}),e+=j(f)+" ",f=a.time,f=c["if"].call(a,f,{hash:{},inverse:l.noop,fn:l.program(4,p,b)});if(f||f===0)e+=f;return e+="</b>          <em>",f=d.trip,f=f==null||f===!1?f:f.name,f=typeof f===i?f():f,e+=j(f)+" </em> with ",g=c.guide,g?f=g.call(a,{hash:{}}):(f=a.guide,f=typeof f===i?f():f),e+=j(f)+"        </div>      ",e}function p(a,b){var d="",e,f;return d+=" at ",f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e)+" ",d}function q(a,b){var d="",e,f;return d+=" at ",f=c.arrival_time,f?e=f.call(a,{hash:{}}):(e=a.arrival_time,e=typeof e===i?e():e),d+=j(e)+" ",d}function r(a,b){var d="",e,f;return d+="    <span>via ",f=c.arriving_by,f?e=f.call(a,{hash:{}}):(e=a.arriving_by,e=typeof e===i?e():e),d+=j(e)+"</span>    ",d}function s(a,b){return'      <span class="small"> (No arrival details provided.)</span>    '}function t(a,b){var d="",e;d+='  <div class="lodging check-ins">  ',e=a.lodge_reservations,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(13,u,b)});if(e||e===0)d+=e;return d+="  </div> ",d}function u(a,b){var d="",e,f;return d+='    <div class="item lodge">      <b>',e=a.check_in,f=c.date_format,e=f?f.call(a,e,"MMM Do YYYY",{hash:{}}):k.call(a,"date_format",e,"MMM Do YYYY",{hash:{}}),d+=j(e)+"</b>      <em>Check in </em> to ",e=a.lodge,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+", ",e=a.room,e=e==null||e===!1?e:e.type,e=typeof e===i?e():e,d+=j(e)+"       (",f=c.adults,f?e=f.call(a,{hash:{}}):(e=a.adults,e=typeof e===i?e():e),d+=j(e)+")    </div>    ",d}function v(a,b){var d="",e;d+="  ",e=a.lodge_reservations,e=c.each.call(a,e,{hash:{},inverse:l.noop,fn:l.program(16,w,b)});if(e||e===0)d+=e;return d+=" ",d}function w(a,b){var d="",e,f;return d+='    <div class="item lodge">      <b>',e=a.check_out,f=c.date_format,e=f?f.call(a,e,"MMM Do YYYY",{hash:{}}):k.call(a,"date_format",e,"MMM Do YYYY",{hash:{}}),d+=j(e)+"</b>      <em>Check out </em> of ",e=a.lodge,e=e==null||e===!1?e:e.name,e=typeof e===i?e():e,d+=j(e)+", ",e=a.room,e=e==null||e===!1?e:e.type,e=typeof e===i?e():e,d+=j(e)+"       (",f=c.adults,f?e=f.call(a,{hash:{}}):(e=a.adults,e=typeof e===i?e():e),d+=j(e)+")    </div>    ",d}function x(a,b){var d="",e,f;return d+=" at ",f=c.departure_time,f?e=f.call(a,{hash:{}}):(e=a.departure_time,e=typeof e===i?e():e),d+=j(e)+" ",d}function y(a,b){var d="",e,f;return d+="    <span>via ",f=c.departing_by,f?e=f.call(a,{hash:{}}):(e=a.departing_by,e=typeof e===i?e():e),d+=j(e)+"</span>    ",d}function z(a,b){return'      <span class="small"> (No departure details provided.)</span>    '}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=c.helperMissing,l=this;f+='<div class="itinerary activity"><h3>Activity Summary</h3>    ',g=b.trip_reservations,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,m,e)});if(g||g===0)f+=g;f+='</div> <div class="itinerary travel-lodge"><h3>Travel/Stay Summary</h3>  <div class="item arrive">  <b>',h=c.arrival_date,h?g=h.call(b,{hash:{}}):(g=b.arrival_date,g=typeof g===i?g():g),f+=j(g)+" ",g=b.arrival_time,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(6,q,e)});if(g||g===0)f+=g;f+="</b>  <em>Arriving</em>     ",g=b.arriving_by,g=c["if"].call(b,g,{hash:{},inverse:l.program(10,s,e),fn:l.program(8,r,e)});if(g||g===0)f+=g;f+=" </div>  ",g=b.lodge_reservations,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(12,t,e)});if(g||g===0)f+=g;f+="    ",g=b.lodge_reservations,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(15,v,e)});if(g||g===0)f+=g;f+='    <div class="item depart">  <b>',h=c.departure_date,h?g=h.call(b,{hash:{}}):(g=b.departure_date,g=typeof g===i?g():g),f+=j(g)+" ",g=b.departure_time,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(18,x,e)});if(g||g===0)f+=g;f+="</b>  <em>Departing</em>    ",g=b.departing_by,g=c["if"].call(b,g,{hash:{},inverse:l.program(22,z,e),fn:l.program(20,y,e)});if(g||g===0)f+=g;return f+=" </div></div> </div>  ",f}),templates.reservations_payment_history=template(function(a,b,c,d,e){return c=c||a.helpers,'<h3>Payment History</h3><div class="longer-headings">  <span>Amount</span>  <span>Name</span>  <span>Method</span>  <span>Date</span></div><ul class="list longer payment-list"><li><div><span class="data" style="width:80%">No payments have been made on this reservation yet.</span></div></li></ul>'}),templates.reservations_payment_info=template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression,m=this;f+='<h3>Amounts Due</h3><div class="price-wrap">  <label>Discount:</label>  ',g=b.model,h={},h["class"]="discount num",j=c.text_field,g=j?j.call(b,g,"discount",{hash:h}):k.call(b,"text_field",g,"discount",{hash:h}),f+=l(g)+'</div>  <div class="price-wrap">  <label>Total:</label>  ',g=b.model,h={},h["class"]="total num",h.disabled="true",j=c.text_field,g=j?j.call(b,g,"total",{hash:h}):k.call(b,"text_field",g,"total",{hash:h}),f+=l(g)+'</div><div class="price-wrap">  <label>Balance Due:</label>  ',g=b.model,h={},h["class"]="balance num",h.disabled="true",j=c.text_field,g=j?j.call(b,g,"balance",{hash:h}):k.call(b,"text_field",g,"balance",{hash:h}),f+=l(g)+'</div><div class="price-wrap" id="deposit">  <label>Deposit Amount:</label>  ',g=b.model,h={},h["class"]="deposit num",h.disabled="true",j=c.text_field,g=j?j.call(b,g,"deposit",{hash:h}):k.call(b,"text_field",g,"deposit",{hash:h}),f+=l(g)+'</div><br /><div class="discounts"><p class="field">',g=b.discounts,h=b.order,i={},i["class"]="promo-codes",j=c.select,g=j?j.call(b,h,"promotion_id",g,{hash:i}):k.call(b,"select",h,"promotion_id",g,{hash:i}),f+=l(g)+'</p> <div id="discount-info"></div></div>',g=b,g=m.invokePartial(d.reservations_auto_balances,"reservations_auto_balances",g,c,d);if(g||g===0)f+=g;return f+="  ",f}),templates.reservations_purchase_item=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+=", ",f=c.variation,f?e=f.call(a,{hash:{}}):(e=a.variation,e=typeof e===i?e():e),d+=j(e),d}function n(a,b){return" (Rental) "}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<li id="',h=c.id,h?g=h.call(b,{hash:{}}):(g=b.id,g=typeof g===i?g():g),f+=j(g)+'"> <div>  <span>    <b>',h=c.name,h?g=h.call(b,{hash:{}}):(g=b.name,g=typeof g===i?g():g),f+=j(g)+"</b>",g=b.variation,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;g=b.rental,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(3,n,e)});if(g||g===0)f+=g;return f+="    <br />",h=c.quantity,h?g=h.call(b,{hash:{}}):(g=b.quantity,g=typeof g===i?g():g),f+=j(g)+" @ $",g=b.price,h=c.dollar,g=h?h.call(b,g,{hash:{}}):l.call(b,"dollar",g,{hash:{}}),f+=j(g)+'  </span> </div> <button class="del remove-product">X</button></li>',f}),templates.reservations_summary=template(function(a,b,c,d,e){return c=c||a.helpers,'<h3>Reservation Summary</h3><h5>Lodging:</h5><ul class="list checklist lodge-list">  <li><div class="empty"><p class="small">No lodging selected.<p></div></li></ul><h5>Activities:</h5><ul class="list checklist trip-list">  <li><div class="empty"><p class="small">No trips selected.<p></div></li></ul><h5>Products:</h5><ul class="list checklist product-list"></ul>'}),templates.reservations_trip_dates=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+="<h3>Trip / Activity Dates</h3>",g=b.trips,h=b.model,i={},i["class"]="trip",j=c.select,g=j?j.call(b,h,"trip_id",g,{hash:i}):k.call(b,"select",h,"trip_id",g,{hash:i}),f+=l(g)+'<p class="checkbox include">',g=b.model,h={},h["class"]="inc-trip",j=c.checkbox,g=j?j.call(b,g,"inc",{hash:h}):k.call(b,"checkbox",g,"inc",{hash:h}),f+=l(g)+"<label>Include / Comp</label></p>",g=b.trips,h=b.model,i={},i["class"]="secondary trip-times",i.style="display:none;",j=c.select,g=j?j.call(b,h,"start_time",g,{hash:i}):k.call(b,"select",h,"start_time",g,{hash:i}),f+=l(g)+'<div id="trip-calendar"><p class="small" style="padding:20px 0">Select a trip above to view availability.</p></div>  ',f}),templates.reservations_trip_item=template(function(a,b,c,d,e){function m(a,b){var d,e;return d=a.start_time,e=c.twenty_four_to_twelve,d=e?e.call(a,d,{hash:{}}):i.call(a,"twenty_four_to_twelve",d,{hash:{}}),j(d)}function n(a,b){var d="",e,f;return d+="$",e=a.total,f=c.dollar,e=f?f.call(a,e,{hash:{}}):i.call(a,"dollar",e,{hash:{}}),d+=j(e),d}function o(a,b){return"(Incl./Comp.)"}c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression,k="function",l=this;f+='<li id="',h=c.id,h?g=h.call(b,{hash:{}}):(g=b.id,g=typeof g===k?g():g),f+=j(g)+'">  <div>    <span>      <b>',h=c.dates,h?g=h.call(b,{hash:{}}):(g=b.dates,g=typeof g===k?g():g),f+=j(g)+" ",g=b.start_time,g=c["if"].call(b,g,{hash:{},inverse:l.noop,fn:l.program(1,m,e)});if(g||g===0)f+=g;f+="</b>      <br />",h=c.name,h?g=h.call(b,{hash:{}}):(g=b.name,g=typeof g===k?g():g),f+=j(g)+"</b>      <br />",h=c.party,h?g=h.call(b,{hash:{}}):(g=b.party,g=typeof g===k?g():g),f+=j(g)+" ",g=b.total,g=c["if"].call(b,g,{hash:{},inverse:l.program(5,o,e),fn:l.program(3,n,e)});if(g||g===0)f+=g;return f+='    </span>   </div>  <button class="del remove-trip">X</button></li>',f}),templates["reservations/approval_list"]=template(function(a,b,c,d,e){function l(a,b){var d="",e,f;return d+="(",f=c.count,f?e=f.call(a,{hash:{}}):(e=a.count,e=typeof e===h?e():e),d+=i(e)+")",d}function m(a,b){var d="",e;d+=' <p>The following reservations require your attention:</p><ul class="list reservation-list">  ',e=a.reservations,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(4,n,b)});if(e||e===0)d+=e;return d+="</ul>",d}function n(a,b){var d="",e,f;d+='    <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===h?e():e),d+=i(e)+'">      <div class="edit">        <span class="dates">',f=c.dates,f?e=f.call(a,{hash:{}}):(e=a.dates,e=typeof e===h?e():e),d+=i(e)+'</span>         <span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===h?e():e),d+=i(e)+" (",f=c.party,f?e=f.call(a,{hash:{}}):(e=a.party,e=typeof e===h?e():e),d+=i(e)+')</span>        <span class="balance',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.noop,fn:k.program(5,o,b)});if(e||e===0)d+=e;d+='">',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.program(9,q,b),fn:k.program(7,p,b)});if(e||e===0)d+=e;return d+='</span>\t\t\t\t<span class="trip">',f=c.trip,f?e=f.call(a,{hash:{}}):(e=a.trip,e=typeof e===h?e():e),d+=i(e)+"</span>      </div>    </li> ",d}function o(a,b){return" due"}function p(a,b){var d="",e,f;return d+="Balance Due: $",e=a.balance_due,f=c.dollar,e=f?f.call(a,e,{hash:{}}):j.call(a,"dollar",e,{hash:{}}),d+=i(e),d}function q(a,b){return"PAID IN FULL."}function r(a,b){return"<p>There are no reservations waiting for approval at this time.</p> "}function s(a,b){var d="",e;d+='<ul class="list reservation-list">  ',e=a.hold,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(14,t,b)});if(e||e===0)d+=e;return d+="</ul>",d}function t(a,b){var d="",e,f;d+='    <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===h?e():e),d+=i(e)+'">      <div class="edit">        <span class="dates">',f=c.dates,f?e=f.call(a,{hash:{}}):(e=a.dates,e=typeof e===h?e():e),d+=i(e)+'</span>         <span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===h?e():e),d+=i(e)+" (",f=c.party,f?e=f.call(a,{hash:{}}):(e=a.party,e=typeof e===h?e():e),d+=i(e)+')</span>        <span class="balance',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.noop,fn:k.program(15,u,b)});if(e||e===0)d+=e;d+='">',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.program(19,w,b),fn:k.program(17,v,b)});if(e||e===0)d+=e;return d+='</span>\t\t\t\t<span class="trip">',f=c.trip,f?e=f.call(a,{hash:{}}):(e=a.trip,e=typeof e===h?e():e),d+=i(e)+"</span>      </div>    </li> ",d}function u(a,b){return" due"}function v(a,b){var d="",e,f;return d+="Balance Due: $",e=a.balance_due,f=c.dollar,e=f?f.call(a,e,{hash:{}}):j.call(a,"dollar",e,{hash:{}}),d+=i(e),d}function w(a,b){return"PAID IN FULL."}function x(a,b){return"<p>There are no reservations on hold at this time.</p>"}c=c||a.helpers;var f="",g,h="function",i=this.escapeExpression,j=c.helperMissing,k=this;f+="<h1>Awaiting Final Approval ",g=b.count,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,l,e)});if(g||g===0)f+=g;f+="</h1>",g=b.reservations,g=c["if"].call(b,g,{hash:{},inverse:k.program(11,r,e),fn:k.program(3,m,e)});if(g||g===0)f+=g;f+="<br /><h3>Reservations On Hold</h3>",g=b.hold,g=c["if"].call(b,g,{hash:{},inverse:k.program(21,x,e),fn:k.program(13,s,e)});if(g||g===0)f+=g;return f+="<br /><br />",f}),templates["reservations/balances_due"]=template(function(a,b,c,d,e){function l(a,b){var d="",e;d+=' <p>These reservations have payments due:</p><ul class="list reservation-list">  ',e=a.reservations,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(2,m,b)});if(e||e===0)d+=e;return d+="</ul>",d}function m(a,b){var d="",e,f;d+='    <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===j?e():e),d+=i(e)+'">      <div class="edit">        <span class="dates">',f=c.dates,f?e=f.call(a,{hash:{}}):(e=a.dates,e=typeof e===j?e():e),d+=i(e)+'</span>         <span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===j?e():e),d+=i(e)+" (",f=c.party,f?e=f.call(a,{hash:{}}):(e=a.party,e=typeof e===j?e():e),d+=i(e)+')</span>        <span class="balance',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.noop,fn:k.program(3,n,b)});if(e||e===0)d+=e;d+='">',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.program(7,p,b),fn:k.program(5,o,b)});if(e||e===0)d+=e;return d+='</span>\t\t\t\t<span class="trip">',f=c.trip,f?e=f.call(a,{hash:{}}):(e=a.trip,e=typeof e===j?e():e),d+=i(e)+"</span>      </div>    </li> ",d}function n(a,b){return" due"}function o(a,b){var d="",e,f;return d+="Balance Due: $",e=a.balance_due,f=c.dollar,e=f?f.call(a,e,{hash:{}}):h.call(a,"dollar",e,{hash:{}}),d+=i(e),d}function p(a,b){return"PAID IN FULL."}function q(a,b){return"<p>There are no pending reservations at this time.</p> "}c=c||a.helpers;var f="",g,h=c.helperMissing,i=this.escapeExpression,j="function",k=this;f+="<h1>Balances Due</h1>",g=b.reservations,g=c["if"].call(b,g,{hash:{},inverse:k.program(9,q,e),fn:k.program(1,l,e)});if(g||g===0)f+=g;return f+="<br />",f}),templates["reservations/form"]=template(function(a,b,c,d,e){function o(a,b){var d="",e,f;return d+="  <h1>",f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===k?e():e),d+=l(e)+' (<span class="heads">',f=c.head_count,f?e=f.call(a,{hash:{}}):(e=a.head_count,e=typeof e===k?e():e),d+=l(e)+"</span>)</h1><br /><br />",d}function p(a,b){var d="",e;d+="  <h1>Start a new reservation ",e=a.start_date,e=c["if"].call(a,e,{hash:{},inverse:n.noop,fn:n.program(4,q,b)});if(e||e===0)d+=e;return d+="</h1><br /><br />",d}function q(a,b){var d="",e,f;return d+="on ",e=a.start_date,f=c.sql_to_slash,e=f?f.call(a,e,{hash:{}}):m.call(a,"sql_to_slash",e,{hash:{}}),d+=l(e),d}function r(a,b){var d="",e,f;return d+=" <li>",e={},e["class"]="tab current",f=c.link_nohref,e=f?f.call(a,"Overview",{hash:e}):m.call(a,"link_nohref","Overview",{hash:e}),d+=l(e)+"</li> <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Activity",{hash:e}):m.call(a,"link_nohref","Activity",{hash:e}),d+=l(e)+"</li>",d}function s(a,b){var d="",e,f;return d+="  <li>",e={},e["class"]="tab current",f=c.link_nohref,e=f?f.call(a,"Activity",{hash:e}):m.call(a,"link_nohref","Activity",{hash:e}),d+=l(e)+"</li>",d}function t(a,b){var d="",e,f;return d+="  <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Lodging",{hash:e}):m.call(a,"link_nohref","Lodging",{hash:e}),d+=l(e)+"</li>",d}function u(a,b){var d="",e,f;return d+="  <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Add-Ons",{hash:e}):m.call(a,"link_nohref","Add-Ons",{hash:e}),d+=l(e)+"</li>",d}function v(a,b){var d="",e,f;return d+=" <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Invoice",{hash:e}):m.call(a,"link_nohref","Invoice",{hash:e}),d+=l(e)+"</li>",d}function w(a,b){var d="",e,f;return d+=" <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Payments",{hash:e}):m.call(a,"link_nohref","Payments",{hash:e}),d+=l(e)+"</li>",d}function x(a,b){var d="",e,f,g;d+='<div class="tab overview"> <div class="left">   <h3>Actions</h3>   ',e=a.status,g=c.eq,e=g?g.call(a,e,"3",{hash:{},inverse:n.program(21,z,b),fn:n.program(19,y,b)}):m.call(a,"eq",e,"3",{hash:{},inverse:n.program(21,z,b),fn:n.program(19,y,b)});if(e||e===0)d+=e;d+="\t ",e=a.status,g=c.eq,e=g?g.call(a,e,"4",{hash:{},inverse:n.program(25,B,b),fn:n.program(23,A,b)}):m.call(a,"eq",e,"4",{hash:{},inverse:n.program(25,B,b),fn:n.program(23,A,b)});if(e||e===0)d+=e;d+='\t \t <button class="action del cancel-reservation">Cancel</button>\t <p class="checkbox">',e=a.model,f={},f["class"]="notify-guides",g=c.checkbox,e=g?g.call(a,e,"notify-guides",{hash:f}):m.call(a,"checkbox",e,"notify-guides",{hash:f}),d+=l(e)+"<label>Notify assigned guides</label></p>\t <p>Total amount:<br /> <b>$",e=a.total,g=c.dollar,e=g?g.call(a,e,{hash:{}}):m.call(a,"dollar",e,{hash:{}}),d+=l(e)+"</b></p>\t ",e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:n.program(29,D,b),fn:n.program(27,C,b)});if(e||e===0)d+=e;return d+=' </div><div class="right">   <div id="overview"></div> </div>      </div>  ',d}function y(a,b){return"    <p>This reservation is <strong>approved.</strong></p>   "}function z(a,b){return'    \t  <button class="action approve">Approve</button>\t '}function A(a,b){return"    <p>This reservation is <strong>on hold</strong>.</p>   "}function B(a,b){return'    \t  <button class="action hold">Place On Hold</button>\t '}function C(a,b){var d="",e,f;return d+="\t  <p>Balance due:<br /> <b>$",e=a.balance_due,f=c.dollar,e=f?f.call(a,e,{hash:{}}):m.call(a,"dollar",e,{hash:{}}),d+=l(e)+"</b></p>\t ",d}function D(a,b){return"\t  <p><b>PAID IN FULL</b></p>\t "}function E(a,b){var d="",e,f,g,h;return d+='   <h3>Stay</h3>   <p class="num-field"><label>Nights</label>',e=a.peoples,f=a.model,g={},g["class"]="stay-length",h=c.select,e=h?h.call(a,f,"nights",e,{hash:g}):m.call(a,"select",f,"nights",e,{hash:g}),d+=l(e)+"</p>   ",d}function F(a,b){var e="",f,g,h;e+='   <div class="tab reservation lodging">  <div class="party">   <h3>Party</h3>   <p class="num-field"><label>Adults</label>',f=a.peoples,g=a.model,h=c.select,f=h?h.call(a,g,"adults",f,{hash:{}}):m.call(a,"select",g,"adults",f,{hash:{}}),e+=l(f)+'</p>   <p class="num-field"><label>Children</label>',f=a.peoples,g=a.model,h=c.select,f=h?h.call(a,g,"children",f,{hash:{}}):m.call(a,"select",g,"children",f,{hash:{}}),e+=l(f)+'</p>   <p class="num-field"><label>Seniors</label>',f=a.peoples,g=a.model,h=c.select,f=h?h.call(a,g,"seniors",f,{hash:{}}):m.call(a,"select",g,"seniors",f,{hash:{}}),e+=l(f)+"</p>   ",f=a.lodges,f=c["if"].call(a,f,{hash:{},inverse:n.noop,fn:n.program(34,G,b)});if(f||f===0)e+=f;e+=' </div>    <div class="left">    ',f=a,f=n.invokePartial(d.reservations_lodge_nights,"reservations_lodge_nights",f,c,d);if(f||f===0)e+=f;return e+=' </div> <div class="right">   <h3>Lodging Summary</h3>  <p class="error small lodge-warn"></p>    <ul class="list checklist lodge-list">    <li><div><p class="small">Select number of guests, stay length and date(s) to add to this reservation.<p></div></li>  </ul> </div> <br /></div>  ',e}function G(a,b){var d="",e,f,g,h;return d+='   <h3>Stay</h3>   <p class="num-field"><label>Nights</label>',e=a.peoples,f=a.model,g={},g["class"]="stay-length",h=c.select,e=h?h.call(a,f,"nights",e,{hash:g}):m.call(a,"select",f,"nights",e,{hash:g}),d+=l(e)+"</p>   ",d}function H(a,b){var d="",e;d+=' <div class="tab"> <div class="right">      ',e=a.products,e=c["if"].call(a,e,{hash:{},inverse:n.noop,fn:n.program(37,I,b)});if(e||e===0)d+=e;return d+=' </div> <div class="left purchase-summary no-edit">  <h3>Purchased Summary</h3>  <ul class="list checklist product-list"></ul> </div>      </div>',d}function I(a,b){var e="",f;e+="    ",f=a,f=n.invokePartial(d.reservations_addons,"reservations_addons",f,c,d);if(f||f===0)e+=f;return e+="  ",e}function J(a,b){return'<div class="buttons-right"> <button class="done">Save Changes</button> <button class="cancel">Cancel</button></div> '}function K(a,b){return'<div class="buttons-right">  <button class="next-step continue">Save &amp; Continue</button><br />  <a href="javascript:void(0);" class="cancel">or cancel</a></div>  '}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j,k="function",l=this.escapeExpression,m=c.helperMissing,n=this;f+='<form class="" onsubmit="return false"><button class="dummy"></button>',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:n.program(3,p,e),fn:n.program(1,o,e)});if(g||g===0)f+=g;f+='  <ul class="tabs">',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:n.program(8,s,e),fn:n.program(6,r,e)});if(g||g===0)f+=g;f+=" ",g=b.lodges,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(10,t,e)});if(g||g===0)f+=g;g=b.products,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(12,u,e)});if(g||g===0)f+=g;g=b.id,g=c["if"].call(b,g,{hash:{},inverse:n.program(16,w,e),fn:n.program(14,v,e)});if(g||g===0)f+=g;f+=" <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Client Info",{hash:g}):m.call(b,"link_nohref","Client Info",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Travel Info",{hash:g}):m.call(b,"link_nohref","Travel Info",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Confirm / Admin",{hash:g}):m.call(b,"link_nohref","Confirm / Admin",{hash:g}),f+=l(g)+'</li></ul><div class="tabshell">',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(18,x,e)});if(g||g===0)f+=g;f+='  <div class="tab reservation activity"> <div class="party">   <h3>Party</h3>   <p class="num-field"><label>Adults</label>',g=b.peoples,h=b.model,j=c.select,g=j?j.call(b,h,"adults",g,{hash:{}}):m.call(b,"select",h,"adults",g,{hash:{}}),f+=l(g)+'</p>   <p class="num-field"><label>Children</label>',g=b.peoples,h=b.model,j=c.select,g=j?j.call(b,h,"children",g,{hash:{}}):m.call(b,"select",h,"children",g,{hash:{}}),f+=l(g)+'</p>   <p class="num-field"><label>Seniors</label>',g=b.peoples,h=b.model,j=c.select,g=j?j.call(b,h,"seniors",g,{hash:{}}):m.call(b,"select",h,"seniors",g,{hash:{}}),f+=l(g)+"</p>   ",g=b.lodges,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(31,E,e)});if(g||g===0)f+=g;f+=' </div>    <div class="left">    ',g=b,g=n.invokePartial(d.reservations_trip_dates,"reservations_trip_dates",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="right">  <h3>Activity Summary</h3>  <ul class="list checklist trip-list">    <li><div><p class="small">Select the party size and trip and date(s) to add to this reservation.<p></div></li>  </ul>   </div> <br /></div> ',g=b.lodges,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(33,F,e)});if(g||g===0)f+=g;f+="  ",g=b.products,g=c["if"].call(b,g,{hash:{},inverse:n.noop,fn:n.program(36,H,e)});if(g||g===0)f+=g;f+='<div class="tab wider-right payments"> <div class="left payment">  ',g=b,g=n.invokePartial(d.reservations_enter_payment,"reservations_enter_payment",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="right">   ',g=b,g=n.invokePartial(d.reservations_payment_history,"reservations_payment_history",g,c,d);if(g||g===0)f+=g;f+="   <br />   ",g=b,g=n.invokePartial(d.reservations_payment_info,"reservations_payment_info",g,c,d);if(g||g===0)f+=g;f+=' </div>      </div> <div class="tab client-info"> <div class="left">   <h3>Primary Contact</h3>   ',g=b,g=n.invokePartial(d.reservations_contact,"reservations_contact",g,c,d);if(g||g===0)f+=g;f+="   <br />   <h3>Physical Address (optional)</h3>   ",g=b,g=n.invokePartial(d.address_fields,"address_fields",g,c,d);if(g||g===0)f+=g;f+=' </div>     <div class="right">   ',g=b,g=n.invokePartial(d.reservations_guest_list,"reservations_guest_list",g,c,d);if(g||g===0)f+=g;f+='    </div>   </div>  <div class="tab three-column schedule">  <div class="left">  <h3>Arrival Date &amp; Time</h3>  <div id="arrive-cal"></div>  <p class="at">AT:</p>  <div class="adder">',g=b.model,g=g==null||g===!1?g:g.hours,h=b.model,i={},i["class"]="hrs",j=c.select,g=j?j.call(b,h,"arrive_hr",g,{hash:i}):m.call(b,"select",h,"arrive_hr",g,{hash:i}),f+=l(g)+":",g=b.model,g=g==null||g===!1?g:g.minutes,h=b.model,i={},i["class"]="mins",j=c.select,g=j?j.call(b,h,"arrive_min",g,{hash:i}):m.call(b,"select",h,"arrive_min",g,{hash:i}),f+=l(g)+'</div> </div> <div class="center">  <h3>Departure Date &amp; Time</h3>  <div id="depart-cal"></div>  <p class="at">AT:</p>  <div class="adder">',g=b.model,g=g==null||g===!1?g:g.hours,h=b.model,i={},i["class"]="hrs",j=c.select,g=j?j.call(b,h,"depart_hr",g,{hash:i}):m.call(b,"select",h,"depart_hr",g,{hash:i}),f+=l(g)+":",g=b.model,g=g==null||g===!1?g:g.minutes,h=b.model,i={},i["class"]="mins",j=c.select,g=j?j.call(b,h,"depart_min",g,{hash:i}):m.call(b,"select",h,"depart_min",g,{hash:i}),f+=l(g)+'</div> </div> <div class="right">  <h3>Flights / Notes</h3>    <p>How is the party arriving?</p>    <fieldset>    ',g=b.model,h={},h["class"]="short",j=c.text_area,g=j?j.call(b,g,"arriving_by",{hash:h}):m.call(b,"text_area",g,"arriving_by",{hash:h}),f+=l(g)+"    <p>How is the party leaving?</p>    ",g=b.model,h={},h["class"]="short",j=c.text_area,g=j?j.call(b,g,"departing_by",{hash:h}):m.call(b,"text_area",g,"departing_by",{hash:h}),f+=l(g)+'    </fieldset> </div></div>           <div class="tab wider-left"> <div class="left purchase-summary no-edit">    ',g=b,g=n.invokePartial(d.reservations_confirmation,"reservations_confirmation",g,c,d);if(g||g===0)f+=g;f+='  </div> <div class="right">  <h3>Administration</h3>  <p><label>Who is taking/managing this reservation?</label></p>  ',g=b.staff,h=b.model,j=c.select,g=j?j.call(b,h,"entered_by",g,{hash:{}}):m.call(b,"select",h,"entered_by",g,{hash:{}}),f+=l(g)+"<br />     <p><label>Current Reservation Status:</label>  ",g=b.model,g=g==null||g===!1?g:g.statuses,h=b.model,j=c.select,g=j?j.call(b,h,"status",g,{hash:{}}):m.call(b,"select",h,"status",g,{hash:{}}),f+=l(g)+"  <h3>Private Notes</h3>  <fieldset>",g=b.model,h={},h.style="height:100px",j=c.text_area,g=j?j.call(b,g,"notes",{hash:h}):m.call(b,"text_area",g,"notes",{hash:h}),f+=l(g)+'</fieldset>  </div>  </div>   <!-- admin <div class="tab wider-right"> <div class="left">    </div> <div class="right">    </div>    </div>   --></div>',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:n.program(41,K,e),fn:n.program(39,J,e)});if(g||g===0)f+=g;return f+="<br /><br /></form>  ",f}),templates["reservations/manifest"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+=" at ",f=c.time,f?e=f.call(a,{hash:{}}):(e=a.time,e=typeof e===i?e():e),d+=j(e),d}function n(a,b){var d="",e,f;d+='<ul class="list group" data-number="',f=c.number,f?e=f.call(a,{hash:{}}):(e=a.number,e=typeof e===i?e():e),d+=j(e)+'">  <li class="guide ',e=a.guide,e=e==null||e===!1?e:e.id,e=typeof e===i?e():e,d+=j(e)+'"><div>',e=a.guide,e=e==null||e===!1?e:e.nickname,e=typeof e===i?e():e,d+=j(e)+"</div></li>   ",e=a.reservations,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(4,o,b)});if(e||e===0)d+=e;d+="   ",e=a.available,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(7,q,b)});if(e||e===0)d+=e;return d+="</ul>",d}function o(a,b){var d="",e;d+="     ",e=a.clients,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(5,p,b)});if(e||e===0)d+=e;return d+="   ",d}function p(a,b){var d="",e,f;return d+='       <li class="client" id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'" data-activity="',f=c.activity_id,f?e=f.call(a,{hash:{}}):(e=a.activity_id,e=typeof e===i?e():e),d+=j(e)+'"><div>',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+"</div></li>     ",d}function q(a,b){return'    <li class="available"><div>Empty Seat</div></li>   '}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<form class="" onsubmit="return false"><button class="dummy"></button><h1>',g=b.trip,g=g==null||g===!1?g:g.name,g=typeof g===i?g():g,f+=j(g)+" Manifest: ",g=b.date,h=c.sql_to_slash,g=h?h.call(b,g,{hash:{}}):l.call(b,"sql_to_slash",g,{hash:{}}),f+=j(g)+" ",g=b.time,g=c["if"].call(b,g,{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;f+='</h1><br /><br /><p>Drag and drop clients to adjust their exact grouping for the day.</p><div class="manifest">',g=b.program,g=g==null||g===!1?g:g.schedule,h=c.break_list,g=h?h.call(b,g,4,{hash:{},inverse:k.noop,fn:k.program(3,n,e)}):l.call(b,"break_list",g,4,{hash:{},inverse:k.noop,fn:k.program(3,n,e)});if(g||g===0)f+=g;return f+='</div>  <br /><br />&nbsp;<div class="buttons-left"> <button class="done">Save Changes</button> <button class="cancel">Cancel</button></div> </form>',f}),templates["reservations/search_results"]=template(function(a,b,c,d,e){function l(a,b){var d="",e;d+=' <ul class="list reservation-list">  ',e=a.reservations,e=c.each.call(a,e,{hash:{},inverse:k.noop,fn:k.program(2,m,b)});if(e||e===0)d+=e;return d+="</ul>",d}function m(a,b){var d="",e,f;d+='    <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===j?e():e),d+=i(e)+'">      <div class="edit">        <span class="dates">',f=c.dates,f?e=f.call(a,{hash:{}}):(e=a.dates,e=typeof e===j?e():e),d+=i(e)+'</span>         <span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===j?e():e),d+=i(e)+" (",f=c.party,f?e=f.call(a,{hash:{}}):(e=a.party,e=typeof e===j?e():e),d+=i(e)+')</span>        <span class="balance',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.noop,fn:k.program(3,n,b)});if(e||e===0)d+=e;d+='">',e=a.balance_due,e=c["if"].call(a,e,{hash:{},inverse:k.program(7,p,b),fn:k.program(5,o,b)});if(e||e===0)d+=e;return d+='</span>\t\t\t\t<span class="trip">',f=c.trip,f?e=f.call(a,{hash:{}}):(e=a.trip,e=typeof e===j?e():e),d+=i(e)+"</span>      </div>    </li> ",d}function n(a,b){return" due"}function o(a,b){var d="",e,f;return d+="Balance Due: $",e=a.balance_due,f=c.dollar,e=f?f.call(a,e,{hash:{}}):h.call(a,"dollar",e,{hash:{}}),d+=i(e),d}function p(a,b){return"PAID IN FULL."}function q(a,b){return"<p>You search returned no results.</p> "}c=c||a.helpers;var f="",g,h=c.helperMissing,i=this.escapeExpression,j="function",k=this;f+="<h1>Search Results</h1>",g=b.reservations,g=c["if"].call(b,g,{hash:{},inverse:k.program(9,q,e),fn:k.program(1,l,e)});if(g||g===0)f+=g;return f+="<br />",f}),templates.trips_capacity=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<h3>Group Size &amp; Capacity</h3><p class="field"><label>Group Size (per Guide)</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"group_size",{hash:h}):j.call(b,"text_field",g,"group_size",{hash:h}),f+=k(g)+'</p><p class="field"><label>Max. Trip Capacity</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"capacity",{hash:h}):j.call(b,"text_field",g,"capacity",{hash:h}),f+=k(g)+'</p><p class="checkbox">',g=b.model,i=c.checkbox,g=i?i.call(b,g,"capacity_only",{hash:{}}):j.call(b,"checkbox",g,"capacity_only",{hash:{}}),f+=k(g)+"<label>Book this trip to capacity</label></p>",f}),templates.trips_deposit_rules=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i=c.helperMissing,j=this.escapeExpression;return f+='<h3>Deposit Rules</h3><div class="headings">  <span>Days Prior</span>  <span>% Due</span></div><ul class="list" id="deposits"></ul>  <div class="add-fields deposits"> ',g=b.model,h=c.text_field,g=h?h.call(b,g,"days_prior",{hash:{}}):i.call(b,"text_field",g,"days_prior",{hash:{}}),f+=j(g)+" ",g=b.model,h=c.text_field,g=h?h.call(b,g,"percent_due",{hash:{}}):i.call(b,"text_field",g,"percent_due",{hash:{}}),f+=j(g)+'</div><button class="add-to add-deposit-rule">Add Deposit Rule</button><br /><!-- deposit rules help <div class="deposit-help tip"><p class="small">Deposit rules allow you to specify a percent(%) to collect under the condition they are booking before the date you set.</p></div>-->',f}),templates.trips_fees=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<h3>Taxes &amp; Fees</h3><div class="longer-headings">    <span class="long">Description</span>    <span class="short">% Fee</span>    <span class="short">Flat Fee $</span>  </div>  <ul class="list longer sortable" id="fees"></ul>  <div class="longer-add-fields add-fees">   ',g=b.model,h={},h["class"]="long",i=c.text_field,g=i?i.call(b,g,"fee_name",{hash:h}):j.call(b,"text_field",g,"fee_name",{hash:h}),f+=k(g)+"   ",g=b.model,h={},h["class"]="short",i=c.text_field,g=i?i.call(b,g,"percent",{hash:h}):j.call(b,"text_field",g,"percent",{hash:h}),f+=k(g)+"   ",g=b.model,h={},h["class"]="short",i=c.text_field,g=i?i.call(b,g,"flat",{hash:h}):j.call(b,"text_field",g,"flat",{hash:h}),f+=k(g)+'  </div><button class="add-to add-fee">Add Fee / Tax</button>    ',f}),templates.trips_price=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=c.helperMissing;return f+='<li id="',h=c.id,h?g=h.call(b,{hash:{}}):(g=b.id,g=typeof g===i?g():g),f+=j(g)+'">  <div>   <span>',h=c.people,h?g=h.call(b,{hash:{}}):(g=b.people,g=typeof g===i?g():g),f+=j(g)+"</span>   <span>$",g=b.price,h=c.dollar,g=h?h.call(b,g,{hash:{}}):k.call(b,"dollar",g,{hash:{}}),f+=j(g)+'</span>   <span class="long">',g=b.start_date,h=c.date_format,g=h?h.call(b,g,"MMM [  ] Do [  ] YYYY",{hash:{}}):k.call(b,"date_format",g,"MMM [  ] Do [  ] YYYY",{hash:{}}),f+=j(g)+"</span>   <span>",g=b.end_date,h=c.date_format,g=h?h.call(b,g,"MMM  [  ] Do [  ] YYYY",{hash:{}}):k.call(b,"date_format",g,"MMM  [  ] Do [  ] YYYY",{hash:{}}),f+=j(g)+'</span>  </div> <button class="del remove-price-point">Delete</buton></li>',f}),templates.trips_pricing=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression;return f+='<h3>Pricing</h3><div class="headings"> <span>People</span> <span>$ / Person</span> <span class="long">Start Date</span> <span>End Date</span></div><ul class="list" id="prices"></ul>  <div class="add-fields"> ',g=b.model,j=c.text_field,g=j?j.call(b,g,"people",{hash:{}}):k.call(b,"text_field",g,"people",{hash:{}}),f+=l(g)+" ",g=b.model,j=c.text_field,g=j?j.call(b,g,"price",{hash:{}}):k.call(b,"text_field",g,"price",{hash:{}}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.months,h=b.model,i={},i["class"]="mo",j=c.select,g=j?j.call(b,h,"start_month",g,{hash:i}):k.call(b,"select",h,"start_month",g,{hash:i}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.days,h=b.model,i={},i["class"]="dt",j=c.select,g=j?j.call(b,h,"start_dt",g,{hash:i}):k.call(b,"select",h,"start_dt",g,{hash:i}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.years,h=b.model,i={},i["class"]="yr",j=c.select,g=j?j.call(b,h,"start_year",g,{hash:i}):k.call(b,"select",h,"start_year",g,{hash:i}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.months,h=b.model,i={},i["class"]="mo",j=c.select,g=j?j.call(b,h,"end_month",g,{hash:i}):k.call(b,"select",h,"end_month",g,{hash:i}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.days,h=b.model,i={},i["class"]="dt",j=c.select,g=j?j.call(b,h,"end_dt",g,{hash:i}):k.call(b,"select",h,"end_dt",g,{hash:i}),f+=l(g)+"  ",g=b.model,g=g==null||g===!1?g:g.years,h=b.model,i={},i["class"]="yr",j=c.select,g=j?j.call(b,h,"end_year",g,{hash:i}):k.call(b,"select",h,"end_year",g,{hash:i}),f+=l(g)+'  <p class="checkbox nodates">',g=b.model,h={},h["class"]="nope",j=c.checkbox,g=j?j.call(b,g,"nodates",{hash:h}):k.call(b,"checkbox",g,"nodates",{hash:h}),f+=l(g)+'<label>Apply date restrictions</label></p>  </div><br /><button class="add-to add-price-point">Add New Price</button><div class="pricing-help tip"><p class="small">This feature allows you to create price points for your trip. For single and double occupancy, create a price for 1 and 2 people. To create a group discount, enter the group size and a price for that number of people. If you leave pricing blank, clients will be able to book without having to pay first.</p></div>\t',f}),templates.trips_rates=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<h3>Special Rates</h3><p class="field"><label>Child Rate (12-)</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"child_rate",{hash:h}):j.call(b,"text_field",g,"child_rate",{hash:h}),f+=k(g)+'</p><p class="field"><label>Senior Rate (65+)</label>',g=b.model,h={},h["class"]="num",i=c.text_field,g=i?i.call(b,g,"senior_rate",{hash:h}):j.call(b,"text_field",g,"senior_rate",{hash:h}),f+=k(g)+'</p><!--<div class="tip"><p class="small">TAX: Entering a tax amount will cause the tax to show up as a line item on purchases and receipts. <b>If you do not want to show taxes, build the tax into your trip pricing.</b></p><p class="small">OVERHEAD: Enter the amount this trip costs you per person. <strong>Do not factor in lodging and meals</strong> as they are accounted for separately.</p>\t</div>-->',f}),templates["trips/create"]=template(function(a,b,c,d,e){c=c||a.helpers;var f="",g,h,i,j=c.helperMissing,k=this.escapeExpression;return f+='<form class="trip" onsubmit="return false"><h1>Add a new activity, trip or package</h1><fieldset><p class="step"><span>1</span> <strong>What do you call this activity or trip?</strong> &nbsp; Be descriptive, but not too long!</p> ',g=b.model,h={},h.placeholder="(2hr Waterfall Hike, Half Day Surf Lesson, 5 Day Heli Ski Package etc.)",i=c.text_field,g=i?i.call(b,g,"name",{hash:h}):j.call(b,"text_field",g,"name",{hash:h}),f+=k(g)+'<br /><p class="step"><span>2</span> <strong>Where is the trip or activity located?</strong> &nbsp; This can be a river, national park, city, town or an address, state or country.</p> ',g=b.model,h={},h.placeholder="(Deschutes River, Grand Canyon, Swiss Alps, North Shore Hawaii, etc.)",i=c.text_field,g=i?i.call(b,g,"location",{hash:h}):j.call(b,"text_field",g,"location",{hash:h}),f+=k(g)+'<p class="step"><span>3</span> Is this <strong>part of your activities schedule</strong> or is it a <strong>inclusive package?</strong> &nbsp;Not sure? <a href="javascript:void(0)">Learn more...</a></p> <div class="trip-type" id="activity">  <input type="radio" name="package" value="0" checked="true" />  <label for="admin">Scheduled Activity</label>  <p>This is an activity or event which I need to see on the calendar so I can schedule reservations and guides</p> </div> <div class="trip-type" id="package">  <input type="radio" name="package" value="1" />  <label for="admin">Inclusive Package</label>  <p>This is a trip package that includes lodging or shares availability with other trips and/or activities.</p> </div>  <br /><!--<p class="step"><span>3</span> <strong>How do you schedule this tour?</strong> I want to take reservations on:</p> ',g=b.model,g=g==null||g===!1?g:g.scheduling,h=b.model,i=c.select,g=i?i.call(b,h,"scheduled",g,{hash:{}}):j.call(b,"select",h,"scheduled",g,{hash:{}}),f+=k(g)+'</fieldset><p>Which would should I choose?</p><p class="small"><strong>Flexible Dates</strong> allows clients &amp; staff to reserve this trip on any date that is not blacked out, is not booked to capacity and least one guide is available. <strong>Scheduled Dates</strong> will allow clients &amp; staff to reserve this trip only on specific dates which have been scheduled on your FLyBOOK calendar.</p><br />--></fieldset><div class="buttons-right"> <button class="save continue">Save &amp; Continue</button><br /> <a href="javascript:void(0)" class="cancel">or cancel</a></div></form>',f}),templates["trips/edit"]=template(function(a,b,c,d,e){function o(a,b){return'<button class="cancel">Cancel</button>  <button class="done">Done</button>  '}function p(a,b){var d="",e,f;return d+=" <li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Guides",{hash:e}):k.call(a,"link_nohref","Guides",{hash:e}),d+=l(e)+"</li>",d}function q(a,b){var d="",e,f,g;d+="  <fieldset>   ",e=a.activities,f=a.model,g=c.select,e=g?g.call(a,f,"activity_id",e,{hash:{}}):k.call(a,"select",f,"activity_id",e,{hash:{}}),d+=l(e)+'    <p class="checkbox">',e=a.model,g=c.checkbox,e=g?g.call(a,e,"activities_scheduled",{hash:{}}):k.call(a,"checkbox",e,"activities_scheduled",{hash:{}}),d+=l(e)+"<label>Schedule daily activities manually</label></p>  ",e=a.lodges,e=c["if"].call(a,e,{hash:{},inverse:m.noop,fn:m.program(6,r,b)});if(e||e===0)d+=e;return d+="    </fieldset> ",d}function r(a,b){var d="",e,f,g;return d+="   <h3>Package Lodging</h3>   ",e=a.lodges,f=a.model,g=c.select,e=g?g.call(a,f,"lodge_id",e,{hash:{}}):k.call(a,"select",f,"lodge_id",e,{hash:{}}),d+=l(e)+'   <p class="field"><label>Nights Included</label>',e=a.model,f={},f["class"]="num",g=c.text_field,e=g?g.call(a,e,"lodging_nights",{hash:f}):k.call(a,"text_field",e,"lodging_nights",{hash:f}),d+=l(e)+'</p>   <p class="checkbox">',e=a.model,g=c.checkbox,e=g?g.call(a,e,"arrive_night_prior",{hash:{}}):k.call(a,"checkbox",e,"arrive_night_prior",{hash:{}}),d+=l(e)+'<label>Guests arrive night before first day</label></p>   <p class="checkbox">',e=a.model,g=c.checkbox,e=g?g.call(a,e,"active_last_day",{hash:{}}):k.call(a,"checkbox",e,"active_last_day",{hash:{}}),d+=l(e)+"<label>Guests participate on check-out day</label></p>  ",d}function s(a,b){return' <p class="small">You have indicated this is an activity. If you would like to make it a package, you can do so in settings. Finish editing this trip and return to this section to see package options here.</p> '}function t(a,b){var d="",e,f;d+='\t\t\t<ol class="list sortable checklist" id="guides">\t\t\t\t',e=a.guides,f=c.list,e=f?f.call(a,e,"No guides or staff members have been added to your account. Don't worry, we can do this later.",{hash:{},inverse:m.noop,fn:m.programWithDepth(u,b,a)}):k.call(a,"list",e,"No guides or staff members have been added to your account. Don't worry, we can do this later.",{hash:{},inverse:m.noop,fn:m.programWithDepth(u,b,a)});if(e||e===0)d+=e;return d+="\t\t\t</ol>\t\t",d}function u(a,b,d){var e="",f,g,h;return e+='\t\t\t\t <li id="',h=c.id,h?f=h.call(a,{hash:{}}):(f=a.id,f=typeof f===n?f():f),e+=l(f)+'"><div>',f=a.id,g=d.model,h=c.checkbox,f=h?h.call(a,g,f,{hash:{}}):k.call(a,"checkbox",g,f,{hash:{}}),e+=l(f)+"<span>",h=c.nickname,h?f=h.call(a,{hash:{}}):(f=a.nickname,f=typeof f===n?f():f),e+=l(f)+"</span></div></li>  \t\t\t\t",e}function v(a,b){return'    <p class="small">This is a package and will not display on your activity schedule.</p>    <p class="radio"><input type="radio" name="package" value="1" checked="true" ><label>Keep this as a package</label></p>    <p class="radio"><input type="radio" name="package" value="0" ><label>Change to scheduled activity</label></p>   '}function w(a,b){var d="",e,f,g;return d+="         ",e=a.model,e=e==null||e===!1?e:e.colors,f=a.model,g=c.select,e=g?g.call(a,f,"color",e,{hash:{}}):k.call(a,"select",f,"color",e,{hash:{}}),d+=l(e)+'          <p class="radio"><input type="radio" name="package" value="0" checked="true" ><label>Keep this on the calendar</label></p>    <p class="radio"><input type="radio" name="package" value="1" ><label>Change to a package</label></p>    ',d}function x(a,b){var d="",e;d+='\t<p class="small">Select which documents you want to attach to the confirmation email</p>\t',e=a.account,e=e==null||e===!1?e:e.documents,e=c.each.call(a,e,{hash:{},inverse:m.noop,fn:m.program(18,y,b)});if(e||e===0)d+=e;return d+="\t",d}function y(a,b){var d="",e,f;return d+='\t<p class="checkbox"><input type="checkbox" value="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===n?e():e),d+=l(e)+'" name="frms" class="frm"><label>',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===n?e():e),d+=l(e)+"</label></p>\t",d}function z(a,b){return'\t<p class="small">When you upload documents such as waivers, information packets, or other paper forms you can configure these settings to automatically attach documents to your confirmation email.</p>\t'}function A(a,b){return" "}function B(a,b){return'<div class="buttons-right"> <button class="next-step continue">Continue Setup</button><br /> <a href="javascript:void(0)" class="done">or save and make changes later</a></div>'}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression,m=this,n="function";f+='<form class="trip" onsubmit="return false"><button class="dummy"></button>',g=b.setup_complete,g=c["if"].call(b,g,{hash:{},inverse:m.noop,fn:m.program(1,o,e)});if(g||g===0)f+=g;g=b.model,h={},h["class"]="title",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):k.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+'<ul class="tabs"> <li>',g={},g["class"]="tab current",j=c.link_nohref,g=j?j.call(b,"Details",{hash:g}):k.call(b,"link_nohref","Details",{hash:g}),f+=l(g)+"</li>   <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Availability",{hash:g}):k.call(b,"link_nohref","Availability",{hash:g}),f+=l(g)+"</li>",g=b.guides,g=c["if"].call(b,g,{hash:{},inverse:m.noop,fn:m.program(3,p,e)});if(g||g===0)f+=g;f+="   <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Pricing",{hash:g}):k.call(b,"link_nohref","Pricing",{hash:g}),f+=l(g)+"</li> <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Fees &amp; Taxes",{hash:g}):k.call(b,"link_nohref","Fees &amp; Taxes",{hash:g}),f+=l(g)+"</li> <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Photos &amp; Location",{hash:g}):k.call(b,"link_nohref","Photos &amp; Location",{hash:g}),f+=l(g)+"</li> <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Settings",{hash:g}):k.call(b,"link_nohref","Settings",{hash:g}),f+=l(g)+"</li> <li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Confirm",{hash:g}):k.call(b,"link_nohref","Confirm",{hash:g}),f+=l(g)+'</li></ul>  <div class="tabshell">  <div class="tab wider-right"> <div class="left">  <h3>Activity Duration</h3>  <p class="field"><label>Trip Length (days)</label>',g=b.model,h={},h["class"]="num",j=c.text_field,g=j?j.call(b,g,"duration",{hash:h}):k.call(b,"text_field",g,"duration",{hash:h}),f+=l(g)+'</p>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"require_same_guide",{hash:{}}):k.call(b,"checkbox",g,"require_same_guide",{hash:{}}),f+=l(g)+"<label>Require same guide for this duration</label></p> <h3>PACKAGE ACTIVITY</h3>  ",g=b["package"],g=c["if"].call(b,g,{hash:{},inverse:m.program(8,s,e),fn:m.program(5,q,e)});if(g||g===0)f+=g;f+='   </div> <div class="right" id="trip-includes">\t<h3>Description</h3>\t<fieldset>  <p class="small">This will be included along with the location and photos on <a href="http://',g=b.account,g=g==null||g===!1?g:g.flybook_url,g=typeof g===n?g():g,f+=l(g)+'.theflybook.com/" target="blank">your booking website</a></p>  ',g=b.model,h={},h.style="height:340px",j=c.text_area,g=j?j.call(b,g,"description",{hash:h}):k.call(b,"text_area",g,"description",{hash:h}),f+=l(g)+'\t</fieldset></div></div> <div class="tab wider-right"> <div class="left">\t',g=b,g=m.invokePartial(d.trips_capacity,"trips_capacity",g,c,d);if(g||g===0)f+=g;f+='\t<h3>Season</h3>\t<p class="small">If this trip happens seasonally specify the start and end dates here.</p>\t<fieldset class="season">\t<label>Opens</label>  \t',g=b.model,g=g==null||g===!1?g:g.months,h=b.model,j=c.select,g=j?j.call(b,h,"season_start_month",g,{hash:{}}):k.call(b,"select",h,"season_start_month",g,{hash:{}}),f+=l(g),g=b.model,g=g==null||g===!1?g:g.days,h=b.model,j=c.select,g=j?j.call(b,h,"season_start_date",g,{hash:{}}):k.call(b,"select",h,"season_start_date",g,{hash:{}}),f+=l(g)+"  <label>Closes</label>   ",g=b.model,g=g==null||g===!1?g:g.months,h=b.model,j=c.select,g=j?j.call(b,h,"season_end_month",g,{hash:{}}):k.call(b,"select",h,"season_end_month",g,{hash:{}}),f+=l(g),g=b.model,g=g==null||g===!1?g:g.days,h=b.model,j=c.select,g=j?j.call(b,h,"season_end_date",g,{hash:{}}):k.call(b,"select",h,"season_end_date",g,{hash:{}}),f+=l(g)+'  </field> </div> <div class="right">\t <h3>Trip Schedule</h3>\t  <p class="small"><strong>Select the first day of the week or specific dates this trip can start.</strong> If clients arrive the night before the trip starts, the first day of activity is the day you should select.</p> \t  ',g=b,g=m.invokePartial(d.weekday_calendar,"weekday_calendar",g,c,d);if(g||g===0)f+=g;f+='\t\t<h3>Start Times (Optional)</h3>\t\t<div id="start-times">\t\t <p></p>\t\t <div class="adder">',g=b.model,g=g==null||g===!1?g:g.hours,h=b.model,i={},i["class"]="hrs",j=c.select,g=j?j.call(b,h,"h",g,{hash:i}):k.call(b,"select",h,"h",g,{hash:i}),f+=l(g)+":",g=b.model,g=g==null||g===!1?g:g.minutes,h=b.model,i={},i["class"]="mins",j=c.select,g=j?j.call(b,h,"m",g,{hash:i}):k.call(b,"select",h,"m",g,{hash:i}),f+=l(g)+'<button class="newtime">+</button></div>  \t </div> </div>\t\t</div><div class="tab"><div class="left">\t<h3>Guiding Order</h3>\t \t\t',g=b.guides,g=c["if"].call(b,g,{hash:{},inverse:m.noop,fn:m.program(10,t,e)});if(g||g===0)f+=g;f+='  </div> <div class="right">\t<h3>Assistants/Tail Guides</h3> \t</div>\t</div>  <div class="tab wider-left trip-pricing"> <div class="left">   ',g=b,g=m.invokePartial(d.trips_pricing,"trips_pricing",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="right">\t    ',g=b,g=m.invokePartial(d.trips_rates,"trips_rates",g,c,d);if(g||g===0)f+=g;f+="    ",g=b,g=m.invokePartial(d.trips_deposit_rules,"trips_deposit_rules",g,c,d);if(g||g===0)f+=g;f+=' </div>  </div> <div class="tab wider-left"> <div class="left">   ',g=b,g=m.invokePartial(d.trips_fees,"trips_fees",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="right">   <h3>About Fees</h3>   <div class="tip"><p class="small">We allow you to flexibly create any fee structure you want to add to any of your trips and lodging.      <br /><br />In exchange, we require that you abide by all federal and state laws <b>in addition to Flybook policy</b>. It is against our rules to charge     a client for any federal or state permit fees you pay (where applicable), or explicitly state any "Flybook", "Online Booking" fees.</p>    </div> </div>      </div>  <div class="tab wider-right"> ',g=b,g=m.invokePartial(d.progress_bar,"progress_bar",g,c,d);if(g||g===0)f+=g;f+='   <div class="left photos">  ',g=b,g=m.invokePartial(d.photos,"photos",g,c,d);if(g||g===0)f+=g;f+=' </div>      <div class="right map">  ',g=b,g=m.invokePartial(d.location,"location",g,c,d);if(g||g===0)f+=g;f+=' </div>   </div>  \t<div class="tab three-column"> <div class="left">  <h3>Publish Settings</h3>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"active",{hash:{}}):k.call(b,"checkbox",g,"active",{hash:{}}),f+=l(g)+'<label>This is an active trip</label></p>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"web_active",{hash:{}}):k.call(b,"checkbox",g,"web_active",{hash:{}}),f+=l(g)+'<label>Allow online reservations to be made</label></p>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"published",{hash:{}}):k.call(b,"checkbox",g,"published",{hash:{}}),f+=l(g)+'<label>Publish this trip to the <a href="http://www.guideoutdoornetwork.com" target="_blank">gone.</a> network</label></p>\t\t<h5>When booking online...</h5>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"allow_time_select",{hash:{}}):k.call(b,"checkbox",g,"allow_time_select",{hash:{}}),f+=l(g)+'<label>Allow clients to select start time</label></p>\t<p class="checkbox">',g=b.model,j=c.checkbox,g=j?j.call(b,g,"allow_guide_req",{hash:{}}):k.call(b,"checkbox",g,"allow_guide_req",{hash:{}}),f+=l(g)+'<label>Allow clients to request a guide</label></p> </div> <div class="center">   <h3>Balance Collection</h3>\t <h5>Collect balances due</h5>  \t<p class="radio">      <input type="radio" name="auto_collect_balances" class="custom-auto" value="2">      <label>Automatically ',g=b.model,h={},h["class"]="num balance-days",j=c.text_field,g=j?j.call(b,g,"auto_collect_days_prior",{hash:h}):k.call(b,"text_field",g,"auto_collect_days_prior",{hash:h}),f+=l(g)+' day(s) prior</label>    </p>    <p class="radio">      <input type="radio" name="auto_collect_balances" class="day-auto" value="1">      <label>Automatically on first day of the trip</label>    </p>    <p class="radio">      <input type="radio" name="auto_collect_balances" class="no-auto" value="0">      <label>Manually</label>    </p>\t </div> <div class="right">   <h3>Calendar Display</h3>   ',g=b["package"],g=c["if"].call(b,g,{hash:{},inverse:m.program(15,w,e),fn:m.program(13,v,e)});if(g||g===0)f+=g;f+='      </div>\t</div><div class="tab wider-right"> <div class="left">\t<h3>Documents</h3>\t',g=b.account,g=g==null||g===!1?g:g.documents,g=c["if"].call(b,g,{hash:{},inverse:m.program(20,z,e),fn:m.program(17,x,e)});if(g||g===0)f+=g;f+='   </div> <div class="right">  <h3>Confirmation Letter</h3>   <p>The confirmation letter is sent to clients when you confirm their reservation.</p>  <fieldset> \t',g=b.model,j=c.text_area,g=j?j.call(b,g,"confirmation_letter",{hash:{}}):k.call(b,"text_area",g,"confirmation_letter",{hash:{}}),f+=l(g)+"\t</fielset> </div></div>\t</div>",g=b.setup_complete,g=c["if"].call(b,g,{hash:{},inverse:m.program(24,B,e),fn:m.program(22,A,e)});if(g||g===0)f+=g;return f+="</form>  ",f}),templates["trips/help"]=template(function(a,b,c,d,e){function i(a,b){return'<button class="close cancel">Close</button>'}function j(a,b){return'<button class="create">Add Activity</button>'}c=c||a.helpers;var f="",g,h=this;f+="<h1>Help: Activities &amp; Trips</h1>",g=b.help,g=c["if"].call(b,g,{hash:{},inverse:h.program(3,j,e),fn:h.program(1,i,e)});if(g||g===0)f+=g;return f+='<p>Whether you guide month long expeditions to the north pole or run several small tours per day (or both!)   this is how you create availability.</p><p>Video here..</p><p class="small">Still need more help? <a href="mailto:support@theflybook.com">Contact FlyBook Support</a></p>',f}),templates["trips/list"]=template(function(a,b,c,d,e){function m(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li> ',d}function n(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li> ',d}function o(a,b){var d="",e,f;return d+='  <li id="',f=c.id,f?e=f.call(a,{hash:{}}):(e=a.id,e=typeof e===i?e():e),d+=j(e)+'"><div class="edit"><span class="name">',f=c.name,f?e=f.call(a,{hash:{}}):(e=a.name,e=typeof e===i?e():e),d+=j(e)+'</span></div><button class="delete">delete</button></li> ',d}c=c||a.helpers;var f="",g,h,i="function",j=this.escapeExpression,k=this,l=c.helperMissing;f+='<h1>Activities &amp; Trips</h1><button class="help">Help</button><button class="create">New Activity</button><h3>Activities &amp; Trips</h3><ol id="trips" class="list sortable"> ',g=b.active,h=c.list,g=h?h.call(b,g,"No active trips or activities at the moment",{hash:{},inverse:k.noop,fn:k.program(1,m,e)}):l.call(b,"list",g,"No active trips or activities at the moment",{hash:{},inverse:k.noop,fn:k.program(1,m,e)});if(g||g===0)f+=g;f+='</ol><br /><h3>Packages</h3><ol id="trips" class="list sortable"> ',g=b.packages,h=c.list,g=h?h.call(b,g,"No packages or multi-day trips at the moment",{hash:{},inverse:k.noop,fn:k.program(3,n,e)}):l.call(b,"list",g,"No packages or multi-day trips at the moment",{hash:{},inverse:k.noop,fn:k.program(3,n,e)});if(g||g===0)f+=g;f+='</ol><br /><h3>Inactive Trips</h3><ol id="inative-trips" class="list sortable"> ',g=b.inactive,h=c.list,g=h?h.call(b,g,"No inactive trips, activities or packages at the moment",{hash:{},inverse:k.noop,fn:k.program(5,o,e)}):l.call(b,"list",g,"No inactive trips, activities or packages at the moment",{hash:{},inverse:k.noop,fn:k.program(5,o,e)});if(g||g===0)f+=g;return f+="</ol>",f}),templates["trips/schedule"]=template(function(a,b,c,d,e){function o(a,b){var d="",e,f;return d+="<li>",e={},e["class"]="tab current",f=c.link_nohref,e=f?f.call(a,"Bookings",{hash:e}):k.call(a,"link_nohref","Bookings",{hash:e}),d+=l(e)+"</li><li>",e={},e["class"]="tab",f=c.link_nohref,e=f?f.call(a,"Schedule &amp; Capacity",{hash:e}):k.call(a,"link_nohref","Schedule &amp; Capacity",{hash:e}),d+=l(e)+"</li>",d}function p(a,b){var d="",e,f;return d+="<li>",e={},e["class"]="tab current",f=c.link_nohref,e=f?f.call(a,"Schedule &amp; Capacity",{hash:e}):k.call(a,"link_nohref","Schedule &amp; Capacity",{hash:e}),d+=l(e)+"</li>",d}function q(a,b){var d="",e;d+='<div class="tab"> <div class="left">   <h3>Book A Client</h3>   <fieldset>        </fieldset>  </div> <div class="right">  <h3>Reservations</h3>  ',e=a.reservations,e=c["if"].call(a,e,{hash:{},inverse:m.program(8,s,b),fn:m.program(6,r,b)});if(e||e===0)d+=e;return d+="   </div>      </div>",d}function r(a,b){return"    "}function s(a,b){return'    <p>Currently no one has made reservations for this trip.</p>    <button class="trip-cancel del">Cancel This Trip</button>  '}function t(a,b,d){var e="",f,g,h;e+='    <li id="',h=c.id,h?f=h.call(a,{hash:{}}):(f=a.id,f=typeof f===n?f():f),e+=l(f)+'"><div>',f=a.id,g=d.model,h=c.checkbox,f=h?h.call(a,g,f,{hash:{}}):k.call(a,"checkbox",g,f,{hash:{}}),e+=l(f)+" <span ",f=a.is_available,f=c["if"].call(a,f,{hash:{},inverse:m.program(13,v,b),fn:m.program(11,u,b)});if(f||f===0)e+=f;return e+=">",h=c.nickname,h?f=h.call(a,{hash:{}}):(f=a.nickname,f=typeof f===n?f():f),e+=l(f)+"</span></div></li>     ",e}function u(a,b){return" "}function v(a,b){return'style="color:#cc0000;"'}function w(a,b,d){var e="",f,g,h;e+='    <li id="',h=c.id,h?f=h.call(a,{hash:{}}):(f=a.id,f=typeof f===n?f():f),e+=l(f)+'"><div>',f=a.id,g=d.model,h=c.checkbox,f=h?h.call(a,g,f,{hash:{}}):k.call(a,"checkbox",g,f,{hash:{}}),e+=l(f)+" <span ",f=a.is_available,f=c["if"].call(a,f,{hash:{},inverse:m.program(18,y,b),fn:m.program(16,x,b)});if(f||f===0)e+=f;return e+=">",h=c.nickname,h?f=h.call(a,{hash:{}}):(f=a.nickname,f=typeof f===n?f():f),e+=l(f)+"</span></div></li>     ",e}function x(a,b){return" "}function y(a,b){return'style="color:#cc0000;"'}c=c||a.helpers,d=d||a.partials;var f="",g,h,i,j,k=c.helperMissing,l=this.escapeExpression,m=this,n="function";f+='<form class="trip-schedule" onsubmit="return false"><fieldset>',g=b.model,h={},h["class"]="title",j=c.text_field,g=j?j.call(b,g,"name",{hash:h}):k.call(b,"text_field",g,"name",{hash:h}),f+=l(g)+'</fieldset><ul class="tabs">',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:m.program(3,p,e),fn:m.program(1,o,e)});if(g||g===0)f+=g;f+="<li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Guides &amp; Staff",{hash:g}):k.call(b,"link_nohref","Guides &amp; Staff",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Specific Pricing",{hash:g}):k.call(b,"link_nohref","Specific Pricing",{hash:g}),f+=l(g)+"</li><li>",g={},g["class"]="tab",j=c.link_nohref,g=j?j.call(b,"Notes",{hash:g}):k.call(b,"link_nohref","Notes",{hash:g}),f+=l(g)+'</li></ul>  <div class="tabshell">',g=b.id,g=c["if"].call(b,g,{hash:{},inverse:m.noop,fn:m.program(5,q,e)});if(g||g===0)f+=g;f+='<div class="tab three-column schedule"> <div class="left">  <h3>Start Date &amp; Time</h3>  <div id="start-cal"></div>  <p class="at">AT:</p>  <div class="adder">',g=b.model,g=g==null||g===!1?g:g.hours,h=b.model,i={},i["class"]="hrs",j=c.select,g=j?j.call(b,h,"start_hr",g,{hash:i}):k.call(b,"select",h,"start_hr",g,{hash:i}),f+=l(g)+":",g=b.model,g=g==null||g===!1?g:g.minutes,h=b.model,i={},i["class"]="mins",j=c.select,g=j?j.call(b,h,"start_min",g,{hash:i}):k.call(b,"select",h,"start_min",g,{hash:i}),f+=l(g)+'</div> </div> <div class="center">  <h3>End Date &amp; Time</h3>  <div id="end-cal"></div>  <p class="at">AT:</p>  <div class="adder">',g=b.model,g=g==null||g===!1?g:g.hours,h=b.model,i={},i["class"]="hrs",j=c.select,g=j?j.call(b,h,"end_hr",g,{hash:i}):k.call(b,"select",h,"end_hr",g,{hash:i}),f+=l(g)+":",g=b.model,g=g==null||g===!1?g:g.minutes,h=b.model,i={},i["class"]="mins",j=c.select,g=j?j.call(b,h,"end_min",g,{hash:i}):k.call(b,"select",h,"end_min",g,{hash:i}),f+=l(g)+'</div> </div> <div class="right">  ',g=b,g=m.invokePartial(d.trips_capacity,"trips_capacity",g,c,d);if(g||g===0)f+=g;f+=' </div></div>  <div class="tab"> <p class="small">&nbsp;&nbsp;Guides and staff members listed in <em style="color:#CC0000;background-color:#FFF">red</em> have at least one day blacked out in the range you selected.</p>   <div class="left">  <h3>Assign Guides</h3>  <ol class="list sortable checklist" id="guides">   ',g=b.staff,j=c.filtered_list,g=j?j.call(b,g,"role","guide,staff,manager","No active guides, managers or staff right now.",{hash:{},inverse:m.noop,fn:m.programWithDepth(t,e,b)}):k.call(b,"filtered_list",g,"role","guide,staff,manager","No active guides, managers or staff right now.",{hash:{},inverse:m.noop,fn:m.programWithDepth(t,e,b)});if(g||g===0)f+=g;f+='  </ol> </div> <div class="col right">  <h3>Assign Assistants</h3>  <ol class="list checklist" id="assistants">   ',g=b.staff,j=c.filtered_list,g=j?j.call(b,g,"role","assistant","No assistants available.",{hash:{},inverse:m.noop,fn:m.programWithDepth(w,e,b)}):k.call(b,"filtered_list",g,"role","assistant","No assistants available.",{hash:{},inverse:m.noop,fn:m.programWithDepth(w,e,b)});if(g||g===0)f+=g;f+='  </ol> </div>  </div><div class="tab three-column"> <div class="left">   ',g=b,g=m.invokePartial(d.trips_pricing,"trips_pricing",g,c,d);if(g||g===0)f+=g;f+=' </div> <div class="center">  ',g=b,g=m.invokePartial(d.trips_deposit_rules,"trips_deposit_rules",g,c,d);if(g||g===0)f+=g;f+=' </div>   <div class="right">   ',g=b,g=m.invokePartial(d.trips_rates,"trips_rates",g,c,d);if(g||g===0)f+=g;return f+=' </div>  </div> <div class="tab"><h3>Private Account / Sales Notes</h3><fieldset>',g=b.model,j=c.text_area,g=j?j.call(b,g,"notes",{hash:{}}):k.call(b,"text_area",g,"notes",{hash:{}}),f+=l(g)+'</fieldset></div>  </div><div class="buttons-left"> <button class="done">Save Changes</button> <button class="cancel">Cancel</button></div><br /><br /></form> ',f}),collections={},controllers={},flybook={},models={},views={},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},collections.Accounts=function(){function a(){this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/accounts/",a.prototype.comparator=function(a){return a.get("company")},a.prototype.search=function(a,b){var c,d=this;return b==null&&(b="company"),a===""?this.models:(c=[],a=a.toLowerCase(),_.each(this.models,function(d){var e;e=d.get(b).toLowerCase();if(e.indexOf(a)>=0)return c.push(d)}),c)},a}(),collections.Activities=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Collection),a.prototype.url="/api/activities/",a}(),collections.Clients=function(){function a(){this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/clients/",a.prototype.comparator=function(a){return a.get("name")},a.prototype.search=function(a,b){var c,d=this;return b==null&&(b="name"),c=[],a=a.toLowerCase(),_.each(this.models,function(d){b=d.get(b).toLowerCase();if(b.indexOf(a)>=0)return c.push(d)}),c},a}(),collections.Employees=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/employees/",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),collections.Lodges=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/lodging/",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),collections.Orders=function(){function a(){this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/orders/",a.prototype.comparator=function(a){return+Date.parse(a.get("arriving_on"))*1e3},a.prototype.search=function(a,b){var c,d=this;return b==null&&(b="name"),a===""?this.models:(c=[],a=a.toLowerCase(),_.each(this.models,function(d){var e;e=d.get(b).toLowerCase();if(e.indexOf(a)>=0)return c.push(d)}),c)},a}(),collections.Pages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/pages",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),collections.Products=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/products/",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),collections.Reservations=function(){function a(){this.update_activity=__bind(this.update_activity,this),this.delete_order_reservations=__bind(this.delete_order_reservations,this),this.remove_reservation=__bind(this.remove_reservation,this),this.cleanup=__bind(this.cleanup,this),this.update=__bind(this.update,this),this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/reservations/",a.prototype.comparator=function(a){return a.get("created_on").toString()},a.prototype.search=function(a,b){var c,d=this;return b==null&&(b="name"),c=[],a=a.toLowerCase(),_.each(this.models,function(d){var e;e=d.get(b).toLowerCase();if(e.indexOf(a)>=0)return c.push(d)}),c},a.prototype.update=function(a){var b=this;return _.each(this.models,function(b){if(!b.get("order")||b.get("order_id")===a.get("id"))return b.set("order",a.attributes)})},a.prototype.cleanup=function(a){var b=this;return _.each(this.models,function(a){if(!a.get("order"))return b.remove(a)})},a.prototype.remove_reservation=function(a){var b=this;return _.each(this.models,function(c){if(c.get("id")===a)return b.remove(c)})},a.prototype.delete_order_reservations=function(a){var b=this;return _.each(this.models,function(c){if(c.get("order").id===a)return b.remove(c)})},a.prototype.update_activity=function(a,b,c){var d,e=this;return d=!1,_.each(this.models,function(f){var g,h,i,j,k;f=f.attributes;if(f.activities){j=f.activities,k=[];for(h=0,i=j.length;h<i;h++)g=j[h],g.id===a?(g.group_number=b,f.start_date=c,g.date=c,d={activity:g,reservation:f},k.push(e.trigger("updated:activity",d))):k.push(void 0);return k}})},a}(),collections.DataStores=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/stores",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),collections.Trips=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.url="/api/trips/",a.prototype.comparator=function(a){return+a.get("sort_order")},a}(),controllers.Accounts=function(){function a(){this.switch_account=__bind(this.switch_account,this),this.make_admin_account=__bind(this.make_admin_account,this),this.search=__bind(this.search,this),this.update=__bind(this.update,this),this.edit=__bind(this.edit,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={accounts:"main","accounts/gone":"gone","accounts/switch/:id/":"switch_account","statements/admin":"statements"},a.prototype.template_list="accounts/list",a.prototype.template_create="accounts/create",a.prototype.template_edit="accounts/edit",a.prototype.model="Account",a.prototype.collection="Accounts",a.prototype.form="AccountForm",a.prototype.form_el="#dropdown",a.prototype.messages={created:"New account for {{company}} has been created.",saved:"Changes to {{company}} have been saved.",delete_warn:"You are about to delete {{company}}, proceed?"},a.prototype.contents=[{id:"_accounts",href:"#accounts",title:"All Accounts"},{id:"_gone",href:"#accounts/gone",title:"gone. Signups"},{id:"_staements",href:"#statements/admin",title:"Statements"}],a.prototype.main=function(){var a=this;return $("title").html("Accounts | Flybook"),app.helpers.check_role(app.user,"super")?(this.setup("accounts"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"})}),app.helpers.loader("#app"),this.fetch(function(b){return a.list.render(a.template_list,{accounts:b.models,title:"All Accounts"})}),$("#app").css({left:"-450px",width:"450px"})):(app.notifications.error("You do not have permissions to administer flybook accounts"),!1)},a.prototype.gone=function(){var a=this;return this.setup("gone"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"})}),app.helpers.loader("#app"),this.fetch(function(b){var c;return c=b.where({status:"gone_signup"}),a.list.render(a.template_list,{accounts:c,title:"Gone Signups"})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.edit=function(a){var b=this;return this.fetch(function(c){return b.get(a,function(a){return app.helpers.get_countries_and_states(function(){return b.form.render(b.template_edit,{countries:app.countries,states:app.states},a),b.form.on("created:admin",b.make_admin_account)})})})},a.prototype.update=function(){var a;return this.query?(a=this.list.collection.search(this.query),this.list.render(!1,{accounts:a})):this.list.render(!1,{accounts:this.list.collection.models})},a.prototype.search=function(a){var b;return this.query=a,b=this.list.collection.search(this.query),this.list.render(!1,{accounts:b,title:"Search Results"})},a.prototype.make_admin_account=function(a){var b=this;return app.sync.ajax("/api/accounts/_make_admin/",{data:a.toJSON(),type:"POST",success:function(c,d){return c.user?(app.notifications.notify("Administrator account created for "+a.get("company")+". An email has been sent to "+a.get("email")),b.edit(c.account_id,!0)):app.notifications.error(c.error)},error:function(a){return app.notifications.error(a.statusText)}})},a.prototype.switch_account=function(a){var b=this;return app.helpers.cookie("event_sources",!1),app.sync.ajax("/api/users/_switch_account/",{data:{to:a},type:"POST",success:function(a,b){return a.switched?window.location="/":app.notifications.error("Sorry, you do not have permission to use this account.")}})},a.prototype.setup=function(a){return app.undelegate(),this.delegate(),app.navigation.select(!1),app.sidebar.render({contents:this.contents,title:"Flybook Admin",search:"Search Accounts"}).show().select(a),app.sidebar.on("search",this.search)},a}(),controllers.Application=function(){function a(){this.undelegate=__bind(this.undelegate,this),this.register=__bind(this.register,this),this.update=__bind(this.update,this),this.login=__bind(this.login,this),this.authenticate=__bind(this.authenticate,this),this.main=__bind(this.main,this),this.initialize=__bind(this.initialize,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Router),a.prototype.initialize=function(){return this.isMobile=navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/),this.isOnline=navigator.onLine,this.sync=new Flint.Sync,this.notifications=new Flint.Notifications(this),this.helpers=new views.Helpers,this.controllers=[],this.accounts=new controllers.Accounts(this),this.settings=new controllers.Settings(this),this.employees=new controllers.Employees(this),this.trips=new controllers.Trips(this),this.lodging=new controllers.Lodging(this),this.products=new controllers.Products(this),this.forms=new controllers.Forms(this),this.preferences=new controllers.Preferences(this),this.pages=new controllers.Pages(this),this.dashboard=new controllers.Dashboard(this),this.reports=new controllers.Reports(this),this.clients=new controllers.Clients(this),this.calendar=new controllers.Calendar(this),this.reservations=new controllers.Reservations(this),this.navigation=new views.Navigation(this),this.sidebar=new views.NavigationSidebar(this),this.dropdown=new views.Dropdown(this),this.user=new models.User,this.date=new Date,this.helpers.cookie("month")?(this.month=this.helpers.cookie("month"),this.year=this.helpers.cookie("year"),this.focus_day=this.helpers.cookie("day")):(this.month=this.date.getMonth(),this.helpers.cookie("month",this.month),this.year=this.date.getFullYear(),this.helpers.cookie("year",this.year),this.focus_day=this.date.getDate(),this.helpers.cookie("day",this.focus_day)),this},a.prototype.main=function(){return this.reserved=new collections.Reservations,this.reserved.model=models.Reservation,this.activities=new collections.Activities,this.authenticate(function(){return Backbone.history.start(),this.update_timer=window.setTimeout(this.update,15e3)})},a.prototype.authenticate=function(a){var b=this;return this.callback=a?a:function(){},this.user.fetch({success:function(a){return b.trigger("refresh",b,b.user),a.get("token")&&a.get("authenticated")?(b.user=a,b.callback()):(Backbone.history.stop(),b.undelegate(),b.user||(b.user=new models.User),b.loginView=new views.Login({model:b.user}))},error:function(){return b.user.get("authorized")&&(b.notifications.notify("Sorry, the server is currently unavailable to authentciate you. Please try again soon."),b.trigger("timeout",b.user)),b.undelegate(),b.user||(b.user=new models.User),b.loginView=new views.Login({model:b.user})}})},a.prototype.login=function(a){var b=this;return this.notifications.dismiss(),this.user.fetch({data:a,success:function(a){return a.get("token")&&a.get("authenticated")?(b.loginView.done().undelegateEvents(),delete b.loginView,b.trigger("login",b.user),b.update_timer=window.setTimeout(b.update,15e3),Backbone.history.start()):(b.loginView.failed("Invalid username or password."),Backbone.history.stop())},error:function(){return b.loginView.failed("Could not connect to the server."),Backbone.history.stop()}})},a.prototype.logout=function(){var a=this;return Backbone.history.stop(),this.trigger("logout",this.user),this.user.fetch({data:{logout:!0},success:function(){return app.notifications.notify("You are now logged out."),window.clearTimeout(a.update_timer),a.undelegate(),a.loginView=new views.Login({model:a.user})}})},a.prototype.update=function(){var a=this;return window.clearTimeout(this.update_timer),this.user.fetch({success:function(b){if(b.get("token")&&b.get("authenticated"))return a.user=b,a.trigger("update",a,a.user),a.update_timer=window.setTimeout(a.update,6e4);if(a.user)return Backbone.history.stop(),a.trigger("logout",a.user),app.notifications.notify("You are logged out of the network. Please sign in again to continue."),a.undelegate(),a.loginView=new views.Login({model:a.user})}})},a.prototype.register=function(a){return this.controllers.push(a)},a.prototype.undelegate=function(){var a=this;return _.each(this.controllers,function(a){return a.undelegate()})},a}(),controllers.Calendar=function(){function a(){this.undelegate=__bind(this.undelegate,this),this.delegate=__bind(this.delegate,this),this.update_date=__bind(this.update_date,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Router),a.prototype.routes={calendar:"main","manifest/:trip/:date":"manifest","manifest/:trip/:date":"manifest"},a.prototype.initialize=function(a){return a.register(this),this},a.prototype.main=function(){var a=this;return $("title").html("Calendar | Flybook"),app.dropdown.collapse(),app.navigation.select("calendar"),this.rendered?!0:(this.setup(),app.helpers.loader("#nav"),this.data={calendar:!0},app.helpers.after_transition("#app",function(){return app.reserved.fetch({success:function(b){return app.trips.fetch(function(b){return a.data.trips=b.models,app.lodging.fetch(function(b){return a.data.lodges=b.models,app.employees.fetch(function(b){return a.data.staff=b?b.where({active:"1"}):!1,app.lodging.fetch_meals(function(b){var c;return a.data.meals=b,app.sidebar.render(a.data),c=$(window).width()-300,app.helpers.after_transition("#app",function(){var b,c;c=app.helpers.cookie("event_sources");if(!c||c==="false")b=[],_.each(a.data.trips,function(a){return b.push(a.get("id")+":"+"trip")}),c=app.helpers.cookie("event_sources",b.join("|"));return app.sidebar.update_selected(c),a.delegate(),a.view.render(),a.rendered=!0}),$("#app").css({left:"230px",width:c+"px"})})})})})}})}),$("#app").empty().css({left:"-600px"}))},a.prototype.setup=function(){return app.undelegate(),this.view=new views.CalendarView,app.sidebar.on("search",this.search),app.sidebar.show(),this.delegate()},a.prototype.update_date=function(a){return app.month=a.getMonth(),app.year=a.getFullYear(),app.focus_day=a.getDate(),app.helpers.cookie("month",app.month),app.helpers.cookie("year",app.year),app.helpers.cookie("day",app.focus_day)},a.prototype.delegate=function(){var a=this;this.view.delegateEvents(),app.reserved.on("updated:activity",function(b){return a.view.refresh(),app.sync.ajax("/api/reservations/_update_activity",{data:JSON.stringify(b),type:"POST",success:function(){}})});if(app.sidebar.calendar)return app.sidebar.on("added:eventsource",this.view.add_event_source),app.sidebar.on("removed:eventsource",this.view.remove_event_source),app.sidebar.calendar.on("clicked",function(b,c){return a.update_date(c),a.view.set_focus_date(b,c)}),app.reservations.on("refresh",this.view.refresh),app.employees.on("refresh",this.view.refresh),this.view.on("selected:date",function(b,c){return app.sidebar.calendar.set_focus_date(b,c),a.update_date(c)}),this.view.on("changed:view",function(a){return app.sidebar.calendar.set_focus_and_highlight(a)}),app.controller=this},a.prototype.undelegate=function(){this.rendered=!1,app.reserved.off("updated:activity"),app.sidebar.off("added:eventsource removed:eventsource"),app.sidebar.off("search"),app.reservations.off("refresh"),app.employees.off("refresh"),app.sidebar.calendar&&app.sidebar.calendar.off("clicked");if(this.view)return this.view.off("selected:date changed:view"),this.view.undelegateEvents(),this.view.unrender(),delete this.view},a}(),controllers.Clients=function(){function a(){this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={clients:"main",addresses:"addresses",emails:"emails",postcards:"postcards","clients/data":"data"},a.prototype.contents=[{id:"_clients",href:"#clients",title:"Client List"},{id:"_addresses",href:"#addresses",title:"Address Book"},{id:"_emails",href:"#emails",title:"Mailing List"},{id:"_postcards",href:"#postcards",title:"Send Postcards"},{id:"_data",href:"#clients/data",title:"Import/Export"}],a.prototype.template_create="clients/create",a.prototype.template_edit="clients/edit",a.prototype.template_list="clients/list",a.prototype.collection="Clients",a.prototype.model="Client",a.prototype.main=function(){var a=this;return $("title").html("Clients | Flybook"),this.setup("clients"),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.fetch(function(b){return a.list.render(a.template_list,{clients:b.models})})}),$("#app").css({left:"-450px"})},a.prototype.addresses=function(){var a=this;return this.setup("addresses"),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.fetch(function(b){return a.list.render("clients/addresses",{clients:b.models})})}),$("#app").css({left:"-450px"})},a.prototype.emails=function(){var a=this;return this.setup("emails"),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.list.render("clients/mailing_list")}),$("#app").css({left:"-450px"})},a.prototype.postcards=function(){var a=this;return this.setup("postcards"),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.list.render("clients/postcards")}),$("#app").css({left:"-450px"})},a.prototype.data=function(){var a=this;return this.setup("data"),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.list.render("clients/data_tools")}),$("#app").css({left:"-450px"})},a.prototype.search=function(a){},a.prototype.setup=function(a){return app.dropdown.collapse(),app.navigation.select("clients"),app.sidebar.on("search",this.search),app.sidebar.render({contents:this.contents,title:"Clients",search:"Search Clients"}).show().select(a),app.undelegate(),this.delegate(),$("#app").css({left:"-540px",width:"450px"})},a}(),controllers.Dashboard=function(){function a(){this.search=__bind(this.search,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.contents=[{id:"_reservations",href:"#reservations",title:"Reservations"},{id:"_balances",href:"#balances",title:"Balances Due"},{id:"_messages",href:"#messages",title:"Staff Messages"},{id:"_phone",href:"#phone",title:"Phone List"},{id:"_todo",href:"#todo",title:"Todo List"}],a.prototype.main=function(){var a=this;return $("title").html("Dashboard | Flybook"),app.dropdown.collapse(),this.setup("home"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("dashboard/home",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.search=function(a){var b;return this.query=a,b=this.list.collection.search(this.query),this.list.render(!1,{accounts:b})},a.prototype.setup=function(a){return app.undelegate(),this.delegate(),app.navigation.select("dashboard"),app.sidebar.render({contents:this.contents,title:"Dashboard",search:"Search Reservations"}).show().select(a),app.sidebar.on("search",app.reservations.search)},a}(),controllers.Employees=function(){function a(){this.canceled=__bind(this.canceled,this),this.catch_save=__bind(this.catch_save,this),this.update=__bind(this.update,this),this.activity=__bind(this.activity,this),this.edit=__bind(this.edit,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={employees:"main","staff/edit/:id":"edit","activity/:date/:guide_id":"activity"},a.prototype.template_create="employees/create",a.prototype.template_edit="employees/edit",a.prototype.template_list="employees/list",a.prototype.template_help="employees/help",a.prototype.model="Employee",a.prototype.collection="Employees",a.prototype.form="EmployeeForm",a.prototype.form_el="#dropdown",a.prototype.sortable=!0,a.prototype.sorted_url="/api/employees/_sort/",a.prototype.messages={created:"{{nickname}} has been added as an employee.",saved:"Changes to {{nickname}} have been saved.",delete_warn:"You are about to delete {{nickname}}, proceed?",sorted:"You have changed the default guiding order."},a.prototype.main=function(){var a=this;return app.helpers.after_transition("#app",function(){return app.helpers.loader("#app").css({left:"230px"}),a.display()}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.edit=function(a){var b=this;return _.each(app.controllers,function(a){if(!a.rendered)return a.undelegate()}),this.delegate(),this.form.on("canceled",this.canceled),this.form.on("saved",this.catch_save),this.fetch(function(c){var d;return d=b.list.collection.get(a),b.form.render(b.template_edit,{},d)})},a.prototype.activity=function(a,b){return this.form.render("employees/activity")},a.prototype.update=function(){},a.prototype.catch_save=function(){if(window.location.hash.indexOf("staff")<0)return this.list.render()},a.prototype.canceled=function(a){return window.location.hash.indexOf("staff")>=0&&(history.go("-1"),this.undelegate()),this.trigger("refresh")},a.prototype.display=function(){var a=this;return app.sidebar.render({contents:app.settings.menus.settings.contents,title:app.settings.menus.settings.title}).show().select("employees"),app.navigation.select("setup"),app.undelegate(),this.delegate(),this.list.before=function(){return this.data={active:this.collection.where({active:"1"}),inactive:this.collection.where({active:"0"})}},this.fetch(function(b){return b?(a.list.collection=b,a.list.render(a.template_list,a.list.collection)):a.list.help(!1)})},a}(),controllers.Forms=function(){function a(){this.update=__bind(this.update,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={forms:"main"},a.prototype.form="StoreForm",a.prototype.form_el="#dropdown",a.prototype.model="DataStore",a.prototype.collection="DataStores",a.prototype.template_list="forms/list",a.prototype.template_help="forms/help",a.prototype.template_create="forms/create",a.prototype.template_edit="forms/edit",a.prototype.valid_changes=!1,a.prototype.sortable=!0,a.prototype.sorted_url="/api/stores/_sort/",a.prototype.main=function(){var a=this;return app.undelegate(),this.delegate(),this.setup(),app.helpers.after_transition("#app",function(){return a.account=app.user.get("account"),a.fetch(function(b){return a.stores=b,a.stores?a.list.render("forms/list",{fields:a.list.collection.models}):a.list.help(!1)}),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.update=function(){return this.account=app.user.get("account"),this.list.render("forms/list")},a.prototype.setup=function(){return app.helpers.loader("#app").css({left:"230px",width:"450px"}),app.sidebar.render({contents:app.settings.menus.settings.contents,title:app.settings.menus.settings.title}).show().select("forms"),app.navigation.select("settings"),this.form.on("deleted:doc",this.document_deleted)},a}(),controllers.Lodging=function(){function a(){this.meals_updated=__bind(this.meals_updated,this),this.fetch_meals=__bind(this.fetch_meals,this),this.edit=__bind(this.edit,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={lodging:"main"},a.prototype.model="Lodge",a.prototype.collection="Lodges",a.prototype.form="LodgeForm",a.prototype.form_el="#dropdown",a.prototype.list="LodgeList",a.prototype.template_list="lodging/list",a.prototype.template_help="lodging/help",a.prototype.template_create="lodging/create",a.prototype.template_edit="lodging/edit",a.prototype.sortable=!0,a.prototype.sorted_url="/api/lodging/_sort/",a.prototype.main=function(){var a=this;return app.dropdown.collapse(),app.helpers.after_transition("#app",function(){return a.setup(),a.fetch(function(b){return b?a.list.render():a.list.help(!1)})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.edit=function(a){var b=this;return app.dropdown.position("200px",function(){return app.helpers.loader("#dropdown"),b.fetch(function(c){return app.trips.fetch(function(c){return b.get(a,function(a){return b.form.render("lodging/edit",{trips:c},a)})})})})},a.prototype.fetch_meals=function(a){var b=this;return app.sync.ajax("/api/lodging/_meals/",{success:function(b){return a(b)}})},a.prototype.meals_updated=function(a){var b=this;return app.notifications.notify("Updating meal service..."),app.sync.ajax("/api/lodging/_save_meals/",{type:"POST",data:a,success:function(a){return b.meals=a,b.list.update_meals(a),app.notifications.notify("Meal service has been updated.")}})},a.prototype.setup=function(a){var b=this;return app.helpers.loader("#app").css({left:"230px",width:"450px"}),app.sidebar.render({contents:app.settings.menus.settings.contents,title:app.settings.menus.settings.title}).show().select("lodging"),app.navigation.select("settings"),app.undelegate(),this.delegate(),this.list.on("rendered",function(){return b.meals?b.list.render_meals(b.meals):b.fetch_meals(function(a){return b.meals=a,b.list.render_meals(a)})}),this.list.on("meals_update",this.meals_updated)},a}(),controllers.Pages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={pages:"main"},a.prototype.model="Page",a.prototype.collection="Pages",a.prototype.form="PageForm",a.prototype.form_el="#dropdown",a.prototype.template_list="pages/list",a.prototype.template_help="pages/help",a.prototype.template_create="pages/edit",a.prototype.template_edit="pages/edit",a.prototype.sortable=!0,a.prototype.sorted_url="/api/pages/_sort/",a.prototype.valid_changes=!1,a.prototype.messages={created:"{{title}} has been created",saved:"Changes to {{title}} have been saved.",delete_warn:"You are about to delete {{title}}, proceed?",navigate_warn:"Did you want to save the changes you just made?",sorted:"You have changed the page architecture."},a.prototype.main=function(){var a=this;return app.helpers.after_transition("#app",function(){return a.setup(),a.fetch(function(b){return b?a.list.render():a.list.help(!1)})}),$("#app").css({left:"-450px"})},a.prototype.create=function(){return this.list.collection.add(new models.Page({sort_order:this.list.collection.length})),this.update()},a.prototype.setup=function(a){return app.helpers.loader("#app").css({left:"230px"}),app.sidebar.render({contents:app.settings.menus.account.contents,title:app.settings.menus.account.title}).show().select("pages"),app.navigation.select(!1),app.undelegate(),this.delegate()},a}(),controllers.Preferences=function(){function a(){this.saved=__bind(this.saved,this),this.passchange=__bind(this.passchange,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={preferences:"main",notifications:"notifications",password:"password","gone-profile":"profile",theme:"theme"},a.prototype.contents=[{id:"_gone_profile",href:"#gone-profile",title:"Edit Your Profile"},{id:"_theme",href:"#theme",title:"Change Theme"},{id:"_password",href:"#password",title:"Change Password"}],a.prototype.form="SettingsForm",a.prototype.main=function(){return app.dropdown.collapse(),this.setup()},a.prototype.profile=function(){var a=this;return this.setup("gone_profile"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.form.render("preferences/profile",{},a.form.model),a.uploader=new views.PhotoUploader("logo-upload","icon","/api/uploads/_user_icon/",app.user.get("id"),"#user li .cover")}),$("#app").css({left:"-450px"})},a.prototype.password=function(){var a=this;return this.setup("password"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.form.render("preferences/password",{},a.form.model)}),$("#app").css({left:"-450px"})},a.prototype.passchange=function(a){var b=this;return app.helpers.loader("#app"),a.save(null,{success:function(a,c){return c.error?(app.notifications.error("Unable to change password. Make sure your old password is correct!"),b.form.render("preferences/password",{},b.form.model)):(app.notifications.notify("Your password has been changed sucessfully."),$("#app").css({left:"-550px"}),window.location.hash="#noop")}})},a.prototype.saved=function(a){return app.notifications.notify("Changes to your preferences have been saved"),app.user=a,app.user.save()},a.prototype.setup=function(a){return a==null&&(a=!1),this.form.model=app.user,this.form.on("changed:password",this.passchange),app.navigation.select(!1),app.sidebar.render({contents:this.contents,title:"Preferences"}).show().select(a),app.undelegate(),this.delegate(),$("#app").css({left:"-540px",width:"450px"})},a}(),controllers.Products=function(){function a(){this.edit=__bind(this.edit,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={products:"main"},a.prototype.form="ProductForm",a.prototype.form_el="#dropdown",a.prototype.model="Product",a.prototype.collection="Products",a.prototype.template_list="products/list",a.prototype.template_help="products/help",a.prototype.template_create="products/create",a.prototype.template_edit="products/edit",a.prototype.sortable=!0,a.prototype.sorted_url="/api/products/_sort/",a.prototype.main=function(){var a=this;return app.dropdown.collapse(),app.helpers.after_transition("#app",function(){return a.setup(),a.fetch(function(b){return b?a.list.render():a.list.help(!1)})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.edit=function(a){var b=this;return app.helpers.loader("#dropdown"),this.fetch(function(c){return app.trips.fetch(function(c){return b.get(a,function(a){return b.form.render("products/edit",{trips:c},a)})})})},a.prototype.setup=function(a){return this.list.before=function(){return this.data={active:this.collection.where({web_active:"1"}),inactive:this.collection.where({web_active:"0"})}},app.helpers.loader("#app").css({left:"230px"}),app.sidebar.render({contents:app.settings.menus.settings.contents,title:app.settings.menus.settings.title}).show().select("products"),app.navigation.select("settings"),app.undelegate(),this.delegate()},a}(),controllers.Reports=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={reports:"main",statements:"statements",revenue:"revenue","client-data":"clients",traffic:"traffic",sources:"sources"},a.prototype.contents=[{id:"_statements",href:"#statements",title:"Statements"},{id:"_revenue",href:"#revenue",title:"Booking &amp; Revenue"},{id:"_sources",href:"#sources",title:"Referral Sources"},{id:"_traffic",href:"#traffic",title:"Web Traffic"},{id:"_clients",href:"#client-data",title:"Client Data"}],a.prototype.main=function(){return $("title").html("Reports | Flybook"),this.setup()},a.prototype.statements=function(){var a=this;return this.setup("statements"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("reports/statements",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.revenue=function(){var a=this;return this.setup("revenue"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("reports/revenue",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.sources=function(){var a=this;return this.setup("sources"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("reports/sources",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.traffic=function(){var a=this;return this.setup("traffic"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("reports/traffic",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.clients=function(){var a=this;return this.setup("clients"),app.helpers.after_transition("#app",function(){return $("#app").css({left:"230px"}),a.list.render("reports/clients",{})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.setup=function(a){return a==null&&(a=!1),app.dropdown.collapse(),app.navigation.select("reports"),app.sidebar.render({contents:this.contents,title:"Reports"}).show().select(a),app.undelegate(),this.delegate(),$("#app").css({left:"-640px",width:"450px"})},a}(),controllers.Reservations=function(){function a(){this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.canceled=__bind(this.canceled,this),this.apply_discount=__bind(this.apply_discount,this),this.refund_payment=__bind(this.refund_payment,this),this.process_payment=__bind(this.process_payment,this),this.deleted=__bind(this.deleted,this),this.added=__bind(this.added,this),this.update=__bind(this.update,this),this.search=__bind(this.search,this),this.edit=__bind(this.edit,this),this.make=__bind(this.make,this),this.guide=__bind(this.guide,this),this.trip=__bind(this.trip,this),this.room=__bind(this.room,this),this.lodge=__bind(this.lodge,this),this.manifest=__bind(this.manifest,this),this.format_reservations=__bind(this.format_reservations,this),this.balances=__bind(this.balances,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={reservations:"main",dashboard:"main",balances:"balances",reservation:"make","reservation/trip/:id/":"trip","reservation/trip/:id/:start":"trip","reservation/trip/:id/:start/:end":"trip","reservation/lodge/:id/":"lodge","reservation/lodge/:id/:start":"lodge","reservation/lodge/:id/:start/:end":"lodge","reservation/room/:id/:start/:room":"room","reservation/edit/:id":"edit","reservation/guide/:id/:start/:guide/:time":"guide","reservation/guide/:id/:start/:guide":"guide","manifest/:trip_id/:date":"manifest","manifest/:trip_id/:date/:time":"manifest"},a.prototype.model="Order",a.prototype.collection="Orders",a.prototype.form="OrderForm",a.prototype.form_el="#dropdown",a.prototype.valid_changes=!1,a.prototype.messages={created:"Reservation(s) for {{name}} has been created. {{notified}}",saved:"Reservation(s) for {{name}} has been saved. {{notified}}",delete_warn:"You are about to completely erase {{name}}&apos;s reservation(s). Forever. Proceed?"},a.prototype.main=function(){var a=this;return $("title").html("Dashboard | Flybook"),this.setup("reservations"),this.template="reservations/approval_list",app.dropdown.collapse(),app.helpers.after_transition("#app",function(){return a.filter=function(b){var c,d,e,f;return b.sort(),f=b.where({status:"2"}),e=b.where({status:"4"}),f.sort(),d=a.format_reservations(f),e=a.format_reservations(e),c=d.length,{reservations:d,count:c,hold:e}},a.refresh(function(b){return a.list.render("reservations/approval_list",a.filter(a.list.collection))})}),app.helpers.loader("#app").css({left:"230px",width:"450px"})},a.prototype.balances=function(){var a=this;return $("title").html("Dashboard | Flybook"),this.setup("balances"),this.template="reservations/balances_due",app.dropdown.collapse(),app.helpers.after_transition("#app",function(){return a.filter=function(b){var c,d,e,f,g;c=[];if(b.models){g=b.models;for(e=0,f=g.length;e<f;e++)d=g[e],d.attributes.balance_due>0&&c.push(d)}return{reservations:a.format_reservations(c),count:c.length,hold:!1}},a.refresh(function(b){return a.list.render("reservations/balances_due",a.filter(b))})}),app.helpers.loader("#app").css({left:"230px",width:"450px"})},a.prototype.format_reservations=function(a){var b,c=this;return b=[],_.each(a,function(a){var c,d;return d=a.attributes,d.dates=app.helpers.sql_to_slash(d.start_date),d.end_date>d.start_date&&(d.dates+=" - "+app.helpers.sql_to_slash(d.end_date)),d.dates===""&&(d.dates="No dates set"),d.party=parseInt(d.adults)+parseInt(d.children)+parseInt(d.seniors),d.trip_reservations.length>0?d.trip=d.trip_reservations[0].attributes?d.trip_reservations[0].get("trip").name:d.trip_reservations[0].trip.name:d.trip="",d.lodge_reservations.length>0&&(c=d.lodge_reservations[0].attributes?d.lodge_reservations[0].get("lodge").name:d.lodge_reservations[0].lodge.name,d.trip!==""&&(d.trip+=" / "),d.trip+=c),d.trip===""&&(d.trip="No trips or lodging set"),b.push(d)}),b},a.prototype.manifest=function(a,b,c){var d=this;return app.reserved.fetch({success:function(){return app.clients.fetch(function(e){return app.employees.fetch(function(e){return app.trips.fetch(function(e){var f,g,h,i;return i=app.trips.list.collection.get(a),g=moment(b).toDate(),h=i.schedule_on(g,c),c=c?app.helpers.twenty_four_to_twelve(c):!1,f={program:h[0].program,trip:i.attributes,date:moment(b).format("YYYY-MM-DD"),time:c},d.daily=new views.TripDaily,d.daily.on("error",d.error),d.daily.on("canceled",d.canceled),d.daily.render("reservations/manifest",f)})})})}})},a.prototype.lodge=function(a,b,c){return this.make(!1,a,b,c)},a.prototype.room=function(a,b,c){return this.make(!1,a,b,!1,!1,!1,c)},a.prototype.trip=function(a,b,c){return this.make(a,!1,b)},a.prototype.guide=function(a,b,c,d){return this.make(a,!1,b,!1,c,d)},a.prototype.make=function(a,b,c,d,e,f,g){var h=this;return a==null&&(a=!1),b==null&&(b=!1),c==null&&(c=!1),d==null&&(d=!1),e==null&&(e=!1),f==null&&(f=!1),g==null&&(g=!1),window.scrollTo(0,0),_.each(app.controllers,function(a){if(!a.rendered)return a.undelegate()}),this.delegate(),app.navigation.select("reservation"),$(".prompt,.screen").remove(),app.dropdown.position("600px",function(){return app.helpers.loader("#dropdown")}),app.reserved.fetch({success:function(){return app.trips.fetch(function(i){return app.lodging.fetch(function(j){return app.employees.fetch(function(k){return app.products.fetch(function(l){return app.helpers.get_countries_and_states(function(){var l;return l=new models.Reservation,l.set("entered_by",app.user.get("name"),{silent:!0}),h.form.trip_id=a,h.form.lodge_id=b,h.form.room_id=g,h.form.start_date=c,h.form.end_date=d,h.form.guide_id=e,h.form.selected_time=f,h.data={trips:i,staff:k,lodges:j,lodge_id:b,trip_id:a,start_date:c,end_date:d,countries:app.countries,states:app.states},h.form.render("reservations/form",h.data,new models.Order)})})})})})}})},a.prototype.edit=function(a){var b=this;return window.scrollTo(0,0),_.each(app.controllers,function(a){if(!a.rendered)return a.undelegate()}),this.delegate(),window.location.hash="#reservation/edit/"+a,app.dropdown.position("600px",function(){return app.helpers.loader("#dropdown"),app.reserved.fetch({success:function(){return app.trips.fetch(function(c){return app.lodging.fetch(function(d){return app.employees.fetch(function(e){return app.products.fetch(function(f){return app.helpers.get_countries_and_states(function(){return b.data={trips:c,staff:e,lodges:d,products:f,countries:app.countries,states:app.states},b.get(a,function(c){if(!c)throw console.log("order "+a+" fucking vanished mysteriously..."),new Error;return b.form.render("reservations/form",b.data,c)})})})})})})}})})},a.prototype.search=function(a){var b,c;return this.query=a,this.query===""?this.list.render(this.template,this.filter(this.list.collection)):(c=this.list.collection.search(this.query),b=this.format_reservations(c),this.list.render("reservations/search_results",{reservations:b,count:b.length}))},a.prototype.update=function(){if(this.filter&&!app.calendar.rendered)return this.list.collection.sort(),this.list.render(this.list.template,this.filter(this.list.collection))},a.prototype.added=function(a){var b=this;return console.log("got added event"),this.trigger("added",a),this.app.notifications.notify("Saving..."),a.save(a,{success:function(){var c,d;return d=tmpl_compile(b.messages.created),c=d(a.attributes),b.app.notifications.notify(c),b.trigger("returned",a)},error:function(a,c){return!b.app.notifications||b.app.notifications.error(c),b.list.collection.remove(a,{silent:!0})}})},a.prototype.deleted=function(a,b,c){var d;app.reserved.delete_order_reservations(a.get("id")),d=Backbone.Model.extend({url:this.list.collection.url}),this.to_delete=new d(a.attributes),this.destroy(),app.notifications.notify("The reservation has been deleted."),this.trigger("refresh");if(window.location.hash.indexOf("reservation")>=0)return history.go("-1"),this.undelegate()},a.prototype.process_payment=function(a){var b=this;return a.save(null,{success:function(a){return a.get("error")?app.notifications.error("Error processing credit card: "+a.get("error")):b.form.add_payment(a)}})},a.prototype.refund_payment=function(a){var b,c=this;return b=new models.Payment(a),b.destroy({success:function(a){return c.form.payment_refunded(a)}})},a.prototype.apply_discount=function(a){var b=this;return app.sync.ajax("/api/payments/_update_discount",{data:{id:a},success:function(a){return a.error?app.notifications.error(reponse.error):b.form.update_discount(a)}})},a.prototype.canceled=function(a){if(window.location.hash.indexOf("reservation")>=0||window.location.hash.indexOf("manifest")>=0)history.go("-1"),this.undelegate();return app.reserved.cleanup(a),this.form.trip_id=!1,this.form.lodge_id=!1,this.form.start_date=!1,this.form.end_date=!1,delete this.daily},a.prototype.bind=function(){var a=this;return this.form.on("process:payment",this.process_payment),this.form.on("refund:payment",this.refund_payment),this.form.on("selected:discount",this.apply_discount),this.form.on("error",this.error),this.form.on("canceled",this.canceled),this.on("returned",function(b){return app.reserved.fetch({success:function(){return app.reserved.update(b),a.trigger("refresh")}})})},a.prototype.unbind=function(){return this.form.off("process:payment refund:payment selected:discount error canceled tabbed"),this.off("saved added")},a.prototype.setup=function(a){return app.undelegate(),this.delegate(),app.navigation.select("dashboard"),app.sidebar.render({contents:app.dashboard.contents,title:"Dashboard",search:"Search Reservations"}).show().select(a),app.sidebar.on("search",this.search)},a}(),controllers.Schedules=function(){function a(){this.undelegate=__bind(this.undelegate,this),this.delegate=__bind(this.delegate,this),this.deleted=__bind(this.deleted,this),this.saved=__bind(this.saved,this),this.canceled=__bind(this.canceled,this),this.edit=__bind(this.edit,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={"schedule/:id/:start":"main","schedule/:id/:start/:end":"main"},a.prototype.form="TripForm",a.prototype.form_el="#dropdown",a.prototype.main=function(a,b,c){var d=this;return this.delegate(),$(".prompt,.screen").remove(),app.employees.fetch(function(e){return app.trips.get(a,function(f){var g;return e=app.employees.list.collection.models,g=new models.Schedule(_.extend(f.clone().attributes,{id:!1,trip_id:a,staff:e})),g.update_dates_and_times(e,app.helpers.sqldate_to_js(b),app.helpers.sqldate_to_js(c)),delete g.id,app.dropdown.clear(),d.form.render("trips/schedule",{},g),d.form.on("canceled",d.canceled),d.form.on("saved",d.saved),d.delegate()})})},a.prototype.edit=function(a){var b=this;return app.helpers.loader("#dropdown"),app.employees.fetch(function(c){var d;return d=new models.Schedule,d.fetch({data:{id:a.id},success:function(){return c=app.employees.list.collection.models,d.update_dates_and_times(c),b.form.render("trips/schedule",{},d),b.form.on("deleted",b.deleted),b.form.on("saved",b.saved),b.modelChanged=!0,b.delegate()}})})},a.prototype.canceled=function(){return this.undelegate(),window.location.hash="#calendar"},a.prototype.saved=function(a){var b=this;return app.notifications.notify("Saving schedule..."),a.save(null,{success:function(c){var d,e,f,g;return app.notifications.notify("Changes to "+a.get("name")+" have been saved."),g=a.get("trip_id"),f=app.trips.list.collection.get(g),e=f.get("schedules"),d=!0,_.each(e,function(b,c){if(b.id===a.get("id"))return e[c]=a.attributes,d=!1}),d&&e.push(a.attributes),f.set("schedules",e,{silent:!0}),b.trigger("changed:schedule",a)}})},a.prototype.deleted=function(a){var b,c,d,e=this;return a.destroy(),d=a.get("trip_id"),c=app.trips.list.collection.get(d),b=c.get("schedules"),_.each(b,function(c,d){if(c.id===a.get("id"))return b.splice(d,1)}),c.set("schedules",b,{silent:!0}),this.modelChanged=!1,this.trigger("changed:schedule",a),app.dropdown.collapse()},a.prototype.delegate=function(){var a=this;return _.each(app.controllers,function(a){if(app.controller===!a)return a.undelegate()}),this.on("saved",this.schedule_saved),this.form.delegateEvents(),this.bind()},a.prototype.undelegate=function(){return this.off("saved"),this.form.undelegateEvents(),this.unbind()},a}(),controllers.Settings=function(){function a(){this.setup=__bind(this.setup,this),this.noop=__bind(this.noop,this),this.saved=__bind(this.saved,this),this.navigated=__bind(this.navigated,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={setup:"main",promos:"promotions",docs:"documents",account:"account",partners:"partners",company:"profile",bank:"bank",payment:"payment",noop:"noop"},a.prototype.form="SettingsForm",a.prototype.menus={settings:{title:"Setup",contents:[{id:"_employees",href:"#employees",title:"Guides &amp; Staff"},{id:"_trips",href:"#trips",title:"Activities &amp; Trips"},{id:"_lodging",href:"#lodging",title:"Lodging &amp; Meals"},{id:"_products",href:"#products",title:"Products &amp; Rentals"},{id:"_forms",href:"#forms",title:"Client Form Data"},{id:"_promos",href:"#promos",title:"Promotion Codes"},{id:"_docs",href:"#docs",title:"Documents"}]},account:{title:"Settings",contents:[{id:"_pages",href:"#pages",title:"Website Pages"},{id:"_profile",href:"#company",title:"Company Profile"},{id:"_bank",href:"#bank",title:"Bank Account"},{id:"_payment",href:"#payment",title:"Payment Method"},{id:"_partners",href:"#partners",title:"Manage Partners"}]}},a.prototype.main=function(){return $("title").html("Setup | Flybook"),this.setup(this.menus.settings,!1,!1)},a.prototype.account=function(){return this.setup(this.menus.account,!1,!1)},a.prototype.navigated=function(){return app.dropdown.collapse()},a.prototype.promotions=function(){var a=this;return this.setup(this.menus.settings,"promos"),app.helpers.after_transition("#app",function(){return a.form.render("settings/promotions",{},a.form.model),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px"})},a.prototype.documents=function(){var a=this;return this.setup(this.menus.settings,"docs"),this.doc_list=new views.FormsList,this.doc_list.on("document:deleted",function(a){return app.sync.ajax("/api/documents/",{contentType:"application/json",type:"DELETE",data:JSON.stringify(a)})}),this.doc_list.on("documents:saved",function(){var b;return app.notifications.notify("Changes to your settings have been saved"),b=new models.Account(app.user.get("account")),b.url="/api/accounts/",b.save(null,{success:function(c){return a.account=b,app.user.set("account",b.attributes,{silent:!0})}})}),app.helpers.after_transition("#app",function(){return a.doc_list.render("settings/documents"),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px"})},a.prototype.partners=function(){var a=this;return this.setup(this.menus.account,"partners"),app.helpers.after_transition("#app",function(){return a.form.render("settings/partners_intro",{},a.form.model),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px"})},a.prototype.profile=function(){var a=this;return this.setup(this.menus.account,"profile"),this.form.model.industries.sort(),app.helpers.after_transition("#app",function(){return app.helpers.loader("#app"),$("#app").css({left:"230px"}),app.helpers.get_countries_and_states(function(){return a.form.render("settings/company_profile",{countries:app.countries,states:app.states},a.form.model)})}),$("#app").css({left:"-450px"})},a.prototype.bank=function(){var a=this;return this.setup(this.menus.account,"bank"),app.helpers.after_transition("#app",function(){return a.form.render("settings/bank_account",{},a.form.model),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px"})},a.prototype.payment=function(){var a=this;return this.setup(this.menus.account,"payment"),app.helpers.after_transition("#app",function(){return a.form.render("settings/payment",{},a.form.model),$("#app").css({left:"230px"})}),$("#app").css({left:"-450px"})},a.prototype.saved=function(a){var b=this;return app.notifications.notify("Changes to your settings have been saved"),a.url="/api/accounts/",a.save(null,{success:function(c){return b.account=a,app.user.set("account",a.attributes,{silent:!0}),app.navigation.render()}})},a.prototype.noop=function(){return app.sidebar.deselect()},a.prototype.setup=function(a,b,c){return b==null&&(b=!1),c==null&&(c=!0),this.form.model=new models.Account(app.user.get("account")),app.dropdown.collapse(),app.undelegate(),this.delegate(),a===this.menus.settings?app.navigation.select("setup"):app.navigation.select(!1),app.sidebar.render({contents:a.contents,title:a.title}).show().select(b),$("#app").css({left:"-540px",width:"450px"})},a}(),controllers.Trips=function(){function a(){this.update=__bind(this.update,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Controller),a.prototype.routes={trips:"main"},a.prototype.form="TripForm",a.prototype.form_el="#dropdown",a.prototype.model="Trip",a.prototype.collection="Trips",a.prototype.template_list="trips/list",a.prototype.template_help="trips/help",a.prototype.template_create="trips/create",a.prototype.template_edit="trips/edit",a.prototype.sortable=!0,a.prototype.sorted_url="/api/trips/_sort/",a.prototype.main=function(){var a=this;return this.list.before=function(){return this.data={active:this.collection.where({active:"1","package":"0"}),packages:this.collection.where({active:"1","package":"1"}),inactive:this.collection.where({active:"0"})}},app.helpers.after_transition("#app",function(){return a.setup(),a.refresh(function(b){return b?a.list.render():a.list.help(!1)})}),$("#app").css({left:"-450px",width:"450px"})},a.prototype.edit=function(a){var b=this;return app.employees.fetch(function(c){return b.refresh(function(c){var d;return d=b.list.collection.get(a),app.dropdown.position("250px",function(){return app.helpers.loader("#dropdown"),b.get(a,function(a){return app.lodging.fetch(function(c){var d,e;return e=[[0,"No Lodging Packaged"],[1,"Any Available Lodge (Check Availability)"],[-1,"Any Available Lodge (Ignore Availability)"]],_.each(c.models,function(a){return e.push([a.get("id"),a.get("name")])}),d=[[0,"Primary package activity..."],[1,"N/A, this is the activity"]],_.each(b.list.collection.models,function(b){if(b.get("id")!==a.get("id"))return d.push([b.get("id"),b.get("name")])}),b.form.render("trips/edit",{lodges:e,activities:d},a)})})})})})},a.prototype.update=function(){return this.list.render()},a.prototype.setup=function(a){return app.helpers.loader("#app").css({left:"230px"}),app.sidebar.render({contents:app.settings.menus.settings.contents,title:app.settings.menus.settings.title}).show().select("trips"),app.navigation.select("setup"),app.undelegate(),this.delegate()},a}(),flybook.Form=function(){function a(){this.cancel=__bind(this.cancel,this),this.next_tab=__bind(this.next_tab,this),this.tab=__bind(this.tab,this),this.pre_check_docs=__bind(this.pre_check_docs,this),this.document_click=__bind(this.document_click,this),this.extend_exceptions=__bind(this.extend_exceptions,this),this.extend_highlights=__bind(this.extend_highlights,this),this.render_starts=__bind(this.render_starts,this),this.dateclick=__bind(this.dateclick,this),this.destroy_map=__bind(this.destroy_map,this),this.lookup_location=__bind(this.lookup_location,this),this.setup_map=__bind(this.setup_map,this),this.upload_complete=__bind(this.upload_complete,this),this.setup_photos=__bind(this.setup_photos,this),this.update_upsells=__bind(this.update_upsells,this),this.upsell_click=__bind(this.upsell_click,this),this.rental_click=__bind(this.rental_click,this),this.remove_deposit_rule=__bind(this.remove_deposit_rule,this),this.add_deposit_rule=__bind(this.add_deposit_rule,this),this.remove_price_point=__bind(this.remove_price_point,this),this.add_price_point=__bind(this.add_price_point,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Form),a.prototype.el="#dropdown",a.prototype.events={"click #weekdays input,#weekdays label":"weekday_click","keyup #lat,#lng":"reverse_lookup","click .lookup":"lookup_location","click .add-price-point":"add_price_point","click .remove-price-point":"remove_price_point","click .add-deposit-rule":"add_deposit_rule","click .remove-deposit-rule":"remove_deposit_rule","click .ups":"upsell_click","click .ren":"rental_click","click .frm":"document_click","click .tabs a":"tab","click .next-step":"next_tab"},a.prototype.init=function(){return this.events=_.extend({},this.__events,this.events)},a.prototype.before=function(a){var b=this;return $(window).scrollTop(0),this.tab_index=0,_.extend(this.data,{account:app.user.get("account"),trips:app.trips.list.collection.models}),app.dropdown.expand(function(){return app.helpers.loader(b.el),a(),app.dropdown.fluid()})},a.prototype.add_price_point=function(){var a,b,c,d,e;return c={id:Math.random()*3e3},$(".trip-pricing input,.trip-pricing select").each(function(){var a,b;return a=$(this).attr("name"),b=$(this).val().toString().replace(/[A-Za-z$-,]/g,""),c[a]=b}),$(".nope").is(":checked")&&(e=c.start_month<10?"0"+c.start_month:c.start_month,d=c.start_dt<10?"0"+c.start_dt:c.start_dt,b=c.end_month<10?"0"+c.end_month:c.end_month,a=c.end_dt<10?"0"+c.end_dt:c.end_dt,c.start_date=c.start_year+"-"+e+"-"+d,c.end_date=c.end_year+"-"+b+"-"+a),c.price===""?(app.notifications.error("You need to specify a price!"),!1):(c.days===""&&(c.days="1"),c.people===""||c.price===""?(app.notifications.error("You need a both number of people and the cost per person to add this price"),!1):(this.model.set("prices_changed",!0),this.price_points.push(c),this.update_prices()))},a.prototype.remove_price_point=function(a){var b,c,d=this;return this.model.set("prices_changed",!0),c=$(a.target).parent(),b=c.attr("id"),_.each(this.price_points,function(a){a.id.toString()===b.toString()&&(d.price_points=_.without(d.price_points,a),d.update_prices())})},a.prototype.update_prices=function(a){var b=this;return $("#prices").html(""),$(".add-fields input").val(""),this.price_points.length>0?$(".pricing-help").css({display:"none"}):app.isMobile||$(".pricing-help").css({display:"block"}),_.each(this.price_points,function(a){var b;return b=tmpl.trips_price(a),$("#prices").append(b)}),this.model.set("pricing",this.price_points),this.delegateEvents()},a.prototype.add_deposit_rule=function(){var a;return a={id:Math.random()*3e3},$(".deposits input").each(function(){var b,c;return b=$(this).attr("name"),c=$(this).val().toString().replace(/[A-Za-z$-,]/g,""),a[b]=c}),a.days_prior===""||a.percent_due===""?(app.notifications.error("You need a both number of days prior and precent due to add this rule."),!1):(this.model.set("deposits_changed",!0),this.deposit_rules.push(a),this.update_deposits())},a.prototype.remove_deposit_rule=function(a){var b,c,d=this;return this.model.set("deposits_changed",!0),c=$(a.target).parent(),b=c.attr("id"),_.each(this.deposit_rules,function(a){a.id.toString()===b.toString()&&(d.deposit_rules=_.without(d.deposit_rules,a),d.update_deposits())})},a.prototype.update_deposits=function(a){var b,c=this;return $("#deposits").html(""),$(".deposits input").val(""),this.deposit_rules.length>0?$(".deposit-help").css({display:"none"}):app.isMobile||$(".deposit-help").css({display:"block"}),b=tmpl_compile(this.deposit_tmpl),_.each(this.deposit_rules,function(a){var c;return c=b(a),$("#deposits").append(c)}),this.model.set("deposit_rules",this.deposit_rules),this.delegateEvents()},a.prototype.rental_click=function(a){var b,c,d,e=this;return b=$(a.target),c=b.parent().parent().attr("id"),b.attr("checked")?d="1":d="0",_.each(this.upsell,function(a,b){if(a.trip_id===c)return e.upsell[b].as_rental=d}),this.update_upsells()},a.prototype.upsell_click=function(a){var b,c,d=this;return b=$(a.target),c=b.parent().parent().attr("id"),b.attr("checked")?this.upsell.push({trip_id:c}):_.each(this.upsell,function(a,b){if(a.trip_id===c)return d.upsell.splice(b,1)}),this.model.set("trips",this.upsell),this.update_upsells()},a.prototype.update_upsells=function(){var a=this;return $(".ups,.ren").attr("checked",!1),_.each(this.upsell,function(a){$("#"+a.trip_id+" .ups").attr("checked",!0);if(a.as_rental==="1")return $("#"+a.trip_id+" .ren").attr("checked",!0)})},a.prototype.setup_photos=function(a,b,c){var d,e,f,g,h,i;c==null&&(c=6),d=app.user.get("account"),f=this.model.get("photos"),i=[];for(e=1;1<=c?e<=c:e>=c;1<=c?e++:e--)g=new views.PhotoUploader("photo-upload-"+e,"photo"+e,"/api/uploads/_"+a+"_photo/",this.model.get("id"),"",b,a+"_"),g.photo_index=e,g.on("complete",this.upload_complete),f&&f.indexOf(e)>=0?(h="https://s3.amazonaws.com/flybook/"+a+"_photo"+e+"_"+this.model.get("id")+".jpg?"+Math.random()*1e3,i.push($("#photo"+e+" div:first").css({"background-image":'url("'+h+'")'}))):i.push(void 0);return i},a.prototype.upload_complete=function(a){var b,c;return c=a.photo_index,b=this.model.get("photos")?this.model.get("photos").split(","):[],b.push(c.toString()),b=_.uniq(b,!0),this.model.set({photos:b.join(",")})},a.prototype.setup_map=function(){var a,b,c,d,e=this;a=this.model.get("lat"),c=this.model.get("lng");if(a==="0"||a==="")a="61.127274";if(c==="0"||c==="")c="-146.344617";return b=new google.maps.LatLng(a,c),d={zoom:12,center:b,mapTypeId:google.maps.MapTypeId.TERRAIN},this.gmap=new google.maps.Map(document.getElementById("gmap"),d),this.geocoder=new google.maps.Geocoder,google.maps.event.addListener(this.gmap,"click",function(b){var d;return d=b.latLng,a=d.lat().toString().substr(0,8),c=d.lng().toString().substr(0,8),$("#lat").val(a),$("#lng").val(c),e.model.set("lat",a,{silent:!0}),e.model.set("lng",c,{silent:!0}),e.marker.setMap(null),e.marker=new google.maps.Marker({map:e.gmap,position:b.latLng})}),this.marker=new google.maps.Marker({map:this.gmap,position:b})},a.prototype.lookup_location=function(a){var b=this;return this.cancel_lookup=!0,this.lookup_value=$("#location").val(),this.lookup_value===""?!1:(window.clearTimeout(app.helpers.timer),app.helpers.delay(800,function(){return b.geocoder?b.geocoder.geocode({address:b.lookup_value},function(a,c){var d,e,f;return c===google.maps.GeocoderStatus.OK?(f=a[0].geometry.location,d=f.lat().toString().substr(0,8),e=f.lng().toString().substr(0,8),$("#lat").val(d),$("#lng").val(e),b.model.set({lat:d,lng:e}),b.gmap.setCenter(a[0].geometry.location),b.marker&&b.marker.setMap(null),b.marker=new google.maps.Marker({map:b.gmap,position:a[0].geometry.location})):app.notifications.error("Not even google knows where that is! ")}):!1}))},a.prototype.reverse_lookup=function(a){var b=this;if(this.cancel_lookup)return!1;this.model.set({lat:lat,lng:lng});if(lat&&lng)return window.clearTimeout(app.helpers.timer),app.helpers.delay(800,function(){var a;return a=new google.maps.LatLng(lat,lng),b.geocoder.geocode({latLng:a},function(c,d){var e;return d===google.maps.GeocoderStatus.OK&&c[1]?(b.gmap.setCenter(a),b.marker&&b.marker.setMap(null),b.marker=new google.maps.Marker({map:b.gmap,position:a}),e=c[1].formatted_address,$("#location").val(e),b.model.set("location",e)):app.notifications.error("Not even google knows where that is!")})})},a.prototype.destroy_map=function(){return $("#gmap").empty(),delete this.gmap,delete this.geocoder,delete this.marker},a.prototype.weekday_click=function(){var a,b,c,d=this;return b=[],_.each($("#weekdays").find("input[type=checkbox]:checked"),function(a,c){return b.push(a.value)}),a="start_days",c=b.join(","),this.start_days=b,this.model.set(a,c.toString()),this.render_starts()},a.prototype.dateclick=function(a,b,c,d){var e;return e=$(d.target).attr("data-dow"),_.indexOf(this.start_days,e)>=0&&(a="-"+a),_.indexOf(this.start_dates,a)>=0?this.start_dates=_.without(this.start_dates,a):this.start_dates.push(a),this.model.set("start_dates",this.start_dates.join(",")),this.render_starts()},a.prototype.render_starts=function(){var a,b,c=this;return $('input[name="dow[]"]').attr("checked",!1),$("#weekday-calendar td").removeClass("start").removeClass("trip-date").removeClass("trip-night"),b=[],_.each(this.start_days,function(a){return $("#dow"+a).attr("checked",!0),$(".dow"+a).each(function(a){return $(this).addClass("start"),b.push($(this).attr("data-sql"))})}),a=[],_.each(this.start_dates,function(c){return c.substr(0,1)==="-"?(c=c.substr(1,c.length-1),$("td[data-sql="+c+"]").removeClass("start").removeClass("trip-date"),a.push(c)):($("td[data-sql="+c+"]").addClass("start"),b.push(c))}),this.extend_highlights(b),this.extend_exceptions(a)},a.prototype.extend_highlights=function(a){var b,c,d=this;b=this.model.get("duration"),c=this.model.get("lodging_nights");if(b>1||c>1)return _.each(a,function(a){var e,f,g,h,i,j;f=app.helpers.sqldate_to_js(a);if(f&&b>1){i=f.getTime(),e=(new Date(i+86400*(b-2)*1e3)).getTime();while(i<=e+864e5)i+=828e5,g=new Date(i),h=app.helpers.jsdate_to_sql(g),$("td[data-sql="+h+"]").addClass("trip-date")}if(f&&c>1){i=f.getTime(),e=(new Date(i+86400*(c-2)*1e3)).getTime(),d.model.get("arrive_night_prior")==="1"&&(i-=1512e5,e-=9e7),j=[];while(i<=e+9e7)i+=828e5,g=new Date(i),h=app.helpers.jsdate_to_sql(g),j.push($("td[data-sql="+h+"]").addClass("trip-night"));return j}})},a.prototype.extend_exceptions=function(a){var b,c,d=this;b=this.model.get("duration"),c=this.model.get("lodging_nights");if(b>1||c>1)return _.each(a,function(a){var e,f,g,h,i,j;f=app.helpers.sqldate_to_js(a);if(f&&b>1){i=f.getTime()-864e5,e=(new Date(i+86400*(b-1)*1e3)).getTime();while(i<=e)i+=864e5,g=new Date(i),h=app.helpers.jsdate_to_sql(g),$("td[data-sql="+h+"]").removeClass("trip-date").removeClass("start")}if(f&&c>1){i=f.getTime(),e=(new Date(i+86400*(c-2)*1e3)).getTime(),d.model.get("arrive_night_prior")==="1"&&(i-=1728e5,e-=828e5),j=[];while(i<=e)i+=864e5,g=new Date(i),h=app.helpers.jsdate_to_sql(g),j.push($("td[data-sql="+h+"]").removeClass("trip-night"));return j}})},a.prototype.document_click=function(a){var b,c,d,e=this;return c=$(a.target).val(),b=this.model.get("documents")?this.model.get("documents").split(","):[],d=!1,_.each(b,function(a,e){if(a===c)return b.splice(e,1),d=!0}),d||b.push(c),this.model.set("documents",b.join(","))},a.prototype.pre_check_docs=function(){var a,b=this;return a=this.model.get("documents")?this.model.get("documents").split(","):[],_.each(a,function(a){return $('input[value="'+a+'"]').attr("checked",!0)})},a.prototype.tab=function(a){var b,c;return window.clearTimeout(app.helpers.timer),$(".tabs a").removeClass("current"),$(a.target).addClass("current"),this.tab_index=$(".tabs a").index(a.target),$(".tabshell").css({left:this.tab_index*730*-1+"px"}),c=$(".tabs").children("li").length,this.tab_index===c-1&&(this.model.get("setup_complete")==="0"||!this.model.get("setup_complete"))&&(this.model.set("setup_complete","1"),$(".done").empty(),$(".next-step").text("Finished!").removeClass("continue").removeClass("next-step").addClass("done"),this.delegateEvents()),b=$(a.target),this.trigger("tabbed",b),b.html().toString().indexOf("hotos")>0?document.getElementById("google-maps")?this.setup_map():app.helpers.load_google_maps_api(this.gmap_callback_method):this.destroy_map()},a.prototype.next_tab=function(){var a,b,c;window.clearTimeout(app.helpers.timer),c=$(".tabs").children("li").length;if(this.tab_index<c)return a=$('.tabs li a[class="tab current"]'),a.removeClass("current"),b=$(a.parent().next().children("a")[0]),b.addClass("current"),b&&b.html()&&b.html().indexOf("hotos")>0?document.getElementById("google-maps")?this.setup_map():app.helpers.load_google_maps_api("app.trips.form.setup_map"):this.destroy_map(),this.tab_index++,$(".tabshell").css({left:this.tab_index*730*-1+"px"}),this.tab_index===c-1&&(this.model.set("setup_complete","1"),$(".done").empty(),$(".next-step").text("Finished!").removeClass("continue").addClass("done"),this.delegateEvents()),this.trigger("tabbed",b)},a.prototype.cancel=function(a){var b=this;return a==null&&(a=!1),this.modelChanged=!1,app.helpers.after_transition("#dropdown",function(){b.destroy_map();if(!a||!!_.isObject(a))return b.trigger("canceled",b.model)}),app.dropdown.collapse()},a}(),models.Account=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.defaults={country:"USA",state:"OR",notes:"",description:""},a.prototype.payment_methods=[["1","Invoice"],["2","Credit Card"]],a.prototype.packages=[["1","Basic"],["2","Custom"],["3","Some Clever Name"],["3","Super Pro VIP Badass"]],a.prototype.industries=["Fishing (Fly)","Fishing (Freshwater/ Other)","Fishing (Saltwater)","Charter Boats","Kayaking (Sea/Touring)","Whitewater","Boardsailing/ Windsurfing","Surfing","SUP Lessons/Rentals","Scuba Diving/ Snorkeling","Climbing","Mountaineering","Skiing/ Snowboarding (Downhill)","Skiing (Nordic)","Bungee jumping","Hang Gliding","Para Gliding","Heli-skiing","Snowshoeing","Snowmobile Rental","Snowmobile Tours","Cycling","Sailing","Canoeing","Backpacking","Hiking","Hunting","Birdwatching","Motorcycle Tours","Off-Road Tours","Camping","Wildlife Viewing","Eco-Tours","Lodging","Adventure Travel","Equestrian/ Horseback","Scenic Tours","Motorsports","Dude Ranch","Skydive","Flightseeing / Helicopter","Boat Tours","Vehicle Tours","Photography","Spelunking","Nature Hikes/ Interpretive","Events","Educational classes","Lessons","Rentals","Other"],a.prototype.validate=function(a){var b,c,d=this;if(!a.company||a.company==="")return"You must enter a company name for the account!";if(this.collection){b=!1,_.each(this.collection.models,function(c){if(c.id!==d.id&&c.get("flybook_url")!==""&&c.get("flybook_url")===a.flybook_url)return b=!0});if(b)return"The Flybook URL you have choosen is use! Please try another."}c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(a.email&&a.email.length>0&&!a.email.match(c))return"You must use a valid email address!"},a}(),models.Client=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.url="/api/clients/",a.prototype.validate=function(a){},a}(),models.Employee=function(){function a(){this.calendar_events=__bind(this.calendar_events,this),this.is_blacked_out=__bind(this.is_blacked_out,this),this.is_guiding=__bind(this.is_guiding,this),this.is_available=__bind(this.is_available,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.defaults={email:"",phone:"",nickname:"",role:"guide",active:1,self_managed:1,blackout_dates:[],blackout_days:[]},a.prototype.roles=[["manager","Manager / Owner"],["staff","Office Staff"],["guide","Guide"],["assistant","Assistant"]],a.prototype.initialize=function(){return this.url="/api/employees/"},a.prototype.validate=function(a){var b;if(!a.id&&a.nickname==="")return"Your new employee needs a name!";if(a.id&&a.nickname==="")return"Your employee needs a name!";b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(a.email.length>0&&!a.email.match(b))return"You must use a valid email address or leave it blank."},a.prototype.is_available=function(a,b){var c,d,e,f;return b==null&&(b=!1),c=!0,a=moment(a),d=a.day(),f=this.get("blackout_days")&&this.get("blackout_days").indexOf(d)<0,f&&this.get("blackout_dates")>""&&(e=a.format("YYYY-MM-DD"),c=this.get("blackout_dates").indexOf(e)<0,c=this.get("blackout_dates").indexOf("-"+e)>=0),c},a.prototype.is_guiding=function(a){var b,c,d,e,f,g,h,i=this;b=[],e=new Backbone.Collection(app.reserved.models),h=e.models;for(f=0,g=h.length;f<g;f++)d=h[f],d=d.attributes,d.activities&&d.start_date===moment(a).format("YYYY-MM-DD")&&_.each(d.activities,function(a){if(a.guide_id===i.get("id"))return b.push({reservation:d,trip_id:d.trip_id,time:d.start_time})});return c=b.length>0?b:!1,c},a.prototype.is_blacked_out=function(a){var b,c,d;return b=!1,c=a.getDay(),b=this.get("blackout_days")&&this.get("blackout_days").indexOf(c)>=0,d=moment(a).clone().format("YYYY-MM-DD"),this.get("blackout_dates")>""&&this.get("blackout_dates").indexOf(d)>=0&&(b=!0),this.get("blackout_dates")>""&&this.get("blackout_dates").indexOf("-"+d)>=0&&(b=!1),b},a.prototype.calendar_events=function(a,b,c){var d,e,f,g,h,i=this;f=[],a=moment(a),b=moment(b);while(a<b)d=a.clone(),d.hours(22),d.add("minutes",this.get("sort_order")),g={title:this.get("nickname"),type:"employee",backgroundColor:"transparent",color:"transparent",employee:this.attributes},h=this.is_guiding(d.toDate()),h?(g.textColor="#6a6944",e=[],_.each(h,function(a){return e.push(a.reservation.order.name)}),g.title+="("+e.join(",")+")",g.start=d.toDate(),f.push(g)):this.is_blacked_out(d.toDate())?(g.textColor="#cc0000",g.title+=" (out)",g.start=d.add("minutes",90).toDate(),f.push(g)):(g.textColor="#333",g.start=d.toDate(),f.push(g)),a=a.add("days",1);return c(f)},a}(),models.Lodge=function(){function a(){this.schedule_on=__bind(this.schedule_on,this),this.calendar_events=__bind(this.calendar_events,this),this.get_party_size=__bind(this.get_party_size,this),this.get_cost=__bind(this.get_cost,this),this.room_is_available=__bind(this.room_is_available,this),this.room_is_available_between=__bind(this.room_is_available_between,this),this.is_available=__bind(this.is_available,this),this.get_availability_by_month=__bind(this.get_availability_by_month,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.defaults={name:"",style:"Lodge",description:"",end_date:"31",end_month:"12"},a.prototype.styles=["Cabin","Dormitory","Hotel","Lodge","Motel","Yurt"],a.prototype.months=[["1","Jan"],["2","Feb"],["3","Mar"],["4","Apr"],["5","May"],["6","Jun"],["7","Jul"],["8","Aug"],["9","Sep"],["10","Oct"],["11","Nov"],["12","Dec"]],a.prototype.days=["1","2","3","4","5","6","7","8","9",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],a.prototype.validate=function(a){if(!a.id&&a.name==="")return"Your new lodge needs a name!";if(a.id&&a.name==="")return"Your lodge needs a name!"},a.prototype.get_availability_by_month=function(a,b,c,d,e){var f,g,h,i,j,k;d==null&&(d=!1),e==null&&(e=!1),g=[];for(i=1,k=moment([a,b,1]).daysInMonth()+1;1<=k?i<k:i>k;1<=k?i++:i--)h=moment([a,b,i]),j=h,h>moment()&&(e&&(j=h.clone().add("days",e-1)),f=this.is_available(h.toDate(),j.toDate(),c,d),f.is_available&&g.push({availability:f,date:h,sql:h.format("YYYY-MM-DD")}));return g},a.prototype.is_available=function(a,b,c,d){var e,f,g,h,i,j,k=this;f=!0,h=!1,j=a.getTime(),b=b.getTime();while(j<=b)j=moment(j),moment()<=moment(j)&&(i=[],g=0,d&&this.room_is_available(j.clone().toDate(),d)?g=d.quantity*d.sleeps:d||(i=this.get("rooms"),g=0,_.each(i,function(a){return k.room_is_available(j.clone().toDate(),a)?g+=a.sleeps*a.quantity:i=_.without(i,a)})),g<=0&&(f=!1)),j=moment(j).add("days","1");return e={is_available:f,beds:g,occupied:h,rooms:i},e},a.prototype.room_is_available_between=function(a,b,c){var d,e;d=!1,a=a.getTime(),b=b.getTime();while(a<=b)e=new Date(a),this.room_is_available(e,c)&&(d=!0),a+=864e5;return d},a.prototype.room_is_available=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=this;return c=!1,e=a.getDate()<10?"0"+a.getDate():a.getDate(),f=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,d=f+"-"+e,m=b.start_month<10?"0"+b.start_month:b.start_month,l=b.start_date<10?"0"+b.start_date:b.start_date,h=b.end_month<10?"0"+b.end_month:b.end_month,g=b.end_date<10?"0"+b.end_date:b.end_date,j=m+"-"+l,i=h+"-"+g,j<=d&&d<=i&&(c=!0),d=moment(a),c&&(k=app.reserved.models,_.each(k,function(a){var e,f,g;f=a.get("room_id"),g=moment(a.get("start_date")),e=moment(a.get("end_date"));if(b.id===f&&g<=d&&d<=e)return c=!1})),c},a.prototype.get_cost=function(a,b,c){var d,e,f,g,h=this;return g=a.split("-"),d=g[1]+"-"+g[2],f=0,_.each(this.get("rooms"),function(b){var c,e,g,h,i;if(in_room.id.toString()===b.id.toString()){i=b.start_month<10?"0"+b.start_month:b.start_month,a=b.start_date<10?"0"+b.start_date:b.start_date,e=b.end_month<10?"0"+b.end_month:b.end_month,c=b.end_date<10?"0"+b.end_date:b.end_date,h=i+"-"+a,g=e+"-"+c;if(h<=d&&d<=g)return f=parseFloat(b.price)}}),e=f*b,e},a.prototype.get_party_size=function(a){var b;return b=0,a.get("adults")&&(b+=parseInt(a.get("adults"))),a.get("seniors")&&(b+=parseInt(a.get("seniors"))),b},a.prototype.calendar_events=function(a,b,c){var d,e,f,g=this;return d=[],e={status:"1",lodge_id:this.get("id")},f=app.reserved.where(e),_.each(f,function(a){var b,c;return c=a.get("start_date")+" 23:00:00",b=g.get_party_size(a),d.push({title:g.get("name")+", "+a.get("order").name+" ("+b+")",start:c,end:a.get("end_date"),type:"reservation",backgroundColor:"#555",color:"#555",textColor:"#fff",reservation:a.attributes})}),c(d)},a.prototype.schedule_on=function(a){var b,c,d=this;return b={booked:[],available:[],checking_in:[],checking_out:[]},c=["none","pending","confirmed","approved","hold"],_.each(this.get("rooms"),function(e){var f,g,h,i,j,k,l,m,n,o,p,q;if(d.room_is_available(a,e)){b.available.push(e),i=new Backbone.Collection(app.reserved.models),o=i.models,q=[];for(k=0,m=o.length;k<m;k++)h=o[k],g=moment(a).clone().format("YYYY-MM-DD"),f=moment(h.get("end_date")).add("days","1").format("YYYY-MM-DD"),h.attributes.room_id===e.id&&f===g?q.push(b.checking_out.push({id:h.attributes.order.id,name:h.attributes.order.name,room:e.type,status:c[h.attributes.order.status]})):q.push(void 0);return q}j=!1,i=new Backbone.Collection(app.reserved.models),p=i.models;for(l=0,n=p.length;l<n;l++)h=p[l],g=moment(a).clone().format("YYYY-MM-DD"),f=moment(h.get("end_date")).add("days","1").format("YYYY-MM-DD"),h.attributes.room_id===e.id&&(h.get("start_date")<=g&&g<=h.get("end_date")&&(j=h,j.status=c[h.attributes.order.status]),h.get("start_date")===g&&b.checking_in.push({id:h.attributes.order.id,name:h.attributes.order.name,room:e.type,status:c[h.attributes.order.status]}));if(j)return b.booked.push({id:j.attributes.order.id,name:j.attributes.order.name,party:j.head_count(),room:e.type,status:j.status})}),b},a}(),models.Order=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Model),a.prototype.defaults={status:0,adults:1,children:0,seniors:0,nights:1,discount:0,trip_reservations:[],lodge_reservations:[],purchases:[],clients:[],guests:[],payments:[],country:"USA",setup_complete:"0",add_as_guest:1,status:2,notify:"0"},a.prototype.payment_methods=[["credit","Credit Card"],["cash","Cash"],["check","Check"],["wire","Wire Transfer"],["other","Other"]],a.prototype.hours=[["00","12am"],["01","1am"],["02","2am"],["03","3am"],["04","4am"],["05","5am"],["06","6am"],["07","7am"],["08","8am"],["09","9am"],["10","10am"],["11","11am"],["12","12pm"],["13","1pm"],["14","2pm"],["15","3pm"],["16","4pm"],["17","5pm"],["18","6pm"],["19","7pm"],["20","8pm"],["21","9pm"],["22","10pm"],["23","11pm"]],a.prototype.minutes=["00","05","10","15","20","25","30","35","40","45","50","55"],a.prototype.statuses=[["0","Special/Reserved"],["1","New From Web"],["2","New From Admin"],["3","Approved"],["4","On hold"]],a.prototype.validate=function(a){if(a.included_nights>0)return"WARNING: You have a package with included lodging nights that need be added.";if(!a.name||a.name===""||a.client&&a.client.name==="")return"Please enter a primary contact name in CLIENT INFO to save this reservation"},a}(),models.Page=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Model),a.prototype.defaults={title:"New Webpage",content:"",summary:""},a}(),models.Payment=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.url="/api/payments",a.prototype.validate=function(a){},a}(),models.Product=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.defaults={name:"",description:"",price:0,sale_price:0},a.prototype.validate=function(a){if(!a.id&&a.name==="")return"Your new product needs a name!";if(a.id&&a.name==="")return"Your product needs a name!"},a}(),models.Reservation=function(){function a(){this.party_detail=__bind(this.party_detail,this),this.head_count=__bind(this.head_count,this),this.match_pricing=__bind(this.match_pricing,this),this.get_lodge_pricing=__bind(this.get_lodge_pricing,this),this.set_all_dates=__bind(this.set_all_dates,this),this.formatted_lodging_dates=__bind(this.formatted_lodging_dates,this),this.validate=__bind(this.validate,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.defaults={adults:1,children:0,seniors:0,email:"",name:"",status:"pending",notes:""},a.prototype.validate=function(a){},a.prototype.formatted_lodging_dates=function(){var a,b,c;return this.set_all_dates(),c=app.helpers.sqldate_to_js(this.get("start_date")),a=app.helpers.sqldate_to_js(this.get("end_date")),b="Check In: "+app.helpers.js_to_slash(c)+"  Check Out: "+app.helpers.js_to_slash(this.get("check_out")),b},a.prototype.set_all_dates=function(){var a,b,c,d,e,f,g;f=app.helpers.sqldate_to_js(this.get("start_date")),c=app.helpers.sqldate_to_js(this.get("end_date")),a=new Date(c.getTime()+864e5),this.set("check_out",a,{silent:!0}),this.set("check_in",f),g=f.getTime(),d=c.getTime(),e=[];while(g<=d)g+=828e5,b=new Date(g),e.push({date:b,sql:app.helpers.jsdate_to_sql(b)});return this.set("nights",e),this},a.prototype.get_lodge_pricing=function(a,b,c){var d,e,f,g,h,i=this;return c==null&&(c=!1),h=this.get("start_date"),g=h.split("-"),d=g[1]+"-"+g[2],f=0,_.each(a.get("rooms"),function(a){var b,e,g,h,i,j;if(!c)return f=300;if(c.id.toString()===a.id.toString()){j=a.start_month,i=a.start_date,j<10&&(j="0"+j),i<10&&(i="0"+i),e=a.end_month,b=a.end_date,e<10&&(e="0"+e),b<10&&(b="0"+b),h=j+"-"+i,g=e+"-"+b;if(h<=d&&d<=g)return f=parseFloat(a.price)}}),e=f*b,e},a.prototype.match_pricing=function(a,b){var c,d=this;return c={"default":0,single:0},_.each(b,function(b){if(parseInt(b.people)<2)return c.single=parseInt(b.price),c["default"]=parseInt(b.price);if(a>=parseInt(b.people))return c["default"]=parseInt(b.price),c.group=parseInt(b.price)}),c},a.prototype.head_count=function(a){var b;return a==null&&(a=!0),b=0,this.get("adults")&&(b+=parseInt(this.get("adults"))),this.get("seniors")&&(b+=parseInt(this.get("seniors"))),this.get("children")&&a&&(b+=parseInt(this.get("children"))),b},a.prototype.party_detail=function(){var a,b,c,d,e,f,g;return b=parseInt(this.get("adults")),a=b>1?b+" Adults":"1 Adult",c=parseInt(this.get("children")),d=c>1?c+" Children":"1 Child",f=parseInt(this.get("seniors")),g=f>1?f+" Seniors":"1 Seniors",e=a,c&&(e+=", "+d),f&&(e+=", "+g),e},a}(),models.Schedule=function(){function a(){this.update_dates_and_times=__bind(this.update_dates_and_times,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.initialize=function(){var a=this;return this.on("error",function(a,b){return _.isString(b)||(b=b.responseText),app.notifications.error(b)})},a.prototype.url="/api/schedules/",a.prototype.defaults={start_time:"08:00",end_time:"18:00"},a.prototype.hours=[["00","12am"],["01","1am"],["02","2am"],["03","3am"],["04","4am"],["05","5am"],["06","6am"],["07","7am"],["08","8am"],["09","9am"],["10","10am"],["11","11am"],["12","12pm"],["13","1pm"],["14","2pm"],["15","3pm"],["16","4pm"],["17","5pm"],["18","6pm"],["19","7pm"],["20","8pm"],["21","9pm"],["22","10pm"],["23","11pm"]],a.prototype.minutes=["00","05","10","15","20","25","30","35","40","45","50","55"],a.prototype.validate=function(a){},a.prototype.update_dates_and_times=function(a,b,c){var d,e,f=this;return b==null&&(b=!1),c==null&&(c=!1),b?this.set("start_date",app.helpers.jsdate_to_sql(b)):(d=this.get("start_date").split("-"),b=new Date(d[0],d[1]-1,d[2])),c||(this.get("end_date")?(d=this.get("end_date").split("-"),c=new Date(d[0],d[1]-1,d[2])):this.get("duration")>1?(e=b.getTime(),c=new Date(e+9e7*(this.get("duration")-1))):c=b),this.set("end_date",app.helpers.jsdate_to_sql(c)),this.set("js_start",b),this.set("js_end",c),d=this.get("start_time").split(":"),this.set("start_hr",d[0]),this.set("start_min",d[1]),d=this.get("end_time").split(":"),this.set("end_hr",d[0]),this.set("end_min",d[1]),_.each(a,function(a){var d;return d=a.is_available(b,c),a.set("is_available",d,{silent:!0})}),this.set("staff",a)},a}(),models.DataStore=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Model),a.prototype.defaults={name:"",type:"text"},a.prototype.validate=function(a){if(!a.name||a.name==="")return"You need to ask a question if you want an answer."},a.prototype.types=[["text","Stanard Text Answer"],["textarea","Longer Text Answer"],["short","Short Text Answer"],["number","Number"],["dropdown","Dropdown Menu"],["radio","Multiple Choice, Choose One"],["checkbox","Multiple Choice, Choose Many"]],a}(),models.Trip=function(){function a(){this.schedule_on=__bind(this.schedule_on,this),this.activity_on=__bind(this.activity_on,this),this.get_guides_and_groups=__bind(this.get_guides_and_groups,this),this.calendar_events=__bind(this.calendar_events,this),this.create_activity=__bind(this.create_activity,this),this.match_pricing=__bind(this.match_pricing,this),this.get_cost_breakdown=__bind(this.get_cost_breakdown,this),this.is_available=__bind(this.is_available,this),this.get_availability_by_month=__bind(this.get_availability_by_month,this),this.set_all_dates=__bind(this.set_all_dates,this),this.formatted_dates=__bind(this.formatted_dates,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Model),a.prototype.defaults={hour:"08",minute:"00",name:"",location:"",description:"",toggled:!0,scheduled:0,end_date:"31",end_month:"12",end_year:"2012",group_size:4},a.prototype.hours=[["00","12am"],["01","1am"],["02","2am"],["03","3am"],["04","4am"],["05","5am"],["06","6am"],["07","7am"],["08","8am"],["09","9am"],["10","10am"],["11","11am"],["12","12pm"],["13","1pm"],["14","2pm"],["15","3pm"],["16","4pm"],["17","5pm"],["18","6pm"],["19","7pm"],["20","8pm"],["21","9pm"],["22","10pm"],["23","11pm"]],a.prototype.minutes=["00","05","10","15","20","25","30","35","40","45","50","55"],a.prototype.months=[["1","Jan"],["2","Feb"],["3","Mar"],["4","Apr"],["5","May"],["6","Jun"],["7","Jul"],["8","Aug"],["9","Sep"],["10","Oct"],["11","Nov"],["12","Dec"]],a.prototype.days=["1","2","3","4","5","6","7","8","9",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],a.prototype.years=["2012","2013","2014","2015","2016","2017","2018","2019"],a.prototype.capacity_options=[["0","Guide Availability"],["1","Max Trip Capacity"]],a.prototype.include_options=[["0","Not Included"],["1","Included"],["2","Upsell"]],a.prototype.colors=[["1","Color One"],["2","Color Two"],["3","Color Three"],["4","Color Four"],["5","Color Five"],["6","Color Six"],["7","Color Seven"],["8","Color Eight"],["9","Color Nine"]],a.prototype.validate=function(a){if(!a.id&&a.name==="")return"Your trip, activity or package needs a name!";if(a.id&&a.name==="")return"Your trip, activity or package needs a name!";if(a.id&&parseInt(a.group_size)===0)return"Your guides must be pretty lazy... You have a zero for Group Size in AVAILABILITY"},a.prototype.formatted_dates=function(a){var b,c,d,e;return a==null&&(a=!1),this.set_all_dates(this.get("start_date")),e=this.get("start_date"),b=this.get("end_date"),d=a?app.helpers.js_to_slash(this.get("check_in_date")):app.helpers.js_to_slash(this.get("start_date_js")),e<b&&(c=a?app.helpers.js_to_slash(this.get("check_out_date")):app.helpers.js_to_slash(this.get("end_date_js")),d+=" - "+c),d},a.prototype.set_all_dates=function(a){var b,c,d,e,f,g,h,i;this.set("start_date",moment(a).format("YYYY-MM-DD")),this.set("start_date_js",moment(a).toDate()),f=[];for(b=0,h=this.get("duration");0<=h?b<h:b>h;0<=h?b++:b--)f.push({date:moment(a).add("days",b).toDate(),sql:moment(a).add("days",b).format("YYYY-MM-DD")});g=[],d=parseInt(this.get("lodging_nights")),e=this.get("arrive_night_prior")==="1"?-1:0;for(c=e,i=d+e;e<=i?c<i:c>i;e<=i?c++:c--)g.push({date:moment(a).add("days",c).toDate(),sql:moment(a).add("days",c).format("YYYY-MM-DD")});return this.set("trip_dates",f),this.set("nights",g),this.set("check_in_date",moment(a).add("days",e).toDate()),this.set("check_in_sql",moment(a).add("days",e).format("YYYY-MM-DD")),this.set("check_out_date",moment(a).add("days",d+e-1).toDate()),this.set("check_out_sql",moment(a).add("days",d+e-1).format("YYYY-MM-DD")),this.set("end_date",moment(a).add("days",this.get("duration")-1).format("YYYY-MM-DD")),this.set("end_date_js",moment(a).add("days",this.get("duration")-1).toDate()),this},a.prototype.get_availability_by_month=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;d==null&&(d=!1),e==null&&(e=!1),q=[];for(i=1,t=moment([a,b,1]).daysInMonth()+1;1<=t?i<t:i>t;1<=t?i++:i--){h=moment([a,b,i]),p=!1;if(h>moment()){m=moment([a,this.get("season_start_month")-1,this.get("season_start_date")]),l=moment([a,this.get("season_end_month")-1,this.get("season_end_date")]),k=m<=h&&h<=l;if(k){j=h.day();if(this.get("start_days")===""||this.get("start_days")&&this.get("start_days").indexOf(j)>=0)p=!0;this.get("start_dates")>""&&(n=h.format("YYYY-MM-DD"),this.get("start_dates").indexOf("-"+n)>0?p=!1:this.get("start_dates").indexOf(n)>0&&(p=!0)),f=!1;if(p){this.get("activity_id")>"1"?app.trips.grab?g=app.trips.grab(this.get("activity_id")):g=app.trips.get(this.get("activity_id")):g=this,this.set_all_dates(h),u=this.get("trip_dates");for(r=0,s=u.length;r<s;r++)o=u[r],f=g.is_available(o.date,c,d,e)}}}p&&f.is_available&&q.push({date:h.toDate(),sql:h.format("YYYY-MM-DD"),times:f.times})}return q},a.prototype.is_available=function(a,b,c,d){var e,f,g,h,i;return d==null&&(d=!1),a=moment(a),e={},f=a.format("YYYY-MM-DD"),g=moment(),a<g&&(f=!1),i=this.schedule_on(a.toDate(),c),i?(h=i[0].program.available,h<b&&(f=!1)):f=!1,e.is_available=f,e},a.prototype.get_cost_breakdown=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this;return m=a.attributes?a.attributes:a,b=parseInt(m.adults),c=parseInt(m.children),o=parseInt(m.seniors),k=this.get("pricing"),n=this.get("deposit_rules"),g=this.get("fees"),h=[],j=[],_.each(k,function(a){if(!a.start_date||a.start_date==="0000-00-00")return j.push(a);if(a.start_date<s.get("start_date")&&s.get("end_date")<a.end_date)return h.push(a)}),h.length===0&&(h=j),h.length===0&&app.notifications.notify("Unable to match a price to selected dates! Pricing for this trip may not be configured correctly."),l=this.match_pricing(b,h),e={adults:0,children:0,seniors:0},parseInt(b)>1?e.adults=l["default"]*b:e.adults=l.single,c&&this.get("child_rate")&&(e.children=c*this.get("child_rate")),o&&trip.get("senior_rate")&&(e.seniors=o*this.get("senior_rate")),e.total=e.adults+e.seniors+e.children,q=new Date,p=app.helpers.sqldate_to_js(m.start_date),f=(p.getTime()-q.getTime())/864e5,i=100,_.each(n,function(a){if(a.days_prior<f&&i>a.percent_due)return i=a.percent_due}),e.deposit=Math.ceil(e.total*(i/100)),d=[],r=0,e.fees=0,_.each(g,function(a){var b;return a.percent?b=Math.round(e.total*(parseFloat(a.percent)/100)):b=parseFloat(a.flat),r+=parseFloat(b),d.push({name:a.name,amount:b})}),e.total+=parseFloat(r),e.fees+=parseFloat(r),e.fee_structure=d,e},a.prototype.match_pricing=function(a,b){var c,d=this;return c={"default":0,single:0},_.each(b,function(b){if(parseInt(b.people)<2)return c.single=parseInt(b.price),c["default"]=parseInt(b.price);if(a>=parseInt(b.people))return c["default"]=parseInt(b.price),c.group=parseInt(b.price)}),c},a.prototype.create_activity=function(a,b,c){var d,e,f,g,h,i,j,k=this;return c==null&&(c=!1),a.activities=[],h=[a],g=parseInt(a.adults)+parseInt(a.children)+parseInt(a.seniors),f=parseInt(this.get("group_size")),i=this.get("trip_dates"),this.get("activity_id")>"1"?(j=this.get("activity_id"),d=app.trips.list.collection.get(this.get("activity_id")).clone(),e=!0):(j=this.get("id"),d=this,e=!0),_.each(i,function(f){var i,k,l,m,n,o,p;o=h[0],o.activities=[],e&&(i=(new models.Reservation(a)).clone().attributes,i.trip_id=j,i.id=Math.random()*3e3,i.trip=d.attributes,i.name=d.attributes.name,i.total=0,i.deposit=0,i.start_date=f.sql,i.end_date=f.sql,i.start_date_js=f.date,i.end_date_js=f.date,i.created_on=moment().format("YYYY-MM-DD HH:mm:ss"),i.activities=[],h.push(i),o=i),k=d.schedule_on(f.date,b),l=g,n=k[0].program.schedule,m=c,p=[];while(l>0)c&&_.each(n,function(d){var e,g,h,i;if(d.space>0&&l>0&&d.guide.id===c&&m)return h=d.guide.id,g=d.guide,i=d.space,l<i&&(i=l),e={trip_id:j,reservation_id:o.id,guide_id:h,guide:g,group_number:d.number,people:i,date:f.sql,start_time:b,cleanup:!0},o.activities.push(e),a.activities.push(e),l-=i,m=!1}),p.push(_.each(n,function(c){var d,e,g,h;if(c.space>0&&l>0)return g=c.guide.id,e=c.guide,h=c.space,l<h&&(h=l),d={trip_id:j,reservation_id:o.id,guide_id:g,guide:e,group_number:c.number,people:h,date:f.sql,start_time:b,cleanup:!0},o.activities.push(d),a.activities.push(d),l-=h}));return p}),console.log(h),h},a.prototype.calendar_events=function(a,b,c){var d,e,f,g=this;return d=[],e={status:"1",trip_id:this.get("id")},f=app.reserved.where(e),_.each(f,function(a){var b,c;return c=a.get("start_date"),a.get("start_time")?c+=" "+a.get("start_time"):c+=" 06:00:00",b=parseInt(a.get("adults"))+parseInt(a.get("children"))+parseInt(a.get("seniors")),d.push({title:g.get("name")+", "+a.get("order").name+" ("+b+")",start:c,end:a.get("end_date"),type:"reservation",backgroundColor:"#6a6944",color:"#6a6944",textColor:"#fff",reservation:a.attributes})}),c(d)},a.prototype.get_guides_and_groups=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this;g=[],f=this.get("group_size"),f<=0&&(f=2),this.get("capacity_only")==="1"&&(e=this.get("capacity")/f,g=function(){p=[];for(var a=0;0<=e?a<e:a>e;0<=e?a++:a--)p.push(a);return p}.apply(this)),c=this.get("guides_assigned")?this.get("guides_assigned").split(","):!1,d=app.employees.list?app.employees.list.collection:app.employees;if(!c){i=[],n=d.models;for(k=0,m=n.length;k<m;k++)h=n[k],i.push(h)}else i=[],_.each(c,function(a){return i.push(d.get(a))});return _.each(i,function(b,c){var d;d=b&&b.attributes?b.is_guiding(a):!1;if(d)return _.each(d,function(a){if(a.trip_id!==r.get("id"))return i=_.without(i,b)});if(b&&b.is_blacked_out(a))return i=_.without(i,b)}),this.get("capacity_only")==="0"&&(g=function(){q=[];for(var a=0,b=i.length;0<=b?a<b:a>b;0<=b?a++:a--)q.push(a);return q}.apply(this)),{groups:g,guides:i}},a.prototype.activity_on=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;i=[],h=[],D=["none","pending","confirmed","approved","hold"],n=new Backbone.Collection(app.reserved.models),z=n.models;for(p=0,t=z.length;p<t;p++){m=z[p],C=m.attributes;if(C.activities){k=[];if(C.order.guests){A=C.order.guests;for(q=0,u=A.length;q<u;q++)g=A[q],k.push(g)}B=C.activities;for(r=0,v=B.length;r<v;r++){c=B[r];if(c.trip_id===this.get("id")&&c.date===moment(a).format("YYYY-MM-DD"))if(!b||c.start_time===b||c.start_time===b+":00"){l=parseInt(c.people),o=c.client_ids?c.client_ids.split(","):[],f=[];for(s=0,w=o.length;s<w;s++){j=o[s];for(y=0,x=k.length;y<x;y++)e=k[y],e.id===j&&k.splice(q,1)}for(d=0;0<=l?d<l:d>l;0<=l?d++:d--)o[d]&&app.clients.get(f[d])?e=app.clients.get(f[d]):k&&k.length>0?(e=k[0],k.splice(0,1)):e={id:"none",name:C.order.name+" (guest)"},f.push(e);i.push({id:C.order.id,activity_id:c.id,reservation_id:C.id,name:C.order.name,status:D[C.order.status],people:l,guide_id:c.guide_id,group_number:c.group_number,clients:f})}}}}return i},a.prototype.schedule_on=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;b==null&&(b=!1);if(this.get("activity_id")>"1"||this.get("activities_scheduled")==="1")return!1;u=a.getFullYear(),q=moment([u,this.get("season_start_month")-1,this.get("season_start_date")]),p=moment([u,this.get("season_end_month")-1,this.get("season_end_date")]),l=q<=a&&a<=p;if(!l)return!1;t=[],r=_.isString(this.get("start_times"))&&this.get("start_times")!==""?this.get("start_times").split(","):!1,b?s=[b]:r?s=r:s=[!1];for(v=0,z=s.length;v<z;v++){b=s[v],o=[],f=0,g=this.get_guides_and_groups(a,b),k=g.guides,j=g.groups,i=this.get("group_size"),e=i*j.length,c=this.activity_on(a,b);for(w=0,A=j.length;w<A;w++){h=j[w],k[w]?h={guide:k[w].attributes,number:w+1,available:function(){D=[];for(var a=0;0<=i?a<i:a>i;0<=i?a++:a--)D.push(a);return D}.apply(this),space:parseInt(i),empty:!0,time:b}:h={guide:{nickname:"Group "+(w+1),id:"capacity "+(w+1)},available:function(){E=[];for(var a=0;0<=i?a<i:a>i;0<=i?a++:a--)E.push(a);return E}.apply(this),space:parseInt(i),empty:!0,time:b,number:w+1,id:this.get("id")},h.filled=0,h.reservations=[],h.clients=[];for(C=0,B=c.length;C<B;C++)d=c[C],parseInt(d.group_number)===parseInt(h.number)&&(m=parseInt(d.people),f+=m,h.filled+=m,h.available.splice(0,m),h.space-=m,h.empty=!1,h.reservations.push(d));h.filled=h.filled+"/"+i,o.push(h)}n={schedule:o,capacity:e,available:e-f,reserved:f},f<=0&&(n.empty=!0),t.push({time:b,program:n})}return t},a}(),models.User=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Model),a.prototype.defaults={email:"",password:""},a.prototype.url="/api/users/",a.prototype.validate=function(a){},a}(),views.AccountForm=function(){function a(){this.make_admin=__bind(this.make_admin,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .new-user-account":"make_admin"},a.prototype.make_admin=function(){return this.trigger("created:admin",this.model)},a}(),views.CalendarDayView=function(){function a(){this.get_arrivals_and_departures=__bind(this.get_arrivals_and_departures,this),this.get_lodging_schedule=__bind(this.get_lodging_schedule,this),this.get_trip_schedule=__bind(this.get_trip_schedule,this),this.edit_daily=__bind(this.edit_daily,this),this.edit_manifest=__bind(this.edit_manifest,this),this.make_reservation=__bind(this.make_reservation,this),this.edit_reservation=__bind(this.edit_reservation,this),this.toggle_clients=__bind(this.toggle_clients,this),this.toggle_available_staff=__bind(this.toggle_available_staff,this),this.toggle_availability=__bind(this.toggle_availability,this),this.show_sources=__bind(this.show_sources,this),this.show_focus_date=__bind(this.show_focus_date,this),this.setup_drag_n_drop=__bind(this.setup_drag_n_drop,this),this.render=__bind(this.render,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Form),a.prototype.events={"click .reservation":"edit_reservation","click .available":"make_reservation","click .trip h4":"edit_manifest","click .guide-name":"edit_daily"},a.prototype.el="#day-view",a.prototype.init=function(){return this.model=new Backbone.Model({"sha-space":app.helpers.cookie("show_available"),"sha-staff":app.helpers.cookie("show_available_staff"),"sha-client":app.helpers.cookie("show_clients")}),this.on("changed:sha-space",this.toggle_availability),this.on("changed:sha-staff",this.toggle_available_staff),this.on("changed:sha-client",this.toggle_clients)},a.prototype.render=function(a,b){var c,d,e,f,g;return this.date=a,this.sources=b,d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=this.get_lodging_schedule(this.date),g=this.get_arrivals_and_departures(moment(this.date).format("YYYY-MM-DD")),f&&f.length>0&&(e=!0),c={lodging:f,trips:this.get_trip_schedule(this.date),arrivals:g.arriving,departures:g.departing,slash:moment(this.date).format("ddd M/D"),sql:moment(this.date).format("YYYY-MM-DD"),label:d[this.date.getDay()]+", "+$.fullCalendar.formatDate(this.date,"MMMM dS yyyy")},$(this.el).html(tmpl["calendar/day"](c)),this.toggle_availability(),this.toggle_available_staff(),this.toggle_clients(),this.show_focus_date(),this.setup_drag_n_drop(),this.show_sources(this.sources)},a.prototype.setup_drag_n_drop=function(){return $(".reservation").draggable({zIndex:5e4,cancel:".client",revert:!0}),$(".available").droppable({over:function(a,b){return $(this).css({background:"#fff"})},out:function(a,b){return $(this).css({background:"#eee"})},drop:function(a,b){var c,d,e,f,g,h=this;return c=b.draggable.attr("data-activity"),f=b.draggable.attr("data-people"),g=e=$(this).parent().attr("data-space"),e=$(this).parent().attr("data-number"),d=$(this).parent().parent().parent().attr("data-sql"),f>g?app.notifications.confirm("There is not enough space in the gudie group for this record to fit. Move it anyway?",function(){return app.reserved.update_activity(c,e,d)}):app.reserved.update_activity(c,e,d)}})},a.prototype.show_focus_date=function(){var a;return $(".week").removeClass("fb-highlight"),a=moment(this.date.getTime()).format("YYYY-MM-DD"),$("."+a).addClass("fb-highlight")},a.prototype.show_sources=function(a){var b=this;return this.sources=a,$(".trip,.lodge,.guide").css({display:"none"}),$(".capacity").css({display:"block"}),this.sources&&_.each(this.sources,function(a){var b;return b=a.split(":"),$("."+b[0]).css({display:"block"})}),$(".generic").css({display:"block"})},a.prototype.toggle_availability=function(){var a,b,c;return c=this.model.get("sha-space"),app.helpers.cookie("show_available",c),b=c>0?"block":"none",a=c>0?!0:!1,$(".available").css({display:b}),$(".sha-space input").attr("checked",a)},a.prototype.toggle_available_staff=function(){var a,b,c;return c=this.model.get("sha-staff"),app.helpers.cookie("show_available_staff",c),b=c>0?"block":"none",a=c>0?!0:!1,$(".empty").css({display:b}),$(".sha-staff input").attr("checked",a)},a.prototype.toggle_clients=function(){var a,b,c;return c=this.model.get("sha-client"),app.helpers.cookie("show_clients",c),b=c>0?"block":"none",a=c>0?!0:!1,$(".client").css({display:b}),b=c>0?"none":"block",$(".client-group").css({display:b}),$(".sha-client input").attr("checked",a)},a.prototype.edit_reservation=function(a){var b;return b=$(a.target).attr("id"),$(a.target).hasClass("client-group")||$(a.target).hasClass("lodging")?window.location.hash="#reservation/edit/"+b:window.location.hash="#clients/edit/"+b},a.prototype.make_reservation=function(a){var b,c,d,e,f,g;return e=$(a.target),c=e.attr("id"),f=e.attr("data-sql"),e.hasClass("seat")?(b=e.attr("data-guide"),g=e.attr("data-time")>""?"/"+e.attr("data-time"):"",window.location.hash="#reservation/guide/"+c+"/"+f+"/"+b+g):(d=e.attr("data-room"),window.location.hash="#reservation/room/"+c+"/"+f+"/"+d)},a.prototype.edit_manifest=function(a){var b,c,d,e;return c=$(a.target).parent(),e=c.attr("class").replace(/trip\ /,""),b=c.attr("data-sql"),d=c.attr("data-time")?"/"+c.attr("data-time"):"",window.location.hash="#manifest/"+e+"/"+b+d},a.prototype.edit_daily=function(a){},a.prototype.get_trip_schedule=function(a){var b,c=this;return b=[],_.each(app.trips.list.collection.models,function(c){var d;return d=c.schedule_on(a),_.each(d,function(a){if(a.program)return a.time&&(a.start=app.helpers.twenty_four_to_twelve(a.time),a.twofour=a.time),b.push({time:a,trip:c.attributes,schedule:a.program.schedule,available:a.program.reserved+"/"+a.program.capacity,empty:a.program.empty})})}),b},a.prototype.get_lodging_schedule=function(a){var b,c=this;return b=[],_.each(app.lodging.list.collection.models,function(c){var d;return d=c.schedule_on(a),b.push({lodge:c.attributes,schedule:d})}),b},a.prototype.get_arrivals_and_departures=function(a){var b,c,d,e,f=this;return b={},c={},_.each(app.reserved.models,function(d){var e;e=d.attributes.order,e.arriving_on===a&&(b[e.arriving_at]||(b[e.arriving_at]={time:app.helpers.twenty_four_to_twelve(e.arriving_at),parties:[]}),b[e.arriving_at][e.id]||(b[e.arriving_at][e.id]=!0,b[e.arriving_at].parties.push({who:e.name,via:e.arriving_by})));if(e.departing_on===a){c[e.departing_at]||(c[e.departing_at]={time:app.helpers.twenty_four_to_twelve(e.departing_at),parties:[]});if(!c[e.departing_at][e.id])return c[e.departing_at][e.id]=!0,c[e.departing_at].parties.push({who:e.name,via:e.departing_by})}}),d=[],_.each(b,function(a){return d.push(a)}),e=[],_.each(c,function(a){return e.push(a)}),{arriving:d,departing:e}},a}(),views.CalendarPrompt=function(){function a(){this.close=__bind(this.close,this),this.show=__bind(this.show,this),this.create=__bind(this.create,this),this.render=__bind(this.render,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el="body",a.prototype.events={"click .screen":"close","click .close":"close"},a.prototype.render=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;return e=$.fullCalendar.formatDate(a,"MMMM dS yyyy"),f=$.fullCalendar.formatDate(b,"MMMM dS yyyy"),e=e!==f?e+" to "+f:e,j=$.fullCalendar.formatDate(a,"yyyy-MM-dd"),i=$.fullCalendar.formatDate(b,"yyyy-MM-dd"),i=j!==i?"/"+i:"",d={display:e,start:j,end:i,trips:app.trips.list.collection.models,lodges:app.lodging.list.collection.models},g=(d.trips.length+d.lodges.length)*45,m=$(window).width(),l=$(window).height(),k=150,h=(m-380)/2,this.create(),$(".pad").html(tmpl["calendar/prompt"](d)),this.show(k,h,g)},a.prototype.create=function(){return $(this.el).append('<div class="prompt"><div class="pad"></div></div><div class="screen"></div>')},a.prototype.show=function(a,b,c){return $(".prompt").css({opacity:1,width:380,height:c+"px",top:a+"px",left:b+"px"}),$(".pad").css({height:c-20+"px"})},a.prototype.close=function(){return $(".screen,.prompt").remove()},a}(),views.CalendarView=function(){function a(){this.unrender=__bind(this.unrender,this),this.resize=__bind(this.resize,this),this.refresh=__bind(this.refresh,this),this.render=__bind(this.render,this),this.init_sources=__bind(this.init_sources,this),this.get_source=__bind(this.get_source,this),this.remove_event_source=__bind(this.remove_event_source,this),this.add_event_source=__bind(this.add_event_source,this),this.set_focus_date=__bind(this.set_focus_date,this),this.next=__bind(this.next,this),this.prev=__bind(this.prev,this),this.event_clicked=__bind(this.event_clicked,this),this.dates_selected=__bind(this.dates_selected,this),this.switch_view=__bind(this.switch_view,this),this.init_fullcalendar=__bind(this.init_fullcalendar,this),this.month_view=__bind(this.month_view,this),this.week_view=__bind(this.week_view,this),this.day_view=__bind(this.day_view,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.View),a.prototype.el="#app",a.prototype.events={"click .next":"next","click .prev":"prev","click .day":"day_view","click .week":"week_view","click .month":"month_view"},a.prototype.day_view=function(){return this.switch_view("day"),this.day.render(this.date,this.sources)},a.prototype.week_view=function(){return this.switch_view("week",!1),this.week.render(this.date,this.sources)},a.prototype.month_view=function(){var a;return this.init_fullcalendar(),this.switch_view("month",!1),a=$("#month-view").fullCalendar("render").fullCalendar("select",this.date).fullCalendar("getDate")},a.prototype.init_fullcalendar=function(){var a;return a={header:{left:"",center:"",right:"title"},selectable:!0,select:this.dates_selected,eventClick:this.event_clicked,eventSources:null,month:app.month,year:app.year,height:$(window).height()-130},$("#month-view").fullCalendar("destroy").fullCalendar(a),this.init_sources(app.helpers.cookie("event_sources"))},a.prototype.switch_view=function(a,b){return this.view=a,b==null&&(b=!0),b&&this.view==="month"&&this.init_fullcalendar(),$(".cal-buttons button").removeClass("selected"),$(".cal-buttons ."+this.view).addClass("selected"),$(".schedule-view").css({display:"none"}),$("#"+this.view+"-view").css({display:"block"}),app.helpers.cookie("calendar_view",this.view),this.trigger("changed:view",this.view)},a.prototype.dates_selected=function(a,b,c,d){var e;e=$.fullCalendar.formatDate(a,"yyyy-MM-dd"),this.date=a,this.trigger("selected:date",e,this.date);if(this.view==="month"&&d)return this.prompt.render(a,b,d)},a.prototype.event_clicked=function(a,b){if(a.reservation&&a.reservation.order)return window.location.hash="#reservation/edit/"+a.reservation.order.id;if(a.employee)return window.location.hash="#staff/edit/"+a.employee.id},a.prototype.prev=function(){var a;return this.view==="month"&&(this.date=new Date(this.date.getFullYear(),this.date.getMonth()-1,this.date.getDate())),this.view==="week"&&(this.date=new Date(this.date.getTime()-6048e5)),this.view==="day"&&(this.date=new Date(this.date.getTime()-864e5)),this.set_focus_date(null,this.date),a=$.fullCalendar.formatDate(this.date,"yyyy-MM-dd"),this.trigger("selected:date",a,this.date)},a.prototype.next=function(){var a;return this.view==="month"&&(this.date=new Date(this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate())),this.view==="week"&&(this.date=new Date(this.date.getTime()+6048e5)),this.view==="day"&&(this.date=new Date(this.date.getTime()+864e5)),this.set_focus_date(null,this.date),a=$.fullCalendar.formatDate(this.date,"yyyy-MM-dd"),this.trigger("selected:date",a,this.date)},a.prototype.set_focus_date=function(a,b){this.date=b,this.view==="month"&&$("#month-view").fullCalendar("gotoDate",this.date).fullCalendar("unselect").fullCalendar("select",this.date),this.view==="week"&&this.week.render(this.date,this.sources);if(this.view==="day")return this.day.render(this.date,this.sources)},a.prototype.add_event_source=function(a){var b;return _.indexOf(this.sources,a)<0&&(this.sources.push(a),app.helpers.cookie("event_sources",this.sources.join("|")),b=this.get_source(a),$("#month-view").fullCalendar("addEventSource",b)),this.week.show_sources(this.sources)},a.prototype.remove_event_source=function(a){var b;return this.sources=_.without(this.sources,a),app.helpers.cookie("event_sources",this.sources.join("|")),b=this.get_source(a),$("#month-view").fullCalendar("removeEventSource",b),this.week.show_sources(this.sources)},a.prototype.get_source=function(a){var b,c,d,e,f;e=a.split(":"),d={id:e[0],type:e[1]};if(d.type==="staff"){c=app.employees.list.collection.get(d.id);if(!c)return!1;d.events=c.calendar_events}if(d.type==="trip"){f=app.trips.list.collection.get(d.id);if(!f)return!1;d.events=f.calendar_events}if(d.type==="lodge"){b=app.lodging.list.collection.get(d.id);if(!b)return!1;d.events=b.calendar_events}return d},a.prototype.init_sources=function(a){var b=this;this.sources=a?a.split("|"):[];if(this.sources)return _.each(this.sources,function(a){var c;c=b.get_source(a);if(c)return $("#month-view").fullCalendar("addEventSource",c)})},a.prototype.render=function(a){var b,c;return this.view=a!=null?a:"week",c=(new Date).getDate(),this.date=new Date(app.year,app.month,app.focus_day),b=$.fullCalendar.formatDate(this.date,"yyyy-MM-dd"),this.trigger("selected:date",b,this.date),$(this.el).html(tmpl["calendar/main"]()),this.init_sources(app.helpers.cookie("event_sources")),this.prompt=new views.CalendarPrompt,this.week=new views.CalendarWeekView,this.day=new views.CalendarDayView,$(window).bind("resize",this.resize),app.helpers.cookie("calendar_view")&&(this.view=app.helpers.cookie("calendar_view"),this.view==="eek"&&(this.view="week"),this.view==="onth"&&(this.view="month"),this.view==="ay"&&(this.view="day")),this.view==="week"&&this.week.render(this.date,this.sources),this.view==="day"&&this.day.render(this.date,this.sources),this.switch_view(this.view)},a.prototype.refresh=function(){return $("#month-view").fullCalendar("refetchEvents"),this.week.render(this.date,this.sources),this.day.render(this.date,this.sources)},a.prototype.resize=function(){var a=this;return window.clearTimeout(app.helpers.timer),app.helpers.delay(300,function(){var a,b;return b=$(window).width()-300,a=$(window).height()-130,app.helpers.after_transition("#app",function(){return $("#month-view").fullCalendar("option","height",a).fullCalendar("render")}),$("#app").css({width:b+"px"})})},a.prototype.unrender=function(){$(window).unbind("resize"),$(this.el).empty();if(this.week)return this.week.undelegateEvents(),this.day.undelegateEvents(),delete this.week,delete this.day,delete this.prompt},a}(),views.CalendarWeekView=function(){function a(){this.render=__bind(this.render,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,views.CalendarDayView),a.prototype.el="#week-view",a.prototype.render=function(a,b){var c,d,e,f,g,h,i,j;this.date=a,this.sources=b,i=moment(this.date).clone().subtract("days",this.date.getDay()).toDate(),g=moment(i.getTime()).add("days",6).toDate(),d=[],h=moment(i.getTime()),e=!1;while(h<=g)f=this.get_lodging_schedule(h.toDate()),j=this.get_arrivals_and_departures(h.format("YYYY-MM-DD")),f&&f.length>0&&(e=!0),d.push({lodging:f,trips:this.get_trip_schedule(h.toDate()),arrivals:j.arriving,departures:j.departing,slash:h.format("ddd M/D"),sql:h.format("YYYY-MM-DD")}),h=h.clone().add("days",1);return c={range:$.fullCalendar.formatDate(i,"MMMM dS yyyy")+" - "+$.fullCalendar.formatDate(g,"MMMM dS yyyy"),days:d,is_lodging:e},$(this.el).html(tmpl["calendar/week"](c)),this.toggle_availability(),this.toggle_available_staff(),this.toggle_clients(),this.show_focus_date(),this.setup_drag_n_drop(),this.show_sources(this.sources)},a}(),views.ClientForm=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Form),a}(),views.Dropdown=function(){function a(){this.clear=__bind(this.clear,this),this.fluid=__bind(this.fluid,this),this.position=__bind(this.position,this),this.expand=__bind(this.expand,this),this.collapse=__bind(this.collapse,this),this.render=__bind(this.render,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el=" #dropdown",a.prototype.initialize=function(a){var b=this;return a.on("login",this.collapse),a.on("refresh",function(){if(a.user&&a.user.get("authenticated"))return b.collapse()}),a.on("logout",function(){return $(b.el).css({height:0}),b.clear()}),this},a.prototype.render=function(a,b){return $(this.el).html(tmpl[a](b))},a.prototype.collapse=function(a){return _.isFunction(a)&&app.helpers.after_transition(this.el,a),this.clear(),$(this.el).css({height:"43px",position:"fixed"})},a.prototype.expand=function(a,b){return b==null&&(b="620px"),_.isFunction(a)&&app.helpers.after_transition($(this.el),a),$(this.el).css({height:b,position:"absolute"})},a.prototype.position=function(a,b){return _.isFunction(b)&&app.helpers.after_transition($(this.el),b),$(this.el).css({height:a,position:"absolute"})},a.prototype.fluid=function(){var a;return a=$(this.el).children([0]).height(),$(this.el).css({height:a+100+"px"})},a.prototype.clear=function(){return $(this.el).empty()},a}(),views.EmployeeForm=function(){function a(){this.role_clicked=__bind(this.role_clicked,this),this.render_blackouts=__bind(this.render_blackouts,this),this.dateclick=__bind(this.dateclick,this),this.after=__bind(this.after,this),this.init=__bind(this.init,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .role":"role_clicked"},a.prototype.init=function(){return this.events=_.extend({},this.__events,this.events),this},a.prototype.after=function(){if(this.template==="employees/edit")return this.calendar=new Flint.Calendar("#weekday-calendar",app.year,app.month),this.calendar.on("clicked",this.dateclick),this.calendar.on("next prev",this.render_blackouts),this.blackout_dates=_.isString(this.model.get("blackout_dates"))?this.model.get("blackout_dates").split(","):[],this.blackout_days=_.isString(this.model.get("blackout_days"))?this.model.get("blackout_days").split(","):[],this.render_blackouts()},a.prototype.weekday_click=function(a,b){var c,d,e=this;return c=[],_.each($("#weekdays").find("input[type=checkbox]:checked"),function(a,b){return c.push(a.value)}),d=c.join(","),this.blackout_days=c,this.model.set("blackout_days",d.toString()),this.render_blackouts()},a.prototype.dateclick=function(a,b,c,d){var e;return e=$(d.target).attr("data-dow"),_.indexOf(this.blackout_days,e)>=0&&(a="-"+a),_.indexOf(this.blackout_dates,a)>=0?this.blackout_dates=_.without(this.blackout_dates,a):this.blackout_dates.push(a),this.model.set("blackout_dates",this.blackout_dates.join(",")),this.render_blackouts()},a.prototype.render_blackouts=function(){var a=this;return $('input[name="dow[]"]').attr("checked",!1),$("#weekday-calendar td").removeClass("blackout"),_.each(this.blackout_days,function(a){return $("#dow"+a).attr("checked",!0),$("#weekday-calendar .dow"+a).addClass("blackout")}),_.each(this.blackout_dates,function(a){return a.substr(0,1)==="-"?(a=a.substr(1,a.length-1),$("#weekday-calendar td[data-sql="+a+"]").removeClass("blackout")):$("#weekday-calendar td[data-sql="+a+"]").addClass("blackout")})},a.prototype.role_clicked=function(a){var b;a.stopPropagation(a),b=$(a.target);if(b.parent().hasClass("role"))return $("#rd-"+b.parent().attr("id")).attr("checked",!0),a.target=$("#rd-"+b.parent().attr("id")),this.changed(a);if(b.hasClass("role"))return $("#rd-"+b.attr("id")).attr("checked",!0),a.target=$("#rd-"+b.parent().attr("id")),this.changed(a)},a}(),views.FormUploader=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.View),a.prototype.el="#app",a}(),views.FormsList=function(){function a(){this.done=__bind(this.done,this),this.update=__bind(this.update,this),this.save=__bind(this.save,this),this.update_document_name=__bind(this.update_document_name,this),this.remove_document=__bind(this.remove_document,this),this.add_document=__bind(this.add_document,this),this.init_documents=__bind(this.init_documents,this),this.after=__bind(this.after,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.List),a.prototype.el="#app",a.prototype.events={"click .done":"save","click .cancel":"done","click .remove-document":"remove_document","change .docs input":"update_document_name"},a.prototype.docs_template='<li id="{{id}}"><div><input type="text" name="docs[]" value="{{name}}" class="doc" /><span><a class="dl" href="/api/documents/_download/?id={{id}}">{{ext}}</a></span><button class="del remove-document">Delete</buton></div></li>',a.prototype.before=function(){return this.data={documents:app.user.get("account").documents}},a.prototype.after=function(){return this.init_documents()},a.prototype.init_documents=function(){var a,b=this;return this.docs=app.user.get("account").documents,a={action:"/api/documents/_upload/",element:document.getElementById("doc-upload"),onProgress:function(a,b,c,d){var e;return e=Math.round(c/d*100),e===100?$("#progress span").text("Processing, this may take a few seconds..."):$("#progress span").text("Uploading "+e+"%..."),$("#progress #bar").css({width:e+"%"}),$("#progress").css({display:"block"})},onComplete:function(a,c,d){return $("#progress").css({display:"none"}),b.add_document(d)}},new qq.FileUploader(a),this.update()},a.prototype.add_document=function(a){return app.notifications.notify("Document uploaded sucessfully!"),this.docs.push(a),this.update()},a.prototype.remove_document=function(a){var b,c,d=this;return c=$(a.target).parent().parent(),b=c.attr("id"),_.each(this.docs,function(a){a.id.toString()===b.toString()&&(d.trigger("document:deleted",a),d.docs=_.without(d.docs,a),d.update())})},a.prototype.update_document_name=function(a){var b,c,d,e=this;return d=$(a.target).val(),c=$(a.target).parent().parent(),b=c.attr("id"),_.each(this.docs,function(a){a.id.toString()===b.toString()&&(a.name=d,e.update())})},a.prototype.save=function(){return this.trigger("documents:saved")},a.prototype.update=function(){var a,b,c=this;return $("#docs").html(""),b=tmpl_compile(this.docs_template),_.each(this.docs,function(a){var c;return c=b(a),$("#docs").append(c)}),a=app.user.get("account"),a.docs=this.docs,app.user.set("account",a)},a.prototype.done=function(){return app.sidebar.select(!1),window.location.hash="#done",$("#app").css({left:"-540px"})},a}(),views.Helpers=function(){function a(){this.after_transition=__bind(this.after_transition,this),this.load_google_maps_api=__bind(this.load_google_maps_api,this),this.get_cookie=__bind(this.get_cookie,this),this.cookie=__bind(this.cookie,this),this.get_countries_and_states=__bind(this.get_countries_and_states,this),this.date_format=__bind(this.date_format,this),this.initialize=__bind(this.initialize,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Helpers),a.prototype.initialize=function(){return Handlebars.registerHelper("eq",this.eq),Handlebars.registerHelper("date_format",this.date_format),Handlebars.registerHelper("break_list",this.break_list)},a.prototype.date_format=function(a,b){return!a||a===""||a==="0000-00-00"||a==="0000-00-00 00:00:00"?"N/A":moment(a).format(b)},a.prototype.check_role=function(a,b,c){var d,e;return e=a&&a.get?a.get("role"):a,d=b.indexOf(e)>=0,d?c?c.fn(this):!0:c?c.inverse(this):!1},a.prototype.get_countries_and_states=function(a){var b=this;return app.states?a():app.sync.ajax("/api/geography/_countries_and_states",{success:function(b){return app.states=b.states,app.countries=b.countries,app.countries_states=b.countries_states,a()}})},a.prototype.cookie=function(a,b,c,d,e){var f,g;return c==null&&(c=""),d==null&&(d="/"),e==null&&(e=""),_.isUndefined(b)?this.get_cookie(a):(f=a+"="+b,c===!0&&(c="; expires="+(new Date(c)).toGMTString()),c===""&&(g=(new Date).getTime()+31536e6,c="; expires="+(new Date(g)).toGMTString()),d="; path="+d,e===!0&&(e="; domain"+e),document.cookie=f+c+d+e,b)},a.prototype.get_cookie=function(a){var b,c,d,e,f,g;d=a+"=",c=document.cookie.split(";"),e=!1;for(f=0,g=c.length;f<g;f++)b=c[f],b.toString().indexOf(d)>=0&&(e=b.substring(d.length+1,b.length));return e},a.prototype.text_area=function(a,b,c){var d,e;return d=[],c&&_.map(c.hash,function(a,b){return d.push(b+'="'+a+'"')}),e=a&&a.get&&a.get(b)?a.get(b):"",new Handlebars.SafeString('<textarea name="'+b+'" '+d.join(" ")+">"+e+"</textarea>")},a.prototype.eq=function(a,b,c){return a===b?c.fn(this):c.inverse(this)},a.prototype.twenty_four_to_twelve=function(a){var b,c,d,e;e=a.split(":"),b=e[0],b.substr(0,1)==="0"&&(b=parseInt(b.substr(1,1))),d=e[1],c="am",b>=12&&(c="pm",b>12&&(b-=12));if(b==="00"||b===0)b="12";return b+":"+d+" "+c},a.prototype.load_google_maps_api=function(a){var b;return b=document.createElement("script"),b.id="google-maps",b.async=!0,b.src="//maps.googleapis.com/maps/api/js?sensor=false&callback="+a,document.body.appendChild(b)},a.prototype.load_facebook_sdk=function(){var a;return a=document.createElement("script"),a.id="facebook-jssdk",a.async=!0,a.src="//connect.facebook.net/en_US/all.js",document.body.appendChild(a)},a.prototype.after_transition=function(a,b){var c,d=this;return c="webkitTransitionEnd transitionend oTransitionEnd",$(a).unbind(c),$(a).bind(c,function(){return $(a).unbind(c),b()})},a.prototype.loader=function(a){return $(a).html(tmpl.loader),$(".loader").css({opacity:1}),$(a)},a.prototype.select=function(a,b,c,d){var e,f,g;return e=[],d&&_.map(d.hash,function(a,b){return e.push(b+'="'+a+'"')}),g=a&&a.get&&a.get(b)?a.get(b):!1,f=[],_.each(c,function(a){var b,c,d;return d=_.isArray(a)?a[0]:a,c=_.isArray(a)?a[1]:a,b="<option ",d.toString()===g.toString()&&(b+="selected "),b+='value="'+d+'">'+c+"</option>",f.push(b)}),new Handlebars.SafeString('<select name="'+b+'" '+e.join(" ")+">"+f.join("")+"</select>")},a.prototype.break_list=function(a,b,c){var d;return d=[],_.each(a,function(e,f){a=e.attributes?e.attributes:e,d.push(c.fn(a));if((f+1)%b===0)return d.push('<br style="clear:both;" />')}),d=d.join(""),new Handlebars.SafeString(d)},a.prototype.list=function(a,b,c){var d;return d=[],_.each(a,function(b){return a=b.attributes?b.attributes:b,d.push(c.fn(a))}),d=d.length>0?d.join(""):b,new Handlebars.SafeString(d)},a.prototype.filtered_list=function(a,b,c,d,e){var f,g;return f=[],g=c.split(","),_.each(a,function(a){var c,d;d=a.get(b),c=!1,_.each(g,function(a){if(d===a)return c=!0});if(c)return f.push(e.fn(a.attributes))}),f=f.length>0?f.join(""):d,new Handlebars.SafeString(f)},a}(),views.LodgeForm=function(){function a(){this.update_rooms=__bind(this.update_rooms,this),this.sort_rooms=__bind(this.sort_rooms,this),this.remove_room=__bind(this.remove_room,this),this.add_room=__bind(this.add_room,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .add-new-room":"add_room","click .remove-room":"remove_room"},a.prototype.price_tmpl='<li id="{{id}}"><div><span class="long">{{room_type}}<span>{{display_start_month}} {{start_date}}</span><span>{{display_end_month}} {{end_date}}</span><span>${{dollar price}}</span><span>{{sleeps}}</span></div><button class="del remove-price-point">Delete</buton></li>',a.prototype.after=function(){if(this.template==="lodging/edit")return this.rooms=this.model.get("rooms"),this.update_rooms(),$(".room-inputs input").val(""),this.lodge_sortable=$(".sortable").sortable({update:this.sort_rooms}),this.upsell=this.model.get("trips"),this.update_upsells(),app.isOnline&&this.setup_photos("lodge",{lodge_id:this.model.get("id")}),this.gmap_callback_method="app.lodging.form.setup_map"},a.prototype.add_room=function(){var a;return a={id:Math.random()*3e3,sort_order:this.rooms.length+1},$(".room-inputs input,.room-inputs select").each(function(){var b,c;return b=$(this).attr("name"),b==="type"?c=$(this).val():c=$(this).val().toString().replace(/[A-Za-z$-,+]/g,""),a[b]=c}),a.type===""?(app.notifications.error("Specify a description of the room to add it."),!1):($(".room-inputs input").val(""),this.rooms.push(a),this.update_rooms())},a.prototype.remove_room=function(a){var b,c,d=this;return c=$(a.target).parent(),b=c.attr("id"),_.each(this.rooms,function(a){a.id.toString()===b.toString()&&(d.rooms=_.without(d.rooms,a),d.update_rooms())})},a.prototype.sort_rooms=function(a){var b,c=this;return b=[],_.each(this.lodge_sortable.find("li"),function(a,d){var e;return e=a.getAttribute("id"),_.each(c.rooms,function(a){if(a.id.toString()===e.toString())return a.sort_order=d,b.push(a)})}),this.rooms=b,this.update_rooms()},a.prototype.update_rooms=function(){var a=this;return $("#rooms").html(""),_.each(this.rooms,function(b){var c;return _.each(a.model.months,function(a){b.start_month===a[0]&&(b.display_start_month=a[1]);if(b.end_month===a[0])return b.display_end_month=a[1]}),c=tmpl.lodging_room(b),$("#rooms").append(c)}),this.model.set("rooms",this.rooms),this.delegateEvents()},a}(),views.LodgeList=function(){function a(){this.serialize_meal=__bind(this.serialize_meal,this),this.restore_meal=__bind(this.restore_meal,this),this.process_meals_data=__bind(this.process_meals_data,this),this.update_meals=__bind(this.update_meals,this),this.render_meals=__bind(this.render_meals,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.List),a.prototype.events={"click .update-meals":"process_meals_data"},a.prototype.before=function(){return app.helpers.loader("#meals"),this.data={lodges:this.collection.models,model:new Backbone.Model}},a.prototype.render_meals=function(a){return $("#meals").html(tmpl["lodging/meals"]({model:new Backbone.Model})),this.update_meals(a),this.delegateEvents()},a.prototype.update_meals=function(a){return this.restore_meal(a,"breakfast"),this.restore_meal(a,"lunch"),this.restore_meal(a,"dinner")},a.prototype.process_meals_data=function(){var a;return a={breakfast:this.serialize_meal("breakfast"),lunch:this.serialize_meal("lunch"),dinner:this.serialize_meal("dinner")},this.trigger("meals_update",a),this.update_meals(a)},a.prototype.restore_meal=function(a,b){a=a[b];if(a)return $("."+b+" input").each(function(c){var d,e;if($(this).hasClass("num"))return d=$(this).attr("name"),$(this).val("$"+app.helpers.dollar(a[d]));e=$(this).index("."+b+" input");if(a.served.indexOf(e)>=0)return $(this).attr("checked",!0)})},a.prototype.serialize_meal=function(a){var b;return b={meal:a,served:[]},$("."+a+" input").each(function(c){var d,e;if($(this).hasClass("num"))return d=$(this).attr("name"),e=$(this).val().replace(/[A-Za-z$-,+]/g,""),b[d]=e;if($(this).is(":checked"))return b.served.push($(this).index("."+a+" input"))}),b.served=b.served.join(","),b},a}(),views.Login=function(){function a(){this.done=__bind(this.done,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Form),a.prototype.el="#app",a.prototype.events={"click .login button":"login"},a.prototype.init=function(){return this.render(),this},a.prototype.render=function(){var a,b;return a=["Go ahead, sign in. We dare you.","Login's healthy!","Hurray it's computer time! Wait...","We know... You'd rather be fishing."],b=parseInt(Math.random()*a.length),$("#main-nav,#side-nav").html(""),$("#app").css({left:"-500px",width:"450px"}),$(this.el).html(tmpl["users/login"]({user:this.model,login_message:a[b]}))},a.prototype.login=function(){var a;return a={login:!0,email:$("form input:eq(0)").val(),password:$("form input:eq(1)").val()},app.login(a),$(".login").css({opacity:0}),$(".loader").css({opacity:1})},a.prototype.failed=function(a){return app.notifications.error("Sorry... "+a),$(".login").css({opacity:1}),$(".loader").css({opacity:0})},a.prototype.done=function(){return $(".loader").css({opacity:0}),$(this.el).empty(),this},a}(),views.Navigation=function(){function a(){this.revert=__bind(this.revert,this),this.revert_tip=__bind(this.revert_tip,this),this.show_tip=__bind(this.show_tip,this),this.select=__bind(this.select,this),this.hide_menu=__bind(this.hide_menu,this),this.show_user_menu=__bind(this.show_user_menu,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el="#navigation",a.prototype.events={"click .logout":"logout","click li.a, a.profile, li span":"show_user_menu","mouseover #main-nav li a":"show_tip","mouseout #main-nav li a":"revert_tip"},a.prototype.initialize=function(a){var b=this;return a.on("login",function(){return b.render()}),a.on("refresh",function(){if(a.user&&a.user.get("authenticated"))return b.render()}),a.on("logout",function(){return $(b.el).css({top:"-60px"}).html("")})},a.prototype.render=function(){return app.user&&app.user.get("accounts")&&app.user.get("accounts").length===1&&app.user.set("accounts",!1),$(this.el).html(tmpl.navigation(app.user.attributes)).css({top:"0"}),this.revert_tip(),this.select(this.selected)},a.prototype.show_user_menu=function(a){return a.stopPropagation(),$("#user .arrow").parent().css({background:"rgba(255,255,255,0.2)"}),$("#user li ul").css({display:"block"}),$("html,a.pm").bind("click",this.hide_menu)},a.prototype.hide_menu=function(a){return a.stopPropagation(),$("#user .arrow").parent().css({background:"transparent"}),$("#user ul").css({display:"none"})},a.prototype.select=function(a){return this.previous=this.selected,this.selected=a,$("#main-nav li").css({opacity:.5}),$("#main-nav li#tip").css({opacity:1}),this.selected||($("#arrow-ind").css({left:"-10px"}),this.tip=""),this.selected==="reservation"&&($("#arrow-ind").css({left:"27px"}),this.tip="New Reservation"),this.selected==="dashboard"&&($("#arrow-ind").css({left:"65px"}),this.tip="Dashboard"),this.selected==="calendar"&&($("#arrow-ind").css({left:"108px"}),this.tip="Calendar"),this.selected==="clients"&&($("#arrow-ind").css({left:"156px"}),this.tip="Clients"),this.selected==="reports"&&($("#arrow-ind").css({left:"205px"}),this.tip="Reports"),this.selected==="setup"&&($("#arrow-ind").css({left:"250px"}),this.tip="Setup"),$("#navigation #"+this.selected).css({opacity:1}),this.previous_tip=this.tip,this.revert_tip()},a.prototype.show_tip=function(a){return $(a.target).parent().css({opacity:1}),$("#navigation #tip").text($(a.target).attr("rel"))},a.prototype.revert_tip=function(a){return a&&a.target&&$(a.target).parent().css({opacity:.5}),$("#navigation #tip").text(this.tip),$("#navigation #"+this.selected).css({opacity:1})},a.prototype.revert=function(){return this.select(this.previous),$("#navigation #tip").text(this.previous_tip)},a.prototype.logout=function(){return app.logout()},a}(),views.NavigationSidebar=function(){function a(){this.deselect=__bind(this.deselect,this),this.select=__bind(this.select,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.group_click=__bind(this.group_click,this),this.update_selected=__bind(this.update_selected,this),this.check_all=__bind(this.check_all,this),this.deselect_all=__bind(this.deselect_all,this),this.select_all=__bind(this.select_all,this),this.all_click=__bind(this.all_click,this),this.box_click=__bind(this.box_click,this),this.label_click=__bind(this.label_click,this),this.clear_search=__bind(this.clear_search,this),this.search=__bind(this.search,this),this.view_changed=__bind(this.view_changed,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.View),a.prototype.el="#side",a.prototype.events={"keyup #search input":"search","click #close":"clear_search","click #toggles .checkbox label":"label_click","click #toggles .checkbox input":"box_click","click #toggles h4":"group_click","click #toggles h4 input":"all_click"},a.prototype.initialize=function(a){return a.on("refresh",this.hide),a.on("logout",this.hide),this},a.prototype.render=function(a){var b,c=this;return this.data=a,$(this.el).html(tmpl.navigation_sidebar(this.data)),$(this.el).css({left:"0"}),this.data.calendar&&(this.calendar=new Flint.Calendar("#side-calendar",app.year,app.month),this.calendar.set_focus_and_highlight("month"),b=app.helpers.cookie("group_select"),this.groups=b?b.split(","):[],_.each(this.groups,function(a){return $("#"+a).css({display:"block"}),$($("#"+a).prev().children()[0]).attr("class","dn")})),this},a.prototype.view_changed=function(a){return this.calendar.set_focus_and_highlight(a)},a.prototype.search=function(a){var b=this;return this.term=$(a.target).val(),this.term===""?($("#find").css({opacity:1}),$("#close").css({opacity:0})):($("#find").css({opacity:0}),$("#close").css({opacity:1})),window.clearTimeout(app.helpers.timer),app.helpers.delay(250,function(){return b.trigger("search",b.term)})},a.prototype.clear_search=function(){return this.term="",$("#search input").val(""),this.trigger("search",""),$("#find").css({opacity:1}),$("#close").css({opacity:0})},a.prototype.label_click=function(a){var b,c;return a.stopPropagation(),c=$(a.target).parent().attr("id"),b=$("#toggles p#"+c).children("input")[0].click()},a.prototype.box_click=function(a){var b,c;return b=$(a.target),c=b.val()+":"+b.attr("name"),b.is(":checked")?this.trigger("added:eventsource",c):this.trigger("removed:eventsource",c),this.check_all(b.attr("name"))},a.prototype.all_click=function(a){var b,c;return a.stopPropagation(),b=$(a.target),c=b.attr("name"),b.is(":checked")?this.select_all(c):this.deselect_all(c)},a.prototype.select_all=function(a){var b,c=this;return b=[],$("#"+a+" input").each(function(a){if(!$(this).is(":checked"))return b.push($(this))}),_.each(b,function(a){var b;return a.attr("checked",!0),b=a.val()+":"+a.attr("name"),c.trigger("added:eventsource",b)})},a.prototype.deselect_all=function(a){var b,c=this;return b=[],$("#"+a+" input").each(function(a){if($(this).is(":checked"))return b.push($(this))}),_.each(b,function(a){var b;return a.attr("checked",!1),b=a.val()+":"+a.attr("name"),c.trigger("removed:eventsource",b)})},a.prototype.check_all=function(a){var b,c;c=!0,b=!0,$("#"+a+" input").each(function(a){var d;return d=$(this).is(":checked"),d?b=!1:c=!1}),c&&$("h4 input[name="+a+"]").attr("checked",!0);if(b)return $("h4 input[name="+a+"]").attr("checked",!1)},a.prototype.update_selected=function(){var a,b=this;return a=app.helpers.cookie("event_sources").toString().split("|"),_.each(a,function(a){var b;if(a>"")return b=a.split(":"),$("#"+b[0]+" input").attr("checked",!0)}),this.check_all("trip"),this.check_all("lodge"),this.check_all("staff")},a.prototype.group_click=function(a){var b,c;return a.target.tagName==="SPAN"&&(a.target=a.target.parentNode),c=$(a.target).next().attr("id"),b=$(a.target).children("span")[0],b.className==="up"?(b.className="dn",$(a.target).next().css({display:"block"}),this.groups.push(c)):(b.className="up",$(a.target).next().css({display:"none"}),this.groups=_.without(this.groups,c)),app.helpers.cookie("group_select",this.groups.join(","))},a.prototype.show=function(){return $(this.el).css({width:"230px",left:0}),this},a.prototype.hide=function(){return $(this.el).css({left:"-230px"}),this},a.prototype.select=function(a){return $("#nav li").removeClass("current"),$("#nav #_"+a).addClass("current"),this},a.prototype.deselect=function(){return $("#nav li").removeClass("current"),this},a}(),views.OrderForm=function(){function a(){this.cancel_reservation=__bind(this.cancel_reservation,this),this.place_reservation_on_hold=__bind(this.place_reservation_on_hold,this),this.approve_reservation=__bind(this.approve_reservation,this),this.update=__bind(this.update,this),this.update_discount=__bind(this.update_discount,this),this.remove_guest=__bind(this.remove_guest,this),this.remove_product=__bind(this.remove_product,this),this.remove_lodge=__bind(this.remove_lodge,this),this.remove_trip=__bind(this.remove_trip,this),this.payment_refunded=__bind(this.payment_refunded,this),this.refund_payment=__bind(this.refund_payment,this),this.add_payment=__bind(this.add_payment,this),this.process_payment=__bind(this.process_payment,this),this.change_pay_method=__bind(this.change_pay_method,this),this.capture_submit=__bind(this.capture_submit,this),this.capture_card=__bind(this.capture_card,this),this.prepare_capture=__bind(this.prepare_capture,this),this.lost_focus=__bind(this.lost_focus,this),this.add_guest=__bind(this.add_guest,this),this.add_promotion_discount=__bind(this.add_promotion_discount,this),this.add_product=__bind(this.add_product,this),this.create_lodging_reservations=__bind(this.create_lodging_reservations,this),this.add_lodge_reservation=__bind(this.add_lodge_reservation,this),this.add_trip_reservation=__bind(this.add_trip_reservation,this),this.show_lodge_dates=__bind(this.show_lodge_dates,this),this.show_trip_dates=__bind(this.show_trip_dates,this),this.show_lodge_availability=__bind(this.show_lodge_availability,this),this.show_trip_availability=__bind(this.show_trip_availability,this),this.show_availability=__bind(this.show_availability,this),this.select_product=__bind(this.select_product,this),this.update_room_selections=__bind(this.update_room_selections,this),this.select_lodge=__bind(this.select_lodge,this),this.select_trip=__bind(this.select_trip,this),this.select_stay_length=__bind(this.select_stay_length,this),this.change_country=__bind(this.change_country,this),this.change_discount=__bind(this.change_discount,this),this.change_product=__bind(this.change_product,this),this.change_room=__bind(this.change_room,this),this.change_lodge=__bind(this.change_lodge,this),this.change_time=__bind(this.change_time,this),this.change_trip=__bind(this.change_trip,this),this.change_party=__bind(this.change_party,this),this.tabbed=__bind(this.tabbed,this),this.after=__bind(this.after,this),this.setup=__bind(this.setup,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"change .num-field select":"change_party","change select.trip":"change_trip","change select.lodge":"change_lodge","change select.lodge-rooms":"change_room","change select.trip-times":"change_time","change select.product":"change_product","change select.country":"change_country","click .trip-list div":"show_trip_dates","click .remove-trip":"remove_trip","click .lodge-list div":"show_lodge_dates","click .remove-lodge":"remove_lodge","click .remove-product":"remove_product","click .add-product":"add_product","click .add-guest":"add_guest","click .remove-guest":"remove_guest","change .payments .left select":"change_pay_method","change .promo-codes":"add_promotion_discount","change .discount":"change_discount","click .refund-payment":"refund_payment","blur .swipe-focus":"lost_focus","keyup .swipe-focus":"capture_card","click .enter-payment":"process_payment","click button.cancel-reservation":"cancel_reservation","click button.hold":"place_reservation_on_hold","click button.approve":"approve_reservation"},a.prototype.before=function(a){var b,c,d=this;return this.tab_index=0,this.model.get("id")&&this.model.set("setup_complete","1",{silent:!0}),this.setup(),this.head_count=parseInt(this.model.get("adults"))+parseInt(this.model.get("children"))+parseInt(this.model.get("seniors")),_.extend(this.data,{trips:this.trip_select,lodges:this.lodge_select,products:this.product_select,staff:this.staff_select,peoples:this.party_select,head_count:this.head_count,discounts:this.discounts}),this.model.get("arriving_at")&&(c=this.model.get("arriving_at").split(":"),this.model.set("arrive_hr",c[0]),this.model.set("arrive_min",c[1]),c=this.model.get("departing_at").split(":"),this.model.set("depart_hr",c[0]),this.model.set("depart_min",c[1])),this.model.get("client")&&(b=this.model.get("client"),delete b.id,_.extend(this.model.attributes,b)),app.helpers.after_transition("#dropdown",a),app.dropdown.expand(),this.off("tabbed"),this.on("tabbed",this.tabbed),this.on("changed",function(){return $("#overview").html(tmpl.reservations_overview(d.model.attributes))})},a.prototype.setup=function(){var a,b,c,d,e,f=this;return this.party_select=function(){e=[];for(d=0;d<50;d++)e.push(d);return e}.apply(this),b=[[0,"Select Trip / Package / Activity..."]],a=app.trips.list.collection.where({web_active:"1"}),_.each(a,function(a){return b.push([a.get("id"),app.helpers.truncate(a.get("name"),40)])}),b=[[0,"Select Lodge..."]],_.each(app.lodging.list.collection.models,function(a){return b.push([a.get("id"),app.helpers.truncate(a.get("name"),40)])}),this.lodge_select=b.length>1?b:!1,this.lodges=app.lodging.list.collection.models,b=[[0,"Add Product / Rental..."]],_.each(app.products.list.collection.models,function(a){return b.push([a.get("id"),app.helpers.truncate(a.get("name"),30)])}),this.product_select=b.length>1?b:!1,c=[],_.each(app.employees.list.collection.models,function(a){return c.push([a.get("nickname"),a.get("nickname")])}),this.staff_select=c,this.staff=app.employees.list.collection,this.discounts=[[0,"Apply promotion code..."]],_.each(app.user.get("account").promotions,function(a){return f.discounts.push([a.id,a.code])})},a.prototype.after=function(){var a,b,c,d,e,f,g,h,i=this;this.trips=[],this.stays=[],this.purchases=[],this.payments=[],this.clients=[],this.model.get("id")||(this.model.set("trip_reservations",[],{silent:!0}),this.model.set("lodge_reservations",[],{silent:!0}),this.model.set("purchases",[],{silent:!0}),this.model.set("payments",[],{silent:!0}),this.model.set("clients",[],{silent:!0})),this.trips=this.model.get("trip_reservations"),this.stays=this.model.get("lodge_reservations"),this.purchases=this.model.get("purchases"),this.payments=this.model.get("payments"),this.clients=this.model.get("clients"),f=app.year,c=app.month,this.model.get("start_date")&&(f=moment(this.model.get("start_date")).year(),c=moment(this.model.get("start_date")).month()),this.trip_calendar=new Flint.Calendar("#trip-calendar",f,c),this.trip_calendar.on("next prev",this.show_availability),this.trip_calendar.on("clicked",this.add_trip_reservation),this.lodge_calendar=new Flint.Calendar("#lodge-calendar",f,c),this.lodge_calendar.on("next prev",this.show_availability),this.lodge_calendar.on("clicked",this.add_lodge_reservation),this.model.get("arriving_on")&&this.model.get("arriving_on")>"0000-00-00"&&(f=moment(this.model.get("arriving_on")).year(),c=moment(this.model.get("arriving_on")).month()),this.arr_select=new Flint.Calendar("#arrive-cal",f,c),this.arr_select.on("clicked",function(a,b){return i.model.set("arriving_on",a),i.update()}),this.model.get("departing_on")&&this.model.get("departing_on")>"0000-00-00"&&(f=moment(this.model.get("departing_on")).year(),c=moment(this.model.get("departing_on")).month()),this.dep_select=new Flint.Calendar("#depart-cal",f,c),this.dep_select.on("clicked",function(a,b){return i.model.set("departing_on",a),i.update()}),this.model.get("arriving_on")&&this.model.get("arriving_on")>"0000-00-00"&&this.arr_select.set_focus_date(this.model.get("arriving_on"),moment(this.model.get("arriving_on")).toDate()),this.model.get("departing_on")&&this.model.get("departing_on")>"0000-00-00"&&this.dep_select.set_focus_date(this.model.get("departing_on"),moment(this.model.get("departing_on")).toDate()),this.trip_id&&!this.model.get("id")&&this.select_trip(this.trip_id,function(){if(i.start_date)return $("#trip-calendar td[data-sql="+i.start_date+"]").addClass("preselect-date")}),this.lodge_id&&!this.model.get("id")&&this.select_lodge(this.lodge_id,!0,function(){var a,b,c,d,e,f,g;if(i.start_date){$("#lodge-calendar td[data-sql="+i.start_date+"]").addClass("preselect-date"),i.end_date&&(c=app.helpers.sqldate_to_js(i.start_date).getTime(),a=app.helpers.sqldate_to_js(i.end_date).getTime()+864e5,d=parseInt((a-c)/864e5),i.select_stay_length(d));if(i.room_id){g=i.lodge.get("rooms");for(e=0,f=g.length;e<f;e++)b=g[e],b.id===i.room_id&&(i.room=b,i.update_room_selections())}}return i.show_lodge_availability()}),a=this.model.get("auto_collect_balances"),b=this.model.get("auto_collect_days_prior"),!a||a==="0"||a===0?$(".no-auto").click():a==="1"||a===1?$(".day-auto").click():($(".custom-auto").val(a).click(),$(".balance-days").val(b)),this.model.get("client")?$(".view-client").css({display:"block"}):$(".view-client").css({display:"none"}),e=[],_.each(this.payments,function(a){var b;if(a.token>""){b={last_four:a.token.substr(a.token.length-4,4),name:a.name,card:a.card.toUpperCase(),id:a.id};if(_.indexOf(i.payments,b)<0)return e.push(b)}});if(e.length>0){$("#pay-method").append('<option value="0">------------------------</option>');for(g=0,h=e.length;g<h;g++)d=e[g],$("#pay-method").append('<option value="token:'+d.id+'">'+d.name+"'s "+d.card+" ("+d.last_four+")</option>")}return this.change_country(),this.update(),app.dropdown.fluid()},a.prototype.tabbed=function(a){var b=this;window.clearTimeout(app.helpers.timer),a.html().indexOf("ayment")>0&&app.helpers.after_transition(".tabshell",this.prepare_capture);if(!this.model.get("id"))return $(".done").removeClass("done").addClass("save").removeClass("next-step").bind("click",function(){if(_.isUndefined(b.model.validate(b.model.attributes)))return b.cancel(),app.dropdown.collapse()})},a.prototype.change_party=function(a){var b;b=$(a.target),this.model.set(b.attr("name"),b.val(),{silent:!0}),this.nights=this.model.get("nights",{silent:!0}),this.trip&&this.show_trip_availability(!1,!1);if(this.lodge)return this.show_lodge_availability(!1,!1)},a.prototype.change_trip=function(a){this.time=!1;if($(a.target).val()>"0")return this.select_trip($(a.target).val())},a.prototype.change_time=function(a){var b;return b=$(a.target).val(),this.time=b,this.show_trip_availability()},a.prototype.change_lodge=function(a){return this.room=!1,$(a.target).val()>"0"?this.select_lodge($(a.target).val(),!0):this.lodge=!1},a.prototype.change_room=function(a){var b=this;return $(a.target).val()==="0"?this.room=!1:_.each(this.lodge.get("rooms"),function(c){if(c.id.toString()===$(a.target).val().toString())return b.room=c}),this.show_lodge_availability()},a.prototype.change_product=function(a){if($(a.target).val()>"0")return this.select_product($(a.target).val())},a.prototype.change_discount=function(a){var b;return b=parseFloat($(a.target).val().replace(/[A-Za-z$-,]/g,"")),this.model.set("discount",b,{silent:!0}),this.update()},a.prototype.change_country=function(){var a,b,c=this;return b=$(".country").val(),$(".state option").remove(),this.model.get("state")?a=this.model.get("state"):a="",_.each(app.countries_states,function(c){var d;if(c.country_code===b)return d=a===c.state_code?"selected":"",$(".state").append('<option value="'+c.state_code+'" '+d+">"+c.state_code+"</option>")})},a.prototype.select_stay_length=function(a){return $(".stay-length option").attr("selected",!1).each(function(b){if($(this).val().toString()===a.toString())return $(this).attr("selected",!0)}),this.nights=a,this.model.set("nights",this.nights,{silent:!0})},a.prototype.select_trip=function(a,b){var c,d,e,f,g=this;b==null&&(b=!1),$(".trip option").attr("selected",!1).each(function(b){if($(this).val()===a)return $(this).attr("selected",!0)}),$("#trip-calendar td").removeClass("trip-date"),$(".trip-list div").removeClass("shown"),this.trip=app.trips.grab(a),f=this.trip.get("start_times").split(","),f.length>0&&f[0]!==""?(this.time=f[0],$(".trip-times").css({display:"block"}),$(".trip-times option").remove(),_.each(f,function(a){var b;return b=g.selected_time===a?"selected":"",$(".trip-times").append('<option value="'+a+'" '+b+">"+app.helpers.twenty_four_to_twelve(a)+"</option>")}),this.time=this.selected_time?this.selected_time:f[0]):(this.time=!1,$(".trip-times").css({display:"none"})),this.model.get("id")||($(".confirm-letter").val(this.trip.get("confirmation_letter")),this.model.set("confirmation",this.trip.get("confirmation_letter"),{silent:!0}),c=this.trip.get("auto_collect_balances"),e=this.trip.get("auto_collect_days_prior"),!c||c==="0"||c===0?$(".no-auto").click():c==="1"||c===1?$(".day-auto").click():($(".custom-auto").val(c).click(),$(".balance-days").val(e))),d=!1,this.trip.get("lodging_nights")>0&&this.trip.get("lodge_id")>"1"?this.select_lodge(this.trip.get("lodge_id"),!0,this.show_trip_availability()):this.show_trip_availability();if(b)return b()},a.prototype.select_lodge=function(a,b,c){var d=this;return b==null&&(b=!1),$(".lodge option").attr("selected",!1).each(function(b){if($(this).val()===a)return $(this).attr("selected",!0)}),$(".lodge-list div").removeClass("shown"),$("#lodge-calendar td").removeClass("trip-date"),app.lodging.get(a,function(a){d.lodge=a,d.update_room_selections(),b&&d.show_lodge_availability();if(c)return c()})},a.prototype.update_room_selections=function(){var a=this;return $(".lodge-rooms").css({display:"block"}),$(".lodge-rooms option").remove(),$(".lodge-rooms").append('<option value="0">All Rooms</option>'),_.each(this.lodge.get("rooms"),function(b){var c,d,e,f,g,h,i,j,k,l;g=parseInt(a.lodge_calendar.month)+1<10?"0"+(parseInt(a.lodge_calendar.month)+1):parseInt(a.lodge_calendar.month)+1,d=g+"-01",c=g+"-31",l=b.start_month<10?"0"+b.start_month:b.start_month,k=b.start_date<10?"0"+b.start_date:b.start_date,f=b.end_month<10?"0"+b.end_month:b.end_month,e=b.end_date<10?"0"+b.end_date:b.end_date,i=l+"-"+k,h=f+"-"+e;if(i<=d&&c<=h)return j=a.room&&a.room.id===b.id?'selected="true"':"",$(".lodge-rooms").append('<option value="'+b.id+'" '+j+">"+b.type+"</option>")})},a.prototype.select_product=function(a){var b=this;return app.products.get(a,function(a){var c;return b.product=a,a.get("variations")>""?($(".product-variations").css({display:"block"}),$(".product-variations option").remove(),c=a.get("variations").split("||"),_.each(c,function(a){return $(".product-variations").append('<option value="'+a+'">'+a+"</option>")})):$(".product-variations").css({display:"none"})})},a.prototype.show_availability=function(a){this.trip_calendar.render(a.year,a.month),this.lodge_calendar.render(a.year,a.month),this.trip&&this.show_trip_availability();if(this.lodge)return this.show_lodge_availability(),this.update_room_selections()},a.prototype.show_trip_availability=function(){var a,b,c,d,e=this;return this.trip?($("#trip-calendar td").removeClass("start-available").removeClass("trip-date-available"),b=parseInt(this.model.get("adults"))+parseInt(this.model.get("children"))+parseInt(this.model.get("seniors")),a=this.trip.get_availability_by_month(this.trip_calendar.year,this.trip_calendar.month,b,this.time),d=!1,this.trip.get("lodge_id")>"0"&&(d=this.lodge?[this.lodge]:this.lodges),c=new models.Trip(this.trip.attributes),_.each(a,function(a){var f,g;c.set_all_dates(a.sql);if(d){g=[],f=0,b=parseInt(e.model.get("adults"))+parseInt(e.model.get("seniors")),_.each(d,function(a){var d;d=a.is_available(c.get("start_date_js"),c.get("end_date_js"),b);if(d.is_available)return f+=parseInt(d.beds),g.push({lodge:a,availability:d})});if(f>=b)return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("start-available"),_.each(c.get("trip_dates"),function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date-available")}),_.each(c.get("nights"),function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date-available")})}else{$("#trip-calendar td[data-sql="+a.sql+"]").addClass("start-available"),_.each(c.get("trip_dates"),function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date-available")});if(c.get("nights"))return _.each(c.get("nights"),function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date-available")})}})):!1},a.prototype.show_lodge_availability=function(){var a,b,c=this;return $("#lodge-calendar td").removeClass("start-available").removeClass("trip-date-available"),b=parseInt(this.model.get("adults"))+parseInt(this.model.get("seniors")),a=this.lodge.get_availability_by_month(this.lodge_calendar.year,this.lodge_calendar.month,b,this.room,this.nights),_.each(a,function(a){if(a.availability.beds>=b)return $("#lodge-calendar td[data-sql="+a.sql+"]").addClass("start-available")})},a.prototype.show_trip_dates=function(a){var b,c,d,e,f=this;$("#trip-calendar td").removeClass("trip-date"),e=null;if(a){d=$(a.target),c=d.attr("id");while(!c)d=d.parent(),c=d.attr("id");_.each(this.trips,function(a){if(a.id.toString()===c.toString())return e=new models.Trip(a.trip),e.set_all_dates(a.start_date)})}else e=this.trip,c=e.get("id");return e?(b=$("#"+c+" div:eq(0)"),b.hasClass("shown")?b.removeClass("shown"):($(".trip-list div").removeClass("shown"),b.addClass("shown"),$("#trip-calendar td[data-sql="+e.get("start_date")+"]").addClass("trip-date"),_.each(e.get("trip_dates"),function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}))):!1},a.prototype.show_lodge_dates=function(a){var b,c,d,e,f=this;$("#lodge-calendar td").removeClass("trip-date"),e=null;if(a){d=$(a.target),c=d.attr("id");while(!c)d=d.parent(),c=d.attr("id");return _.each(this.stays,function(a){if(a.id.toString()===c.toString())return e=new models.Reservation(a),e.set_all_dates(a.start_date)}),e?(b=$("#"+e.get("id").toString()+" div:eq(0)"),b.hasClass("shown")?b.removeClass("shown"):($(".lodge-list div").removeClass("shown"),b.addClass("shown"),_.each(e.get("nights"),function(a){return $("#lodge-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}))):!1}},a.prototype.add_trip_reservation=function(a,b,c){var d,e,f,g,h,i,j,k=this;return c==null&&(c=!1),d=$("#trip-calendar td[data-sql="+a+"]"),!d.hasClass("start-available")&&(!c||_.isArray(c))?!1:($("#trip-calendar td").removeClass("trip-date"),this.trip.set_all_dates(a),delete this.trip.id,i={id:"n"+Math.round(Math.random()*2e3),adults:this.model.get("adults"),children:this.model.get("children"),seniors:this.model.get("seniors"),start_date:a,end_date:this.trip.get("end_date"),start_time:this.time,trip_id:this.trip.get("id"),trip:this.trip.clone().attributes,status:"1",order:!1,created_on:moment().format("YYYY-MM-DD HH:mm:ss")},$(".inc-trip").is(":checked")?(i.total=0,i.deposit=0,i.fees=0):(e=this.trip.get_cost_breakdown(i),i.total=e.total,i.total_fees=e.fees,i.deposit=e.deposit),(!this.model.get("start_date")||a<this.model.get("start_date"))&&this.model.set("start_date",a,{silent:!0}),(!this.model.get("end_date")||this.trip.get("end_date")>this.model.get("end_date"))&&this.model.set("end_date",this.trip.get("end_date"),{silent:!0}),j=[i],this.trip.get("activities_scheduled")!=="1"&&(j=this.trip.create_activity(i,this.time,this.guide_id)),_.each(j,function(a){return k.trips.push(a),app.reserved.models.push(new models.Reservation(a))}),this.trip.get("lodge_id")>"0"&&(h=parseInt(i.adults)+parseInt(i.seniors),this.included_nights=this.trip.get("lodging_nights"),g=this.create_lodging_reservations(this.trip.get("check_in_date"),this.trip.get("check_out_date"),h,!0),this.select_stay_length(this.trip.get("lodging_nights"))),f=this.trip.get("trip_dates"),this.update(),this.show_trip_availability(),_.each(f,function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}),_.each(g,function(a){return $("#lodge-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}))},a.prototype.add_lodge_reservation=function(a,b,c){var d,e,f,g,h=this;return c==null&&(c=!1),d=$("#lodge-calendar td[data-sql="+a+"]"),d.hasClass("start-available")?($("#lodge-calendar td").removeClass("trip-date"),this.nights||(this.nights=this.model.get("nights")),e=new Date(b.getTime()+86400*(this.nights-1)*1e3),f=parseInt(this.model.get("adults"))+parseInt(this.model.get("seniors")),g=new models.Reservation({start_date:a,end_date:app.helpers.jsdate_to_sql(e)}),g.set_all_dates(),_.each(g.get("nights"),function(a){return $("#lodge-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}),(!this.model.get("start_date")||g.get("start_date")<this.model.get("start_date"))&&this.model.set("start_date",g.get("start_date"),{silent:!0}),(!this.model.get("end_date")||g.get("end_date")>this.model.get("end_date"))&&this.model.set("end_date",g.get("end_date"),{silent:!0}),this.create_lodging_reservations(b,e,f),this.show_lodge_availability(),_.each(g.get("nights"),function(a){return $("#lodge-calendar td[data-sql="+a.sql+"]").addClass("trip-date")}),this.update()):!1},a.prototype.create_lodging_reservations=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=this;d==null&&(d=!1),k=this.lodge?[this.lodge]:this.lodges,e=[],l=app.helpers.jsdate_to_sql(a),i=app.helpers.jsdate_to_sql(b),j=[],m=new models.Reservation({start_date:l,end_date:i}),m.set_all_dates(),f=[],_.each(k,function(d){var e;e=d.is_available(a,b,c,n.room);if(e.is_available)return n.room?f.push({room:n.room,lodge:n.lodge.clone()}):_.each(e.rooms,function(c){if(d.room_is_available_between(a,b,c))return f.push({room:c,lodge:d.clone()})})}),h=c;while(h>0)g=0,_.each(f,function(a){var b,c,e;e=a.room,parseInt(e.sleeps)<h?g=e.sleeps:g=h;if(e&&h>0)return c={id:Math.round(Math.random()*2e4).toString(),lodge:a.lodge.attributes,lodge_id:a.lodge.id,room_id:e.id,room:e,adults:g,start_date:l,end_date:i,status:"1",order:!1,created_on:moment().format("YYYY-MM-DD HH:mm:ss")},d||$(".inc-lodge").is(":checked")?c.total=0:(b=m.get("nights").length-n.included_nights,c.total=m.get_lodge_pricing(new models.Lodge(c.lodge),b,c.room)),n.stays.push(c),app.reserved.add(new models.Reservation(c)),j=m.get("nights"),h-=g,h<=0&&d?(n.lodge=a.lodge,n.select_lodge(a.lodge.id,!0),!1):!1});return j},a.prototype.add_product=function(){var a,b,c;return b={id:Math.round(Math.random()*2e4).toString(),product:this.product,name:this.product.get("name")},c=this.product.get("rentable"),$(".addons select,.addons input").each(function(a){var d,e;return d=$(this).attr("name"),e=$(this).val(),d==="rental"&&(c==="1"?e=$(this).is(":checked"):e=0),d==="quantity"&&(e=e.replace(/[A-Za-z$-,]/g,"")),b[d]=e}),b.quantity===""?app.notifications.error("You need to enter a quantity to add this product."):(a=this.product.get("price"),b.rental?a=this.product.get("rental_price"):this.product.get("sale_price")>0&&this.product.get("sale_price")<a&&(a=this.product.get("sale_price")),b.price=a,this.purchases.push(b),this.update())},a.prototype.add_promotion_discount=function(a){var b;b=$(a.target).val();if(b>"0")return $("#discount-info").html("Validating code..."),this.trigger("selected:discount",b)},a.prototype.add_guest=function(){var a;return a={id:Math.round(Math.random()*2e4).toString(),create:!0,name:$(".guest-name").val(),email:$(".guest-email").val()},a.name===""?app.notifications.error("You must enter a name for this guest"):(this.clients.push(a),this.model.attributes.guests.push(a),$(".guest-name,.guest-email").val(""),this.update())},a.prototype.lost_focus=function(){var a=this;return $("form").unbind("submit"),$(".swipe-msg").text("click to swipe card").bind("click",function(){return a.prepare_capture()})},a.prototype.prepare_capture=function(){var a=this;return window.clearTimeout(app.helpers.timer),app.helpers.delay(300,function(){return document.getElementById("pay-method").selectedIndex=0,$(".card-info").css({display:"block"}),$(".swipe-focus").focus(),$(".swipe-msg").text("swipe the card now")})},a.prototype.capture_card=function(a){var b=this;return a.stopPropagation(),this.raw_card=$(".swipe-focus").val(),this.payment=new models.Payment,window.clearTimeout(app.helpers.timer),app.helpers.delay(300,function(){var a,c,d,e,f;return b.raw_card=b.raw_card.substr(2,b.raw_card.length),c=b.raw_card.split("^"),f=c[0],e=c[1].split("/"),d=e[1]+" "+e[0],a=c[2].substr(2,2)+"/"+c[2].substr(0,2),$(".payer-name").val(d),$(".card-info input:eq(0)").val(f),$(".card-info input:eq(1)").val(a),$(".swipe-focus").val("")}),!1},a.prototype.capture_submit=function(){return!1},a.prototype.change_pay_method=function(a){var b;return b=$(a.target).val(),this.payment_id=!1,b==="credit"?($(".card-info").css({display:"block"}),$(".payment fieldset").css({display:"block"})):b.indexOf("token:")>=0?(this.payment_id=b.replace(/token:/,""),$(".add-as-guest").attr("checked",!1),$(".card-info").css({display:"none"}),$(".payment fieldset").css({display:"none"})):($(".payment fieldset").css({display:"block"}),$(".card-info").css({display:"none"}))},a.prototype.process_payment=function(){var a,b,c,d;if(this.trips.length===0&&this.stays.length===0&&this.purchases.length===0)return app.notifications.error("You must add a trip / lodge reservation or product before you enter payments."),!1;b=new models.Payment,b.set("order_id",this.model.get("id"),{silent:!0});if(this.payment_id)b.set("id",this.payment_id,{silent:!0}),b.set("amount",$(".amount").val().replace(/[A-Za-z$-,]/g,""));else{c=!0,$(".payment input,.payment select").each(function(a){var d,e;return d=$(this).attr("name").replace(/_/,""),e=$(this).val(),d==="paid_by"&&e===""?(app.notifications.error("Please complete all payment fields and enter a valid amount."),!1):(d==="amount"&&(e=e.replace(/[A-Za-z$-,]/g,"")),e===""&&d!=="swipefocus"&&d!=="email"&&(c=!1),b.set(d,e,{silent:!0}))}),a=$(".add-as-guest").is(":checked")?"1":"0",b.set("add_as_guest",a,{silent:!0}),d=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(b.email>""&&!b.email.match(d))return app.notifications.error("You must use a valid email address or leave it blank."),!1;if(b.get("method")==="credit"&&!c||b.get("amount")<1||b.get("name")==="")return app.notifications.error("Please enter all payment fields and a valid amount."),!1}return app.notifications.notify("Processing payment..."),this.trigger("process:payment",b)},a.prototype.save=function(a,b){return b==null&&(b=!1),b?this.collection.add(this.model,{silent:!0}):this.collection.add(this.model)},a.prototype.add_payment=function(a){var b,c=this;return a.get("created_order")&&!this.model.get("id")&&(this.model.set("id",a.get("created_order"),{silent:!0}),this.save(event,!0)),a.get("client")&&(b=a.get("client"),this.model.get("client_id")?this.clients.push(b):(b.user_id&&this.model.set("user_id",b.user_id,{silent:!0}),this.model.set("client_id",b.id,{silent:!0}),this.model.set("name",b.name,{silent:!0}),this.model.set("email",b.email,{silent:!0}),_.each(b,function(a,b){if(a!=="")return $("."+b).val(a)}))),app.notifications.notify("Payment of $"+app.helpers.dollar(a.attributes.amount)+" has been applied to this reservation."),this.payments.push(a.attributes),this.update(),$(".payment input").val("")},a.prototype.refund_payment=function(a){var b,c=this;return b=$(a.target).parent().attr("id"),_.each(this.payments,function(a){if(a.id.toString()===b.toString())return $(".no-auto").click(),c.trigger("refund:payment",a),app.notifications.notify("Refunding payment...")})},a.prototype.payment_refunded=function(a){var b=this;return _.each(this.payments,function(c){if(c.id.toString()===a.get("id"))return b.payments=_.without(b.payments,c)}),this.update(),this.payments.length===0&&this.model.get("id")?app.notifications.yes_or_no("You have refunded the entire cost of this reservation. Do you want to cancel it?",this.cancel_reservation):app.notifications.notify("$"+app.helpers.dollar(a.get("amount"))+" has been refunded to "+a.get("name"))},a.prototype.remove_trip=function(a){var b,c=this;return $("#trip-calendar td").removeClass("trip-date"),b=$(a.target).parent().attr("id"),_.each(this.trips,function(a){if(a.id.toString()===b.toString())return c.trips=_.without(c.trips,a),app.reserved.remove_reservation(a.id)}),this.show_trip_availability(),this.update()},a.prototype.remove_lodge=function(a){var b,c=this;return $("#lodge-calendar td").removeClass("trip-date"),b=$(a.target).parent().attr("id"),_.each(this.stays,function(a){if(a.id.toString()===b.toString())return c.stays=_.without(c.stays,a),app.reserved.remove_reservation(b)}),this.show_lodge_availability(),this.update()},a.prototype.remove_product=function(a){var b,c=this;return b=$(a.target).parent().attr("id"),_.each(this.purchases,function(a){if(a.id.toString()===b.toString())return c.purchases=_.without(c.purchases,a)}),this.update()},a.prototype.remove_guest=function(a){var b,c=this;return b=$(a.target).parent().attr("id"),_.each(this.clients,function(a){if(a.id.toString()===b.toString())return c.clients=_.without(c.clients,a),c.model.attributes.guests=_.without(c.model.attributes.guests,a)}),this.update()},a.prototype.update_discount=function(a){var b,c,d,e;return d=this.model.get("total"),a.percent_discount?(c=a.percent_discount+"%",b=Math.round(d*(a.percent_discount/100),2)):b=a.flat_discount,a=this.model.get("discount"),e=parseFloat(a)+parseFloat(b),this.model.set("discount",e,{silent:!0}),this.model.set("promotion_id",a.id,{silent:!0}),$(".discount").val("$"+app.helpers.dollar(e)),$("#discount-info").html("Promotion code "+c+" discount of $"+app.helpers.dollar(b)+" applied."),this.update()},a.prototype.update=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=this;return v=0,x=0,j=0,s=0,e=0,a=this.model.get("adults"),c=this.model.get("children"),t=this.model.get("seniors"),this.model.set("trip_reservations",this.trips,{silent:!0}),this.included_nights=0,w=this.trips.length>0?"":'<li><div><p class="small">No trips have been added to this reservation.</p></div></li>',$(".trip-list").html(w),_.each(this.trips,function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;r=a,delete a.trip.id,delete a.trip.start_date,delete a.trip.end_date,n=_.extend(a,a.trip),n.id=a.id,t=new models.Trip(n),s=new models.Reservation(a),n.dates=t.formatted_dates(),n.party=s.party_detail(),$(".trip-list").append(tmpl.reservations_trip_item(n)),l=parseInt(a.adults)+parseInt(a.seniors),y.included_nights+=t.get("nights").length*l,v+=parseFloat(n.total),x+=parseFloat(n.total),e+=parseFloat(n.deposit),k=[];if(a.activities){i=!1,h=!1,j=!1,g=!1,d=-1,q=a.activities;for(o=0,p=q.length;o<p;o++)b=q[o],c=app.employees.list.collection.get(b.guide_id),c?c=c.attributes.nickname:c="Group "+b.group_number,f=moment(b.date),b.start_time&&b.start_time!=="00:00:00"?m=app.helpers.twenty_four_to_twelve(b.start_time):m=!1,i!==b.trip_id||h!==m||g!==b.date?(h=m,i=b.trip_id,g=b.date,j={time:m,date:g,guide:c+" ("+b.people+")"},k.push(j),d++):k[d].guide+=", "+c+" ("+b.people+")";return a.merged_activities=k}}),this.model.set("lodge_reservations",this.stays,{silent:!0}),this.filled_nights=0,l=[],k=0,i=this.stays.length>0?"":'<li><div><p class="small">No lodging nights have been added to this reservation.</p></div></li>',$(".lodge-list").html(i),_.each(this.stays,function(a){var b;return b=new models.Reservation(a),a.dates=b.formatted_lodging_dates(),a.check_in=b.get("check_in"),a.check_out=b.get("check_out"),a.party=a.adults>1?a.adults+" people":"1 person",$(".lodge-list").append(tmpl.reservations_lodging_item(a)),v+=parseFloat(a.total),j+=parseFloat(a.total),e+=parseInt(a.total),y.filled_nights+=b.get("nights").length*parseInt(a.adults)}),this.included_nights>this.filled_nights?($(".lodge-warn").html('<p class="error-msg"><b>Warning!</b> There are inclusive trips with lodging nights left to be scheduled. You will not be able to save the reservation until the lodging has been added.</p>').css({display:"block"}),this.included_nights=this.included_nights-this.filled_nights):($(".lodge-warn").empty().css({display:"none"}),this.included_nights=0),this.model.set("included_nights",this.included_nights,{silent:!0}),r=this.purchases.length>0?"":'<li><div p class="small">No products or rentals have been added to this reservation.</p></div></li>',$(".product-list").html(r),_.each(this.purchases,function(a){var b;return b=parseFloat(a.price)*parseFloat(a.quantity),$(".product-list").append(tmpl.reservations_purchase_item(a)),v+=parseFloat(b),s+=parseFloat(b),e+=parseFloat(b)}),m=0,n=this.payments.length>0?"":'<div><span class="data" style="width:80%">No payments have been made on this reservation yet.</span></div></li>',o=[],$(".payment-list").html(n),this.model.set("payments",this.payments,{silent:!0}),_.each(this.payments,function(a){var b,c;if(!a.refunded||a.refunded==="0")return c='<li id="'+a.id+'"><div>',c+="<span>$"+app.helpers.dollar(a.amount)+"</span>",c+="<span>"+app.helpers.truncate(a.name,16)+"</span>",a.method==="credit"?b='<img src="https://flybook-asset.s3.amazonaws.com/images/payment-types/'+a.card+'.jpg" /> ':b='<img src="https://flybook-asset.s3.amazonaws.com/images/payment-types/'+a.method+'.jpg" />',c+="<span>"+b+"</span>",c+="<span>"+app.helpers.sql_to_slash(a.created_on)+"</span>",c+='</div><button class="del refund-payment">Refund</button></li>',$(".payment-list").append(c),m+=parseFloat(a.amount)}),h=this.clients.length>0?"":'<div><span class="data" style="width:80%">No additional guests have been added to this reservation.</span></div></li>',$(".guest-list").html(h),this.model.set("clients",this.clients,{silent:!0}),_.each(this.clients,function(a){var b;return b='<li id="'+a.id+'"><div>',b+='<span class="data">'+a.name+"</span>",b+='</div><button class="del view-guest">View</button><button class="del remove-guest">Remove</button></li>',$(".guest-list").append(b)}),q={name:this.model.get("name"),email:this.model.get("email")},this.model.set("guests",_.union(q,this.clients),{silent:!0}),f=parseFloat(this.model.get("discount")),v-=f,x-=f,j-=f,s-=f,e-=f,$(".total").val("$"+app.helpers.dollar(v)),$(".deposit").val("$"+app.helpers.dollar(e)),$(".discount").val("$"+app.helpers.dollar(f)),b=parseFloat(v)-parseFloat(m),$(".balance").val("$"+app.helpers.dollar(b)),u=b,e<u&&(u=e),$(".amount").val(app.helpers.dollar(u)),this.model.set("total",v,{silent:!0}),this.model.set("total_trip",x,{silent:!0}),this.model.set("total_lodge",j,{silent:!0}),this.model.set("total_product",s,{silent:!0}),this.model.set("deposit",e,{silent:!0}),this.model.set("discount",f,{slient:!0}),this.model.set("balance_due",b,{silent:!0}),p=parseInt(this.model.get("adults"))+parseInt(this.model.get("children"))+parseInt(this.model.get("seniors")),$(".heads").text(p),!this.model.get("arriving_on")||this.model.get("arriving_on")==="0000-00-00"?this.model.set("arrival_date","No arrival date set",{silent:!0}):(d=moment(this.model.get("arriving_on")+" "+this.model.get("arriving_at"),"YYYY-MM-DD HH:mm:ss"),this.model.set("arrival_date",d.format("MMM Do YYYY")),this.model.get("arriving_at")&&this.model.get("arriving_at")!=="00:00:00"&&this.model.set("arrival_time",d.format("h:mma"),{silent:!0})),!this.model.get("departing_on")||this.model.get("departing_on")==="0000-00-00"?this.model.set("departure_date","No departure date set.",{silent:!0}):(g=moment(this.model.get("departing_on")+" "+this.model.get("departing_at"),"YYYY-MM-DD HH:mm:ss"),this.model.set("departure_date",g.format("MMM Do YYYY")),this.model.get("departing_at")&&this.model.get("departing_at")!=="00:00:00"&&this.model.set("departure_time",g.format("h:mma"),{silent:!0})),$("#overview").html(tmpl.reservations_overview(this.model.attributes)),app.dropdown.fluid()},a.prototype.approve_reservation=function(){return this.model.set("status","3",{silent:!0}),this.done()},a.prototype.place_reservation_on_hold=function(){var a=this;return app.notifications.confirm("Are you sure you want to place this reservation on hold? This will NOT free the space.",function(){return a.model.set("status","4",{silent:!0}),a.done()})},a.prototype.cancel_reservation=function(){var a=this;return this.payments.length>0?(app.notifications.error("This reservation has payments. You must refund them before you can cancel this reservation."),!1):(app.notifications.confirm("Are you sure you want to cancel this reservation? This will delete all reservations and activities permenantly. Client records will remain intact.",function(){return a["delete"]()}),!1)},a}(),views.PageForm=function(){function a(){this.make_address=__bind(this.make_address,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"keyup .title":"make_address"},a.prototype.after=function(){if(this.model.get("id")&&app.isOnline)return this.setup_photos("page",{page_id:this.model.get("id")})},a.prototype.make_address=function(a){},a}(),views.PhotoUploader=function(){function a(a,b,c,d,e,f,g,h){var i,j=this;this.id=b,this.url=c,this.file_name_pattern=d,this.additional_selectors=e!=null?e:"",this.additional_params=f!=null?f:{},this.prefix=g!=null?g:"",this.format=h!=null?h:"jpg",this.additional_selectors&&(this.additional_selectors=","+this.additional_selectors),i={action:this.url,params:_.extend({},{photo:this.id,format:this.format},this.additional_params),element:document.getElementById(a),onProgress:function(a,b,c,d){var e;return e=Math.round(c/d*100),e===100?$("#progress span").text("Processing, this may take a few seconds..."):$("#progress span").text("Uploading "+e+"%..."),$("#progress #bar").css({width:e+"%"}),$("#progress").css({display:"block"})},onComplete:function(a,b,d){return $("#progress").css({display:"none"}),c="https://s3.amazonaws.com/flybook/"+j.prefix+j.id+"_"+j.file_name_pattern+"."+j.format+"?"+Math.random()*1e3,$("#"+j.id+" div:first"+j.additional_selectors).css({"background-image":'url("'+c+'")'}),j.trigger("complete",j)}},new qq.FileUploader(i),this}return __extends(a,Backbone.View),a}(),views.ProductForm=function(){function a(){this.vars_sorted=__bind(this.vars_sorted,this),this.update_variations=__bind(this.update_variations,this),this.remove_variation=__bind(this.remove_variation,this),this.add_variation=__bind(this.add_variation,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .add-var":"add_variation","click .remove-variation":"remove_variation"},a.prototype.after=function(){this.tab_index=0;if(this.template==="products/edit"){this.sortable=$("#variations").sortable({update:this.vars_sorted}),this.vars=this.model.get("variations")?this.model.get("variations").split("||"):[],this.update_variations(),this.upsell=this.model.get("trips"),this.update_upsells();if(app.isOnline)return this.setup_photos("product",{product_id:this.model.get("id")},5)}},a.prototype.add_variation=function(){var a;return a=$("#variant").val(),a===""?(app.notifications.error("Enter a value to create a product variation."),!1):(this.vars.push(a),$("#variant").val(""),this.update_variations())},a.prototype.remove_variation=function(a){var b,c;return b=$(a.target).parent().parent(),c=$("#variations li").index(b),this.vars.splice(c,1),this.update_variations()},a.prototype.update_variations=function(a){var b=this;return $("#variations").html(""),$("#variant").val(""),_.each(this.vars,function(a){return $("#variations").append("<li><div><span>"+a+'</span><button class="del remove-variation">Delete</button></div></li>')}),this.model.set("variations",this.vars.join("||")),app.dropdown.fluid()},a.prototype.vars_sorted=function(){var a;return a=[],$("#variations span").each(function(b){return a.push($(this).html())}),this.vars=a,this.update_variations()},a}(),views.ReservationForm=function(){function a(){this.get_dropdown_values=__bind(this.get_dropdown_values,this),this.process_payment=__bind(this.process_payment,this),this.lost_focus=__bind(this.lost_focus,this),this.remove_discount=__bind(this.remove_discount,this),this.change_discount=__bind(this.change_discount,this),this.change_pay_method=__bind(this.change_pay_method,this),this.update_lodging_list=__bind(this.update_lodging_list,this),this.set_room=__bind(this.set_room,this),this.lodge_date_clicked=__bind(this.lodge_date_clicked,this),this.show_lodge_availability=__bind(this.show_lodge_availability,this),this.set_lodge=__bind(this.set_lodge,this),this.select_lodge=__bind(this.select_lodge,this),this.update_trip_list=__bind(this.update_trip_list,this),this.remove_trip=__bind(this.remove_trip,this),this.add_trip_lodging_dates=__bind(this.add_trip_lodging_dates,this),this.show_trip_dates=__bind(this.show_trip_dates,this),this.trip_date_clicked=__bind(this.trip_date_clicked,this),this.show_trip_availability=__bind(this.show_trip_availability,this),this.set_trip=__bind(this.set_trip,this),this.show_availability=__bind(this.show_availability,this),this.party_change=__bind(this.party_change,this),this.after=__bind(this.after,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"change select.trip":"set_trip","change select.lodge":"set_lodge","change select.room":"set_room","change .num-field select":"party_change","click .remove-trip":"remove_trip","change #payment .left select":"change_pay_method","change #payment .right select":"change_discount","click #remove-discount":"remove_discount","blur .swipe-focus":"lost_focus","click .enter-payment":"process_payment"},a.prototype.before=function(a){return this.tab_index=0,this.get_dropdown_values(this.data.trips,this.data.lodges,this.data.staff),_.extend(this.data,{trips:this.trips,lodges:this.lodges,rooms:this.rooms,staff:this.staff_select,party:this.party,discounts:this.discounts}),app.helpers.after_transition("#dropdown",a),app.dropdown.expand()},a.prototype.after=function(){return this.trip_calendar=new Flint.Calendar("#trip-calendar",app.year,app.month),this.trip_calendar.on("next prev",this.show_availability),this.trip_calendar.on("clicked",this.trip_date_clicked),this.lodge_calendar=new Flint.Calendar("#lodge-calendar",app.year,app.month),this.lodge_calendar.on("next prev",this.show_availability),this.lodge_calendar.on("clicked",this.lodge_date_clicked),this.nights||(this.trips=[]),this.nights||(this.nights=[]),this.trip&&this.show_trip_availability(),this.lodge&&this.show_lodge_availability(),this.start_date&&this.date_clicked(this.start_date),app.dropdown.fluid()},a.prototype.party_change=function(a){var b,c,d;return c=$(a.target),b=c.attr("name"),d=c.val(),this.trips=[],this.nights=[],this.update_trip_list(),this.update_lodging_list(),this.model.set(b,d,{silent:!0}),this.show_trip_availability()},a.prototype.show_availability=function(a){this.trip_calendar.render(a.year,a.month),this.lodge_calendar.render(a.year,a.month),this.trip&&this.show_trip_availability();if(this.lodge)return this.show_lodge_availability()},a.prototype.set_trip=function(a){var b,c=this;return this.trip_dates=[],b=$(a.target),b.val()==="0"?!1:app.trips.get(b.val(),function(a){return c.trip=a,c.model.set("trip_id",a.get("id")),c.show_trip_availability(),c.show_lodge_availability()})},a.prototype.show_trip_availability=function(){var a,b,c=this;return $("#trip-calendar td").removeClass("start-available").removeClass("trip-date-available").removeClass("trip-date").removeClass("start"),this.people=parseInt(this.model.get("adults"))+parseInt(this.model.get("children"))+parseInt(this.model.get("seniors")),a=this.trip.get_availability_by_month(this.trip_calendar.year,this.trip_calendar.month,this.people,this.staff),b=[],a.length>0&&_.each(a,function(a){return $("#trip-calendar td[data-sql="+a.sql+"]").addClass("start-available"),b.push(a.sql)}),this.show_trip_dates(b,"trip-calendar","trip-date-available")},a.prototype.trip_date_clicked=function(a,b){var c,d,e;return c=$("#trip-calendar td[data-sql="+a+"]"),c.hasClass("start-available")&&$("#trip-calendar td").removeClass("start").removeClass("trip-date"),e={id:Math.random()*5e3,start_date:a,name:this.trip.get("name"),formatted:app.helpers.js_to_slash(b)},this.trip.get("duration")<2?c.addClass("start"):(d=new Date(b.getTime()+86400*(this.trip.get("duration")-1)*1e3),e.formatted+=" - "+app.helpers.js_to_slash(d),e.end_date=this.trip.jsdate_to_sql(d),c.addClass("start"),this.show_trip_dates([a],"trip-calendar","trip-date")),this.trip.get("lodging_nights")&&(e.nights=this.add_trip_lodging_dates(b)),this.trips.push(e),this.update_trip_list()},a.prototype.show_trip_dates=function(a,b,c){var d,e=this;d=this.trip.get("duration");if(d>1)return _.each(a,function(a){var f,g,h,i,j,k;g=e.trip.sqldate_to_js(a);if(g&&d>1){j=g.getTime(),f=(new Date(j+86400*(d-2)*1e3)).getTime(),k=[];while(j<=f+9e7)j+=828e5,h=new Date(j),i=e.trip.jsdate_to_sql(h),k.push($("#"+b+" td[data-sql="+i+"]").addClass(c));return k}})},a.prototype.add_trip_lodging_dates=function(a){var b,c,d,e,f;f=[],e=a.getTime(),b=new Date(a.getTime()+86400*(this.trip.get("lodging_nights")-1)*1e3),this.trip.get("lodge_id")&&this.trip.get("lodge_id")!=="0"&&this.trip.get("lodge_id")!=="1"&&this.select_lodge(this.trip.get("lodge_id")),this.trip.get("arrive_night_prior")==="1"&&(e-=864e5,b-=864e5);while(e<=b)e+=828e5,a=new Date(e),d=this.trip.jsdate_to_sql(a),c={date:d,included:!0},this.nights.push(c),f.push(c);return this.update_lodging_list(),f},a.prototype.remove_trip=function(a){var b,c=this;return b=$(a.target).parent().attr("id"),_.each(this.trips,function(a){if(a.id.toString()===b.toString()){c.trips=_.without(c.trips,a);if(a.nights)return _.each(a.nights,function(a){return c.nights=_.without(c.nights,a)}),c.update_lodging_list()}}),this.update_trip_list()},a.prototype.update_trip_list=function(){var a,b=this;return $("#trips").empty(),this.trips.length>0&&_.each(this.trips,function(a){return $("#trips").append('<li id="'+a.id+'"><div><span><b>'+a.formatted+"</b><br />"+a.name+'<span></div><button class="del remove-trip">X</button></li>')}),a=JSON.stringify(this.trips),this.model.set("pending_trips",a,{silent:!0}),app.dropdown.fluid()},a.prototype.select_lodge=function(a){var b=this;return $(".lodge option").attr("selected",!1).each(function(b){if($(this).val()===a)return $(this).attr("selected",!0)}),this.model.set("lodge_id",a),app.lodging.get(a,function(a){return a.get("rooms").length>0?($(".lodge-rooms").css({display:"block"}),$(".lodge-rooms option").remove(),_.each(a.get("rooms"),function(a){return $(".lodge-rooms").append('<option value="'+a.id+'">'+a.type+"</option>")})):$(".lodge-rooms").css({display:"none"})})},a.prototype.set_lodge=function(){},a.prototype.show_lodge_availability=function(){},a.prototype.lodge_date_clicked=function(a,b){},a.prototype.set_room=function(){},a.prototype.update_lodging_list=function(){var a,b,c,d,e,f,g;$("#lodge-calendar td").removeClass("trip-date"),$("#nights").empty();if(this.nights.length>0){this.nights.sort(),g=this.trip.sqldate_to_js(this.nights[0]),d=this.trip.sqldate_to_js(this.nights[this.nights.length-1]),e=new Date(d.getTime()+864e5),a=app.helpers.js_to_slash(g),b=app.helpers.js_to_slash(e),g=g.getTime(),d=d.getTime();while(g<=d)c=new Date(g),f=app.helpers.jsdate_to_sql(c),$('#lodge-calendar td[data-sql="'+f+'"]').addClass("trip-date"),g+=864e5;return $("#nights").html('<p class="small">'+this.nights.length+" Night Stay:</p></p><p><b>Check in: </b>"+a+" &nbsp; <b>Check Out: </b> "+b+"</p>")}},a.prototype.change_pay_method=function(){},a.prototype.change_discount=function(){},a.prototype.remove_discount=function(){},a.prototype.lost_focus=function(){},a.prototype.process_payment=function(){},a.prototype.get_dropdown_values=function(a,b,c){var d,e,f,g,h,i,j=this;this.party=function(){i=[];for(h=0;h<50;h++)i.push(h);return i}.apply(this),g=[[0,"Select Trip / Package..."]],_.each(app.trips.list.collection.models,function(a){return g.push([a.get("id"),app.helpers.truncate(a.get("name"),30)])}),this.trips=g,g=[[0,"Select Lodge..."]],_.each(app.lodging.list.collection.models,function(a){return g.push([a.get("id"),app.helpers.truncate(a.get("name"),30)])}),this.lodges=g,this.rooms=[[0,"Select Room (select lodge first)..."]],c=[[app.user.get("name"),app.user.get("name")]],_.each(app.employees.list.collection.models,function(a){return c.push([a.get("nickname"),a.get("nickname")])}),this.staff_select=c,this.staff=app.employees.list.collection;if(this.template==="reservations/edit")return f=this.model.get("order"),this.model.set("total",f.total),this.model.set("balance_due",f.balance_due),d=f.deposit<f.balance_due?f.deposit:f.balance_due,e=f.deposit<f.balance_due?f.deposit:0,this.model.set("amount",d),this.model.set("deposit",e),this.discounts=[[0,"Select discount to apply..."]],_.each(app.user.get("account").promotions,function(a){return j.discounts.push([a.id,a.code])})},a}(),views.SettingsForm=function(){function a(){this.passchange=__bind(this.passchange,this),this.update_codes=__bind(this.update_codes,this),this.remove_code=__bind(this.remove_code,this),this.add_code=__bind(this.add_code,this),this.update_docs=__bind(this.update_docs,this),this.update_document_name=__bind(this.update_document_name,this),this.remove_document=__bind(this.remove_document,this),this.add_document=__bind(this.add_document,this),this.doc_uploader=__bind(this.doc_uploader,this),this.cancel=__bind(this.cancel,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Flint.Form),a.prototype.el="#app",a.prototype.events={"click .add-code":"add_code","click .remove-code":"remove_code","click .remove-document":"remove_document","change .doc":"update_document_name","click button.passchange":"passchange"},a.prototype.code_template='<li id="{{id}}"><div><span class="long" style="width:120px">{{code}}</span><span >{{#if percent_discount}}{{percent_discount}}%{{else}}N/A{{/if}}</span><span >{{#if flat_discount}}${{dollar flat_discount}}{{else}}N/A{{/if}}</span><span>{{sql_to_slash valid_through}}&nbsp;</span><button class="del remove-code">Delete</buton></div></li>',a.prototype.docs_template='<li id="{{id}}"><div><input type="text" name="docs[]" value="{{name}}" class="doc" /><span><a href="/api/documents/_download/?id={{id}}">{{ext}}</a></span><button class="del rdc">Delete</buton></div></li>',a.prototype.after=function(){var a,b=this;this.template==="settings/company_profile"&&(this.logo_upload=new views.PhotoUploader("logo-upload","logo","/api/uploads/_company_profile/",this.model.id,"",{},"","png"),this.logo_upload.on("complete",function(){return b.model.set("has_logo","1")}),this.photo_upload=new views.PhotoUploader("photo-upload","photo","/api/uploads/_company_profile/",this.model.id),this.photo_upload.on("complete",function(){return b.model.set("has_photo","1")}),this.model.get("has_logo")==="1"&&(a="https://s3.amazonaws.com/flybook/logo_"+this.model.get("id")+".png?"+Math.random()*1e3,$("#logo div:first").css({"background-image":'url("'+a+'")'})),this.model.get("has_photo")==="1"&&(a="https://s3.amazonaws.com/flybook/photo_"+this.model.get("id")+".jpg?"+Math.random()*1e3,$("#photo div:first").css({"background-image":'url("'+a+'")'}))),this.template==="settings/promotions"&&(this.promo_codes=this.model.get("promotions"),this.update_codes()),this.template==="settings/forms"&&(this.docs=this.model.get("documents"),this.update_docs(),this.doc_uploader());if(this.template==="preferences/profile")return a="https://s3.amazonaws.com/flybook/icon_"+this.model.id+".jpg?"+Math.random()*1e3,$("#icon div:first,#user li .cover").css({"background-image":'url("'+a+'")'})},a.prototype.cancel=function(){return $("#app").css({left:"-540px"}),window.location.hash="#noop"},a.prototype.doc_uploader=function(){var a,b=this;return a={action:"/api/documents/_upload/",element:document.getElementById("doc-upload"),onProgress:function(a,b,c,d){var e;return e=Math.round(c/d*100),e===100?$("#progress span").text("Processing, this may take a few seconds..."):$("#progress span").text("Uploading "+e+"%..."),$("#progress #bar").css({width:e+"%"}),$("#progress").css({display:"block"})},onComplete:function(a,c,d){return $("#progress").css({display:"none"}),b.add_document(d)}},new qq.FileUploader(a)},a.prototype.add_document=function(a){return app.notifications.notify("Document uploaded sucessfully!"),this.docs.push(a),this.update_docs()},a.prototype.remove_document=function(a){var b,c,d=this;return c=$(a.target).parent().parent(),b=c.attr("id"),_.each(this.docs,function(a){a.id.toString()===b.toString()&&(d.trigger("deleted:doc",a),d.docs=_.without(d.docs,a),d.update_docs())})},a.prototype.update_document_name=function(a){var b,c,d,e=this;return d=$(a.target).val(),c=$(a.target).parent().parent(),b=c.attr("id"),_.each(this.docs,function(a){a.id.toString()===b.toString()&&(a.name=d,e.update_docs())})},a.prototype.update_docs=function(){var a,b=this;return $("#docs").html(""),a=Handlebars.compile(this.docs_template),_.each(this.docs,function(b){var c;return c=a(b),$("#docs").append(c)}),this.model.set("documents",this.docs),this.delegateEvents()},a.prototype.add_code=function(){var a;return a={id:Math.random()*3e3},$(".code-fields input").each(function(){var b,c;return b=$(this).attr("name"),b==="code"||b==="valid_through"?c=$(this).val():c=$(this).val().toString().replace(/[A-Za-z$-,+]/g,""),a[b]=c}),a.code===""||a.percent_discount===""&&a.flat_discount===""?(app.notifications.error("You need to specify a code and a discount!"),!1):($(".code-fields input").val(""),this.promo_codes.push(a),this.update_codes())},a.prototype.remove_code=function(a){var b,c,d=this;return c=$(a.target).parent().parent(),b=c.attr("id"),_.each(this.promo_codes,function(a){a.id.toString()===b.toString()&&(d.promo_codes=_.without(d.promo_codes,a),d.update_codes())})},a.prototype.update_codes=function(){var a,b=this;return $("#promotion-codes").html(""),a=tmpl_compile(this.code_template),_.each(this.promo_codes,function(b){var c;return c=a(b),$("#promotion-codes").append(c)}),this.model.set("promotions",this.promo_codes),this.delegateEvents()},a.prototype.passchange=function(){return!this.model.get("new_password")||!this.model.get("old_password")?(app.notifications.error("You need to enter your old and a new password to change it!"),!1):this.model.get("new_password").toString().length<6?(app.notifications.error("Your pasword needs to be at least six characters!"),!1):this.model.get("new_password")!==this.model.get("confirmed")?(app.notifications.error("Your password and confirmation do not match!"),!1):(this.trigger("changed:password",this.model),!1)},a}(),views.StoreForm=function(){function a(){this.values_sorted=__bind(this.values_sorted,this),this.update_values=__bind(this.update_values,this),this.remove_value=__bind(this.remove_value,this),this.add_value=__bind(this.add_value,this),this.render_preview=__bind(this.render_preview,this),this.update_question=__bind(this.update_question,this),this.type_changed=__bind(this.type_changed,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .add-value":"add_value","click .remove-value":"remove_value","change #types":"type_changed","keyup #quest":"update_question"},a.prototype.after=function(){var a;if(this.template="forms/edit")return this.sortable=$("#responses").sortable({update:this.values_sorted}),this.values=this.model.get("responses")?this.model.get("responses").split("||"):[],this.update_values(),this.render_preview(),a=this.model.get("type"),a==="dropdown"||a==="radio"||a==="checkbox"?$("#value-specs").css({display:"block"}):$("#value-specs").css({display:"none"})},a.prototype.type_changed=function(a){var b;return b=$(a.target).val(),b==="dropdown"||b==="radio"||b==="checkbox"?$("#value-specs").css({display:"block"}):$("#value-specs").css({display:"none"}),this.model.set("type",b,{silent:!0}),this.render_preview()},a.prototype.update_question=function(a){var b;return b=$(a.target).val(),this.model.set("field",b,{silent:!0}),this.render_preview()},a.prototype.render_preview=function(){var a,b,c=this;return a=[],_.each(this.values,function(b){return a.push({val:b})}),this.model.set("name",$("#quest").val()),b=this.model.attributes,b.copy=this.model.clone(),b.answers=a,$("#preview").html(tmpl.forms_preview(b)),delete this.model.attributes.model},a.prototype.add_value=function(){var a;return a=$("#response").val(),a===""?(app.notifications.error("Enter a value to create an answer option."),!1):(this.values.push(a),$("#response").val(""),this.update_values(),app.dropdown.fluid())},a.prototype.remove_value=function(a){var b,c;return b=$(a.target).parent(),c=$("#responses li").index(b),this.values.splice(c,1),this.update_values()},a.prototype.update_values=function(a){var b=this;return $("#responses").html(""),_.each(this.values,function(a){return $("#responses").append("<li><div><span>"+a+'</span></div><button class="del remove-value">Delete</button></li>')}),this.model.set("responses",this.values.join("||")),this.render_preview()},a.prototype.values_sorted=function(){var a;return a=[],$("#responses span").each(function(b){return a.push($(this).html())}),this.values=a,this.model.set("responses",this.values.join("||")),this.render_preview()},a}(),views.TripDaily=function(){function a(){this.sorted=__bind(this.sorted,this),this.after=__bind(this.after,this),this.before=__bind(this.before,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.before=function(a){return console.log(this.data),app.helpers.after_transition("#dropdown",a),app.dropdown.expand()},a.prototype.after=function(){return this.sortable=$(".list").sortable({connectWith:".list",cancel:".guide"}),app.dropdown.fluid()},a.prototype.sorted=function(){},a}(),views.TripForm=function(){function a(){this.guides_sorted=__bind(this.guides_sorted,this),this.update_staff_assignments=__bind(this.update_staff_assignments,this),this.show_staff_assignments=__bind(this.show_staff_assignments,this),this.remove_start_time=__bind(this.remove_start_time,this),this.add_start_time=__bind(this.add_start_time,this),this.remove_fee=__bind(this.remove_fee,this),this.add_fee=__bind(this.add_fee,this),this.after=__bind(this.after,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,flybook.Form),a.prototype.__events={"click .newtime":"add_start_time","click p span":"remove_start_time","click #guides input,#assistants input":"update_staff_assignments","click .add-fee":"add_fee","click .remove-fee":"remove_fee"},a.prototype.deposit_tmpl='<li id="{{id}}"><div><span>{{days_prior}}</span><span>{{percent_due}}%</span></div><button class="del remove-deposit-rule">Delete</buton></li>',a.prototype.fee_tmpl='<li id="{{id}}"><div><span class="long">{{name}}</span><span class="short">{{#if percent}}{{percent}}%{{else}}N/A{{/if}}</span><span>{{#if flat}}${{dollar flat}}%{{else}}N/A{{/if}}</span></div><button class="del remove-fee">Delete</buton></li>',a.prototype.after=function(){var a,b,c,d,e,f,g=this;this.valid_changes=!1,this.gmap_callback_method="app.trips.form.setup_map";if(this.template==="trips/edit"||this.template==="trips/schedule")this.price_points=this.model.get("pricing"),this.update_prices(),this.deposit_rules=this.model.get("deposit_rules"),this.update_deposits(),this.fees=this.model.get("fees"),this.update_fees(),this.trip_sortable=$("#guides").sortable({update:this.guides_sorted}),this.show_staff_assignments();return this.template==="trips/edit"&&(this.pre_check_docs(),app.isOnline&&this.setup_photos("trip",{trip_id:this.model.get("id")}),this.start_dates=_.isString(this.model.get("start_dates"))?this.model.get("start_dates").split(","):[],this.start_days=_.isString(this.model.get("start_days"))?this.model.get("start_days").split(","):[],f=app.year,b=this.model.get("season_end_month"),e=this.model.get("season_start_month"),parseInt(app.month)>parseInt(b)?(c=parseInt(b)-1,f++):parseInt(app.month)<parseInt(e)?c=parseInt(e)-1:c=app.month,this.calendar=new Flint.Calendar("#weekday-calendar",f,c),this.calendar.on("clicked",this.dateclick),this.calendar.on("next prev",this.render_starts),this.render_starts(),this.times=_.isString(this.model.get("start_times"))&&this.model.get("start_times")!==""?this.model.get("start_times").split(","):[],this.update_start_times(),a=this.model.get("auto_collect_balances"),!a||a==="0"||a===0?$(".no-auto").click():a==="1"||a===1?$(".day-auto").click():($(".custom-auto").val(a).click(),$(".balance-days").val(this.model.get("auto_collect_days_prior")))),this.template==="trips/schedule"&&(d=this.model.get("start_date").split("-"),this.start_select=new Flint.Calendar("#start-cal",d[0],d[1]-1),this.start_select.set_focus_date(this.model.get("start_date"),this.model.get("js_start")),this.start_select.on("clicked",function(a,b){return g.model.set("start_date",a)}),d=this.model.get("end_date").split("-"),this.end_select=new Flint.Calendar("#end-cal",d[0],d[1]-1),this.end_select.set_focus_date(this.model.get("end_date"),this.model.get("js_end")),this.end_select.on("clicked",function(a,b){return g.model.set("end_date",a)})),app.dropdown.fluid()},a.prototype.add_fee=function(){var a;return a={id:Math.random()*3e3},$(".add-fees input").each(function(){var b,c;return b=$(this).attr("name"),c=$(this).val(),b!=="fee_name"?c=c.toString().replace(/[A-Za-z$-,]/g,""):b="name",a[b]=c}),a.name===""?(app.notifications.error("You must enter a name and flat or percentage based rate to add a fee or tax."),!1):a.name.toLowerCase().indexOf("book")>=0||a.name.toLowerCase().indexOf("permit")>=0?(app.notifications.error("Sorry, we have to assume that fee name is against our policy to the right..."),!1):a.percent===""&&a.flat===""?(app.notifications.error("You must enter a name and flat or percentage based rate to add a fee or tax."),!1):(this.model.set("fees_changed",!0),this.fees.push(a),this.update_fees())},a.prototype.remove_fee=function(a){var b,c,d=this;return this.model.set("fees_changed",!0),c=$(a.target).parent(),b=c.attr("id"),_.each(this.fees,function(a){a.id.toString()===b.toString()&&(d.fees=_.without(d.fees,a),d.update_fees())})},a.prototype.update_fees=function(){var a,b=this;return $("#fees").html(""),$(".add-fees input").val(""),a=tmpl_compile(this.fee_tmpl),_.each(this.fees,function(b){var c;return c=a(b),$("#fees").append(c)}),this.model.set("fees",this.fees),this.delegateEvents()},a.prototype.add_start_time=function(){var a,b,c,d=this;return this.times||(this.times=[]),a=$(".hrs").val(),b=$(".mins").val(),c=a+":"+b,this.times.push(c),this.times=_.sortBy(this.times,function(a){return a}),this.model.set("start_times",_.uniq(this.times).join(","),{silent:!0}),this.update_start_times()},a.prototype.remove_start_time=function(a){var b,c;return c=a.target,b=$("#start-times p span").index(c),this.times=_.without(this.times,this.times[b]),this.model.set("start_times",this.times.join(","),{silent:!0}),this.update_start_times()},a.prototype.update_start_times=function(){var a=this;return $("#start-times p").html(""),_.each(this.times,function(a){return a=app.helpers.twenty_four_to_twelve(a),$("#start-times p").append("<span>"+a+"<em>X</em></span>")})},a.prototype.show_staff_assignments=function(){var a;return a=_.isString(this.model.get("guides_assigned"))?this.model.get("guides_assigned"):"",$("#guides input").each(function(b){var c;c=$(this).attr("name");if(a.indexOf(c)>=0)return $(this).attr("checked",!0)})},a.prototype.update_staff_assignments=function(){var a,b;return b=[],a=[],$("#guides input").each(function(a){if($(this).is(":checked"))return b.push($(this).attr("name"))}),$("#assistants input").each(function(b){if($(this).is(":checked"))return a.push($(this).attr("name"))}),this.model.set("guides_assigned",b.join(",")),this.model.set("assistants_assigned",a.join(","))},a.prototype.guides_sorted=function(){var a,b,c,d=this;return b=[],a=[],c=0,_.each(this.trip_sortable.find("li"),function(a,c){var d;return d=a.getAttribute("id"),b.push(d)}),this.update_staff_assignments()},a}()